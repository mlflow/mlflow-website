name: Format Release Note
on:
  pull_request:

permissions:
  pull-requests: read

defaults:
  run:
    shell: bash --noprofile --norc -exo pipefail {0}

jobs:
  format:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - uses: actions/checkout@v4
        with:
          # Set fetch-depth to merge the base branch
          fetch-depth: 300
      # - name: Merge base branch
      #   run: |
      #     git config user.name 'mlflow-automation'
      #     git config user.email 'mlflow-automation@users.noreply.github.com'
      #     git remote add base https://github.com/${{ github.event.pull_request.base.repo.full_name }}.git
      #     git fetch base ${{ github.event.pull_request.base.ref }}
      #     git merge base/${{ github.event.pull_request.base.ref }}
      - name: Format
        uses: actions/github-script@v7
        with:
          script: |
            const prNumber = context.payload.pull_request.number;
            const repo = context.repo;
            const { data: files } = await github.rest.pulls.listFiles({
              owner: repo.owner,
              repo: repo.repo,
              pull_number: prNumber,
            });
            const filenames = files.map(file => file.filename);
            core.info(`filenames: ${filenames.join(' ')}`)
            core.info(`files: ${files}`)
            core.info(`${repo.repo}, ${prNumber}, ${repo}`)

            const { formatMarkdown } = require(".github/workflows/format-release-note.js");
            formatMarkdown({ core, filenames })
          