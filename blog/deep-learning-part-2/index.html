<!doctype html><html lang=en dir=ltr class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated=false><head><meta charset=UTF-8><meta name=generator content="Docusaurus v3.9.2"><title data-rh=true>Deep Learning with MLflow (Part 2) | MLflow</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"/><meta data-rh=true name=twitter:card content=summary_large_image /><meta data-rh=true property=og:url content=http://mlflow.org/mlflow-website/blog/deep-learning-part-2 /><meta data-rh=true property=og:locale content=en /><meta data-rh=true name=docusaurus_locale content=en /><meta data-rh=true name=docusaurus_tag content=default /><meta data-rh=true name=docsearch:language content=en /><meta data-rh=true name=docsearch:docusaurus_tag content=default /><meta data-rh=true property=og:title content="Deep Learning with MLflow (Part 2) | MLflow"/><meta data-rh=true name=description content="Using MLflow's Deep Learning tracking features for fine tuning an LLM"/><meta data-rh=true property=og:description content="Using MLflow's Deep Learning tracking features for fine tuning an LLM"/><meta data-rh=true property=og:image content=http://mlflow.org/mlflow-website/img/blog/dl-blog-2.png /><meta data-rh=true name=twitter:image content=http://mlflow.org/mlflow-website/img/blog/dl-blog-2.png /><meta data-rh=true property=og:type content=article /><meta data-rh=true property=article:published_time content=2024-04-26T00:00:00.000Z /><meta data-rh=true property=article:author content=https://www.linkedin.com/in/puneetjain159/,https://www.linkedin.com/in/avi-data-ml/,https://www.linkedin.com/in/abeomor/,https://www.linkedin.com/in/benjamin-wilson-arch/ /><meta data-rh=true property=article:tag content="Deep Learning"/><link data-rh=true rel=icon href=/mlflow-website/img/mlflow-favicon.ico /><link data-rh=true rel=canonical href=http://mlflow.org/mlflow-website/blog/deep-learning-part-2 /><link data-rh=true rel=alternate href=http://mlflow.org/mlflow-website/blog/deep-learning-part-2 hreflang=en /><link data-rh=true rel=alternate href=http://mlflow.org/mlflow-website/blog/deep-learning-part-2 hreflang=x-default /><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@id":"http://mlflow.org/mlflow-website/blog/deep-learning-part-2","@type":"BlogPosting","author":[{"@type":"Person","description":"Sr. Specialist Solutions Architect at Databricks","image":"/mlflow-website/img/authors/puneet.png","name":"Puneet Jain","url":"https://www.linkedin.com/in/puneetjain159/"},{"@type":"Person","description":"Sr. Solutions Architect at Databricks","image":"/mlflow-website/img/authors/avinash.png","name":"Avinash Sooriyarachchi","url":"https://www.linkedin.com/in/avi-data-ml/"},{"@type":"Person","description":"Product Manager, ML at Databricks","image":"/mlflow-website/img/authors/abe.png","name":"Abe Omorogbe","url":"https://www.linkedin.com/in/abeomor/"},{"@type":"Person","description":"Software Engineer at Databricks","image":"/mlflow-website/img/authors/ben.png","name":"Ben Wilson","url":"https://www.linkedin.com/in/benjamin-wilson-arch/"}],"datePublished":"2024-04-26T00:00:00.000Z","description":"Using MLflow's Deep Learning tracking features for fine tuning an LLM","headline":"Deep Learning with MLflow (Part 2)","image":{"@id":"http://mlflow.org/mlflow-website/img/blog/dl-blog-2.png","@type":"ImageObject","caption":"title image for the blog post: Deep Learning with MLflow (Part 2)","contentUrl":"http://mlflow.org/mlflow-website/img/blog/dl-blog-2.png","url":"http://mlflow.org/mlflow-website/img/blog/dl-blog-2.png"},"isPartOf":{"@id":"http://mlflow.org/mlflow-website/blog","@type":"Blog","name":"Blog"},"keywords":[],"mainEntityOfPage":"http://mlflow.org/mlflow-website/blog/deep-learning-part-2","name":"Deep Learning with MLflow (Part 2)","url":"http://mlflow.org/mlflow-website/blog/deep-learning-part-2"}</script><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=AW-16857946923"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","AW-16857946923",{anonymize_ip:!0})</script><link rel=preconnect href=https://www.googletagmanager.com><script>window.dataLayer=window.dataLayer||[],function(e,t,a,n,r){e[n]=e[n]||[],e[n].push({"gtm.start":new Date().getTime(),event:"gtm.js"});var d=t.getElementsByTagName(a)[0],g=t.createElement(a);g.async=!0,g.src="https://www.googletagmanager.com/gtm.js?id="+r+("dataLayer"!=n?"&l="+n:""),d.parentNode.insertBefore(g,d)}(window,document,"script","dataLayer","GTM-N6WMTTJ")</script><link rel=alternate type=application/rss+xml href=/mlflow-website/blog/rss.xml title="MLflow RSS Feed"><link rel=alternate type=application/atom+xml href=/mlflow-website/blog/atom.xml title="MLflow Atom Feed"><link rel=alternate type=application/rss+xml href=/mlflow-website/releases/rss.xml title="MLflow RSS Feed"><link rel=alternate type=application/atom+xml href=/mlflow-website/releases/atom.xml title="MLflow Atom Feed"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin=anonymous><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap" display=swap><link rel=stylesheet href=/mlflow-website/assets/css/styles.d55e5617.css /><script src=/mlflow-website/assets/js/runtime~main.59955d13.js defer></script><script src=/mlflow-website/assets/js/main.e4060ac2.js defer></script></head><body class=navigation-with-keyboard><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N6WMTTJ" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript>


<svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="theme-layout-navbar navbar navbar--fixed-top"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><a class=navbar__brand href=/mlflow-website/></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_Bca1></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="flex flex-col min-h-screen w-full bg-[#0E1416]"><nav class="fixed w-full z-20 top-0 start-0 bg-black/20 border-b border-[#F7F8F8]/8 backdrop-blur-[20px] overflow-y-auto"><div class="flex flex-wrap items-center mx-auto px-6 lg:px-20 py-2 max-w-container"><div class="md:contents flex flex-row justify-between w-full sticky top-[8px]"><a class="flex items-center space-x-3 rtl:space-x-reverse grow basis-0" aria-label="MLflow Home" href=/mlflow-website/><svg xmlns=http://www.w3.org/2000/svg width=109 height=40 fill=none viewBox="0 0 109 40" class=h-[36px] aria-hidden=true><path fill=#fff d="M0 31.032v-15.53h3.543v1.968c.893-1.594 2.84-2.425 4.593-2.425 2.042 0 3.828.926 4.658 2.745 1.216-2.043 3.034-2.745 5.043-2.745 2.81 0 5.49 1.787 5.49 5.904v10.083h-3.574v-9.478c0-1.818-.926-3.19-3-3.19-1.947 0-3.224 1.53-3.224 3.445v9.22H9.893v-9.475c0-1.786-.898-3.18-3.003-3.18-1.977 0-3.223 1.467-3.223 3.444v9.221ZM27.855 31.032V7.929h3.703v23.103ZM30.07 39.487c.833.232 1.582.383 3.17.383 2.953 0 6.436-1.665 7.353-6.339l3.786-18.739h5.629l.687-3.117h-5.686l.765-3.725c.586-2.892 2.186-4.358 4.754-4.358.668 0 .48.058 1.076.17L52.427.57c-.793-.237-1.503-.379-3.049-.379a7.32 7.32 0 0 0-4.528 1.484c-1.441 1.114-2.393 2.75-2.827 4.863l-1.066 5.137h-5.034l-.411 3.12h4.823L36.859 32.12c-.383 1.965-1.5 4.315-4.708 4.315-.727 0-.463-.055-1.121-.162ZM53.342 30.905H49.64l5.074-23.309h3.701ZM71.807 16.477A7.962 7.962 0 0 0 60.97 27.904l2.425-1.78a5.005 5.005 0 0 1 3.845-8.145v1.895ZM62.618 29.472a7.962 7.962 0 0 0 10.836-11.428l-2.425 1.78a5.005 5.005 0 0 1-3.845 8.145v-1.894ZM78.092 15.493h4.044l.823 10.612 5.759-10.612 3.839.055 1.508 10.557 5.074-10.612 3.701.055-7.678 15.493H91.46l-1.783-11.106-5.895 11.106h-3.84ZM105.072 15.768h-.766v-.266h1.845v.272h-.765v2.243h-.314ZM106.614 15.502h.383l.482 1.34q.091.259.178.524h.018c.059-.176.113-.352.172-.524l.478-1.34h.383v2.515h-.298V16.63c0-.22.024-.523.04-.747h-.016l-.191.574-.475 1.304h-.208l-.481-1.302-.191-.574h-.015c.017.224.042.527.042.747v1.387h-.291Z"/></svg></a><div class="flex flex-row items-center gap-6 md:order-2 space-x-3 md:space-x-0 rtl:space-x-reverse grow justify-end basis-0"><a class="hidden md:block" href=/mlflow-website/#get-started><button class="rounded-xl inline-flex items-center justify-center whitespace-nowrap font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 hover:cursor-pointer bg-white text-black hover:bg-gray-900 text-[15px] px-4 py-2 w-fit">Get started</button></a><button data-collapse-toggle=navbar-sticky type=button class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-white md:hidden focus:outline-none cursor-pointer"><span class=sr-only>Open main menu</span><svg class="w-5 h-5" aria-hidden=true xmlns=http://www.w3.org/2000/svg fill=none viewBox="0 0 17 14"><path stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M1 1h15M1 7h15M1 13h15"/></svg></button></div></div><div class="items-center justify-between w-full md:w-auto md:order-1 mt-4 md:mt-0 hidden md:flex"><ul class="flex flex-col font-medium md:flex-row gap-y-6 gap-x-4 lg:gap-x-10 w-full md:w-auto"><li class="w-full md:w-auto md:hidden"><button type=button aria-expanded=false aria-controls=mobile-components-submenu class="flex items-center justify-between gap-2 py-2 text-white text-lg w-full cursor-pointer transition-colors duration-200 hover:text-white/60">Components<svg xmlns=http://www.w3.org/2000/svg width=16 height=17 fill=none viewBox="0 0 16 17" class="w-6 h-6 transition-transform duration-300"><path fill=#F7F8F8 fill-rule=evenodd d="m8 10.776 3.61-3.61-.943-.942L8 8.89 5.333 6.224l-.942.943z" clip-rule=evenodd /></svg></button><div id=mobile-components-submenu class="transition-all duration-300 ease-in-out overflow-hidden max-h-0 opacity-0"><div class="flex flex-col md:flex-row md:max-w-4xl mx-auto gap-6 md:gap-8 lg:gap-10 px-1 md:px-4 lg:pl-0 products-submenu overflow-x-hidden"><div class="flex flex-col gap-4"><div class="flex flex-col gap-1 md:gap-4 border-b border-[#F7F8F8]/8 pb-4 group"><a href=/mlflow-website/genai><h3 class="text-white transition-colors duration-200 group-hover:!text-white/60">GenAI Apps & Agents</h3><p class="text-[#F7F8F8]/60 m-0">Ship high-quality GenAI, fast</p></a></div><div class="flex flex-col gap-3"><span class="text-[#F7F8F8]/60 text-sm">Features</span><div class="flex flex-row gap-6 xxs:gap-8"><div class="min-w-30 xxs:min-w-40 flex flex-col md:gap-1"><a class="flex items-center gap-2 py-2 text-white text-lg w-full md:w-auto cursor-pointer transition-colors duration-200 hover:!text-white/60" href=/mlflow-website/genai/observability>Observability</a><a class="flex items-center gap-2 py-2 text-white text-lg w-full md:w-auto cursor-pointer transition-colors duration-200 hover:!text-white/60" href=/mlflow-website/genai/evaluations>Evaluations</a></div><div class="min-w-30 xxs:min-w-40 flex flex-col md:gap-1"><a class="flex items-center gap-2 py-2 text-white text-lg w-full md:w-auto cursor-pointer transition-colors duration-200 hover:!text-white/60" href=/mlflow-website/genai/prompt-registry>Prompt Registry</a><a class="flex items-center gap-2 py-2 text-white text-lg w-full md:w-auto cursor-pointer transition-colors duration-200 hover:!text-white/60" href=/mlflow-website/genai/ai-gateway>AI Gateway</a></div></div></div></div><div class="flex flex-col gap-4"><div class="flex flex-col gap-1 md:gap-4 border-b border-[#F7F8F8]/8 pb-4 group"><a href=/mlflow-website/classical-ml><h3 class="text-white transition-colors duration-200 group-hover:!text-white/60">Model Training</h3><p class="text-[#F7F8F8]/60 m-0">Mastering the ML lifecycle</p></a></div><div class="flex flex-col gap-3"><span class="text-[#F7F8F8]/60 text-sm">Features</span><div class="flex flex-row gap-6 xxs:gap-8"><div class="min-w-30 xxs:min-w-40 flex flex-col md:gap-1"><a class="flex items-center gap-2 py-2 text-white text-lg w-full md:w-auto cursor-pointer transition-colors duration-200 hover:!text-white/60" href=/mlflow-website/classical-ml/experiment-tracking>Experiment tracking</a><a class="flex items-center gap-2 py-2 text-white text-lg w-full md:w-auto cursor-pointer transition-colors duration-200 hover:!text-white/60" href=/mlflow-website/classical-ml/model-evaluation>Model evaluation</a></div><div class="min-w-30 xxs:min-w-40 flex flex-col md:gap-1"><a class="flex items-center gap-2 py-2 text-white text-lg w-full md:w-auto cursor-pointer transition-colors duration-200 hover:!text-white/60" href=/mlflow-website/classical-ml/models>MLflow models</a><a class="flex items-center gap-2 py-2 text-white text-lg w-full md:w-auto cursor-pointer transition-colors duration-200 hover:!text-white/60" href=/mlflow-website/classical-ml/model-registry>Model Registry & deployment</a></div></div></div></div></div></div><li class="w-full md:w-auto hidden md:block"><a class="flex items-center gap-2 py-2 text-white text-lg w-full md:w-auto cursor-pointer transition-colors duration-200 hover:!text-white/60">Components<svg xmlns=http://www.w3.org/2000/svg width=16 height=17 fill=none viewBox="0 0 16 17" class="w-6 h-6"><path fill=#F7F8F8 fill-rule=evenodd d="m8 10.776 3.61-3.61-.943-.942L8 8.89 5.333 6.224l-.942.943z" clip-rule=evenodd /></svg></a><li class="w-full md:w-auto"><a class="flex items-center gap-2 py-2 text-white text-lg w-full md:w-auto cursor-pointer transition-colors duration-200 hover:!text-white/60" href=/mlflow-website/releases>Releases</a><li class="w-full md:w-auto"><a class="flex items-center gap-2 py-2 text-white text-lg w-full md:w-auto cursor-pointer transition-colors duration-200 hover:!text-white/60" href=/mlflow-website/blog>Blog</a><li class="w-full md:w-auto md:hidden"><button type=button aria-expanded=false aria-controls=mobile-docs-submenu class="flex items-center justify-between gap-2 py-2 text-white text-lg w-full cursor-pointer transition-colors duration-200 hover:text-white/60">Docs<svg xmlns=http://www.w3.org/2000/svg width=16 height=17 fill=none viewBox="0 0 16 17" class="w-6 h-6 transition-transform duration-300"><path fill=#F7F8F8 fill-rule=evenodd d="m8 10.776 3.61-3.61-.943-.942L8 8.89 5.333 6.224l-.942.943z" clip-rule=evenodd /></svg></button><div id=mobile-docs-submenu class="transition-all duration-300 ease-in-out overflow-hidden max-h-0 opacity-0"><div class="flex flex-col md:flex-row md:max-w-2xl mx-auto gap-6 md:gap-8 lg:gap-10 px-1 md:px-4 lg:pl-0 docs-submenu overflow-x-hidden"><div class="flex flex-col gap-1 md:gap-2 pb-4 flex-1 group"><a href=https://mlflow.org/docs/latest/genai/ target=_blank rel="noopener noreferrer"><h3 class="text-white transition-colors duration-200 group-hover:!text-white/60">GenAI Apps & Agents</h3><p class="text-[#F7F8F8]/60 m-0">Learn how to track, evaluate, and optimize your GenAI applications and agent workflows.</p></a></div><div class="flex flex-col gap-1 md:gap-2 pb-4 flex-1 group"><a href=https://mlflow.org/docs/latest/ml/ target=_blank rel="noopener noreferrer"><h3 class="text-white transition-colors duration-200 group-hover:!text-white/60">Model Training</h3><p class="text-[#F7F8F8]/60 m-0">Get started with the core functionality for traditional machine learning workflows, hyperparameter tuning, and model lifecycle management.</p></a></div></div></div><li class="w-full md:w-auto hidden md:block"><a class="flex items-center gap-2 py-2 text-white text-lg w-full md:w-auto cursor-pointer transition-colors duration-200 hover:!text-white/60">Docs<svg xmlns=http://www.w3.org/2000/svg width=16 height=17 fill=none viewBox="0 0 16 17" class="w-6 h-6"><path fill=#F7F8F8 fill-rule=evenodd d="m8 10.776 3.61-3.61-.943-.942L8 8.89 5.333 6.224l-.942.943z" clip-rule=evenodd /></svg></a><li class="w-full md:w-auto"><a class="flex items-center gap-2 py-2 text-white text-lg w-full md:w-auto cursor-pointer transition-colors duration-200 hover:!text-white/60" href=/mlflow-website/ambassadors>Ambassador Program</a><li class="w-full md:w-auto md:hidden"><a href=/mlflow-website/#get-started><button class="rounded-xl inline-flex items-center justify-center whitespace-nowrap font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 hover:cursor-pointer bg-white text-black hover:bg-gray-900 text-[15px] px-4 py-2 w-full">Get started</button></a></ul></div></div><div class="flex-col w-full py-6 hidden"><div class="flex flex-col md:flex-row md:max-w-4xl mx-auto gap-6 md:gap-8 lg:gap-10 px-1 md:px-4 lg:pl-0 products-submenu overflow-x-hidden"><div class="flex flex-col gap-4"><div class="flex flex-col gap-1 md:gap-4 border-b border-[#F7F8F8]/8 pb-4 group"><a href=/mlflow-website/genai><h3 class="text-white transition-colors duration-200 group-hover:!text-white/60">GenAI Apps & Agents</h3><p class="text-[#F7F8F8]/60 m-0">Ship high-quality GenAI, fast</p></a></div><div class="flex flex-col gap-3"><span class="text-[#F7F8F8]/60 text-sm">Features</span><div class="flex flex-row gap-6 xxs:gap-8"><div class="min-w-30 xxs:min-w-40 flex flex-col md:gap-1"><a class="flex items-center gap-2 py-2 text-white text-lg w-full md:w-auto cursor-pointer transition-colors duration-200 hover:!text-white/60" href=/mlflow-website/genai/observability>Observability</a><a class="flex items-center gap-2 py-2 text-white text-lg w-full md:w-auto cursor-pointer transition-colors duration-200 hover:!text-white/60" href=/mlflow-website/genai/evaluations>Evaluations</a></div><div class="min-w-30 xxs:min-w-40 flex flex-col md:gap-1"><a class="flex items-center gap-2 py-2 text-white text-lg w-full md:w-auto cursor-pointer transition-colors duration-200 hover:!text-white/60" href=/mlflow-website/genai/prompt-registry>Prompt Registry</a><a class="flex items-center gap-2 py-2 text-white text-lg w-full md:w-auto cursor-pointer transition-colors duration-200 hover:!text-white/60" href=/mlflow-website/genai/ai-gateway>AI Gateway</a></div></div></div></div><div class="flex flex-col gap-4"><div class="flex flex-col gap-1 md:gap-4 border-b border-[#F7F8F8]/8 pb-4 group"><a href=/mlflow-website/classical-ml><h3 class="text-white transition-colors duration-200 group-hover:!text-white/60">Model Training</h3><p class="text-[#F7F8F8]/60 m-0">Mastering the ML lifecycle</p></a></div><div class="flex flex-col gap-3"><span class="text-[#F7F8F8]/60 text-sm">Features</span><div class="flex flex-row gap-6 xxs:gap-8"><div class="min-w-30 xxs:min-w-40 flex flex-col md:gap-1"><a class="flex items-center gap-2 py-2 text-white text-lg w-full md:w-auto cursor-pointer transition-colors duration-200 hover:!text-white/60" href=/mlflow-website/classical-ml/experiment-tracking>Experiment tracking</a><a class="flex items-center gap-2 py-2 text-white text-lg w-full md:w-auto cursor-pointer transition-colors duration-200 hover:!text-white/60" href=/mlflow-website/classical-ml/model-evaluation>Model evaluation</a></div><div class="min-w-30 xxs:min-w-40 flex flex-col md:gap-1"><a class="flex items-center gap-2 py-2 text-white text-lg w-full md:w-auto cursor-pointer transition-colors duration-200 hover:!text-white/60" href=/mlflow-website/classical-ml/models>MLflow models</a><a class="flex items-center gap-2 py-2 text-white text-lg w-full md:w-auto cursor-pointer transition-colors duration-200 hover:!text-white/60" href=/mlflow-website/classical-ml/model-registry>Model Registry & deployment</a></div></div></div></div></div></div><div class="flex-col w-full py-6 hidden"><div class="flex flex-col md:flex-row md:max-w-2xl mx-auto gap-6 md:gap-8 lg:gap-10 px-1 md:px-4 lg:pl-0 docs-submenu overflow-x-hidden"><div class="flex flex-col gap-1 md:gap-2 pb-4 flex-1 group"><a href=https://mlflow.org/docs/latest/genai/ target=_blank rel="noopener noreferrer"><h3 class="text-white transition-colors duration-200 group-hover:!text-white/60">GenAI Apps & Agents</h3><p class="text-[#F7F8F8]/60 m-0">Learn how to track, evaluate, and optimize your GenAI applications and agent workflows.</p></a></div><div class="flex flex-col gap-1 md:gap-2 pb-4 flex-1 group"><a href=https://mlflow.org/docs/latest/ml/ target=_blank rel="noopener noreferrer"><h3 class="text-white transition-colors duration-200 group-hover:!text-white/60">Model Training</h3><p class="text-[#F7F8F8]/60 m-0">Get started with the core functionality for traditional machine learning workflows, hyperparameter tuning, and model lifecycle management.</p></a></div></div></div></nav><main class="flex flex-col"><div class="relative flex flex-col gap-20 bg-no-repeat w-full py-32"><div style="position:absolute;width:100%;top:0;pointer-events:none;mask-composite:intersect;height:820px;background-image:repeating-linear-gradient(
        to right,
        rgba(0, 0, 0, 0.05),
        rgba(0, 0, 0, 0.25) 24px,
        transparent 2px,
        transparent 10px
      ),
      radial-gradient(
        circle at top center,
        var(--color-brand-red) 0%,
        transparent 60%
      ),
      linear-gradient(to right, color-mix(in srgb, var(--color-brand-red), oklch(0.33 0.15 328.37) 80%), color-mix(in srgb, var(--color-brand-red), oklch(0.66 0.17 248.82) 100%));mask-image:linear-gradient(to bottom, black 40%, transparent 90%)"></div><div class=z-1><div class="flex flex-col gap-24 w-full px-6 md:px-20 max-w-container"><div class="flex flex-col max-w-7xl mx-auto w-full"><article class=""><header><h1 class=title_f1Hy>Deep Learning with MLflow (Part 2)</h1><div class="container_mt6G margin-vert--md"><time datetime=2024-04-26T00:00:00.000Z>April 26, 2024</time> · <!-- -->13 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href=https://www.linkedin.com/in/puneetjain159/ target=_blank rel="noopener noreferrer" class=avatar__photo-link><img class="avatar__photo authorImage_XqGP" src=/mlflow-website/img/authors/puneet.png alt="Puneet Jain"/></a><div class="avatar__intro authorDetails_lV9A"><div class=avatar__name><a href=https://www.linkedin.com/in/puneetjain159/ target=_blank rel="noopener noreferrer"><span class=authorName_yefp translate=no>Puneet Jain</span></a></div><small class=authorTitle_nd0D title="Sr. Specialist Solutions Architect at Databricks">Sr. Specialist Solutions Architect at Databricks</small><div class=authorSocials_rSDt></div></div></div></div><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href=https://www.linkedin.com/in/avi-data-ml/ target=_blank rel="noopener noreferrer" class=avatar__photo-link><img class="avatar__photo authorImage_XqGP" src=/mlflow-website/img/authors/avinash.png alt="Avinash Sooriyarachchi"/></a><div class="avatar__intro authorDetails_lV9A"><div class=avatar__name><a href=https://www.linkedin.com/in/avi-data-ml/ target=_blank rel="noopener noreferrer"><span class=authorName_yefp translate=no>Avinash Sooriyarachchi</span></a></div><small class=authorTitle_nd0D title="Sr. Solutions Architect at Databricks">Sr. Solutions Architect at Databricks</small><div class=authorSocials_rSDt></div></div></div></div><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href=https://www.linkedin.com/in/abeomor/ target=_blank rel="noopener noreferrer" class=avatar__photo-link><img class="avatar__photo authorImage_XqGP" src=/mlflow-website/img/authors/abe.png alt="Abe Omorogbe"/></a><div class="avatar__intro authorDetails_lV9A"><div class=avatar__name><a href=https://www.linkedin.com/in/abeomor/ target=_blank rel="noopener noreferrer"><span class=authorName_yefp translate=no>Abe Omorogbe</span></a></div><small class=authorTitle_nd0D title="Product Manager, ML at Databricks">Product Manager, ML at Databricks</small><div class=authorSocials_rSDt></div></div></div></div><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href=https://www.linkedin.com/in/benjamin-wilson-arch/ target=_blank rel="noopener noreferrer" class=avatar__photo-link><img class="avatar__photo authorImage_XqGP" src=/mlflow-website/img/authors/ben.png alt="Ben Wilson"/></a><div class="avatar__intro authorDetails_lV9A"><div class=avatar__name><a href=https://www.linkedin.com/in/benjamin-wilson-arch/ target=_blank rel="noopener noreferrer"><span class=authorName_yefp translate=no>Ben Wilson</span></a></div><small class=authorTitle_nd0D title="Software Engineer at Databricks">Software Engineer at Databricks</small><div class=authorSocials_rSDt></div></div></div></div></div></header><div id=__blog-post-container class=markdown><p>In the realm of deep learning, finetuning of pre-trained Large Language Models (LLMs) on private datasets is an excellent customization
option to increase a model’s relevancy for a specific task. This practice is not only common, but also essential for developing specialized
models, particularly for tasks like text classification and summarization.</p>
<p>In such scenarios, tools like MLflow are invaluable. Tracking tools like MLflow help to ensure that every aspect of the training
process - metrics, parameters, and artifacts - are reproducibly tracked and logged, allowing for the analysis, comparison, and sharing of tuning iterations.</p>
<p>In this blog post, we are going to be using <a href=https://mlflow.org/releases/2.12.1 target=_blank rel="noopener noreferrer" class="">MLflow 2.12</a> and the
<a href=https://mlflow.org/blog/deep-learning-part-1 target=_blank rel="noopener noreferrer" class="">recently introduced MLflow Deep Learning features</a> to track all the important aspects of fine
tuning a large language model for text classification, including the use of automated logging of training checkpoints in order to simplify
the process of resumption of training.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=use-case-fine-tuning-a-transformer-model-for-text-classification>Use Case: Fine Tuning a Transformer Model for Text Classification<a href=#use-case-fine-tuning-a-transformer-model-for-text-classification class=hash-link aria-label="Direct link to Use Case: Fine Tuning a Transformer Model for Text Classification" title="Direct link to Use Case: Fine Tuning a Transformer Model for Text Classification" translate=no>​</a></h2>
<p>The example scenario that we're using within this blog utilizes the <a href=https://huggingface.co/datasets/coastalcph/lex_glue/viewer/unfair_tos target=_blank rel="noopener noreferrer" class="">unfair-TOS</a> dataset.</p>
<p>In today’s world, it’s hard to find a service, platform, or even a consumer good that doesn’t have a legally-binding terms of service connected
with it. These encyclopedic size agreements, filled with dense legal jargon and sometimes baffling levels of specificity, are so large that
most people simply accept them without reading them. However, reports have indicated over time that occasionally, some suspiciously unfair
terms are embedded within them.</p>
<p>Addressing unfair clauses in Terms of Service (TOS) agreements through machine learning (ML) is particularly relevant due to the pressing
need for transparency and fairness in legal agreements that affect consumers. Consider the following clause from an example TOS
agreement: <strong>"We may revise these Terms from time to time. The changes will not be retroactive, and the most current version of the Terms, which will always..."</strong>
This clause stipulates that the service provider may suspend or terminate the service at any time for any reason,
with or without notice. Most people would consider this to be quite unfair.</p>
<p>While this sentence is buried quite deeply within a fairly dense document, an ML algorithm is not burdened by the exhaustion that a human
would have for combing through the text and identifying clauses that might seem a bit unfair. By automatically identifying potentially
unfair clauses, a transformers-based Deep Learning (DL) model can help protect consumers from exploitative practices, ensure greater compliance with legal standards,
and foster trust between service providers and users.</p>
<p>A base pre-trained transformer model, without specialized fine-tuning, faces several challenges in accurately identifying unfair Terms of Service clauses.
Firstly, it lacks the domain-specific knowledge essential for understanding complex legal language. Secondly, its training objectives are
too general to capture the nuanced interpretation required for legal analysis. Lastly, it may not effectively recognize the subtle
contextual meanings that determine the fairness of contractual terms, making it less effective for this specialized task.</p>
<p>Using prompt engineering to address the identification of unfair Terms of Service clauses with a closed-source Large language model
can be prohibitively expensive. This approach requires extensive trial and error to refine prompts without the ability to tweak
the underlying model mechanics. Each iteration can consume significant computational resources , especially when using
<a href=https://www.promptingguide.ai/techniques/fewshot target=_blank rel="noopener noreferrer" class="">few-shot prompting</a>, leading to escalating costs without guaranteeing a corresponding
increase in accuracy or effectiveness.</p>
<p>In this context, the use of the <strong>RoBERTa-base</strong> model is particularly effective, provided that it is fine-tuned. This model is robust
enough to handle complex tasks like discerning embedded instructions within texts, yet it is sufficiently compact to be fine-tuned
on modest hardware, such as an Nvidia T4 GPU.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=what-is-peft>What is PEFT?<a href=#what-is-peft class=hash-link aria-label="Direct link to What is PEFT?" title="Direct link to What is PEFT?" translate=no>​</a></h3>
<p><a href=https://huggingface.co/docs/peft/en/index target=_blank rel="noopener noreferrer" class="">Parameter-Efficient Fine-Tuning (PEFT)</a> approaches are advantageous as they involve
keeping the bulk of the pre-trained model parameters fixed while either only training a few additional layers or modifying the parameters used
when interacting with the model's weights. This methodology not only conserves memory during training, but also significantly reduces the overall training time. When
compared with the alternative of fine-tuning a base model's weights in order to customize its performance for a specific targeted task, the PEFT
approach can save significant cost in both time and money, while providing an equivalent or better performance results with less data than is required
for a comprehensive fine-tuning training task.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=integrating-hugging-face-models-and-the-pytorch-lightning-framework>Integrating Hugging-Face models and the PyTorch Lightning framework<a href=#integrating-hugging-face-models-and-the-pytorch-lightning-framework class=hash-link aria-label="Direct link to Integrating Hugging-Face models and the PyTorch Lightning framework" title="Direct link to Integrating Hugging-Face models and the PyTorch Lightning framework" translate=no>​</a></h2>
<p><a href=https://lightning.ai/docs/pytorch/stable/ target=_blank rel="noopener noreferrer" class="">PyTorch Lightning</a> integrates seamlessly with
<a href=https://huggingface.co/docs/transformers/en/index target=_blank rel="noopener noreferrer" class="">Hugging Face's Transformers library</a>, enabling streamlined model training workflows
that capitalize on Lightning's easy-to-use Higher level API’s and HF's state-of-the-art pre-trained models. The combination of Lightning with transformers’
<a href=https://huggingface.co/blog/peft target=_blank rel="noopener noreferrer" class="">PEFT module</a> enhances productivity and scalability by reducing code complexity and enabling the use of
high-quality pre-optimized models for a range of diverse NLP tasks.</p>
<p>Below is an example of configuring the PEFT-based fine tuning of a base model using PyTorch Lightning and HuggingFace's <code>peft</code> module.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#9CDCFE;--prism-background-color:#1E1E1E><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#9CDCFE;background-color:#1E1E1E><code class=codeBlockLines_e6Vv><span class=token-line style=color:#9CDCFE><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> typing </span><span class="token keyword" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> List</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> lightning </span><span class="token keyword" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> LightningModule</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> peft </span><span class="token keyword" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> get_peft_model</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> LoraConfig</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> TaskType</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> transformers </span><span class="token keyword" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> AutoModelForSequenceClassification</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">TransformerModule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">LightningModule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">__init__</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        pretrained_model</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">str</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        num_classes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        lora_alpha</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">32</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        lora_dropout</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">float</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0.1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        r</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">8</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        lr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">float</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2e-4</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        </span><span class="token builtin" style="color:rgb(86, 156, 214)">super</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">model </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">create_model</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">pretrained_model</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> num_classes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> lora_alpha</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> lora_dropout</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">lr </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> lr</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">save_hyperparameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">"pretrained_model"</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">create_model</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pretrained_model</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> num_classes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> lora_alpha</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> lora_dropout</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(206, 145, 120)">"""Create and return the PEFT model with the given configuration.</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token triple-quoted-string string" style="display:inline-block;color:rgb(206, 145, 120)"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token triple-quoted-string string" style="color:rgb(206, 145, 120)">        Args:</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token triple-quoted-string string" style="color:rgb(206, 145, 120)">            pretrained_model: The path or identifier for the pretrained model.</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token triple-quoted-string string" style="color:rgb(206, 145, 120)">            num_classes: The number of classes for the sequence classification.</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token triple-quoted-string string" style="color:rgb(206, 145, 120)">            lora_alpha: The alpha parameter for LoRA.</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token triple-quoted-string string" style="color:rgb(206, 145, 120)">            lora_dropout: The dropout rate for LoRA.</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token triple-quoted-string string" style="color:rgb(206, 145, 120)">            r: The rank of LoRA adaptations.</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token triple-quoted-string string" style="display:inline-block;color:rgb(206, 145, 120)"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token triple-quoted-string string" style="color:rgb(206, 145, 120)">        Returns:</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token triple-quoted-string string" style="color:rgb(206, 145, 120)">            Model: A model configured with PEFT.</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token triple-quoted-string string" style="color:rgb(206, 145, 120)">        """</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        model </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> AutoModelForSequenceClassification</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">from_pretrained</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">            pretrained_model_name_or_path</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">pretrained_model</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">            num_labels</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">num_classes</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        peft_config </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> LoraConfig</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">            task_type</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">TaskType</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">SEQ_CLS</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">            inference_mode</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token boolean">False</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">            r</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">            lora_alpha</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">lora_alpha</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">            lora_dropout</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">lora_dropout</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> get_peft_model</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">model</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> peft_config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">forward</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> input_ids</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> List</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token builtin" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> attention_mask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> List</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token builtin" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> label</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> List</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token builtin" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(206, 145, 120)">"""Calculate the loss by passing inputs to the model and comparing against ground truth labels.</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token triple-quoted-string string" style="display:inline-block;color:rgb(206, 145, 120)"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token triple-quoted-string string" style="color:rgb(206, 145, 120)">        Args:</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token triple-quoted-string string" style="color:rgb(206, 145, 120)">            input_ids: List of token indices to be fed to the model.</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token triple-quoted-string string" style="color:rgb(206, 145, 120)">            attention_mask: List to indicate to the model which tokens should be attended to, and which should not.</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token triple-quoted-string string" style="color:rgb(206, 145, 120)">            label: List of ground truth labels associated with the input data.</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token triple-quoted-string string" style="display:inline-block;color:rgb(206, 145, 120)"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token triple-quoted-string string" style="color:rgb(206, 145, 120)">        Returns:</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token triple-quoted-string string" style="color:rgb(206, 145, 120)">            torch.Tensor: The computed loss from the model as a tensor.</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token triple-quoted-string string" style="color:rgb(206, 145, 120)">        """</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">model</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">            input_ids</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">input_ids</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">            attention_mask</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">attention_mask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">            labels</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">label</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br/></span></code></pre></div></div>
<p>Additional references for the full implementation can be <a href=https://github.com/puneet-jain159/deeplearning_with_mlfow/blob/master/custom_module/fine_tune_clsify_head.py target=_blank rel="noopener noreferrer" class="">seen within the companion repository here</a></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=configuring-mlflow-for-peft-based-fine-tuning>Configuring MLflow for PEFT-based fine-tuning<a href=#configuring-mlflow-for-peft-based-fine-tuning class=hash-link aria-label="Direct link to Configuring MLflow for PEFT-based fine-tuning" title="Direct link to Configuring MLflow for PEFT-based fine-tuning" translate=no>​</a></h2>
<p>Before initiating the training process, it's crucial to configure MLFlow so that all system metrics, loss metrics, and parameters are logged for the training run.
As of MLFlow 2.12, auto-logging for TensorFlow and PyTorch now includes support for checkpointing model weights during training, giving a snapshot of the model
weights at defined epoch frequencies in order to provide for training resumption in the case of an error or loss of the compute environment.
Below is an example of how to enable this feature:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#9CDCFE;--prism-background-color:#1E1E1E><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#9CDCFE;background-color:#1E1E1E><code class=codeBlockLines_e6Vv><span class=token-line style=color:#9CDCFE><span class="token keyword" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> mlflow</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">mlflow</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">enable_system_metrics_logging</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">mlflow</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">pytorch</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">autolog</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">checkpoint_save_best_only </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token boolean">False</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> checkpoint_save_freq</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">'epoch'</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br/></span></code></pre></div></div>
<p>In the code above we are doing the following:</p>
<ul>
<li class=""><strong>Enabling System Metrics Logging</strong>: The system resources will be logged to MLflow in order to understand where bottlenecks in memory, CPU, GPU, disk usage, and network traffic are throughout the training process.</li>
</ul>
<p><img decoding=async loading=lazy alt="MLflow UI System Metrics" src=/mlflow-website/assets/images/sys_metrics-9423a86b67b9aeeac27ee5aea7be01e2.png width=1600 height=866 class=img_ev3q /></p>
<ul>
<li class=""><strong>Configuring Auto Logging to log parameters, metrics and checkpoints for all epochs</strong>: Deep learning involves experimenting with various model architectures and hyperparameter settings. Auto logging plays a crucial role in systematically recording these experiments, making it easier to compare different runs and determine which configurations yield the best results. Checkpoints are logged at every epoch, enabling detailed evaluations of all intermediate epochs during the initial exploration phase of the project. However, it is generally not advisable to log all epochs during late-stage development to avoid excessive data writes and latency in the final training stages.</li>
</ul>
<p><img decoding=async loading=lazy alt="System Metrics Logged" src=/mlflow-website/assets/images/epoch_logging-c21dd79a1004d20b4804923690472a18.png width=1600 height=864 class=img_ev3q /></p>
<p>The auto-logged checkpoint metrics and model artifacts will be viewable in the MLflow UI as the model trains, as shown below:</p>
<p><img decoding=async loading=lazy alt="Metrics logged with each epoch" src=/mlflow-website/assets/images/checkpoint_metrics-ad7d10db8f81555e3ab4d04c8fb63240.png width=1600 height=731 class=img_ev3q /></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=the-importance-of-logging-and-early-stopping>The Importance of Logging and Early-stopping<a href=#the-importance-of-logging-and-early-stopping class=hash-link aria-label="Direct link to The Importance of Logging and Early-stopping" title="Direct link to The Importance of Logging and Early-stopping" translate=no>​</a></h2>
<p>The integration of the Pytorch Lightning <code>Trainer</code> callback with MLflow is crucial within this training exercise. The integration allows for comprehensive
tracking and logging of metrics, parameters, and artifacts during model finetuning without having to explicitly call MLflow logging APIs. Additionally,
the autologging API allows for modifying the default logging behavior, permitting changes to the logging frequency, allowing for logging to occur at each
epoch, after a specified number of epochs, or at explicitly defined steps.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=early-stopping>Early stopping<a href=#early-stopping class=hash-link aria-label="Direct link to Early stopping" title="Direct link to Early stopping" translate=no>​</a></h3>
<p>Early stopping is a critical regularization technique in neural network training, designed to assist in preventing overfitting through the act of
halting training when validation performance plateaus. Pytorch Lightning includes APIs that allow for an easy high-level control of training cessation,
as demonstrated below.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=configuring-pytorch-trainer-callback-with-early-stopping>Configuring Pytorch Trainer Callback with Early stopping<a href=#configuring-pytorch-trainer-callback-with-early-stopping class=hash-link aria-label="Direct link to Configuring Pytorch Trainer Callback with Early stopping" title="Direct link to Configuring Pytorch Trainer Callback with Early stopping" translate=no>​</a></h3>
<p>The example below shows the configuration of the <code>Trainer</code> object within <code>Lightning</code> to leverage early stopping to prevent overfitting. Once configured, the
training is executed by calling <code>fit</code> on the <code>Trainer</code> object. By providing the <code>EarlyStopping</code> callback, in conjunction with MLflow's autologging, the
appropriate number of epochs will be used, logged, and tracked without any additional effort.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#9CDCFE;--prism-background-color:#1E1E1E><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#9CDCFE;background-color:#1E1E1E><code class=codeBlockLines_e6Vv><span class=token-line style=color:#9CDCFE><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> dataclasses </span><span class="token keyword" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> dataclass</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> field</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> os</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> data </span><span class="token keyword" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> LexGlueDataModule</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> lightning </span><span class="token keyword" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> Trainer</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> lightning</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">pytorch</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">callbacks </span><span class="token keyword" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> EarlyStopping</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> mlflow</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:rgb(212, 212, 212)">@dataclass</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">TrainConfig</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">    pretrained_model</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">str</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"bert-base-uncased"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">    num_classes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">    lr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">float</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2e-4</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">    max_length</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">128</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">    batch_size</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">256</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">    num_workers</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">cpu_count</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">    max_epochs</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">    debug_mode_sample</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">    max_time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">dict</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token builtin" style="color:rgb(86, 156, 214)">str</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">float</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> field</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">default_factory</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token keyword" style="color:rgb(86, 156, 214)">lambda</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token string" style="color:rgb(206, 145, 120)">"hours"</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">    model_checkpoint_dir</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">str</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"/local_disk0/tmp/model-checkpoints"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">    min_delta</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">float</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0.005</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">    patience</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">train_config </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> TrainConfig</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Instantiate the custom Transformer class for PEFT training</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">nlp_model </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> TransformerModule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        pretrained_model</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">train_config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">pretrained_model</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        num_classes</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">train_config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">num_classes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        lr</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">train_config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">lr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">datamodule </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> LexGlueDataModule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        pretrained_model</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">train_config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">pretrained_model</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        max_length</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">train_config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">max_length</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        batch_size</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">train_config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">batch_size</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        num_workers</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">train_config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">num_workers</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        debug_mode_sample</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">train_config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">debug_mode_sample</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Log system metrics while training loop is running</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">mlflow</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">enable_system_metrics_logging</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Automatically log per-epoch parameters, metrics, and checkpoint weights</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">mlflow</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">pytorch</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">autolog</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">checkpoint_save_best_only </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token boolean">False</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Define the Trainer configuration</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">trainer </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> Trainer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">   callbacks</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">       EarlyStopping</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">           monitor</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">"Val_F1_Score"</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">           min_delta</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">train_config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">min_delta</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">           patience</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">train_config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">patience</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">           verbose</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">           mode</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">"max"</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">       </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">   default_root_dir</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">train_config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">model_checkpoint_dir</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">   fast_dev_run</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token builtin" style="color:rgb(86, 156, 214)">bool</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">train_config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">debug_mode_sample</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">   max_epochs</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">train_config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">max_epochs</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">   max_time</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">train_config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">max_time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">   precision</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">"32-true"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Execute the training run</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">trainer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">model</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">nlp_model</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> datamodule</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">datamodule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=visualization-and-sharing-capabilities-within-mlflow>Visualization and Sharing Capabilities within MLflow<a href=#visualization-and-sharing-capabilities-within-mlflow class=hash-link aria-label="Direct link to Visualization and Sharing Capabilities within MLflow" title="Direct link to Visualization and Sharing Capabilities within MLflow" translate=no>​</a></h2>
<p>The newly introduced DL-specific visualization capabilities introduced in MLflow 2.12 enable you to make comparisons between different runs and artifacts over epochs.
When comparing training runs, MLflow is capable of generating useful visualization that can be integrated into dashboards, facilitating
easy sharing. Additionally, the centralized storage of metrics, in conjunction with parameters, allows for effective analysis of the training
efficacy, as shown in the image below.</p>
<p><img decoding=async loading=lazy alt="Epoch Run Compare" src=/mlflow-website/assets/images/compare-ea0bead7c1244ca8868d1f039c791ac4.png width=1600 height=820 class=img_ev3q /></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=when-to-stop-training>When to stop training?<a href=#when-to-stop-training class=hash-link aria-label="Direct link to When to stop training?" title="Direct link to When to stop training?" translate=no>​</a></h2>
<p>When training DL models, it is important to understand when to stop. Efficient training (for minimizing the overall cost incurred for
conducting training) and optimal model performance rely heavily on preventing a model from overfitting on the training data. A model
that trains for too long will invariably become quite good at effectively ‘memorizing’ the training data, resulting in a reduction in
the performance of the model when presented with novel data. A straightforward way to evaluate this behavior is to ensure that
validation data set metrics (scoring loss metrics on data that is not in the training data set) are captured during the training
loop. Integrating the MLflow callback into the PyTorch Lightning Trainer allows for iterative logging of loss metrics at
configurable iterations, enabling an easily debuggable evaluation of the training performance, ensuring that stopping criteria
can be enforced at the appropriate time to prevent overfitting.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=evaluating-epoch-checkpoints-of-fine-tuned-models-with-mlflow>Evaluating epoch checkpoints of Fine Tuned Models with MLflow<a href=#evaluating-epoch-checkpoints-of-fine-tuned-models-with-mlflow class=hash-link aria-label="Direct link to Evaluating epoch checkpoints of Fine Tuned Models with MLflow" title="Direct link to Evaluating epoch checkpoints of Fine Tuned Models with MLflow" translate=no>​</a></h3>
<p>With your training process meticulously tracked and logged by MLflow, you have the flexibility to retrieve and test your model at
any arbitrary checkpoint. To do this, you can use the mlflow.pytorch.load_model() API to load the model from a specific run
and use the <code>predict()</code> method for evaluation.</p>
<p>In the example below, we will load the model checkpoint from the 3rd epoch and use the <code>Lightning</code> train module to generate predictions based on the
checkpoint state of the saved training epoch.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#9CDCFE;--prism-background-color:#1E1E1E><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#9CDCFE;background-color:#1E1E1E><code class=codeBlockLines_e6Vv><span class=token-line style=color:#9CDCFE><span class="token keyword" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> mlflow</span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">mlflow</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">pytorch</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">autolog</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">disable </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">run_id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">'&lt;Add the run ID>'</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">model </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">pytorch</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">load_checkpoint</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">TransformerModule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> run_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">examples_to_test </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">"We reserve the right to modify the service price at any time and retroactively apply the adjusted price to historical service usage."</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">train_module </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> Trainer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">tokenizer </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> AutoTokenizer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">from_pretrained</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">train_config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">pretrained_model</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">tokens </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> tokenizer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">examples_to_test</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">                  max_length</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">train_config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">max_length</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">                  padding</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">"max_length"</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">                  truncation</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">ds </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> Dataset</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">from_dict</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token builtin" style="color:rgb(86, 156, 214)">dict</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">tokens</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">ds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">set_format</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">            </span><span class="token builtin" style="color:rgb(86, 156, 214)">type</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">"torch"</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> columns</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">"input_ids"</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"attention_mask"</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#9CDCFE><span class="token plain">train_module</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">model</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> dataloaders </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> DataLoader</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">ds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=summary>Summary<a href=#summary class=hash-link aria-label="Direct link to Summary" title="Direct link to Summary" translate=no>​</a></h2>
<p>The integration of MLflow into the finetuning process of pre-trained language models, particularly for applications like custom
named entity recognition, text classification and instruction-following represents a significant advancement in managing and
optimizing deep learning workflows. Leveraging the autologging and tracking capabilities of MLflow in these workstreams not only
enhances the reproducibility and efficiency of model development, but also fosters a collaborative environment where insights
and improvements can be easily shared and implemented.</p>
<p>As we continue to push the boundaries of what these models can achieve, tools like MLflow will be instrumental in harnessing their full potential.</p>
<p>If you're interested in seeing the full example in its entirety, feel free to <a href=https://github.com/puneet-jain159/deeplearning_with_mlfow target=_blank rel="noopener noreferrer" class="">see the full example implementation</a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=check-out-the-code>Check out the code<a href=#check-out-the-code class=hash-link aria-label="Direct link to Check out the code" title="Direct link to Check out the code" translate=no>​</a></h3>
<p>The code we provide will delve into additional aspects such as training from a checkpoint, integrating MLflow and TensorBoard, and utilizing Pyfunc for model wrapping, among others. These resources are specifically tailored for implementation on <a href=https://mlflow.org/blog/databricks-ce target=_blank rel="noopener noreferrer" class="">Databricks Community Edition</a>. The main runner notebook
within the full example repository <a href=https://github.com/puneet-jain159/deeplearning_with_mlfow/blob/master/train.ipynb target=_blank rel="noopener noreferrer" class="">can be found here</a>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=get-started-with-mlflow-212-today>Get Started with MLflow 2.12 Today<a href=#get-started-with-mlflow-212-today class=hash-link aria-label="Direct link to Get Started with MLflow 2.12 Today" title="Direct link to Get Started with MLflow 2.12 Today" translate=no>​</a></h2>
<p>Dive into the latest MLflow updates today and enhance the way you manage your machine learning projects! With our newest enhancements,
including advanced metric aggregation, automatic capturing of system metrics, intuitive feature grouping, and streamlined search capabilities,
MLflow is here to elevate your ML workflow to new heights. <a href=https://mlflow.org/releases/2.12.1 target=_blank rel="noopener noreferrer" class="">Get started now with MLflow's cutting-edge tools and features</a>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=feedback>Feedback<a href=#feedback class=hash-link aria-label="Direct link to Feedback" title="Direct link to Feedback" translate=no>​</a></h2>
<p>We value your input! Our feature prioritization is guided by feedback from the MLflow late 2023 survey. Please fill out our
<a href=https://surveys.training.databricks.com/jfe/form/SV_3jGIliwGC0g5xTU target=_blank rel="noopener noreferrer" class="">Spring 2024 survey</a>, and by participating, you can help ensure that the features
you want most are implemented in MLflow.</div><footer class=docusaurus-mt-lg><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class=col><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/mlflow-website/blog/tags/deep-learning>Deep Learning</a></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href=/mlflow-website/blog/mlflow-tracing><div class=pagination-nav__sublabel>Newer post</div><div class=pagination-nav__label>Introducing MLflow Tracing</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/mlflow-website/blog/release-candidates><div class=pagination-nav__sublabel>Older post</div><div class=pagination-nav__label>MLflow Release Candidates</div></a></nav></div></div></div></div></main><footer class="relative pb-30 flex flex-col pt-30"><div style="position:absolute;width:100%;bottom:0;pointer-events:none;mask-composite:intersect;height:360px;background-image:repeating-linear-gradient(
        to right,
        rgba(0, 0, 0, 0.05),
        rgba(0, 0, 0, 0.25) 18px,
        transparent 2px,
        transparent 10px
      ),
      radial-gradient(
        circle at bottom center,
        var(--color-brand-red) 0%,
        transparent 60%
      ),
      linear-gradient(to right, color-mix(in srgb, var(--color-brand-red), oklch(0.33 0.15 328.37) 80%), color-mix(in srgb, var(--color-brand-red), oklch(0.66 0.17 248.82) 100%));mask-image:radial-gradient(ellipse at center bottom, black 60%, transparent 80%),
      linear-gradient(to top, black 10%, transparent 40%)"></div><div class=z-1><div class="flex flex-row justify-between items-start px-6 lg:px-20 gap-10 xs:gap-0 max-w-container"><div class="flex flex-col gap-8"><svg xmlns=http://www.w3.org/2000/svg width=109 height=40 fill=none viewBox="0 0 109 40" class="h-[36px] shrink-0"><path fill=#fff d="M0 31.032v-15.53h3.543v1.968c.893-1.594 2.84-2.425 4.593-2.425 2.042 0 3.828.926 4.658 2.745 1.216-2.043 3.034-2.745 5.043-2.745 2.81 0 5.49 1.787 5.49 5.904v10.083h-3.574v-9.478c0-1.818-.926-3.19-3-3.19-1.947 0-3.224 1.53-3.224 3.445v9.22H9.893v-9.475c0-1.786-.898-3.18-3.003-3.18-1.977 0-3.223 1.467-3.223 3.444v9.221ZM27.855 31.032V7.929h3.703v23.103ZM30.07 39.487c.833.232 1.582.383 3.17.383 2.953 0 6.436-1.665 7.353-6.339l3.786-18.739h5.629l.687-3.117h-5.686l.765-3.725c.586-2.892 2.186-4.358 4.754-4.358.668 0 .48.058 1.076.17L52.427.57c-.793-.237-1.503-.379-3.049-.379a7.32 7.32 0 0 0-4.528 1.484c-1.441 1.114-2.393 2.75-2.827 4.863l-1.066 5.137h-5.034l-.411 3.12h4.823L36.859 32.12c-.383 1.965-1.5 4.315-4.708 4.315-.727 0-.463-.055-1.121-.162ZM53.342 30.905H49.64l5.074-23.309h3.701ZM71.807 16.477A7.962 7.962 0 0 0 60.97 27.904l2.425-1.78a5.005 5.005 0 0 1 3.845-8.145v1.895ZM62.618 29.472a7.962 7.962 0 0 0 10.836-11.428l-2.425 1.78a5.005 5.005 0 0 1-3.845 8.145v-1.894ZM78.092 15.493h4.044l.823 10.612 5.759-10.612 3.839.055 1.508 10.557 5.074-10.612 3.701.055-7.678 15.493H91.46l-1.783-11.106-5.895 11.106h-3.84ZM105.072 15.768h-.766v-.266h1.845v.272h-.765v2.243h-.314ZM106.614 15.502h.383l.482 1.34q.091.259.178.524h.018c.059-.176.113-.352.172-.524l.478-1.34h.383v2.515h-.298V16.63c0-.22.024-.523.04-.747h-.016l-.191.574-.475 1.304h-.208l-.481-1.302-.191-.574h-.015c.017.224.042.527.042.747v1.387h-.291Z"/></svg><div class="text-xs text-gray-800 text-left md:text-nowrap md:w-0">© 2025 MLflow Project, a Series of LF Projects, LLC.</div></div><div class="flex flex-col flex-wrap justify-end md:text-right md:flex-row gap-x-10 lg:gap-x-20 gap-y-5 w-2/5 md:w-auto md:pt-2 max-w-fit"><div><a href=/mlflow-website/>Components</a></div><div><a href=/mlflow-website/releases>Releases</a></div><div><a href=/mlflow-website/blog>Blog</a></div><div><a href=https://mlflow.org/docs/latest/ target=_blank rel="noopener noreferrer">Docs</a></div><div><a href=/mlflow-website/ambassadors>Ambassador Program</a></div></div></div></div></footer></div></div></div></body>