<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tracing/tracing-schema" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Trace Data Structure | MLflow</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://mlflow.org/docs/latest/tracing/tracing-schema"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Trace Data Structure | MLflow"><meta data-rh="true" name="description" content="This document provides a detailed view of the schema for traces and its ingredients. MLflow traces are compatible to OpenTelemetry specs,"><meta data-rh="true" property="og:description" content="This document provides a detailed view of the schema for traces and its ingredients. MLflow traces are compatible to OpenTelemetry specs,"><link data-rh="true" rel="icon" href="/docs/latest/images/favicon.ico"><link data-rh="true" rel="canonical" href="https://mlflow.org/docs/latest/tracing/tracing-schema"><link data-rh="true" rel="alternate" href="https://mlflow.org/docs/latest/tracing/tracing-schema" hreflang="en"><link data-rh="true" rel="alternate" href="https://mlflow.org/docs/latest/tracing/tracing-schema" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://XKVLO8P882-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-N6WMTTJ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-N6WMTTJ",{anonymize_ip:!0}),gtag("config","AW-16857946923",{anonymize_ip:!0})</script>
<link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var g=t.getElementsByTagName(a)[0],m=t.createElement(a);m.async=!0,m.src="https://www.googletagmanager.com/gtm.js?id=GTM-N6WMTTJ",g.parentNode.insertBefore(m,g)}(window,document,"script","dataLayer")</script>



<link rel="search" type="application/opensearchdescription+xml" title="MLflow" href="/docs/latest/opensearch.xml">

<script src="/docs/latest/js/runllm.js" defer="defer"></script><link rel="stylesheet" href="/docs/latest/assets/css/styles.504e3d8b.css">
<script src="/docs/latest/assets/js/runtime~main.5af5e8cd.js" defer="defer"></script>
<script src="/docs/latest/assets/js/main.f59a9612.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N6WMTTJ" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/latest/"><div class="navbar__logo"><img src="/docs/latest/images/logo-light.svg" alt="MLflow Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs/latest/images/logo-dark.svg" alt="MLflow Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/latest/">Docs</a><a href="https://mlflow.org/docs/latest/api_reference/index.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API Reference</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/mlflow/mlflow" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item sidebar-top-level-category"><a class="menu__link" href="/docs/latest/">MLflow</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-top-level-category"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/latest/mlflow-3/">MLflow 3.0</a><button aria-label="Expand sidebar category &#x27;MLflow 3.0&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-top-level-category"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/latest/getting-started/">Getting Started</a><button aria-label="Expand sidebar category &#x27;Getting Started&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item sidebar-top-level-category"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/latest/llms/">Machine Learning 🧠</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/latest/llms/">LLM / GenAI</a><button aria-label="Expand sidebar category &#x27;LLM / GenAI&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/latest/deep-learning/">Deep Learning</a><button aria-label="Expand sidebar category &#x27;Deep Learning&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/latest/traditional-ml/">Traditional ML</a><button aria-label="Expand sidebar category &#x27;Traditional ML&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item sidebar-top-level-category"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/latest/tracking/">Build 🔨 </a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/latest/tracking/">MLflow Tracking</a><button aria-label="Expand sidebar category &#x27;MLflow Tracking&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/latest/model/">MLflow Model</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/latest/prompts/">MLflow Prompts 🆕</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item sidebar-top-level-category"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/latest/model-evaluation/">Evaluate &amp; Monitor 📊</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/model-evaluation/">MLflow Evaluation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/latest/tracing/">MLflow Tracing (Observability)</a><button aria-label="Collapse sidebar category &#x27;MLflow Tracing (Observability)&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/tracing/">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/latest/tracing/integrations/">Integrations</a><button aria-label="Expand sidebar category &#x27;Integrations&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/latest/tracing/api/">APIs</a><button aria-label="Expand sidebar category &#x27;APIs&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/tracing/lightweight-sdk">Lightweight SDK</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/tracing/production">Production Monitoring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/tracing/session">Managing Chat Sessions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/tracing/faq">FAQ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/latest/tracing/tracing-schema">Data Structure</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/latest/tracing/tutorials/">Tutorials</a><button aria-label="Expand sidebar category &#x27;Tutorials&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/tracing/ui">MLflow Tracing UI</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/dataset/">MLflow Dataset</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item sidebar-top-level-category"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/latest/model-registry/">Deploy 🚀</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/model-registry/">MLflow Model Registry</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/latest/deployment/">MLflow Serving</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/latest/llms/deployments/">MLflow AI Gateway</a><button aria-label="Expand sidebar category &#x27;MLflow AI Gateway&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-top-level-category"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/latest/tracking/#tracking-setup">Team Collaboration 👥</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-top-level-category"><div class="menu__list-item-collapsible"><a href="https://mlflow.org/docs/latest/api_reference/python_api/index.html" target="_blank" rel="noopener noreferrer" class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false">API References</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-top-level-category"><div class="menu__list-item-collapsible"><a href="https://github.com/mlflow/mlflow/blob/master/CONTRIBUTING.md" target="_blank" rel="noopener noreferrer" class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false">More</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs/latest/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Evaluate &amp; Monitor 📊</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/latest/tracing/"><span itemprop="name">MLflow Tracing (Observability)</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Data Structure</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Trace Data Structure</h1></header>
<p>This document provides a detailed view of the schema for traces and its ingredients. MLflow traces are <strong>compatible to OpenTelemetry specs</strong>,
but we also define a few additional layers of structure upon the OpenTelemetry Spans to provide additional metadata about the trace.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>The <code>request_id</code> field was renamed to <code>trace_id</code> in MLflow 3.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="structure-of-traces">Structure of Traces<a href="#structure-of-traces" class="hash-link" aria-label="Direct link to Structure of Traces" title="Direct link to Structure of Traces">​</a></h2>
<p><strong>TL;DR</strong>: <code>Trace = TraceInfo + TraceData</code> where <code>TraceData = List[Span]</code></p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Trace</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Trace Info</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Trace Data</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Span</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><h4 class="anchor anchorWithStickyNavbar_LWe7" id="trace-structure">Trace Structure<a href="#trace-structure" class="hash-link" aria-label="Direct link to Trace Structure" title="Direct link to Trace Structure">​</a></h4><p>A <a href="/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.Trace" target="_blank"><code>Trace</code></a> in MLflow consists of two components:
<a href="/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.TraceInfo" target="_blank"><code>Trace Info</code></a> and
<a href="/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.TraceData" target="_blank"><code>Trace Data</code></a>.</p><p>The metadata that aids in explaining the origination
of the trace, the status of the trace, and the information about the total execution time is stored within the Trace Info. The Trace
Data is comprised entirely of the instrumented <a href="/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.Span" target="_blank"><code>Span</code></a>
objects that make up the core of the trace.</p><div class="max-height-img-container" style="max-height:400px"><p><img decoding="async" loading="lazy" alt="Trace Architecture" src="/docs/latest/assets/images/trace_architecture-4d7b474a12b802862207e96a40040e12.png" width="1204" height="903" class="img_ev3q"></p></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><h4 class="anchor anchorWithStickyNavbar_LWe7" id="trace-info-structure">Trace Info Structure<a href="#trace-info-structure" class="hash-link" aria-label="Direct link to Trace Info Structure" title="Direct link to Trace Info Structure">​</a></h4><p>The Trace Info within MLflow&#x27;s tracing feature aims to provide a lightweight snapshot of critical data about the overall trace.
This includes the logistical information about the trace, such as the experiment_id, providing the storage location for the trace,
as well as trace-level data such as start time and total execution time. The Trace Info also includes tags and status information for
the trace as a whole.</p><div class="max-height-img-container" style="max-height:400px"><p><img decoding="async" loading="lazy" alt="Trace Info Architecture" src="/docs/latest/assets/images/trace_info_architecture-0a66e4960efd9299f04427c0aef04a45.png" width="1242" height="994" class="img_ev3q"></p></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><h4 class="anchor anchorWithStickyNavbar_LWe7" id="trace-data-structure-1">Trace Data Structure<a href="#trace-data-structure-1" class="hash-link" aria-label="Direct link to Trace Data Structure" title="Direct link to Trace Data Structure">​</a></h4><p>The Trace Data within MLflow&#x27;s tracing feature provides the core of the trace information. Within this object is a list of
<a href="/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.Span" target="_blank"><code>Span</code></a> objects that represent the individual steps of the trace.
These spans are associated with one another in a hierarchical relationship, providing a clear order-of-operations linkage of what
happened within your application during the trace.</p><div class="max-height-img-container" style="max-height:400px"><p><img decoding="async" loading="lazy" alt="Trace Data Architecture" src="/docs/latest/assets/images/trace_data_architecture-96cd4fb71c42d2616dd28acdba33b5e6.png" width="1243" height="935" class="img_ev3q"></p></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><h4 class="anchor anchorWithStickyNavbar_LWe7" id="span-structure">Span Structure<a href="#span-structure" class="hash-link" aria-label="Direct link to Span Structure" title="Direct link to Span Structure">​</a></h4><p>The Span object within MLflow&#x27;s tracing feature provides detailed information about the individual steps of the trace.
It complies to the <a href="https://opentelemetry.io/docs/concepts/signals/traces#spans" target="_blank" rel="noopener noreferrer">OpenTelemetry Span spec</a>.
Each Span object contains information about the step being instrumented, including the span_id, name, start_time, parent_id, status,
inputs, outputs, attributes, and events.</p><div class="max-height-img-container" style="max-height:400px"><p><img decoding="async" loading="lazy" alt="Span Architecture" src="/docs/latest/assets/images/span_architecture-01e1f5a3edf522f567e7eaad16f2b1d1.png" width="1880" height="1149" class="img_ev3q"></p></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="trace">Trace<a href="#trace" class="hash-link" aria-label="Direct link to Trace" title="Direct link to Trace">​</a></h2>
<p>A trace is a root object composed of two components:</p>
<ul>
<li>
<a href="/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.TraceInfo" target="_blank"><code>TraceInfo</code></a>
</li>
<li>
<a href="/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.TraceData" target="_blank"><code>TraceData</code></a>
</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Check the API documentation for helper methods on these <code>dataclass</code> objects for more information on how to convert or extract data from them.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="trace-info">Trace Info<a href="#trace-info" class="hash-link" aria-label="Direct link to Trace Info" title="Direct link to Trace Info">​</a></h2>
<p>Trace Info is a <code>dataclass</code> object that contains metadata about the trace. This metadata includes information about the trace&#x27;s origin, status, and
various other data that aids in retrieving and filtering traces when used with <a href="/docs/latest/api_reference/python_api/mlflow.client.html#mlflow.client.MlflowClient.search_traces" target="_blank"><code>mlflow.client.MlflowClient.search_traces<!-- -->()</code></a> and for
navigation of traces within the MLflow UI.</p>
<p>To learn more about how <code>TraceInfo</code> metadata is used for searching, you can see examples <a href="/docs/latest/tracing/api/search">here</a>.</p>
<p>The data that is contained in the <code>TraceInfo</code> object is used to populate the trace view page within the MLflow tracking UI, as shown below.</p>
<p><img decoding="async" loading="lazy" alt="TraceInfo as it is used in the MLflow UI" src="/docs/latest/assets/images/trace_info_in_ui-ad801e1eeea03ac3004bed18a34fbf8c.png" width="2920" height="918" class="img_ev3q"></p>
<p>The primary components of MLflow <a href="/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.TraceInfo" target="_blank"><code>TraceInfo</code></a> objects are listed below.</p>
<table><thead><tr><th><strong>Property</strong></th><th><strong>Type</strong></th><th><strong>Description</strong></th><th><strong>Note</strong></th></tr></thead><tbody><tr><td><strong>trace_id</strong></td><td><code>str</code></td><td><p>A unique identifier for the trace. The identifier is used within MLflow
and integrated system to resolve the event being captured and to provide
associations for external systems to map the logged trace to the
originating caller.</p></td><td>This value is generated by the tracing backend and is immutable. Within the tracing client APIs, you will need to deliberately pass this value to the <a href="/docs/latest/api_reference/python_api/mlflow.client.html#mlflow.client.MlflowClient.start_span" target="_blank">span creation API</a> to ensure that a given span is associated with a trace.</td></tr><tr><td><strong>trace_location</strong></td><td><a href="/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.TraceLocation" target="_blank"><code>mlflow.entities.TraceLocation<!-- -->()</code></a></td><td><p>The location where the trace is stored.</p></td><td>MLflow currently supports MLflow Experiment or Databricks Inference Table as a trace location.</td></tr><tr><td><strong>request_time</strong></td><td><code>int</code></td><td><p>The time that marks the moment when the root span of the trace was
created. This is a Unix timestamp in milliseconds.</p></td><td><p>The time reflected in this property is the time at with the trace was
created, not the time at which a request to your application was made.
As such, it does not factor into account the time it took to process the
request to the environment in which your application is being served,
which may introduce additional latency to the total round trip time,
depending on network configurations.</p></td></tr><tr><td><strong>execution_duration</strong></td><td><code>int</code></td><td><p>The time that marks the moment when the call to end the trace is made.
This is a Unix timestamp in milliseconds.</p></td><td><p>This time does not include the networking time associated with sending
the response from the environment that generates the trace to the
environment that is consuming the application’s invocation result.</p></td></tr><tr><td><strong>state</strong></td><td><a href="/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.TraceState" target="_blank"><code>mlflow.entities.TraceState<!-- -->()</code></a></td><td>An enumerated value that denotes the state of the trace.</td><td><p><code>TraceState</code> values are one of:</p><ul>
<li><strong>OK</strong> - The trace and the
instrumented call were successful.</li>
<li><strong>ERROR</strong> - An error occurred
while an application was being instrumented. The error can be seen
within the span data for the trace.</li>
<li><strong>IN_PROGRESS</strong> - The trace has
started and is currently running. Temporary state that will update while
spans are being logged to a trace.</li>
<li><strong>STATE_UNSPECIFIED</strong> -
internal default state that should not be seen in logged traces.</li>
</ul></td></tr><tr><td><strong>request_preview</strong></td><td><code>str</code></td><td>The <code>request_preview</code> property is the input data for the entire trace. The input <code>str</code> is a JSON-serialized string that contains the input data for the trace, typically the end-user request that was submitted as a call to the application.</td><td>Due to the varied structures of inputs that could go to a given application that is being instrumented by MLflow Tracing, all inputs are JSON serialized for compatibility&#x27;s sake. This allows for the input data to be stored in a consistent format, regardless of the input data&#x27;s structure. This field can be truncated if it exceeds the length limit.</td></tr><tr><td><strong>response_preview</strong></td><td><code>str</code></td><td>The <code>response_preview</code> property is the final output data that will be returned to the caller of the invocation of the application.</td><td>Similar to the request property, this value is a JSON-serialized string to maximize compatibility of disparate formats. This field can be truncated if it exceeds the length limit.</td></tr><tr><td><strong>trace_metadata</strong></td><td><code>dict[str, str]</code></td><td><p>The trace metadata are additional key-value pairs of information that
are associated with the Trace, set and modified by the tracing backend.</p></td><td><p>These are not open for addition or modification by the user, but can
provide additional context about the trace, such as an MLflow <code>run_id</code>
that is associated with the trace.</p></td></tr><tr><td><strong>tags</strong></td><td><code>dict[str, str]</code></td><td><p>User-defined key-value pairs that can be applied to a trace for applying
additional context, aid in <a href="/docs/latest/tracing/api/search/">search functionality</a>, or to
provide additional information during the creation or after the
successful logging of a trace.</p></td><td><p>These tags are fully mutable and can be changed at any time, even long
after a trace has been logged to an experiment.</p></td></tr><tr><td><strong>assessments</strong></td><td>List of <a href="/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.Assessment" target="_blank"><code>mlflow.entities.Assessment<!-- -->()</code></a></td><td><p>A list of assessments associated with the trace.</p></td><td><p>Currently, this property is only supported on Databricks.</p></td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="trace-data">Trace Data<a href="#trace-data" class="hash-link" aria-label="Direct link to Trace Data" title="Direct link to Trace Data">​</a></h2>
<p>The MLflow <a href="/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.trace_data.TraceData" target="_blank"><code>TraceData</code></a> object is a <code>dataclass</code> object that holds the core of the trace data.
This object contains the following elements:</p>
<table><thead><tr><th><strong>Property</strong></th><th><strong>Description</strong></th><th><strong>Note</strong></th></tr></thead><tbody><tr><td><strong>spans</strong></td><td>This property is a list of <a href="/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.Span" target="_blank">Span</a> objects that represent the individual steps of the trace.</td><td>For further information on the structure of Span objects, see the section below.</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="span-schema">Span Schema<a href="#span-schema" class="hash-link" aria-label="Direct link to Span Schema" title="Direct link to Span Schema">​</a></h2>
<p>Spans are the core of the trace data. They record key, critical data about each of the steps within your genai application.</p>
<p>When you view your traces within the MLflow UI, you&#x27;re looking at a collection of spans, as shown below.</p>
<p><img decoding="async" loading="lazy" alt="Spans within the MLflow UI" src="/docs/latest/assets/images/spans_in_mlflow_ui-fb6052e2093862fc0477999a92b76f7a.png" width="2684" height="2068" class="img_ev3q"></p>
<p>The sections below provide a detailed view of the structure of a span.</p>
<table><thead><tr><th><strong>Property</strong></th><th><strong>Description</strong></th><th><strong>Note</strong></th></tr></thead><tbody><tr><td><strong>inputs</strong></td><td><p>The inputs are stored as JSON-serialized strings, representing the
input data that is passed into the particular stage (step) of your
application. Due to the wide variety of input data that can be passed
between specific stages of a GenAI application, this data may be
extremely large (such as when using the output of a vector store
retrieval step).</p></td><td><p>Reviewing the Inputs, along with the Outputs, of individual stages can
dramatically increase the ability to diagnose and debug issues that
exist with responses coming from your application.</p></td></tr><tr><td><strong>outputs</strong></td><td><p>The outputs are stored as JSON-serialized strings, representing the
output data that is passed out of the particular stage (step) of your
application.</p></td><td><p>Just as with the Inputs, the Outputs can be quite large, depending on
the complexity of the data that is being passed between stages.</p></td></tr><tr><td><strong>attributes</strong></td><td><p>Attributes are metadata that are associated with a given step within
your application. These attributes are key-value pairs that can be used
to provide insight into behavioral modifications for function and method
calls, giving insight into how modification of them can affect the
performance of your application.</p></td><td><p>Common examples of attributes that could be associated with a given
span include:</p><ul>
<li><strong>model</strong></li>
<li><strong>temperature</strong></li>
<li><strong>document_count</strong></li>
</ul><p>These attributes provide additional context and insight into the results that are present in the outputs property for the span.</p></td></tr><tr><td><strong>events</strong></td><td><p>Events are a system-level property that is optionally applied to a span
only if there was an issue during the execution of the span. These
events contain information about exceptions that were thrown in the
instrumented call, as well as the stack trace.</p></td><td>This data is structured within a <a href="/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.SpanEvent" target="_blank">SpanEvent</a> object, containing the properties:<ul>
<li><strong>name</strong></li>
<li><strong>timestamp</strong></li>
<li><strong>attributes</strong></li>
</ul><p><strong>The attributes</strong> property contains the stack trace of the exception that was thrown during the execution of the span if such an error occurred during execution.</p></td></tr><tr><td><strong>parent_id</strong></td><td><p>The <code>parent_id</code> property is an identifier that establishes the
hierarchical association of a given span with its parent span. This is
used to establish an event chain for the spans, helping to determine
which step followed another step in the execution of the application.</p></td><td><p>A span <strong>must</strong> have a <code>parent_id</code> set.</p></td></tr><tr><td><strong>span_id</strong></td><td><p>The <code>span_id</code> is a unique identifier that is generated for each span
within a trace. This identifier is used to disambiguate spans from one
another and allow for proper association of the span within the
sequential execution of other spans within a trace.</p></td><td>A <code>span_id</code> is set when a span is created and is immutable.</td></tr><tr><td><strong>trace_id</strong></td><td><p>The <code>trace_id</code> property is a unique identifier that is generated for
each <strong>trace</strong> and is propagated to each span that is a member of that trace.</p></td><td>The <code>trace_id</code> is a system-generated property and is immutable.</td></tr><tr><td><strong>name</strong></td><td><p>The name of the trace is either user-defined (optionally when using the
fluent and client APIs) or is automatically generated through CallBack
integrations or when omitting the name argument when calling the fluent
or client APIs. If the name is not overridden, the name will be
generated based on the name of the function or method that is being
instrumented.</p></td><td><p>It is recommended to provide a name for your span that is unique and
relevant to the functionality that is being executed when using manual
instrumentation via the client or fluent APIs. Generic names for spans or
confusing names can make it difficult to diagnose issues when reviewing
traces.</p></td></tr><tr><td><strong>status</strong></td><td><p>The status of a span is reflected in a value from the enumeration object
<code>SpanStatusCode</code>. The span status object contains an optional description
if the <code>status_code</code> is reflecting an error that occurred. The values that
the status may have are:</p><ul>
<li><strong>OK</strong> - The span and the underlying instrumented
call were successful.</li>
<li><strong>UNSET</strong> - The status of the span hasn’t been set yet
(this is the default value and should not be seen in logged trace
events)</li>
<li><strong>ERROR</strong> - An issue happened within the call being instrumented.
The <code>description</code> property will contain additional information about the
error that occurred.</li>
</ul></td><td><p>Evaluating the status of spans can greatly reduce the amount of time and
effort required to diagnose issues with your applications.</p></td></tr><tr><td><strong>start_time_ns</strong></td><td>The unix timestamp (in nanoseconds) when the span was started.</td><td><p>The precision of this property is higher than that of the trace start
time, allowing for more granular analysis of the execution time of very
short-lived spans.</p></td></tr><tr><td><strong>end_time_ns</strong></td><td>The unix timestamp (in nanoseconds) when the span was ended.</td><td><p>This precision is higher than the trace timestamps, similar to the
<code>start_time_ns</code> timestamp above.</p></td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="span-types">Span Types<a href="#span-types" class="hash-link" aria-label="Direct link to Span Types" title="Direct link to Span Types">​</a></h2>
<p>Span types are a way to categorize spans within a trace. By default, the span type is set to <code>&quot;UNKNOWN&quot;</code> when using the trace decorator. MLflow provides a set of predefined span types for common use cases, while also allowing you to setting custom span types.</p>
<p>The following span types are available:</p>
<table><thead><tr><th><strong>Span Type</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><code>&quot;LLM&quot;</code></td><td>Represents a call to an LLM endpoint or a local model.</td></tr><tr><td><code>&quot;CHAT_MODEL&quot;</code></td><td>Represents a query to a chat model. This is a special case of an LLM interaction.</td></tr><tr><td><code>&quot;CHAIN&quot;</code></td><td>Represents a chain of operations.</td></tr><tr><td><code>&quot;AGENT&quot;</code></td><td>Represents an autonomous agent operation.</td></tr><tr><td><code>&quot;TOOL&quot;</code></td><td>Represents a tool execution (typically by an agent), such as querying a search engine.</td></tr><tr><td><code>&quot;EMBEDDING&quot;</code></td><td>Represents a text embedding operation.</td></tr><tr><td><code>&quot;RETRIEVER&quot;</code></td><td>Represents a context retrieval operation, such as querying a vector database.</td></tr><tr><td><code>&quot;PARSER&quot;</code></td><td>Represents a parsing operation, transforming text into a structured format.</td></tr><tr><td><code>&quot;RERANKER&quot;</code></td><td>Represents a re-ranking operation, ordering the retrieved contexts based on relevance.</td></tr><tr><td><code>&quot;UNKNOWN&quot;</code></td><td>A default span type that is used when no other span type is specified.</td></tr></tbody></table>
<p>To set a span type, you can pass the <code>span_type</code> parameter to the <a href="/docs/latest/api_reference/python_api/mlflow.html#mlflow.trace" target="_blank"><code>@mlflow.trace</code></a> decorator or <a href="/docs/latest/api_reference/python_api/mlflow.html#mlflow.start_span" target="_blank"><code>mlflow.start_span<!-- -->()</code></a>
context manager. When you are using <a href="/docs/latest/tracing/#automatic-tracing">automatic tracing</a>, the span type is automatically set by MLflow.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> mlflow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">entities </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> SpanType</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Using a built-in span type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@mlflow</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">trace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">span_type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">SpanType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RETRIEVER</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">retrieve_documents</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Setting a custom span type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">start_span</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;add&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> span_type</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;MATH&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> span</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    span</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_inputs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;x&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;y&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    z </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    span</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_outputs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;z&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">span</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">span_type</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Output: MATH</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="schema-for-specific-span-types">Schema for specific span types<a href="#schema-for-specific-span-types" class="hash-link" aria-label="Direct link to Schema for specific span types" title="Direct link to Schema for specific span types">​</a></h2>
<p>MLflow has a set of 10 predefined types of spans (see <a href="/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.SpanType" target="_blank">mlflow.entities.SpanType</a>), and
certain span types have properties that are required in order to enable additional functionality
within the UI and downstream tasks such as evaluation.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="retriever-spans">Retriever Spans<a href="#retriever-spans" class="hash-link" aria-label="Direct link to Retriever Spans" title="Direct link to Retriever Spans">​</a></h3>
<p>The <code>RETRIEVER</code> span type is used for operations involving retrieving data from a data store (for example, querying
documents from a vector store). The <code>RETRIEVER</code> span type has the following schema:</p>
<table><thead><tr><th><strong>Property</strong></th><th><strong>Description</strong></th><th><strong>Note</strong></th></tr></thead><tbody><tr><td><strong>Input</strong></td><td>There are no restrictions on the span inputs</td><td></td></tr><tr><td><strong>Output</strong></td><td>The output must be of type <code>List[<a href="/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.Document" target="_blank">mlflow.entities.Document</a>]</code>, or a dict matching the structure of the dataclass*. The dataclass contains the following properties:<ul>
<li><strong>id</strong> (<code>Optional[str]</code>) - An optional unique identifier for the document.</li>
<li><strong>page_content</strong> (<code>str</code>) - The text content of the document.</li>
<li><strong>metadata</strong> (<code>Optional[Dict[str,any]]</code>) - The metadata associated with the document. There are two important metadata keys that are reserved for the MLflow UI and evaluation metrics:<!-- -->
<ul>
<li><code>&quot;doc_uri&quot; (str)</code>: The URI for the document. This is used for rendering a link in the UI.</li>
<li><code>&quot;chunk_id&quot; (str)</code>: If your document is broken up into chunks in your data store, this key can be used to
identify the chunk that the document is a part of. This is used by some evaluation metrics.</li>
</ul>
</li>
</ul></td><td><p>This output structure is guaranteed to be provided if the traces are generated via MLflow autologging for the LangChain and LlamaIndex flavors.
By conforming to this specification, <code>RETRIEVER</code> spans will be rendered in a more user-friendly manner in the MLflow UI, and downstream tasks
such as evaluation will function as expected.</p></td></tr><tr><td><strong>Attributes</strong></td><td>There are no restrictions on the span attributes</td><td></td></tr></tbody></table>
<p>* For example, both <code>[Document(page_content=&quot;Hello world&quot;, metadata={&quot;doc_uri&quot;: &quot;https://example.com&quot;})]</code> and
<code>[{&quot;page_content&quot;: &quot;Hello world&quot;, &quot;metadata&quot;: {&quot;doc_uri&quot;: &quot;https://example.com&quot;}}]</code> are valid outputs for a <code>RETRIEVER</code> span.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="chat-completion-spans">Chat Completion Spans<a href="#chat-completion-spans" class="hash-link" aria-label="Direct link to Chat Completion Spans" title="Direct link to Chat Completion Spans">​</a></h3>
<p>Spans of type <code>CHAT_MODEL</code> or <code>LLM</code> are used to represent interactions with a chat completions API
(for example, OpenAI&#x27;s <a href="https://platform.openai.com/docs/api-reference/chat/create" target="_blank" rel="noopener noreferrer">chat completions</a>,
or Anthropic&#x27;s <a href="https://docs.anthropic.com/en/api/messages" target="_blank" rel="noopener noreferrer">messages</a> API). As providers can have
different schemas for their API, there are no restrictions on the format of the span&#x27;s inputs and
outputs.</p>
<p>However, it is still important to have a common schema in order to enable certain UI features (e.g. rich
conversation display), and to make authoring evaluation functions easier. To support this, we specify some
custom attributes for standardized chat messages and tool definitions:</p>
<table><thead><tr><th><strong>Attribute Name</strong></th><th><strong>Description</strong></th><th><strong>Note</strong></th></tr></thead><tbody><tr><td><p><strong>mlflow.chat.messages</strong></p></td><td><p>This attribute represents the system/user/assistant messages involved in the
conversation with the chat model. It enables rich conversation rendering in the UI,
and will also be used in MLflow evaluation in the future.</p><p>The type must be <code>List[</code> <a href="/docs/latest/api_reference/python_api/mlflow.types.html#mlflow.types.chat.ChatMessage" target="_blank">ChatMessage</a> <code>]</code></p></td><td><p>This attribute can be conveniently set using the <a href="/docs/latest/api_reference/python_api/mlflow.tracing.html#mlflow.tracing.set_span_chat_messages" target="_blank"><code>mlflow.tracing.set_span_chat_messages<!-- -->()</code></a> function. This function
will throw a validation error if the data does not conform to the spec.</p></td></tr><tr><td><p><strong>mlflow.chat.tools</strong></p></td><td><p>This attribute represents the tools that were available for the chat model to call. In the OpenAI
context, this would be equivalent to the <a href="https://platform.openai.com/docs/api-reference/chat/create#chat-create-tools%3E" target="_blank" rel="noopener noreferrer">tools</a>
param in the Chat Completions API.</p><p>The type must be <code>List[</code> <a href="/docs/latest/api_reference/python_api/mlflow.types.html#mlflow.types.chat.ChatTool" target="_blank">ChatTool</a> <code>]</code></p></td><td><p>This attribute can be conveniently set using the <a href="/docs/latest/api_reference/python_api/mlflow.tracing.html#mlflow.tracing.set_span_chat_tools" target="_blank"><code>mlflow.tracing.set_span_chat_tools<!-- -->()</code></a> function. This function
will throw a validation error if the data does not conform to the spec.</p></td></tr></tbody></table>
<p>Please refer to the example below for a quick demonstration of how to use the utility functions described above, as well as
how to retrieve them using the <a href="/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.Span.get_attribute" target="_blank">span.get_attribute()</a> function:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> mlflow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">entities</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">span </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> SpanType</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tracing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">constant </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> SpanAttributeKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tracing </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> set_span_chat_messages</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> set_span_chat_tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># example messages and tools</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">messages </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;role&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;system&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;content&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;please use the provided tool to answer the user&#x27;s questions&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;role&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;user&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;content&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;what is 1 + 1?&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tools </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;function&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;function&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;name&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;add&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;description&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Add two numbers&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;parameters&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;object&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;properties&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;a&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;number&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;b&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;number&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;required&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;a&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;b&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@mlflow</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">trace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">span_type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">SpanType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CHAT_MODEL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">call_chat_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">messages</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tools</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># mocking a response</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;role&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;assistant&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;tool_calls&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;id&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;function&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;arguments&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{&quot;a&quot;: 1,&quot;b&quot;: 2}&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;name&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;add&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;function&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    combined_messages </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> messages </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    span </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_current_active_span</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    set_span_chat_messages</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">span</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> combined_messages</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    set_span_chat_tools</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">span</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tools</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> response</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">call_chat_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">messages</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tools</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">trace_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_last_active_trace_id</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">trace </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_trace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">trace_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">span </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> trace</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spans</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Messages: &quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> span</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_attribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SpanAttributeKey</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CHAT_MESSAGES</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Tools: &quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> span</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_attribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SpanAttributeKey</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CHAT_TOOLS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/latest/tracing/faq"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">FAQ</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/latest/tracing/tutorials/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Tutorials</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#structure-of-traces" class="table-of-contents__link toc-highlight">Structure of Traces</a></li><li><a href="#trace" class="table-of-contents__link toc-highlight">Trace</a></li><li><a href="#trace-info" class="table-of-contents__link toc-highlight">Trace Info</a></li><li><a href="#trace-data" class="table-of-contents__link toc-highlight">Trace Data</a></li><li><a href="#span-schema" class="table-of-contents__link toc-highlight">Span Schema</a></li><li><a href="#span-types" class="table-of-contents__link toc-highlight">Span Types</a></li><li><a href="#schema-for-specific-span-types" class="table-of-contents__link toc-highlight">Schema for specific span types</a><ul><li><a href="#retriever-spans" class="table-of-contents__link toc-highlight">Retriever Spans</a></li><li><a href="#chat-completion-spans" class="table-of-contents__link toc-highlight">Chat Completion Spans</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/mlflow" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/mlflow-org" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://x.com/mlflow" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/latest/">Docs</a></li><li class="footer__item"><a href="https://mlflow.org/releases" target="_blank" rel="noopener noreferrer" class="footer__link-item">Releases</a></li><li class="footer__item"><a href="https://mlflow.org/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 MLflow Project, a Series of LF Projects, LLC.</div></div></div></footer></div>
</body>
</html>