"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([["4771"],{74270(e,l,r){r.r(l),r.d(l,{metadata:()=>t,default:()=>m,frontMatter:()=>s,contentTitle:()=>c,toc:()=>d,assets:()=>h});var t=JSON.parse('{"id":"architecture/backend-store","title":"Backend Stores","description":"The backend store is a core component in MLflow that stores metadata for","source":"@site/docs/self-hosting/architecture/backend-store.mdx","sourceDirName":"architecture","slug":"/architecture/backend-store","permalink":"/mlflow-website/docs/latest/self-hosting/architecture/backend-store","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"selfHostingSidebar","previous":{"title":"Tracking Server","permalink":"/mlflow-website/docs/latest/self-hosting/architecture/tracking-server"},"next":{"title":"Artifact Store","permalink":"/mlflow-website/docs/latest/self-hosting/architecture/artifact-store"}}'),n=r(74848),a=r(28453),i=r(54725),o=r(14591);let s={},c="Backend Stores",h={},d=[{value:"Types of Backend Stores",id:"types-of-backend-stores",level:2},{value:"Relational Database (<strong>Default</strong>)",id:"relational-database-default",level:3},{value:"Local File System (<strong>Legacy</strong>)",id:"local-file-system-legacy",level:3},{value:"Configure Backend Store",id:"configure-backend-store",level:2},{value:"Supported Store Types",id:"supported-store-types",level:2},{value:"Deletion Behavior",id:"deletion-behavior",level:2},{value:"SQLAlchemy Options",id:"sqlalchemy-options",level:2},{value:"MySQL SSL Options",id:"mysql-ssl-options",level:2},{value:"File Store Performance",id:"file-store-performance",level:2}];function p(e){let l={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.header,{children:(0,n.jsx)(l.h1,{id:"backend-stores",children:"Backend Stores"})}),"\n",(0,n.jsx)(l.p,{children:"The backend store is a core component in MLflow that stores metadata for\nRuns, models, traces, and experiments such as:"}),"\n",(0,n.jsxs)(l.ul,{children:["\n",(0,n.jsx)(l.li,{children:"Run ID"}),"\n",(0,n.jsx)(l.li,{children:"Model ID"}),"\n",(0,n.jsx)(l.li,{children:"Trace ID"}),"\n",(0,n.jsx)(l.li,{children:"Tags"}),"\n",(0,n.jsx)(l.li,{children:"Start & end time"}),"\n",(0,n.jsx)(l.li,{children:"Parameters"}),"\n",(0,n.jsx)(l.li,{children:"Metrics"}),"\n"]}),"\n",(0,n.jsxs)(l.p,{children:["Large model artifacts such as model weight files are stored in the ",(0,n.jsx)(l.a,{href:"/self-hosting/architecture/artifact-store",children:"artifact store"}),"."]}),"\n",(0,n.jsx)(l.h2,{id:"types-of-backend-stores",children:"Types of Backend Stores"}),"\n",(0,n.jsxs)(l.h3,{id:"relational-database-default",children:["Relational Database (",(0,n.jsx)(l.strong,{children:"Default"}),")"]}),"\n",(0,n.jsxs)(l.p,{children:["MLflow supports different databases through SQLAlchemy, including ",(0,n.jsx)(l.code,{children:"sqlite"}),", ",(0,n.jsx)(l.code,{children:"postgresql"}),", ",(0,n.jsx)(l.code,{children:"mysql"}),", and ",(0,n.jsx)(l.code,{children:"mssql"}),". This option provides better performance through indexing and is easier to scale to larger volumes of data than the file system backend."]}),"\n",(0,n.jsxs)(l.p,{children:[(0,n.jsx)(l.strong,{children:"SQLite is the default backend store"}),". When you start MLflow without specifying a backend, it automatically creates and uses ",(0,n.jsx)(l.code,{children:"sqlite:///mlflow.db"})," in the current directory. To use a different database such as PostgreSQL, specify ",(0,n.jsx)(l.code,{children:"--backend-store-uri"})," when starting MLflow (e.g., ",(0,n.jsx)(l.code,{children:"--backend-store-uri postgresql://..."}),")."]}),"\n",(0,n.jsxs)(l.h3,{id:"local-file-system-legacy",children:["Local File System (",(0,n.jsx)(l.strong,{children:"Legacy"}),")"]}),"\n",(0,n.jsxs)(l.p,{children:["The file-based backend stores metadata in local files in the ",(0,n.jsx)(l.code,{children:"./mlruns"})," directory. This was the default backend in earlier versions of MLflow, but is still supported for backward compatibility."]}),"\n",(0,n.jsxs)(l.p,{children:["To use file-based storage, specify ",(0,n.jsx)(l.code,{children:"--backend-store-uri ./mlruns"})," when starting the server, or set ",(0,n.jsx)(l.code,{children:"MLFLOW_TRACKING_URI=./mlruns"}),"."]}),"\n",(0,n.jsx)(l.admonition,{title:"TO BE DEPRECATED SOON",type:"warning",children:(0,n.jsx)(l.p,{children:"File system backend is in Keep-the-Light-On (KTLO) mode and is no longer receiving new feature updates. We strongly recommend using the database backend (now the default) for better performance and reliability."})}),"\n",(0,n.jsx)(l.h2,{id:"configure-backend-store",children:"Configure Backend Store"}),"\n",(0,n.jsxs)(l.p,{children:["You can configure a different backend store by passing the desired ",(0,n.jsx)(l.strong,{children:"tracking URI"})," to MLflow, via either of the following methods:"]}),"\n",(0,n.jsxs)(l.ul,{children:["\n",(0,n.jsxs)(l.li,{children:["Set the ",(0,n.jsx)(l.code,{children:"MLFLOW_TRACKING_URI"})," environment variable."]}),"\n",(0,n.jsxs)(l.li,{children:["Call ",(0,n.jsx)(i.B,{fn:"mlflow.set_tracking_uri"})," in your code."]}),"\n",(0,n.jsxs)(l.li,{children:["If you are running a ",(0,n.jsx)(l.a,{href:"/self-hosting/architecture/tracking-server",children:"Tracking Server"}),", you can set the ",(0,n.jsx)(l.code,{children:"--backend-store-uri"})," option when starting the server, like ",(0,n.jsx)(l.code,{children:"mlflow server --backend-store-uri postgresql://..."})]}),"\n"]}),"\n",(0,n.jsxs)(l.p,{children:["Continue to the next section for the supported format of tracking URLs.\nAlso visit ",(0,n.jsx)(l.a,{href:"/self-hosting/architecture/tracking-server",children:"this guidance"})," for how to set up the backend store properly for your workflow."]}),"\n",(0,n.jsx)(l.h2,{id:"supported-store-types",children:"Supported Store Types"}),"\n",(0,n.jsx)(l.p,{children:"MLflow supports the following types of tracking URI for backend stores:"}),"\n",(0,n.jsxs)(l.ul,{children:["\n",(0,n.jsxs)(l.li,{children:["Local file path (specified as ",(0,n.jsx)(l.code,{children:"file:/my/local/dir"}),"), where data is just directly stored locally to a system disk where your code is executing."]}),"\n",(0,n.jsxs)(l.li,{children:["A Database, encoded as ",(0,n.jsx)(l.code,{children:"<dialect>+<driver>://<username>:<password>@<host>:<port>/<database>"}),". MLflow supports the dialects ",(0,n.jsx)(l.code,{children:"mysql"}),", ",(0,n.jsx)(l.code,{children:"mssql"}),", ",(0,n.jsx)(l.code,{children:"sqlite"}),", and ",(0,n.jsx)(l.code,{children:"postgresql"}),". For more details, see ",(0,n.jsx)(l.a,{href:"https://docs.sqlalchemy.org/en/latest/core/engines.html#database-urls",children:"SQLAlchemy database uri"}),"."]}),"\n",(0,n.jsxs)(l.li,{children:["HTTP server (specified as ",(0,n.jsx)(l.code,{children:"https://my-server:5000"}),"), which is a server hosting an ",(0,n.jsx)(l.a,{href:"/self-hosting/architecture/tracking-server",children:"MLflow tracking server"}),"."]}),"\n",(0,n.jsxs)(l.li,{children:["Databricks workspace (specified as ",(0,n.jsx)(l.code,{children:"databricks"})," or as ",(0,n.jsx)(l.code,{children:"databricks://<profileName>"}),", a ",(0,n.jsx)(l.a,{href:"https://github.com/databricks/databricks-cli#installation",children:"Databricks CLI profile"}),").\nRefer to Access the MLflow tracking server from outside Databricks ",(0,n.jsx)(l.a,{href:"http://docs.databricks.com/applications/mlflow/access-hosted-tracking-server.html",children:"[AWS]"}),"\n",(0,n.jsx)(l.a,{href:"http://docs.microsoft.com/azure/databricks/applications/mlflow/access-hosted-tracking-server",children:"[Azure]"}),"."]}),"\n"]}),"\n",(0,n.jsxs)(l.admonition,{title:"database-requirements",type:"warning",children:[(0,n.jsx)(l.p,{children:(0,n.jsx)(l.strong,{children:"Database-Backed Store Requirements"})}),(0,n.jsx)(l.p,{children:"When using database-backed stores, please note:"}),(0,n.jsxs)(l.ul,{children:["\n",(0,n.jsxs)(l.li,{children:["\n",(0,n.jsxs)(l.p,{children:[(0,n.jsx)(l.strong,{children:"Model Registry Integration"}),": ",(0,n.jsx)(l.a,{href:"/ml/model-registry",children:"Model Registry"})," functionality requires a database-backed store. See ",(0,n.jsx)(l.a,{href:"/ml/tracking#tracking-with-model-registry",children:"this FAQ"})," for more information."]}),"\n"]}),"\n",(0,n.jsxs)(l.li,{children:["\n",(0,n.jsxs)(l.p,{children:[(0,n.jsx)(l.strong,{children:"Schema Migrations"}),": ",(0,n.jsx)(l.code,{children:"mlflow server"})," will fail against a database with an out-of-date schema. Always run ",(0,n.jsx)(l.code,{children:"mlflow db upgrade [db_uri]"})," to upgrade your database schema before starting the server. Schema migrations can result in database downtime and may take longer on larger databases. ",(0,n.jsx)(l.strong,{children:"Always backup your database before running migrations."})]}),"\n"]}),"\n"]})]}),"\n",(0,n.jsx)(l.admonition,{title:"parameter-limits",type:"note",children:(0,n.jsxs)(l.p,{children:["In Sep 2023, we increased the max length for params recorded in a Run from 500 to 8k (but we limit param value max length to 6000 internally).\n",(0,n.jsx)(l.a,{href:"https://github.com/mlflow/mlflow/blob/master/mlflow/store/db_migrations/versions/2d6e25af4d3e_increase_max_param_val_length.py",children:"mlflow/2d6e25af4d3e_increase_max_param_val_length"}),"\nis a non-invertible migration script that increases the cap in existing database to 8k. Please be careful if you want to upgrade and backup your database before upgrading."]})}),"\n",(0,n.jsx)(l.h2,{id:"deletion-behavior",children:"Deletion Behavior"}),"\n",(0,n.jsxs)(l.p,{children:["In order to allow MLflow Runs to be restored, Run metadata and artifacts are not automatically removed\nfrom the backend store or artifact store when a Run is deleted. The ",(0,n.jsx)(i.B,{fn:"mlflow.server.cli",hash:"mlflow-gc",children:"mlflow gc"})," CLI is provided\nfor permanently removing Run metadata and artifacts for deleted runs."]}),"\n",(0,n.jsx)(l.h2,{id:"sqlalchemy-options",children:"SQLAlchemy Options"}),"\n",(0,n.jsxs)(l.p,{children:["You can inject some ",(0,n.jsx)(l.a,{href:"https://docs.sqlalchemy.org/en/latest/core/pooling.html",children:"SQLAlchemy connection pooling options"})," using environment variables."]}),"\n",(0,n.jsxs)(o.X,{children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"MLflow Environment Variable"}),(0,n.jsx)("th",{children:"SQLAlchemy QueuePool Option"})]})}),(0,n.jsxs)("tbody",{children:[(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsx)(l.code,{children:"MLFLOW_SQLALCHEMYSTORE_POOL_SIZE"})}),(0,n.jsx)("td",{children:(0,n.jsx)(l.code,{children:"pool_size"})})]}),(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsx)(l.code,{children:"MLFLOW_SQLALCHEMYSTORE_POOL_RECYCLE"})}),(0,n.jsx)("td",{children:(0,n.jsx)(l.code,{children:"pool_recycle"})})]}),(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsx)(l.code,{children:"MLFLOW_SQLALCHEMYSTORE_MAX_OVERFLOW"})}),(0,n.jsx)("td",{children:(0,n.jsx)(l.code,{children:"max_overflow"})})]})]})]}),"\n",(0,n.jsx)(l.h2,{id:"mysql-ssl-options",children:"MySQL SSL Options"}),"\n",(0,n.jsx)(l.p,{children:"When connecting to a MySQL database that requires SSL certificates, you can set the following environment variables:"}),"\n",(0,n.jsx)(l.pre,{children:(0,n.jsx)(l.code,{className:"language-bash",children:"# Path to SSL CA certificate file\nexport MLFLOW_MYSQL_SSL_CA=/path/to/ca.pem\n\n# Path to SSL client certificate file (if needed)\nexport MLFLOW_MYSQL_SSL_CERT=/path/to/client-cert.pem\n\n# Path to SSL client key file (if needed)\nexport MLFLOW_MYSQL_SSL_KEY=/path/to/client-key.pem\n"})}),"\n",(0,n.jsx)(l.p,{children:"Then start the MLflow server with your MySQL URI:"}),"\n",(0,n.jsx)(l.pre,{children:(0,n.jsx)(l.code,{className:"language-bash",children:'mlflow server --backend-store-uri="mysql+pymysql://username@hostname:port/database" --default-artifact-root=s3://your-bucket --host=0.0.0.0 --port=5000\n'})}),"\n",(0,n.jsx)(l.p,{children:"These environment variables will be used to configure the SSL connection to the MySQL server."}),"\n",(0,n.jsx)(l.h2,{id:"file-store-performance",children:"File Store Performance"}),"\n",(0,n.jsxs)(l.p,{children:["MLflow will automatically try to use ",(0,n.jsx)(l.a,{href:"https://pyyaml.org/wiki/LibYAML",children:"LibYAML"})," bindings if they are already installed.\nHowever, if you notice any performance issues when using ",(0,n.jsx)(l.em,{children:"file store"})," backend, it could mean LibYAML is not installed on your system.\nOn Linux or Mac you can easily install it using your system package manager:"]}),"\n",(0,n.jsx)(l.pre,{children:(0,n.jsx)(l.code,{className:"language-bash",children:"# On Ubuntu/Debian\napt-get install libyaml-cpp-dev libyaml-dev\n\n# On macOS using Homebrew\nbrew install yaml-cpp libyaml\n"})}),"\n",(0,n.jsx)(l.p,{children:"After installing LibYAML, you need to reinstall PyYAML:"}),"\n",(0,n.jsx)(l.pre,{children:(0,n.jsx)(l.code,{className:"language-bash",children:"# Reinstall PyYAML\npip --no-cache-dir install --force-reinstall -I pyyaml\n"})}),"\n",(0,n.jsx)(l.admonition,{type:"note",children:(0,n.jsx)(l.p,{children:"We generally recommend using a database backend to get better performance."})})]})}function m(e={}){let{wrapper:l}={...(0,a.R)(),...e.components};return l?(0,n.jsx)(l,{...e,children:(0,n.jsx)(p,{...e})}):p(e)}},54725(e,l,r){r.d(l,{B:()=>i});var t=r(74848);r(96540);var n=JSON.parse('{"mlflow.ag2":"api_reference/python_api/mlflow.ag2.html","mlflow.agno":"api_reference/python_api/mlflow.agno.html","mlflow.anthropic":"api_reference/python_api/mlflow.anthropic.html","mlflow.artifacts":"api_reference/python_api/mlflow.artifacts.html","mlflow.autogen":"api_reference/python_api/mlflow.autogen.html","mlflow.bedrock":"api_reference/python_api/mlflow.bedrock.html","mlflow.catboost":"api_reference/python_api/mlflow.catboost.html","mlflow.client":"api_reference/python_api/mlflow.client.html","mlflow.config":"api_reference/python_api/mlflow.config.html","mlflow.crewai":"api_reference/python_api/mlflow.crewai.html","mlflow.data":"api_reference/python_api/mlflow.data.html","mlflow.deployments":"api_reference/python_api/mlflow.deployments.html","mlflow.diviner":"api_reference/python_api/mlflow.diviner.html","mlflow.dspy":"api_reference/python_api/mlflow.dspy.html","mlflow.entities":"api_reference/python_api/mlflow.entities.html","mlflow.environment_variables":"api_reference/python_api/mlflow.environment_variables.html","mlflow.gateway":"api_reference/python_api/mlflow.gateway.html","mlflow.gemini":"api_reference/python_api/mlflow.gemini.html","mlflow.genai":"api_reference/python_api/mlflow.genai.html","mlflow.groq":"api_reference/python_api/mlflow.groq.html","mlflow.h2o":"api_reference/python_api/mlflow.h2o.html","mlflow.johnsnowlabs":"api_reference/python_api/mlflow.johnsnowlabs.html","mlflow.keras":"api_reference/python_api/mlflow.keras.html","mlflow.langchain":"api_reference/python_api/mlflow.langchain.html","mlflow.lightgbm":"api_reference/python_api/mlflow.lightgbm.html","mlflow.litellm":"api_reference/python_api/mlflow.litellm.html","mlflow.llama_index":"api_reference/python_api/mlflow.llama_index.html","mlflow.metrics":"api_reference/python_api/mlflow.metrics.html","mlflow.mistral":"api_reference/python_api/mlflow.mistral.html","mlflow.models":"api_reference/python_api/mlflow.models.html","mlflow.onnx":"api_reference/python_api/mlflow.onnx.html","mlflow.openai":"api_reference/python_api/mlflow.openai.html","mlflow.paddle":"api_reference/python_api/mlflow.paddle.html","mlflow.pmdarima":"api_reference/python_api/mlflow.pmdarima.html","mlflow.projects":"api_reference/python_api/mlflow.projects.html","mlflow.prophet":"api_reference/python_api/mlflow.prophet.html","mlflow.pydantic_ai":"api_reference/python_api/mlflow.pydantic_ai.html","mlflow.pyfunc":"api_reference/python_api/mlflow.pyfunc.html","mlflow.pyspark.ml":"api_reference/python_api/mlflow.pyspark.ml.html","mlflow.pytorch":"api_reference/python_api/mlflow.pytorch.html","mlflow":"api_reference/python_api/mlflow.html","mlflow.sagemaker":"api_reference/python_api/mlflow.sagemaker.html","mlflow.sentence_transformers":"api_reference/python_api/mlflow.sentence_transformers.html","mlflow.server":"api_reference/python_api/mlflow.server.html","mlflow.shap":"api_reference/python_api/mlflow.shap.html","mlflow.sklearn":"api_reference/python_api/mlflow.sklearn.html","mlflow.smolagents":"api_reference/python_api/mlflow.smolagents.html","mlflow.spacy":"api_reference/python_api/mlflow.spacy.html","mlflow.spark":"api_reference/python_api/mlflow.spark.html","mlflow.statsmodels":"api_reference/python_api/mlflow.statsmodels.html","mlflow.system_metrics":"api_reference/python_api/mlflow.system_metrics.html","mlflow.tensorflow":"api_reference/python_api/mlflow.tensorflow.html","mlflow.tracing":"api_reference/python_api/mlflow.tracing.html","mlflow.transformers":"api_reference/python_api/mlflow.transformers.html","mlflow.types":"api_reference/python_api/mlflow.types.html","mlflow.utils":"api_reference/python_api/mlflow.utils.html","mlflow.webhooks":"api_reference/python_api/mlflow.webhooks.html","mlflow.xgboost":"api_reference/python_api/mlflow.xgboost.html","mlflow.server.auth":"api_reference/auth/python-api.html","mlflow.server.cli":"api_reference/cli.html","mlflow.r":"api_reference/R-api.html","mlflow.java":"api_reference/java_api/index.html","mlflow.python":"api_reference/python_api/index.html","mlflow.rest":"api_reference/rest-api.html","mlflow.typescript":"api_reference/typescript_api/index.html","mlflow.llms.deployments.api":"api_reference/llms/deployments/api.html"}'),a=r(66497);function i({fn:e,children:l,hash:r}){let i=(e=>{let l=e.split(".");for(let e=l.length;e>0;e--){let r=l.slice(0,e).join(".");if(n[r])return r}return null})(e);if(!i)return(0,t.jsx)(t.Fragment,{children:l});let o=(0,a.default)(`/${n[i]}#${r??e}`);return(0,t.jsx)("a",{href:o,target:"_blank",children:l??(0,t.jsxs)("code",{children:[e,"()"]})})}},14591(e,l,r){r.d(l,{X:()=>n});var t=r(74848);function n({children:e}){return(0,t.jsx)("div",{className:"w-full overflow-x-auto",children:(0,t.jsx)("table",{children:e})})}},28453(e,l,r){r.d(l,{R:()=>i,x:()=>o});var t=r(96540);let n={},a=t.createContext(n);function i(e){let l=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(l):{...l,...e}},[l,e])}function o(e){let l;return l=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:i(e.components),t.createElement(a.Provider,{value:l},e.children)}}}]);