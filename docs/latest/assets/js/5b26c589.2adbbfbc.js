"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7803],{28453:(e,l,n)=>{n.d(l,{R:()=>a,x:()=>i});var o=n(96540);const t={},r=o.createContext(t);function a(e){const l=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(l):{...l,...e}}),[l,e])}function i(e){let l;return l=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),o.createElement(r.Provider,{value:l},e.children)}},50499:(e,l,n)=>{n.r(l),n.d(l,{assets:()=>d,contentTitle:()=>m,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"llms/custom-pyfunc-for-llms/index","title":"Deploying Advanced LLMs with Custom PyFuncs in MLflow","description":"Starting in MLflow 3.0.0, we recommend ResponsesAgent instead of ChatModel. See more details in the ResponsesAgent Introduction.","source":"@site/docs/llms/custom-pyfunc-for-llms/index.mdx","sourceDirName":"llms/custom-pyfunc-for-llms","slug":"/llms/custom-pyfunc-for-llms/","permalink":"/docs/latest/llms/custom-pyfunc-for-llms/","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Advanced Guide","permalink":"/docs/latest/llms/chat-model-guide/"},"next":{"title":"What is RAG?","permalink":"/docs/latest/llms/rag/"}}');var t=n(74848),r=n(28453),a=n(67756),i=n(86294);const s={},m="Deploying Advanced LLMs with Custom PyFuncs in MLflow",d={},c=[{value:"Explore the Tutorial",id:"explore-the-tutorial",level:2}];function p(e){const l={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.header,{children:(0,t.jsx)(l.h1,{id:"deploying-advanced-llms-with-custom-pyfuncs-in-mlflow",children:"Deploying Advanced LLMs with Custom PyFuncs in MLflow"})}),"\n",(0,t.jsx)(l.admonition,{title:"attention",type:"warning",children:(0,t.jsxs)(l.p,{children:["Starting in MLflow 3.0.0, we recommend ",(0,t.jsx)(a.B,{fn:"mlflow.pyfunc.ResponsesAgent",children:(0,t.jsx)(l.code,{children:"ResponsesAgent"})})," instead of ",(0,t.jsx)(a.B,{fn:"mlflow.pyfunc.ChatModel",children:(0,t.jsx)(l.code,{children:"ChatModel"})}),". See more details in the ",(0,t.jsx)(l.a,{href:"/llms/responses-agent-intro",children:"ResponsesAgent Introduction"}),"."]})}),"\n",(0,t.jsx)(l.p,{children:"Advanced Large Language Models (LLMs) such as the MPT-7B instruct transformer are intricate and have requirements that don't align with\ntraditional MLflow flavors. This demands a deeper understanding and the need for custom solutions."}),"\n",(0,t.jsx)(l.admonition,{type:"note",children:(0,t.jsxs)(l.p,{children:["This tutorial utilizes the ",(0,t.jsx)(a.B,{fn:"mlflow.pyfunc.PythonModel",children:(0,t.jsx)(l.code,{children:"mlflow.pyfunc.PythonModel"})})," class to create a custom PyFunc model for building custom GenAI solutions.\nIt is recommended to utilize the newer ",(0,t.jsx)(a.B,{fn:"mlflow.pyfunc.ChatModel",children:(0,t.jsx)(l.code,{children:"mlflow.pyfunc.ChatModel"})})," class for building custom implementations due to a simplified\ndevelopment experience and an easier approach to deployment. To learn more, see ",(0,t.jsx)(l.a,{href:"/llms/chat-model-guide",children:"the guide to building GenAI applications with ChatModel"}),"."]})}),"\n",(0,t.jsx)(l.admonition,{type:"tip",children:(0,t.jsxs)(l.p,{children:['MLflow 2.12.2 introduced the feature "models from code", which greatly simplifies the process of serializing and deploying custom models through the use\nof script serialization. While the tutorial here is valuable as a point of reference, we strongly recommend migrating custom model implementations to this\nnew paradigm. You can learn more about models from code within the ',(0,t.jsx)(l.a,{href:"/model/models-from-code",children:"Models From Code Guide"}),"."]})}),"\n",(0,t.jsx)(l.p,{children:"What's in this tutorial?"}),"\n",(0,t.jsx)(l.p,{children:"This guide is designed to provide insights into the deployment of advanced LLMs with MLflow, with a focus on using custom PyFuncs to address challenges:"}),"\n",(0,t.jsxs)(l.ul,{children:["\n",(0,t.jsxs)(l.li,{children:[(0,t.jsx)(l.strong,{children:"The World of LLMs"}),": An introduction to LLMs, particularly models like the MPT-7B instruct transformer.\nWe'll delve into their intricacies, importance, and the challenges associated with their deployment."]}),"\n",(0,t.jsxs)(l.li,{children:[(0,t.jsx)(l.strong,{children:"Why Custom PyFuncs for LLM Deployment?"}),": We'll explore the reasons behind the need for custom PyFuncs in the context of LLMs.\nHow do they provide a bridge, ensuring that LLMs can be seamlessly deployed while adhering to MLflow's standards?","\n",(0,t.jsxs)(l.ul,{children:["\n",(0,t.jsxs)(l.li,{children:[(0,t.jsx)(l.strong,{children:"Managing Complex Behaviors"}),": How custom PyFuncs can help in handling intricate model behaviors and dependencies that\naren't catered to by MLflow's default flavors."]}),"\n",(0,t.jsxs)(l.li,{children:[(0,t.jsx)(l.strong,{children:"Interface Data Manipulation"}),": Delve into how custom PyFuncs allow the manipulation of interface data to generate prompts,\nthereby simplifying end-user interactions in a RESTful environment."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(l.li,{children:[(0,t.jsx)(l.strong,{children:"Crafting Custom PyFuncs for LLM Deployment"}),": A step-by-step walkthrough on how to define, manage, and deploy an LLM using a custom PyFunc.\nWe'll look at how to design a ",(0,t.jsx)(l.em,{children:"pyfunc"})," to address LLM requirements and behaviors, and then how to deploy it using MLflow."]}),"\n",(0,t.jsxs)(l.li,{children:[(0,t.jsx)(l.strong,{children:"Challenges with Traditional LLM Deployment"}),": Recognize the issues and limitations when trying to deploy an advanced LLM using\nMLflow's built-in capabilities. Understand why custom PyFuncs become essential in such scenarios."]}),"\n"]}),"\n",(0,t.jsx)(l.p,{children:"By the conclusion of this guide, you'll possess a deep understanding of how to deploy advanced LLMs in MLflow using custom PyFuncs.\nYou'll appreciate the role of custom PyFuncs in making complex deployments streamlined and efficient."}),"\n",(0,t.jsx)(l.h2,{id:"explore-the-tutorial",children:"Explore the Tutorial"}),"\n",(0,t.jsx)(i.AC,{children:(0,t.jsx)(i._C,{headerText:"Serving LLMs with MLflow: Leveraging Custom PyFunc",link:"/llms/custom-pyfunc-for-llms/notebooks/custom-pyfunc-advanced-llm",text:"Learn how to use the MLflow Custom Pyfunc Model to serve Large Language Models (LLMs) in a RESTful environment."})})]})}function h(e={}){const{wrapper:l}={...(0,r.R)(),...e.components};return l?(0,t.jsx)(l,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}},67756:(e,l,n)=>{n.d(l,{B:()=>s});n(96540);const o=JSON.parse('{"mlflow.anthropic":"api_reference/python_api/mlflow.anthropic.html","mlflow.artifacts":"api_reference/python_api/mlflow.artifacts.html","mlflow.ag2":"api_reference/python_api/mlflow.ag2.html","mlflow.autogen":"api_reference/python_api/mlflow.autogen.html","mlflow.bedrock":"api_reference/python_api/mlflow.bedrock.html","mlflow.catboost":"api_reference/python_api/mlflow.catboost.html","mlflow.client":"api_reference/python_api/mlflow.client.html","mlflow.config":"api_reference/python_api/mlflow.config.html","mlflow.crewai":"api_reference/python_api/mlflow.crewai.html","mlflow.data":"api_reference/python_api/mlflow.data.html","mlflow.deployments":"api_reference/python_api/mlflow.deployments.html","mlflow.diviner":"api_reference/python_api/mlflow.diviner.html","mlflow.dspy":"api_reference/python_api/mlflow.dspy.html","mlflow.entities":"api_reference/python_api/mlflow.entities.html","mlflow.environment_variables":"api_reference/python_api/mlflow.environment_variables.html","mlflow.gateway":"api_reference/python_api/mlflow.gateway.html","mlflow.gemini":"api_reference/python_api/mlflow.gemini.html","mlflow.groq":"api_reference/python_api/mlflow.groq.html","mlflow.h2o":"api_reference/python_api/mlflow.h2o.html","mlflow.johnsnowlabs":"api_reference/python_api/mlflow.johnsnowlabs.html","mlflow.keras":"api_reference/python_api/mlflow.keras.html","mlflow.langchain":"api_reference/python_api/mlflow.langchain.html","mlflow.lightgbm":"api_reference/python_api/mlflow.lightgbm.html","mlflow.litellm":"api_reference/python_api/mlflow.litellm.html","mlflow.llama_index":"api_reference/python_api/mlflow.llama_index.html","mlflow.metrics":"api_reference/python_api/mlflow.metrics.html","mlflow.mistral":"api_reference/python_api/mlflow.mistral.html","mlflow.models":"api_reference/python_api/mlflow.models.html","mlflow.onnx":"api_reference/python_api/mlflow.onnx.html","mlflow.openai":"api_reference/python_api/mlflow.openai.html","mlflow.paddle":"api_reference/python_api/mlflow.paddle.html","mlflow.pmdarima":"api_reference/python_api/mlflow.pmdarima.html","mlflow.projects":"api_reference/python_api/mlflow.projects.html","mlflow.promptflow":"api_reference/python_api/mlflow.promptflow.html","mlflow.prophet":"api_reference/python_api/mlflow.prophet.html","mlflow.pyfunc":"api_reference/python_api/mlflow.pyfunc.html","mlflow.pyspark.ml":"api_reference/python_api/mlflow.pyspark.ml.html","mlflow.pytorch":"api_reference/python_api/mlflow.pytorch.html","mlflow":"api_reference/python_api/mlflow.html","mlflow.sagemaker":"api_reference/python_api/mlflow.sagemaker.html","mlflow.sentence_transformers":"api_reference/python_api/mlflow.sentence_transformers.html","mlflow.server":"api_reference/python_api/mlflow.server.html","mlflow.shap":"api_reference/python_api/mlflow.shap.html","mlflow.sklearn":"api_reference/python_api/mlflow.sklearn.html","mlflow.spacy":"api_reference/python_api/mlflow.spacy.html","mlflow.spark":"api_reference/python_api/mlflow.spark.html","mlflow.statsmodels":"api_reference/python_api/mlflow.statsmodels.html","mlflow.system_metrics":"api_reference/python_api/mlflow.system_metrics.html","mlflow.tensorflow":"api_reference/python_api/mlflow.tensorflow.html","mlflow.tracing":"api_reference/python_api/mlflow.tracing.html","mlflow.transformers":"api_reference/python_api/mlflow.transformers.html","mlflow.types":"api_reference/python_api/mlflow.types.html","mlflow.utils":"api_reference/python_api/mlflow.utils.html","mlflow.xgboost":"api_reference/python_api/mlflow.xgboost.html","mlflow.server.auth":"api_reference/auth/python-api.html"}');var t=n(29030),r=n(56289),a=n(74848);const i=e=>{const l=e.split(".");for(let n=l.length;n>0;n--){const e=l.slice(0,n).join(".");if(o[e])return e}return null};function s(e){let{fn:l,children:n}=e;const s=i(l);if(!s)return(0,a.jsx)(a.Fragment,{children:n});const m=(0,t.Ay)(`/${o[s]}#${l}`);return(0,a.jsx)(r.A,{to:m,target:"_blank",children:n??(0,a.jsxs)("code",{children:[l,"()"]})})}},86294:(e,l,n)=>{n.d(l,{Zp:()=>s,AC:()=>i,WO:()=>d,tf:()=>p,_C:()=>m,$3:()=>c,jK:()=>h});var o=n(34164);const t={CardGroup:"CardGroup_P84T",MaxThreeColumns:"MaxThreeColumns_FO1r",AutofillColumns:"AutofillColumns_fKhQ",Card:"Card_aSCR",CardBordered:"CardBordered_glGF",CardBody:"CardBody_BhRs",TextColor:"TextColor_a8Tp",BoxRoot:"BoxRoot_Etgr",FlexWrapNowrap:"FlexWrapNowrap_f60k",FlexJustifyContentFlexStart:"FlexJustifyContentFlexStart_ZYv5",FlexDirectionRow:"FlexDirectionRow_T2qL",FlexAlignItemsCenter:"FlexAlignItemsCenter_EHVM",FlexFlex:"FlexFlex__JTE",Link:"Link_fVkl",MarginLeft4:"MarginLeft4_YQSJ",MarginTop4:"MarginTop4_jXKN",PaddingBottom4:"PaddingBottom4_O9gt",LogoCardContent:"LogoCardContent_kCQm",LogoCardImage:"LogoCardImage_JdcX",SmallLogoCardContent:"SmallLogoCardContent_LxhV",SmallLogoCardImage:"SmallLogoCardImage_tPZl",NewFeatureCardContent:"NewFeatureCardContent_Rq3d",NewFeatureCardHeading:"NewFeatureCardHeading_f6q3",NewFeatureCardHeadingSeparator:"NewFeatureCardHeadingSeparator_pSx8",NewFeatureCardTags:"NewFeatureCardTags_IFHO",NewFeatureCardWrapper:"NewFeatureCardWrapper_NQ0k",TitleCardContent:"TitleCardContent_l9MQ",TitleCardTitle:"TitleCardTitle__K8J",TitleCardSeparator:"TitleCardSeparator_IN2E",Cols1:"Cols1_Gr2U",Cols2:"Cols2_sRvc",Cols3:"Cols3_KjUS",Cols4:"Cols4_dKOj",Cols5:"Cols5_jDmj",Cols6:"Cols6_Q0OR"};var r=n(56289),a=n(74848);const i=e=>{let{children:l,isSmall:n,cols:r}=e;return(0,a.jsx)("div",{className:(0,o.A)(t.CardGroup,n?t.AutofillColumns:r?t[`Cols${r}`]:t.MaxThreeColumns),children:l})},s=e=>{let{children:l,link:n=""}=e;return n?(0,a.jsx)(r.A,{className:(0,o.A)(t.Link,t.Card,t.CardBordered),to:n,children:l}):(0,a.jsx)("div",{className:(0,o.A)(t.Card,t.CardBordered),children:l})},m=e=>{let{headerText:l,link:n,text:r}=e;return(0,a.jsx)(s,{link:n,children:(0,a.jsxs)("span",{children:[(0,a.jsx)("div",{className:(0,o.A)(t.CardTitle,t.BoxRoot,t.PaddingBottom4),style:{pointerEvents:"none"},children:(0,a.jsx)("div",{className:(0,o.A)(t.BoxRoot,t.FlexFlex,t.FlexAlignItemsCenter,t.FlexDirectionRow,t.FlexJustifyContentFlexStart,t.FlexWrapNowrap),style:{marginLeft:"-4px",marginTop:"-4px"},children:(0,a.jsx)("div",{className:(0,o.A)(t.BoxRoot,t.BoxHideIfEmpty,t.MarginTop4,t.MarginLeft4),style:{pointerEvents:"auto"},children:(0,a.jsx)("span",{className:"",children:l})})})}),(0,a.jsx)("span",{className:(0,o.A)(t.TextColor,t.CardBody),children:(0,a.jsx)("p",{children:r})})]})})},d=e=>{let{description:l,children:n,link:o}=e;return(0,a.jsx)(s,{link:o,children:(0,a.jsxs)("div",{className:t.LogoCardContent,children:[(0,a.jsx)("div",{className:t.LogoCardImage,children:n}),(0,a.jsx)("p",{className:t.TextColor,children:l})]})})},c=e=>{let{children:l,link:n}=e;return(0,a.jsx)(s,{link:n,children:(0,a.jsx)("div",{className:t.SmallLogoCardContent,children:(0,a.jsx)("div",{className:(0,o.A)("max-height-img-container",t.SmallLogoCardImage),children:l})})})},p=e=>{let{children:l,description:n,name:o,releaseVersion:i,learnMoreLink:m=""}=e;return(0,a.jsx)(s,{children:(0,a.jsxs)("div",{className:t.NewFeatureCardWrapper,children:[(0,a.jsxs)("div",{className:t.NewFeatureCardContent,children:[(0,a.jsxs)("div",{className:t.NewFeatureCardHeading,children:[o,(0,a.jsx)("br",{}),(0,a.jsx)("hr",{className:t.NewFeatureCardHeadingSeparator})]}),(0,a.jsx)("div",{className:t.LogoCardImage,children:l}),(0,a.jsx)("br",{}),(0,a.jsx)("p",{children:n}),(0,a.jsx)("br",{})]}),(0,a.jsxs)("div",{className:t.NewFeatureCardTags,children:[(0,a.jsx)("div",{children:m&&(0,a.jsx)(r.A,{className:"button button--outline button--sm button--primary",to:m,children:"Learn more"})}),(0,a.jsxs)(r.A,{className:"button button--outline button--sm button--primary",to:`https://github.com/mlflow/mlflow/releases/tag/v${i}`,children:["released in ",i]})]})]})})},h=e=>{let{title:l,description:n,link:r=""}=e;return(0,a.jsx)(s,{link:r,children:(0,a.jsxs)("div",{className:t.TitleCardContent,children:[(0,a.jsx)("div",{className:(0,o.A)(t.TitleCardTitle),style:{textAlign:"left",fontWeight:"bold"},children:l}),(0,a.jsx)("hr",{className:(0,o.A)(t.TitleCardSeparator),style:{margin:"12px 0"}}),(0,a.jsx)("p",{className:(0,o.A)(t.TextColor),children:n})]})})}}}]);