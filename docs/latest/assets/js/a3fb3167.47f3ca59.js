"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2422],{14563:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>m,frontMatter:()=>a,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"search-runs/index","title":"Search Runs","description":"This guide will walk you through how to search your MLflow runs through the MLflow UI and Python API.","source":"@site/docs/search-runs/index.mdx","sourceDirName":"search-runs","slug":"/search-runs/","permalink":"/docs/latest/search-runs/","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":20,"frontMatter":{"sidebar_position":20},"sidebar":"docsSidebar","previous":{"title":"Remote Experiment Tracking with MLflow Tracking Server","permalink":"/docs/latest/tracking/tutorials/remote-server/"},"next":{"title":"Search Experiments","permalink":"/docs/latest/search-experiments/"}}');var t=s(74848),i=s(28453),l=s(67756);const a={sidebar_position:20},o="Search Runs",c={},d=[{value:"Search Runs on MLflow UI",id:"search-runs-on-mlflow-ui",level:2},{value:"Create Example MLflow Runs",id:"create-example-mlflow-runs",level:3},{value:"Search Query Example",id:"search-runs-syntax",level:3},{value:"Search Syntax Overview",id:"search-syntax-overview",level:3},{value:"Search Query Syntax Deep Dive",id:"search-query-syntax-deep-dive",level:3},{value:"Example Queries",id:"example-queries",level:3},{value:"1 - Searching By Metrics",id:"1---searching-by-metrics",level:4},{value:"2 - Searching By Params",id:"2---searching-by-params",level:4},{value:"3 - Searching By Tags",id:"mlflow_tags",level:4},{value:"4 - Searching By Dataset Information",id:"4---searching-by-dataset-information",level:4},{value:"5 - Searching By Run&#39;s Metadata",id:"5---searching-by-runs-metadata",level:4},{value:"6 - Searching over a Set",id:"6---searching-over-a-set",level:4},{value:"7 - Chained Queries",id:"7---chained-queries",level:4},{value:"8 - Non-None Queries",id:"8---non-none-queries",level:4},{value:"Programmatically Searching Runs",id:"programmatically-searching-runs",level:2},{value:"Python",id:"python",level:3},{value:"1 - Complex Filter",id:"1---complex-filter",level:4},{value:"2 - <code>run_view_type</code>",id:"2---run_view_type",level:4},{value:"3 - Ordering",id:"3---ordering",level:4},{value:"4 - Searching All Experiments",id:"4---searching-all-experiments",level:4},{value:"R",id:"r",level:3},{value:"Java",id:"java",level:3}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"search-runs",children:"Search Runs"})}),"\n",(0,t.jsx)(n.p,{children:"This guide will walk you through how to search your MLflow runs through the MLflow UI and Python API.\nThis resource will be valuable if you're interested in querying specific runs based on their metrics,\nparams, tags, dataset information, or run metadata."}),"\n",(0,t.jsxs)(n.p,{children:["In short, you can leverage SQL-like syntax to filter your runs based on a variety of conditions.\nNote that the ",(0,t.jsx)(n.code,{children:"OR"})," keyword is not supported and there are a few other differences from SQL\nmentioned below, but despite these limitations, the run search functionality is quite powerful."]}),"\n",(0,t.jsx)(n.h2,{id:"search-runs-on-mlflow-ui",children:"Search Runs on MLflow UI"}),"\n",(0,t.jsx)(n.p,{children:"The MLflow UI provides a powerful search interface that allows you to filter runs. Below we'll..."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Create example MLflow runs"}),"\n",(0,t.jsx)(n.li,{children:"Look at a simple querying example"}),"\n",(0,t.jsx)(n.li,{children:"Deep dive into query syntax"}),"\n",(0,t.jsx)(n.li,{children:"Provide a variety of example queries"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"create-example-mlflow-runs",children:"Create Example MLflow Runs"}),"\n",(0,t.jsx)(n.p,{children:"First, let's create some example MLflow runs. This documentation is based on experiments created\nwith the below script. If you don't want to interactively explore this on your machine, skip\nthis section."}),"\n",(0,t.jsx)(n.p,{children:"Before running the script, let's simply start the MLflow UI on a local host."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"mlflow ui\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Let's visit ",(0,t.jsx)(n.code,{children:"http://localhost:5000/"})," in our web browser. After doing so, you'll notice that we don't\nhave any experiments or models. Let's resolve this by creating a few MLflow runs via the script\nbelow."]}),"\n",(0,t.jsxs)(n.p,{children:["Note that when you run this script, you'll want to do so from the same directory that you ran\nthe ",(0,t.jsx)(n.code,{children:"mlflow ui"})," command."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'import mlflow\nimport numpy as np\n\nmlflow.set_experiment("search-run-guide")\n\naccuracy = np.arange(0, 1, 0.1)\nloss = np.arange(1, 0, -0.1)\nlog_scale_loss = np.log(loss)\nf1_score = np.arange(0, 1, 0.1)\n\nbatch_size = [2] * 5 + [4] * 5\nlearning_rate = [0.001, 0.01] * 5\nmodel = ["GPT-2", "GPT-3", "GPT-3.5", "GPT-4"] + [None] * 6\n\ntask = ["classification", "regression", "causal lm"] + [None] * 7\nenvironment = ["notebook"] * 5 + [None] * 5\n\ndataset_name = ["custom"] * 5 + ["also custom"] * 5\ndataset_digest = ["s8ds293b", "jks834s2"] + [None] * 8\ndataset_context = ["train"] * 5 + ["test"] * 5\n\nfor i in range(10):\n    with mlflow.start_run():\n        mlflow.log_metrics(\n            {\n                "loss": loss[i],\n                "accuracy": accuracy[i],\n                "log-scale-loss": log_scale_loss[i],\n                "f1 score": f1_score[i],\n            }\n        )\n\n        mlflow.log_params(\n            {\n                "batch_size": batch_size[i],\n                "learning rate": learning_rate[i],\n                "model": model[i],\n            }\n        )\n\n        mlflow.set_tags(\n            {\n                "task": task[i],\n                "environment": environment[i],\n            }\n        )\n\n        dataset = mlflow.data.from_numpy(\n            features=np.random.uniform(size=[20, 28, 28, 3]),\n            targets=np.random.randint(0, 10, size=[20]),\n            name=dataset_name[i],\n            digest=dataset_digest[i],\n        )\n        mlflow.log_input(dataset, context=dataset_context[i])\n'})}),"\n",(0,t.jsx)(n.p,{children:'The code above creates 10 MLflow runs with different metrics, params, tags and dataset information.\nAfter successful execution, if you return to the MLflow UI in your browser, you should find all of\nthese runs under the experiment "search-run-guide", as shown by the following screenshot:'}),"\n",(0,t.jsx)("div",{class:"center-div",style:{width:"90%"},children:(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"testing runs",src:s(92320).A+"",width:"2290",height:"1192"})})}),"\n",(0,t.jsx)(n.p,{children:"In real-world production deployments of MLflow, it's common to have thousands or even hundreds of thousands of\nruns. In such cases, it's important to be able to filter and search for runs based on specific criteria."}),"\n",(0,t.jsx)(n.h3,{id:"search-runs-syntax",children:"Search Query Example"}),"\n",(0,t.jsxs)(n.p,{children:["In order to filter your MLflow runs, you will need to write ",(0,t.jsx)(n.strong,{children:"search queries"}),", which are pseudo-SQL\nconditions expressed in a distinct syntax."]}),"\n",(0,t.jsx)(n.p,{children:"To showcase this functionality, let's look at the below code examples."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"import mlflow\n\nall_runs = mlflow.search_runs(search_all_experiments=True)\nprint(all_runs)\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-_",metastring:'title="Output"',children:"                             run_id  ... tags.mlflow.user\n0  5984a3488161440f92de9847e846b342  ...     michael.berk\n1  41160f238a5841998dda263794b26067  ...     michael.berk\n2  babe221a676b4fa4b204f8240f2c4f14  ...     michael.berk\n3  45eb4f02c5a1461aa6098fa550233be6  ...     michael.berk\n4  1c7c459486c44b23bb016028aee1f153  ...     michael.berk\n5  4453f59f1ab04491bb9582d8cba5f437  ...     michael.berk\n6  22db81f070f6413588641c8c343cdd72  ...     michael.berk\n7  c3680e37d0fa44eb9c9fb7828f6b5481  ...     michael.berk\n8  67973142b9c0470d8d764ada07c5a988  ...     michael.berk\n9  59853d5f17f946218f63de1dc82de07b  ...     michael.berk\n\n[10 rows x 19 columns]\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Second, let's try filtering the runs for our really bad models: ",(0,t.jsx)(n.code,{children:"metrics.loss > 0.8"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'import mlflow\n\nbad_runs = mlflow.search_runs(\n    filter_string="metrics.loss > 0.8", search_all_experiments=True\n)\nprint(bad_runs)\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-_",metastring:'title="Output"',children:"                             run_id  ... tags.mlflow.source.name\n0  67973142b9c0470d8d764ada07c5a988  ...               delete.py\n1  59853d5f17f946218f63de1dc82de07b  ...               delete.py\n\n[2 rows x 19 columns]\n"})}),"\n",(0,t.jsx)(n.p,{children:"You'll notice that we now are displaying 2 runs instead of 10. Pretty easy, right?"}),"\n",(0,t.jsx)(n.h3,{id:"search-syntax-overview",children:"Search Syntax Overview"}),"\n",(0,t.jsx)(n.p,{children:"MLflow's Search functionality leverages a Domain Specific Language (DSL) for querying. It is inspired by SQL but does not\noffer the full range of SQL capabilities."}),"\n",(0,t.jsxs)(n.p,{children:['This section describes the syntax formatting, focusing on "left side" and "right side" elements in search queries. The\n"left side" pertains to the field being filtered, such as ',(0,t.jsx)(n.code,{children:"metrics.loss"}),', while the "right side" relates to the value against which\nthe field is being compared, like ',(0,t.jsx)(n.code,{children:"0.8"}),"."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Visual Representation of Search Components:"})}),"\n",(0,t.jsx)("div",{class:"center-div",style:{width:"30%"},children:(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"search components",src:s(20139).A+"",width:"439",height:"142"})})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Valid Syntax for Left and Right Side Elements:"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Left Side Syntax:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Fields without special characters or reserved keywords can be referenced directly (e.g., ",(0,t.jsx)(n.code,{children:"tag.test"}),")."]}),"\n",(0,t.jsx)(n.li,{children:"Use backticks for fields that contain special characters or are reserved keywords."}),"\n",(0,t.jsxs)(n.li,{children:["Double quotes are also acceptable for enclosing field names (e.g., ",(0,t.jsx)(n.code,{children:'tag."test"'}),")."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Unsupported:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Single quotes are ",(0,t.jsx)(n.strong,{children:"not valid"})," for enclosing field names (e.g., ",(0,t.jsx)(n.code,{children:"tag.'test'"})," results in a syntax error)."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Right Side Syntax:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Enclose values in single or double quotes based on content requirements (e.g., ",(0,t.jsx)(n.code,{children:"tag.`test` = 'abc'"})," or ",(0,t.jsx)(n.code,{children:'tag.`test` = "abc"'}),")."]}),"\n",(0,t.jsxs)(n.li,{children:["Non-metric values, ",(0,t.jsx)(n.strong,{children:"including numeric values"})," that may be stored as tags or as parameters must be enclosed in quotations."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Unsupported:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Using backticks or no wrapping for values is not allowed. Examples of invalid syntax include:"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This results in a syntax error as backticks cannot be used for right-hand values."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"tag.`test` = `abc`\n"})}),"\n",(0,t.jsx)(n.p,{children:"This results in a syntax error as values must be wrapped in double quotes if they are not metrics."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"tag.`test` = abc\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"search-query-syntax-deep-dive",children:"Search Query Syntax Deep Dive"}),"\n",(0,t.jsx)(n.p,{children:"As noted above, MLflow search syntax is similar to SQL with a few notable exceptions."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The SQL ",(0,t.jsx)(n.code,{children:"OR"})," keyword is not supported."]}),"\n",(0,t.jsxs)(n.li,{children:["For fields that contain special characters or start with numbers, these should be wrapped in ",(0,t.jsx)(n.strong,{children:"backticks"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-diff",children:'- Bad:  metrics.cross-entropy-loss < 0.5\n+ Good: metrics.`cross-entropy-loss` < 0.5\n\n- Bad:  params.1st_iteration_timestamp = "2022-01-01"\n+ Good: params.`1st_iteration_timestamp` = "2022-01-01"\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["For the SQL ",(0,t.jsx)(n.code,{children:"IN"})," keyword, you must surround the values of your list with ",(0,t.jsx)(n.strong,{children:"single quotes"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-diff",children:"- Bad:  attributes.run_id IN (\"5984a3488161440f92de9847e846b342\", \"babe221a676b4fa4b204f8240f2c4f14\")\n+ Good: attributes.run_id IN ('5984a3488161440f92de9847e846b342', 'babe221a676b4fa4b204f8240f2c4f14')\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["For the SQL ",(0,t.jsx)(n.code,{children:"IN"})," keyword, you can only search the following fields:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"datasets.name"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"datasets.digest"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"datasets.context"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"attributes.run_id"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Non-None conditions for numeric fields are not supported e.g. ",(0,t.jsx)(n.code,{children:'metrics.accuracy != "None"'})," will fail."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Other than the that, the syntax should be intuitive to anyone who has used SQL. To assemble\na single search condition, you must assemble an inequality using the following components..."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"An MLflow field"}),": a metric, param, tag, dataset or run metadata."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"A comparator"}),": an inequality operator."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["For numerics, MLflow supports ",(0,t.jsx)(n.code,{children:"="}),", ",(0,t.jsx)(n.code,{children:"!="}),", ",(0,t.jsx)(n.code,{children:">"}),", ",(0,t.jsx)(n.code,{children:">="}),", ",(0,t.jsx)(n.code,{children:"<"}),", and ",(0,t.jsx)(n.code,{children:"<="}),". Examples include:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"metrics.accuracy > 0.72\nmetrics.loss <= 0.15\nmetrics.accuracy != 0.15\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["For strings, MLflow supports ",(0,t.jsx)(n.code,{children:"="}),", ",(0,t.jsx)(n.code,{children:"!="}),", ",(0,t.jsx)(n.code,{children:"LIKE"})," (case-sensitive) and ",(0,t.jsx)(n.code,{children:"ILIKE"})," (case-insensitive). Examples include:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'params.model = "GPT-4o"\nparams.model LIKE "GPT%"\nparams.model ILIKE "gpt%"\n'})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["For sets, MLflow supports ",(0,t.jsx)(n.code,{children:"IN"}),". Examples include:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"datasets.name IN ('custom', 'also custom', 'another custom name')\ndatasets.digest IN ('s8ds293b', 'jks834s2')\nattributes.run_id IN ('5984a3488161440f92de9847e846b342')\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"A reference value"}),": a numeric value, string, or set of strings."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Let's look at some more examples."}),"\n",(0,t.jsx)(n.h3,{id:"example-queries",children:"Example Queries"}),"\n",(0,t.jsxs)(n.p,{children:["In this section we will go over how to search by different categories of MLflow fields. For each category we provide\na few sample queries. If you have executed the run creation script we provided, these queries should fetch certain runs\nbut sometimes require modification for run-specific information, such as ",(0,t.jsx)(n.code,{children:"start_time"}),"."]}),"\n",(0,t.jsx)(n.h4,{id:"1---searching-by-metrics",children:"1 - Searching By Metrics"}),"\n",(0,t.jsxs)(n.p,{children:["Metrics are quantitative measures typically used to evaluate the model's performance during\nor after training. Metrics can include values like accuracy, precision, recall, F1 score, etc., and\ncan change over time as the model trains. They are logged manually via ",(0,t.jsx)(n.code,{children:"mlflow.log_metric"})," or\n",(0,t.jsx)(n.code,{children:"mlflow.log_metrics"})," or automatically via autologging."]}),"\n",(0,t.jsxs)(n.p,{children:["To search for runs by filtering on metrics, you must include the ",(0,t.jsx)(n.code,{children:"metrics"})," prefix in the left\nside of the inequality. Note that they are ",(0,t.jsx)(n.strong,{children:"stored as numbers"}),", so you must use numeric comparators."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'metrics.accuracy > 0.72\nmetrics."accuracy" > 0.72\nmetrics.loss <= 0.15\nmetrics.`log-scale-loss` <= 0\nmetrics.`f1 score` >= 0.5\nmetrics.accuracy > 0.72 AND metrics.loss <= 0.15\n'})}),"\n",(0,t.jsx)(n.h4,{id:"2---searching-by-params",children:"2 - Searching By Params"}),"\n",(0,t.jsxs)(n.p,{children:["Params are strings that typically represent the configuration aspects of the model. Parameters can include values\nlike learning rate, batch size, and number of epochs. They are logged manually via ",(0,t.jsx)(n.code,{children:"mlflow.log_param"}),"\nor ",(0,t.jsx)(n.code,{children:"mlflow.log_params"})," or automatically via autologging."]}),"\n",(0,t.jsxs)(n.p,{children:["To search for runs by filtering on params, you must include the ",(0,t.jsx)(n.code,{children:"params"})," prefix in the left\nside of the inequality. Note that they are ",(0,t.jsx)(n.strong,{children:"stored as strings"}),", so you must use string\ncomparators, such as ",(0,t.jsx)(n.code,{children:"="})," and ",(0,t.jsx)(n.code,{children:"!="}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["Note that numeric values stored as parameters are cast to string in the tracking store.\nWhen querying for numeric parameters, you must specify them as strings by enclosing them in ",(0,t.jsx)(n.strong,{children:"double quotes"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'params.batch_size = "2"\nparams.model LIKE "GPT%"\nparams.model ILIKE "gPt%"\nparams.model LIKE "GPT%" AND params.batch_size = "2"\n'})}),"\n",(0,t.jsx)(n.h4,{id:"mlflow_tags",children:"3 - Searching By Tags"}),"\n",(0,t.jsxs)(n.p,{children:["Tags are metadata that typically provide additional context about the run. Tags can include values\nlike user name, team, etc. They are logged manually via ",(0,t.jsx)(n.code,{children:"mlflow.set_tag"}),"\nor ",(0,t.jsx)(n.code,{children:"mlflow.set_tags"}),". In addition, ",(0,t.jsx)(n.a,{href:"/tracking/tracking-api/#system_tags",children:"system tags"}),",\nsuch as ",(0,t.jsx)(n.code,{children:"mlflow.user"}),", are automatically logged."]}),"\n",(0,t.jsxs)(n.p,{children:["To search for runs by filtering on tags, you must include the ",(0,t.jsx)(n.code,{children:"tags"})," or ",(0,t.jsx)(n.code,{children:"mlflow"})," prefixes in\nthe left side of the inequality. Note that tags are ",(0,t.jsx)(n.strong,{children:"stored as strings"}),", so you must use string\ncomparators, such as ",(0,t.jsx)(n.code,{children:"="})," and ",(0,t.jsx)(n.code,{children:"!="}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'tags."environment" = "notebook"\ntags.environment = "notebook"\ntags.task = "Classification"\ntags.task ILIKE "classif%"\n'})}),"\n",(0,t.jsx)(n.h4,{id:"4---searching-by-dataset-information",children:"4 - Searching By Dataset Information"}),"\n",(0,t.jsxs)(n.p,{children:["Datasets represent data used in model training or evaluation, including features, targets,\npredictions, and metadata such as the dataset's name, digest (hash) schema, profile, and source.\nThey are logged via ",(0,t.jsx)(n.code,{children:"mlflow.log_input"})," or automatically via autologging."]}),"\n",(0,t.jsx)(n.p,{children:"To search for runs by filtering on dataset information, you must filter on one of the below fields"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"datasets.name"}),", which is the dataset's name."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"datasets.digest"}),", which is a unique identifier for the dataset."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"datasets.context"}),", which represents if the dataset is used for train, evaluation or test."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Note that dataset information is ",(0,t.jsx)(n.strong,{children:"stored as strings"}),", so you must use string comparators, such as ",(0,t.jsx)(n.code,{children:"="})," and ",(0,t.jsx)(n.code,{children:"!="}),".\nAlso note that datasets support set comparators, such as ",(0,t.jsx)(n.code,{children:"IN"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"datasets.name LIKE \"custom\"\ndatasets.digest IN ('s8ds293b', 'jks834s2')\ndatasets.context = \"train\"\n"})}),"\n",(0,t.jsx)(n.h4,{id:"5---searching-by-runs-metadata",children:"5 - Searching By Run's Metadata"}),"\n",(0,t.jsx)(n.p,{children:"Run metadata are a variety of user-specified and system-generated attributes that provide additional context about the run."}),"\n",(0,t.jsxs)(n.p,{children:["To search for runs by filtering on the metadata of runs, you must include the ",(0,t.jsx)(n.code,{children:"attributes"})," prefix in the left\nside of the inequality. Note that run metadata can be either a string or a numeric depending on the\nattribute, so you must use the appropriate comparator. For a complete list of attributes, see"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(l.B,{fn:"mlflow.entities.RunInfo",children:"mlflow.entities.RunInfo"}),", however note that not all fields in the RunInfo object are searchable."]}),"\n",(0,t.jsxs)(n.p,{children:["To search for runs by filtering on tags, you must include the ",(0,t.jsx)(n.code,{children:"tags"})," or ",(0,t.jsx)(n.code,{children:"mlflow"})," prefixes in\nthe left side of the inequality. Note that tags are ",(0,t.jsx)(n.strong,{children:"stored as strings"}),", so you must use string\ncomparators, such as ",(0,t.jsx)(n.code,{children:"="})," and ",(0,t.jsx)(n.code,{children:"!="}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",metastring:'title="Examples for Strings"',children:'attributes.status = "ACTIVE"\nattributes.user_id LIKE "user1"\nattributes.run_name = "my-run"\nattributes.run_id = "a1b2c3d4"\nattributes.run_id IN (\'a1b2c3d4\', \'e5f6g7h8\')\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",metastring:'title="Examples for Numerics"',children:"attributes.start_time >= 1664067852747\nattributes.end_time < 1664067852747\nattributes.created > 1664067852747\n"})}),"\n",(0,t.jsx)(n.h4,{id:"6---searching-over-a-set",children:"6 - Searching over a Set"}),"\n",(0,t.jsxs)(n.p,{children:["You can search for runs by filtering on a set of acceptable values via the ",(0,t.jsx)(n.code,{children:"IN"})," keyword. As noted\nabove, this is only supported for the following fields:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"datasets.{any_attribute}"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"attributes.run_id"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"datasets.name IN ('custom', 'also custom')\ndatasets.digest IN ('s8ds293b', 'jks834s2')\nattributes.run_id IN ('a1b2c3d4', 'e5f6g7h8')\n"})}),"\n",(0,t.jsx)(n.h4,{id:"7---chained-queries",children:"7 - Chained Queries"}),"\n",(0,t.jsxs)(n.p,{children:["You can chain multiple queries together using the ",(0,t.jsx)(n.code,{children:"AND"})," keyword. For example, to search for runs\nwith a variety of conditions, you can use the following queries:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"metrics.accuracy > 0.72 AND metrics.loss <= 0.15\nmetrics.accuracy > 0.72 AND metrics.batch_size != 0\nmetrics.accuracy > 0.72 AND metrics.batch_size != 0 AND attributes.run_id IN ('a1b2c3d4', 'e5f6g7h8')\n"})}),"\n",(0,t.jsxs)(n.p,{children:["You can also apply multiple conditions on the same field, for example searching for all loss metrics\n",(0,t.jsx)(n.code,{children:"BETWEEN"})," 0.1 and 0.15, inclusive:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"metrics.loss <= 0.15 AND metrics.loss >= 0.1\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Finally, before moving on it's important to revisit that that you cannot use the ",(0,t.jsx)(n.code,{children:"OR"})," keyword in\nyour queries."]}),"\n",(0,t.jsx)(n.h4,{id:"8---non-none-queries",children:"8 - Non-None Queries"}),"\n",(0,t.jsxs)(n.p,{children:["To search for runs where a field (only type string is supported) is not null, use the\n",(0,t.jsx)(n.code,{children:'field != "None"'})," syntax. For example, to search for runs where the batch_size is not null, you\ncan use the following query:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'params.batch_size != "None"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"programmatically-searching-runs",children:"Programmatically Searching Runs"}),"\n",(0,t.jsx)(n.p,{children:"When scaling out to large production systems, typically you'll want to interact with your runs\noutside the MLflow UI. This can be done programmatically using the MLflow client APIs."}),"\n",(0,t.jsx)(n.h3,{id:"python",children:"Python"}),"\n",(0,t.jsxs)(n.p,{children:["",(0,t.jsx)(l.B,{fn:"mlflow.client.MlflowClient.search_runs"})," or ",(0,t.jsx)(l.B,{fn:"mlflow.search_runs"})," take\nthe same arguments as the above UI examples and more! They return all the runs that match the specified\nfilters. Your best resource is the docstrings for each of these functions, but here are some useful examples."]}),"\n",(0,t.jsx)(n.h4,{id:"1---complex-filter",children:"1 - Complex Filter"}),"\n",(0,t.jsx)(n.p,{children:"Python provides powerful ways to build these queries programmatically. Some tips:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["For complex filters, specifically those with both single and double quotes, use multi-line strings or ",(0,t.jsx)(n.code,{children:'\\\\"'})," to escape the quotes."]}),"\n",(0,t.jsxs)(n.li,{children:["When working with lists, use the ",(0,t.jsx)(n.code,{children:".join()"})," method to concatenate the list elements with a delimiter."]}),"\n",(0,t.jsx)(n.li,{children:"It's often most concise to use the fluent APIs, so below we demo only with the fluent API."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'import mlflow\n\nrun_ids = ["22db81f070f6413588641c8c343cdd72", "c3680e37d0fa44eb9c9fb7828f6b5481"]\nrun_id_condition = "\'" + "\',\'".join(run_ids) + "\'"\n\ncomplex_filter = f"""\nattributes.run_id IN ({run_id_condition})\n  AND metrics.loss > 0.3\n  AND metrics."f1 score" < 0.5\n  AND params.model LIKE "GPT%"\n"""\n\nruns_with_complex_filter = mlflow.search_runs(\n    experiment_names=["search-run-guide"],\n    filter_string=complex_filter,\n)\nprint(runs_with_complex_filter)\n'})}),"\n",(0,t.jsx)(n.p,{children:"The output will be a pandas DataFrame with the runs that match the specified filters, as shown below."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"                             run_id  ... tags.mlflow.runName\n0  22db81f070f6413588641c8c343cdd72  ...   orderly-quail-568\n1  c3680e37d0fa44eb9c9fb7828f6b5481  ...    melodic-lynx-301\n\n[2 rows x 19 columns]\n"})}),"\n",(0,t.jsxs)(n.h4,{id:"2---run_view_type",children:["2 - ",(0,t.jsx)(n.code,{children:"run_view_type"})]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"run_view_type"})," parameter exposes additional filtering options, as noted in\nthe ",(0,t.jsx)(l.B,{fn:"mlflow.entities.ViewType",children:"mlflow.entities.ViewType"})," enum.\nFor example, if you want to filter only active runs, which is a dropdown in the UI,\nsimply pass ",(0,t.jsx)(n.code,{children:"run_view_type=ViewType.ACTIVE_ONLY"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'import mlflow\nfrom mlflow.entities import ViewType\n\nactive_runs = mlflow.search_runs(\n    experiment_names=["search-run-guide"],\n    run_view_type=ViewType.ACTIVE_ONLY,\n    order_by=["metrics.accuracy DESC"],\n)\n'})}),"\n",(0,t.jsx)(n.h4,{id:"3---ordering",children:"3 - Ordering"}),"\n",(0,t.jsxs)(n.p,{children:["Another useful feature that is available in the search API is allowing for ordering of the\nreturned search results. You can specify a list of columns of interest along with ",(0,t.jsx)(n.code,{children:"DESC"})," or\n",(0,t.jsx)(n.code,{children:"ASC"})," in the ",(0,t.jsx)(n.code,{children:"order_by"})," kwarg. Note that the ",(0,t.jsx)(n.code,{children:"DESC"})," or ",(0,t.jsx)(n.code,{children:"ASC"})," value is optional,\nso when the value is not provided, the default is ",(0,t.jsx)(n.code,{children:"ASC"}),". Also note that the default ordering when\nthe ",(0,t.jsx)(n.code,{children:"order_by"})," parameter is omitted is to sort by ",(0,t.jsx)(n.code,{children:"start_time DESC"}),", then ",(0,t.jsx)(n.code,{children:"run_id ASC"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'import mlflow\nfrom mlflow.entities import ViewType\n\nactive_runs_ordered_by_accuracy = mlflow.search_runs(\n    experiment_names=["search-run-guide"],\n    run_view_type=ViewType.ACTIVE_ONLY,\n    order_by=["metrics.accuracy DESC"],\n)\n'})}),"\n",(0,t.jsxs)(n.p,{children:["A common use case is getting the top ",(0,t.jsx)(n.code,{children:"n"})," results, for example, the top 5 runs by accuracy. When\ncombined with the ",(0,t.jsx)(n.code,{children:"max_results"})," parameter, you can get the top ",(0,t.jsx)(n.code,{children:"n"})," that match your query."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'import mlflow\nfrom mlflow.entities import ViewType\n\nhighest_accuracy_run = mlflow.search_runs(\n    experiment_names=["search-run-guide"],\n    run_view_type=ViewType.ACTIVE_ONLY,\n    max_results=1,\n    order_by=["metrics.accuracy DESC"],\n)[0]\n'})}),"\n",(0,t.jsx)(n.h4,{id:"4---searching-all-experiments",children:"4 - Searching All Experiments"}),"\n",(0,t.jsxs)(n.p,{children:["Now you might be wondering how to search all experiments. It's as simple as specifying\n",(0,t.jsx)(n.code,{children:"search_all_experiments=True"})," and omitting the ",(0,t.jsx)(n.code,{children:"experiment_ids"})," parameter."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'import mlflow\nfrom mlflow.entities import ViewType\n\nmodel_of_interest = "GPT-4"\ngpt_4_runs_global = mlflow.search_runs(\n    filter_string=f"params.model = \'{model_of_interest}\'",\n    run_view_type=ViewType.ALL,\n    search_all_experiments=True,\n)\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Finally, there are additional useful features in the ",(0,t.jsx)(l.B,{fn:"mlflow.client.MlflowClient.search_runs"}),"\nor ",(0,t.jsx)(l.B,{fn:"mlflow.search_runs"})," methods, so be sure to\ncheck out the documentation for more details."]}),"\n",(0,t.jsx)(n.h3,{id:"r",children:"R"}),"\n",(0,t.jsx)(n.p,{children:"The R API is similar to the Python API, with the exception that the filter conditions must be string wrapped. Due to this\nbehavior, right-hand side conditional elements must be wrapped in single quotes for parameters, attributes, and tags."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-r",children:'library(mlflow)\nmlflow_search_runs(\n  filter = "metrics.rmse < 0.9 and tags.production = \'true\'",\n  experiment_ids = as.character(1:2),\n  order_by = "params.lr DESC"\n)\n'})}),"\n",(0,t.jsx)(n.h3,{id:"java",children:"Java"}),"\n",(0,t.jsx)(n.p,{children:"The Java API is similar to the Python API with the exception that the entire conditional filter syntax is string-encapsulated.\nThis is due to the fact that the Java API is a thin wrapper around the Python core APIs, and as such, will be translated between\nthe two languages."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'List<Long> experimentIds = Arrays.asList("1", "2", "4", "8");\nList<RunInfo> searchResult = client.searchRuns(experimentIds, "metrics.accuracy_score < 99.90");\n'})})]})}function m(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},20139:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/search_syntax-8db1091a58dda699e58cd3846c12cace.png"},28453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>a});var r=s(96540);const t={},i=r.createContext(t);function l(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),r.createElement(i.Provider,{value:n},e.children)}},67756:(e,n,s)=>{s.d(n,{B:()=>o});s(96540);const r=JSON.parse('{"mlflow.anthropic":"api_reference/python_api/mlflow.anthropic.html","mlflow.artifacts":"api_reference/python_api/mlflow.artifacts.html","mlflow.ag2":"api_reference/python_api/mlflow.ag2.html","mlflow.autogen":"api_reference/python_api/mlflow.autogen.html","mlflow.bedrock":"api_reference/python_api/mlflow.bedrock.html","mlflow.catboost":"api_reference/python_api/mlflow.catboost.html","mlflow.client":"api_reference/python_api/mlflow.client.html","mlflow.config":"api_reference/python_api/mlflow.config.html","mlflow.crewai":"api_reference/python_api/mlflow.crewai.html","mlflow.data":"api_reference/python_api/mlflow.data.html","mlflow.deployments":"api_reference/python_api/mlflow.deployments.html","mlflow.diviner":"api_reference/python_api/mlflow.diviner.html","mlflow.dspy":"api_reference/python_api/mlflow.dspy.html","mlflow.entities":"api_reference/python_api/mlflow.entities.html","mlflow.environment_variables":"api_reference/python_api/mlflow.environment_variables.html","mlflow.gateway":"api_reference/python_api/mlflow.gateway.html","mlflow.gemini":"api_reference/python_api/mlflow.gemini.html","mlflow.groq":"api_reference/python_api/mlflow.groq.html","mlflow.h2o":"api_reference/python_api/mlflow.h2o.html","mlflow.johnsnowlabs":"api_reference/python_api/mlflow.johnsnowlabs.html","mlflow.keras":"api_reference/python_api/mlflow.keras.html","mlflow.langchain":"api_reference/python_api/mlflow.langchain.html","mlflow.lightgbm":"api_reference/python_api/mlflow.lightgbm.html","mlflow.litellm":"api_reference/python_api/mlflow.litellm.html","mlflow.llama_index":"api_reference/python_api/mlflow.llama_index.html","mlflow.metrics":"api_reference/python_api/mlflow.metrics.html","mlflow.mistral":"api_reference/python_api/mlflow.mistral.html","mlflow.models":"api_reference/python_api/mlflow.models.html","mlflow.onnx":"api_reference/python_api/mlflow.onnx.html","mlflow.openai":"api_reference/python_api/mlflow.openai.html","mlflow.paddle":"api_reference/python_api/mlflow.paddle.html","mlflow.pmdarima":"api_reference/python_api/mlflow.pmdarima.html","mlflow.projects":"api_reference/python_api/mlflow.projects.html","mlflow.promptflow":"api_reference/python_api/mlflow.promptflow.html","mlflow.prophet":"api_reference/python_api/mlflow.prophet.html","mlflow.pyfunc":"api_reference/python_api/mlflow.pyfunc.html","mlflow.pyspark.ml":"api_reference/python_api/mlflow.pyspark.ml.html","mlflow.pytorch":"api_reference/python_api/mlflow.pytorch.html","mlflow":"api_reference/python_api/mlflow.html","mlflow.sagemaker":"api_reference/python_api/mlflow.sagemaker.html","mlflow.sentence_transformers":"api_reference/python_api/mlflow.sentence_transformers.html","mlflow.server":"api_reference/python_api/mlflow.server.html","mlflow.shap":"api_reference/python_api/mlflow.shap.html","mlflow.sklearn":"api_reference/python_api/mlflow.sklearn.html","mlflow.spacy":"api_reference/python_api/mlflow.spacy.html","mlflow.spark":"api_reference/python_api/mlflow.spark.html","mlflow.statsmodels":"api_reference/python_api/mlflow.statsmodels.html","mlflow.system_metrics":"api_reference/python_api/mlflow.system_metrics.html","mlflow.tensorflow":"api_reference/python_api/mlflow.tensorflow.html","mlflow.tracing":"api_reference/python_api/mlflow.tracing.html","mlflow.transformers":"api_reference/python_api/mlflow.transformers.html","mlflow.types":"api_reference/python_api/mlflow.types.html","mlflow.utils":"api_reference/python_api/mlflow.utils.html","mlflow.xgboost":"api_reference/python_api/mlflow.xgboost.html","mlflow.server.auth":"api_reference/auth/python-api.html"}');var t=s(29030),i=s(56289),l=s(74848);const a=e=>{const n=e.split(".");for(let s=n.length;s>0;s--){const e=n.slice(0,s).join(".");if(r[e])return e}return null};function o(e){let{fn:n,children:s}=e;const o=a(n);if(!o)return(0,l.jsx)(l.Fragment,{children:s});const c=(0,t.Ay)(`/${r[o]}#${n}`);return(0,l.jsx)(i.A,{to:c,target:"_blank",children:s??(0,l.jsxs)("code",{children:[n,"()"]})})}},92320:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/created_mlflow_runs-ba9cdc82478269e4af7b43ad5a6c8733.png"}}]);