"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([["6003"],{85551(e,r,t){t.r(r),t.d(r,{metadata:()=>l,default:()=>w,frontMatter:()=>d,contentTitle:()=>f,toc:()=>g,assets:()=>u});var l=JSON.parse('{"id":"eval-monitor/scorers/llm-judge/prompt","title":"Bring Your Own Prompts","description":"The custompromptjudge API is being phased out. We strongly recommend using the make_judge API instead, which provides:","source":"@site/docs/genai/eval-monitor/scorers/llm-judge/prompt.mdx","sourceDirName":"eval-monitor/scorers/llm-judge","slug":"/eval-monitor/scorers/llm-judge/prompt","permalink":"/mlflow-website/docs/latest/genai/eval-monitor/scorers/llm-judge/prompt","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{}}'),o=t(74848),n=t(28453),i=t(54725),a=t(46077),s=t(77541),p=t(10440),m=t(42640),c=t(60665),h=t(47504);let d={},f="Bring Your Own Prompts",u={},g=[{value:"Example Usage",id:"example-usage",level:2},{value:"Prompt requirements",id:"prompt-requirements",level:2},{value:"Maintaining Your Prompt",id:"maintaining-your-prompt",level:2},{value:"Selecting Judge Models",id:"selecting-judge-models",level:2},{value:"Next Steps",id:"next-steps",level:2}];function _(e){let r={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,n.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.header,{children:(0,o.jsx)(r.h1,{id:"bring-your-own-prompts",children:"Bring Your Own Prompts"})}),"\n",(0,o.jsxs)(r.admonition,{title:"Recommendation: Use make_judge Instead",type:"note",children:[(0,o.jsxs)(r.p,{children:["The ",(0,o.jsx)(r.code,{children:"custom_prompt_judge"})," API is being phased out. We strongly recommend using the ",(0,o.jsx)(i.B,{fn:"mlflow.genai.judges.make_judge",children:"make_judge"})," API instead, which provides:"]}),(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"More flexible template-based instructions"}),"\n",(0,o.jsx)(r.li,{children:"Better version control and collaboration features"}),"\n",(0,o.jsx)(r.li,{children:"Support for both field-based and Agent-as-a-Judge evaluation"}),"\n",(0,o.jsx)(r.li,{children:"Alignment capabilities with human feedback"}),"\n"]}),(0,o.jsxs)(r.p,{children:["See the ",(0,o.jsx)(r.a,{href:"/genai/eval-monitor/scorers/llm-judge/custom-judges",children:"make_judge documentation"})," for migration guidance."]})]}),"\n",(0,o.jsxs)(r.p,{children:["The ",(0,o.jsx)(i.B,{fn:"mlflow.genai.judges.custom_prompt_judge",children:"custom_prompt_judge"}),' API is designed to help you quickly and easily create LLM scorers when you need full control over the judge\'s prompt or need to return multiple output values beyond "pass" / "fail", for example, "great", "ok", "bad".']}),"\n",(0,o.jsx)(r.p,{children:"You provide a prompt template that has placeholders for specific fields in your app's trace and define the output choices the judge can select. The LLM judge model uses these inputs to select the best output choice and provides a rationale for its selection."}),"\n",(0,o.jsx)(r.admonition,{type:"tip",children:(0,o.jsxs)(r.p,{children:["We recommend starting with ",(0,o.jsx)("ins",{children:(0,o.jsx)(r.a,{href:"/genai/eval-monitor/scorers/llm-judge/guidelines",children:"guidelines-based judges"})})," and only using prompt-based judges if you need more control or can't write your evaluation criteria as pass/fail guidelines. Guidelines-based judges have the distinct advantage of being easy to explain to business stakeholders and can often be directly written by domain experts."]})}),"\n",(0,o.jsx)(r.h2,{id:"example-usage",children:"Example Usage"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-python",children:'from mlflow.genai.judges import custom_prompt_judge\nfrom mlflow.genai.scorers import scorer\n\n\nissue_resolution_prompt = """\nEvaluate the entire conversation between a customer and an LLM-based agent. Determine if the issue was resolved in the conversation.\n\nYou must choose one of the following categories.\n\n[[fully_resolved]]: The response directly and comprehensively addresses the user\'s question or problem, providing a clear solution or answer. No further immediate action seems required from the user on the same core issue.\n[[partially_resolved]]: The response offers some help or relevant information but doesn\'t completely solve the problem or answer the question. It might provide initial steps, require more information from the user, or address only a part of a multi-faceted query.\n[[needs_follow_up]]: The response does not adequately address the user\'s query, misunderstands the core issue, provides unhelpful or incorrect information, or inappropriately deflects the question. The user will likely need to re-engage or seek further assistance.\n\nConversation to evaluate: {{conversation}}\n"""\n\n\n# Define a custom scorer that wraps the custom prompt judge to check if the issue was resolved\n@scorer\ndef is_issue_resolved(inputs, outputs):\n    issue_judge = custom_prompt_judge(\n        name="issue_resolution",\n        prompt_template=issue_resolution_prompt,\n        # Optionally map the categories to numeric values for ease\n        # of aggregation and comparison. When not provided, the judge\n        # directly returns the choice value as a string.\n        numeric_values={\n            "fully_resolved": 1,\n            "partially_resolved": 0.5,\n            "needs_follow_up": 0,\n        },\n    )\n\n    # Pass values for the placeholders ({{conversation}}) as kwargs\n    conversation = inputs["messages"] + outputs["messages"]\n    return issue_judge(conversation=conversation)\n'})}),"\n",(0,o.jsx)(r.h2,{id:"prompt-requirements",children:"Prompt requirements"}),"\n",(0,o.jsx)(r.p,{children:"The prompt template for the judge must have:"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:["Placeholders for input values with ",(0,o.jsx)(r.strong,{children:"double curly braces"}),", e.g., ",(0,o.jsx)(r.code,{children:"{{conversation}}"}),"."]}),"\n",(0,o.jsxs)(r.li,{children:["Choices for the judge to select from as output, enclosed in ",(0,o.jsx)(r.strong,{children:"square brackets"}),", e.g., ",(0,o.jsx)(r.code,{children:"[[fully_resolved]]"}),". The choice name can contain alphanumeric characters and underscores."]}),"\n"]}),"\n",(0,o.jsx)(r.admonition,{title:"Handling Parsing Errors",type:"tip",children:(0,o.jsxs)(r.p,{children:["MLflow uses raw prompt-based instructions for handling structured outputs to make the API generic to all LLM providers. This may not be strict enough to enforce structured outputs in all cases. If you see output parsing errors frequently, consider using ",(0,o.jsx)("ins",{children:(0,o.jsx)(r.a,{href:"/genai/eval-monitor/scorers/custom",children:"code-based custom scorers"})})," and invoke the specific structured output API for the LLM provider you are using to get more reliable results."]})}),"\n",(0,o.jsx)(r.h2,{id:"maintaining-your-prompt",children:"Maintaining Your Prompt"}),"\n",(0,o.jsxs)(r.p,{children:["Writing good prompts for LLM judges requires iterative testing and refinement. ",(0,o.jsx)(r.a,{href:"/genai/prompt-registry",children:"MLflow Prompt Registry"})," is a great tool to help you manage and version control your prompts and share them with your team."]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-python",children:'from mlflow.genai import register_prompt\n\nregister_prompt(\n    name="issue_resolution",\n    template=issue_resolution_prompt,\n)\n'})}),"\n",(0,o.jsx)(a.A,{src:"/images/mlflow-3/eval-monitor/scorers/prompt-registry.png",alt:"Prompt Registry"}),"\n",(0,o.jsx)(r.h2,{id:"selecting-judge-models",children:"Selecting Judge Models"}),"\n",(0,o.jsxs)(r.p,{children:["MLflow supports all major LLM providers, such as OpenAI, Anthropic, Google, xAI, and more. See ",(0,o.jsx)(r.a,{href:"/genai/eval-monitor/scorers/llm-judge/custom-judges/supported-models",children:"Supported Models"})," for more details."]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-python",children:'from mlflow.genai.judges import custom_prompt_judge\n\ncustom_prompt_judge(\n    name="is_issue_resolved",\n    prompt_template=issue_resolution_prompt,\n    model="anthropic:/claude-3-opus",\n)\n'})}),"\n",(0,o.jsx)(r.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,o.jsxs)(p.A,{children:[(0,o.jsx)(s.A,{icon:m.A,title:"Evaluate Agents",description:"Learn how to evaluate AI agents with specialized techniques and scorers",href:"/genai/eval-monitor/running-evaluation/agents"}),(0,o.jsx)(s.A,{icon:c.A,title:"Prompt Registry",description:"Version control and manage your judge prompts with MLflow Prompt Registry",href:"/genai/prompt-registry"}),(0,o.jsx)(s.A,{icon:h.A,title:"Collect User Feedback",description:"Integrate user feedback to continuously improve your evaluation criteria and model performance",href:"/genai/assessments/feedback/"})]})]})}function w(e={}){let{wrapper:r}={...(0,n.R)(),...e.components};return r?(0,o.jsx)(r,{...e,children:(0,o.jsx)(_,{...e})}):_(e)}},75689(e,r,t){t.d(r,{A:()=>s});var l=t(96540);let o=e=>{let r=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,r,t)=>t?t.toUpperCase():r.toLowerCase());return r.charAt(0).toUpperCase()+r.slice(1)},n=(...e)=>e.filter((e,r,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===r).join(" ").trim();var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let a=(0,l.forwardRef)(({color:e="currentColor",size:r=24,strokeWidth:t=2,absoluteStrokeWidth:o,className:a="",children:s,iconNode:p,...m},c)=>(0,l.createElement)("svg",{ref:c,...i,width:r,height:r,stroke:e,strokeWidth:o?24*Number(t)/Number(r):t,className:n("lucide",a),...!s&&!(e=>{for(let r in e)if(r.startsWith("aria-")||"role"===r||"title"===r)return!0})(m)&&{"aria-hidden":"true"},...m},[...p.map(([e,r])=>(0,l.createElement)(e,r)),...Array.isArray(s)?s:[s]])),s=(e,r)=>{let t=(0,l.forwardRef)(({className:t,...i},s)=>(0,l.createElement)(a,{ref:s,iconNode:r,className:n(`lucide-${o(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,t),...i}));return t.displayName=o(e),t}},60665(e,r,t){t.d(r,{A:()=>l});let l=(0,t(75689).A)("book-open",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]])},42640(e,r,t){t.d(r,{A:()=>l});let l=(0,t(75689).A)("bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]])},47504(e,r,t){t.d(r,{A:()=>l});let l=(0,t(75689).A)("message-square",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},54725(e,r,t){t.d(r,{B:()=>i});var l=t(74848);t(96540);var o=JSON.parse('{"mlflow.ag2":"api_reference/python_api/mlflow.ag2.html","mlflow.agno":"api_reference/python_api/mlflow.agno.html","mlflow.anthropic":"api_reference/python_api/mlflow.anthropic.html","mlflow.artifacts":"api_reference/python_api/mlflow.artifacts.html","mlflow.autogen":"api_reference/python_api/mlflow.autogen.html","mlflow.bedrock":"api_reference/python_api/mlflow.bedrock.html","mlflow.catboost":"api_reference/python_api/mlflow.catboost.html","mlflow.client":"api_reference/python_api/mlflow.client.html","mlflow.config":"api_reference/python_api/mlflow.config.html","mlflow.crewai":"api_reference/python_api/mlflow.crewai.html","mlflow.data":"api_reference/python_api/mlflow.data.html","mlflow.deployments":"api_reference/python_api/mlflow.deployments.html","mlflow.diviner":"api_reference/python_api/mlflow.diviner.html","mlflow.dspy":"api_reference/python_api/mlflow.dspy.html","mlflow.entities":"api_reference/python_api/mlflow.entities.html","mlflow.environment_variables":"api_reference/python_api/mlflow.environment_variables.html","mlflow.gateway":"api_reference/python_api/mlflow.gateway.html","mlflow.gemini":"api_reference/python_api/mlflow.gemini.html","mlflow.genai":"api_reference/python_api/mlflow.genai.html","mlflow.groq":"api_reference/python_api/mlflow.groq.html","mlflow.h2o":"api_reference/python_api/mlflow.h2o.html","mlflow.johnsnowlabs":"api_reference/python_api/mlflow.johnsnowlabs.html","mlflow.keras":"api_reference/python_api/mlflow.keras.html","mlflow.langchain":"api_reference/python_api/mlflow.langchain.html","mlflow.lightgbm":"api_reference/python_api/mlflow.lightgbm.html","mlflow.litellm":"api_reference/python_api/mlflow.litellm.html","mlflow.llama_index":"api_reference/python_api/mlflow.llama_index.html","mlflow.metrics":"api_reference/python_api/mlflow.metrics.html","mlflow.mistral":"api_reference/python_api/mlflow.mistral.html","mlflow.models":"api_reference/python_api/mlflow.models.html","mlflow.onnx":"api_reference/python_api/mlflow.onnx.html","mlflow.openai":"api_reference/python_api/mlflow.openai.html","mlflow.paddle":"api_reference/python_api/mlflow.paddle.html","mlflow.pmdarima":"api_reference/python_api/mlflow.pmdarima.html","mlflow.projects":"api_reference/python_api/mlflow.projects.html","mlflow.prophet":"api_reference/python_api/mlflow.prophet.html","mlflow.pydantic_ai":"api_reference/python_api/mlflow.pydantic_ai.html","mlflow.pyfunc":"api_reference/python_api/mlflow.pyfunc.html","mlflow.pyspark.ml":"api_reference/python_api/mlflow.pyspark.ml.html","mlflow.pytorch":"api_reference/python_api/mlflow.pytorch.html","mlflow":"api_reference/python_api/mlflow.html","mlflow.sagemaker":"api_reference/python_api/mlflow.sagemaker.html","mlflow.sentence_transformers":"api_reference/python_api/mlflow.sentence_transformers.html","mlflow.server":"api_reference/python_api/mlflow.server.html","mlflow.shap":"api_reference/python_api/mlflow.shap.html","mlflow.sklearn":"api_reference/python_api/mlflow.sklearn.html","mlflow.smolagents":"api_reference/python_api/mlflow.smolagents.html","mlflow.spacy":"api_reference/python_api/mlflow.spacy.html","mlflow.spark":"api_reference/python_api/mlflow.spark.html","mlflow.statsmodels":"api_reference/python_api/mlflow.statsmodels.html","mlflow.system_metrics":"api_reference/python_api/mlflow.system_metrics.html","mlflow.tensorflow":"api_reference/python_api/mlflow.tensorflow.html","mlflow.tracing":"api_reference/python_api/mlflow.tracing.html","mlflow.transformers":"api_reference/python_api/mlflow.transformers.html","mlflow.types":"api_reference/python_api/mlflow.types.html","mlflow.utils":"api_reference/python_api/mlflow.utils.html","mlflow.webhooks":"api_reference/python_api/mlflow.webhooks.html","mlflow.xgboost":"api_reference/python_api/mlflow.xgboost.html","mlflow.server.auth":"api_reference/auth/python-api.html","mlflow.server.cli":"api_reference/cli.html","mlflow.r":"api_reference/R-api.html","mlflow.java":"api_reference/java_api/index.html","mlflow.python":"api_reference/python_api/index.html","mlflow.rest":"api_reference/rest-api.html","mlflow.typescript":"api_reference/typescript_api/index.html","mlflow.llms.deployments.api":"api_reference/llms/deployments/api.html"}'),n=t(66497);function i({fn:e,children:r,hash:t}){let i=(e=>{let r=e.split(".");for(let e=r.length;e>0;e--){let t=r.slice(0,e).join(".");if(o[t])return t}return null})(e);if(!i)return(0,l.jsx)(l.Fragment,{children:r});let a=(0,n.default)(`/${o[i]}#${t??e}`);return(0,l.jsx)("a",{href:a,target:"_blank",children:r??(0,l.jsxs)("code",{children:[e,"()"]})})}},46077(e,r,t){t.d(r,{A:()=>n});var l=t(74848);t(96540);var o=t(66497);function n({src:e,alt:r,width:t,caption:n,className:i}){return(0,l.jsxs)("div",{className:`container_JwLF ${i||""}`,children:[(0,l.jsx)("div",{className:"imageWrapper_RfGN",style:t?{width:t}:{},children:(0,l.jsx)("img",{src:(0,o.default)(e),alt:r,className:"image_bwOA"})}),n&&(0,l.jsx)("p",{className:"caption_jo2G",children:n})]})}},77541(e,r,t){t.d(r,{A:()=>p});var l=t(74848);t(96540);var o=t(95310),n=t(34164);let i="tileImage_O4So";var a=t(66497),s=t(92802);function p({icon:e,image:r,imageDark:t,imageWidth:p,imageHeight:m,iconSize:c=32,containerHeight:h,title:d,description:f,href:u,linkText:g="Learn more \u2192",className:_}){if(!e&&!r)throw Error("TileCard requires either an icon or image prop");let w=h?{height:`${h}px`}:{},y={};return p&&(y.width=`${p}px`),m&&(y.height=`${m}px`),(0,l.jsxs)(o.A,{href:u,className:(0,n.A)("tileCard_NHsj",_),children:[(0,l.jsx)("div",{className:"tileIcon_pyoR",style:w,children:e?(0,l.jsx)(e,{size:c}):t?(0,l.jsx)(s.A,{sources:{light:(0,a.default)(r),dark:(0,a.default)(t)},alt:d,className:i,style:y}):(0,l.jsx)("img",{src:(0,a.default)(r),alt:d,className:i,style:y})}),(0,l.jsx)("h3",{children:d}),(0,l.jsx)("p",{children:f}),(0,l.jsx)("div",{className:"tileLink_iUbu",children:g})]})}},10440(e,r,t){t.d(r,{A:()=>n});var l=t(74848);t(96540);var o=t(34164);function n({children:e,className:r}){return(0,l.jsx)("div",{className:(0,o.A)("tilesGrid_hB9N",r),children:e})}},28453(e,r,t){t.d(r,{R:()=>i,x:()=>a});var l=t(96540);let o={},n=l.createContext(o);function i(e){let r=l.useContext(n);return l.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),l.createElement(n.Provider,{value:r},e.children)}}}]);