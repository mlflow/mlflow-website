"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([["6668"],{2453(e,n,t){t.r(n),t.d(n,{metadata:()=>r,default:()=>d,frontMatter:()=>l,contentTitle:()=>i,toc:()=>c,assets:()=>a});var r=JSON.parse('{"id":"tracing/opentelemetry/ingest-shared","title":"ingest-shared","description":"OpenTelemetry trace ingestion is supported in MLflow 3.6.0 and above.","source":"@site/docs/genai/tracing/opentelemetry/ingest-shared.mdx","sourceDirName":"tracing/opentelemetry","slug":"/tracing/opentelemetry/ingest-shared","permalink":"/mlflow-website/docs/latest/genai/tracing/opentelemetry/ingest-shared","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{}}'),o=t(74848),s=t(28453);let l={},i,a={},c=[{value:"OpenTelemetry endpoint (OTLP)",id:"opentelemetry-endpoint-otlp",level:2}];function p(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["OpenTelemetry trace ingestion is supported in ",(0,o.jsx)(n.strong,{children:"MLflow 3.6.0 and above"}),"."]})}),"\n",(0,o.jsx)(n.h2,{id:"opentelemetry-endpoint-otlp",children:"OpenTelemetry endpoint (OTLP)"}),"\n",(0,o.jsxs)(n.p,{children:["MLflow Server exposes an OTLP endpoint at ",(0,o.jsx)(n.code,{children:"/v1/traces"})," (",(0,o.jsx)(n.a,{href:"https://opentelemetry.io/docs/specs/otlp/",children:"OTLP"}),"). This endpoint accepts traces from any native OpenTelemetry instrumentation, allowing you to trace applications written in other languages such as Java, Go, Rust, etc."]}),"\n",(0,o.jsx)(n.p,{children:"To use this endpoint, start MLflow Server with a SQL-based backend store. The following command starts MLflow Server with an SQLite backend store:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"mlflow server\n"})}),"\n",(0,o.jsxs)(n.p,{children:["To use other types of SQL databases such as PostgreSQL, MySQL, and MSSQL, change the store URI as described in the ",(0,o.jsx)(n.a,{href:"/self-hosting/architecture/backend-store",children:"backend store documentation"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["In your application, configure the server endpoint and set the MLflow experiment ID in the OTLP header ",(0,o.jsx)(n.code,{children:"x-mlflow-experiment-id"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"export OTEL_EXPORTER_OTLP_TRACES_ENDPOINT=http://localhost:5000/v1/traces\nexport OTEL_EXPORTER_OTLP_TRACES_HEADERS=x-mlflow-experiment-id=123\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsx)(n.p,{children:"Currently, MLflow Server supports only the OTLP/HTTP endpoint, and the OTLP/gRPC endpoint is not yet supported."})})]})}function d(e={}){let{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(p,{...e})}):p(e)}},98690(e,n,t){t.r(n),t.d(n,{metadata:()=>r,default:()=>m,frontMatter:()=>i,contentTitle:()=>a,toc:()=>p,assets:()=>c});var r=JSON.parse('{"id":"tracing/opentelemetry/ingest","title":"Collect OpenTelemetry Traces into MLflow","description":"Basic Example","source":"@site/docs/genai/tracing/opentelemetry/ingest.mdx","sourceDirName":"tracing/opentelemetry","slug":"/tracing/opentelemetry/ingest","permalink":"/mlflow-website/docs/latest/genai/tracing/opentelemetry/ingest","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"genAISidebar","previous":{"title":"Overview","permalink":"/mlflow-website/docs/latest/genai/tracing/opentelemetry/"},"next":{"title":"Export MLflow Traces/Metrics via OTLP","permalink":"/mlflow-website/docs/latest/genai/tracing/opentelemetry/export"}}'),o=t(74848),s=t(28453),l=t(2453);let i={},a="Collect OpenTelemetry Traces into MLflow",c={},p=[...l.toc,{value:"Basic Example",id:"basic-example",level:2},{value:"Using OpenTelemetry Collector",id:"using-opentelemetry-collector",level:2},{value:"Compression",id:"compression",level:2}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"collect-opentelemetry-traces-into-mlflow",children:"Collect OpenTelemetry Traces into MLflow"})}),"\n",(0,o.jsx)(l.default,{}),"\n",(0,o.jsx)(n.h2,{id:"basic-example",children:"Basic Example"}),"\n",(0,o.jsx)(n.p,{children:"The following example shows how to collect traces from a FastAPI application using OpenTelemetry FastAPI instrumentation."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'import os\nimport uvicorn\nfrom fastapi import FastAPI\nfrom opentelemetry.instrumentation.fastapi import FastAPIInstrumentor\n\n# Set the endpoint and header\nMLFLOW_TRACKING_URI = "http://localhost:5000"\nMLFLOW_EXPERIMENT_ID = "123"\n\nos.environ["OTEL_EXPORTER_OTLP_TRACES_ENDPOINT"] = f"{MLFLOW_TRACKING_URI}/v1/traces"\nos.environ[\n    "OTEL_EXPORTER_OTLP_TRACES_HEADERS"\n] = f"x-mlflow-experiment-id={MLFLOW_EXPERIMENT_ID}"\n\n\napp = FastAPI()\nFastAPIInstrumentor.instrument_app(app)\n\n\n@app.get("/")\nasync def root():\n    return {"message": "Hello, World!"}\n\n\nif __name__ == "__main__":\n    uvicorn.run(app, host="0.0.0.0", port=8000)\n'})}),"\n",(0,o.jsx)(n.h2,{id:"using-opentelemetry-collector",children:"Using OpenTelemetry Collector"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.a,{href:"https://opentelemetry.io/docs/collector/",children:"OpenTelemetry Collector"})," is a vendor-agnostic agent that can be used to collect, process, and export traces to various observability platforms. To configure OpenTelemetry Collector to ingest traces into MLflow, use the following configuration:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"export MLFLOW_TRACKING_URI=http://localhost:5000\nexport MLFLOW_EXPERIMENT_ID=123\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title="opentelemetry-collector.yaml"',children:"receivers:\n  otlp:\n    protocols:\n      grpc:\n        endpoint: 0.0.0.0:4317\n      http:\n        endpoint: 0.0.0.0:4318\n\nexporters:\n  otlphttp:\n    endpoint: ${MLFLOW_TRACKING_URI}\n    headers:\n      x-mlflow-experiment-id: ${MLFLOW_EXPERIMENT_ID}\n\nservice:\n  pipelines:\n    traces:\n      receivers: [otlp]\n      processors: [batch]\n      exporters: [otlphttp]\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"docker run -d --name opentelemetry-collector \\\n  -p 4317:4317 \\\n  -p 4318:4318 \\\n  -v $(pwd)/opentelemetry-collector.yaml:/etc/otel/collector/config.yaml \\\n  otel/opentelemetry-collector\n"})}),"\n",(0,o.jsx)(n.h2,{id:"compression",children:"Compression"}),"\n",(0,o.jsxs)(n.p,{children:["Since MLflow 3.7.0, MLflow's OTLP/HTTP endpoint accepts compressed trace payloads. To enable compression, set the ",(0,o.jsx)(n.code,{children:"OTEL_EXPORTER_OTLP_TRACES_COMPRESSION"})," environment variable to either ",(0,o.jsx)(n.code,{children:"gzip"})," or ",(0,o.jsx)(n.code,{children:"deflate"}),". Other encodings are not supported."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"export OTEL_EXPORTER_OTLP_TRACES_ENDPOINT=http://localhost:5000/v1/traces\nexport OTEL_EXPORTER_OTLP_TRACES_HEADERS=x-mlflow-experiment-id=123\nexport OTEL_EXPORTER_OTLP_TRACES_COMPRESSION=gzip\n"})}),"\n",(0,o.jsx)(n.p,{children:"When routing through the OpenTelemetry Collector, set compression on the OTLP HTTP exporter so it forwards a compressed request to MLflow:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"exporters:\n  otlphttp:\n    endpoint: ${MLFLOW_TRACKING_URI}\n    headers:\n      x-mlflow-experiment-id: ${MLFLOW_EXPERIMENT_ID}\n    compression: gzip\n"})})]})}function m(e={}){let{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},28453(e,n,t){t.d(n,{R:()=>l,x:()=>i});var r=t(96540);let o={},s=r.createContext(o);function l(e){let n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);