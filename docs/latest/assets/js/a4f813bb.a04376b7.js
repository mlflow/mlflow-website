"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([["143"],{78791(e,n,r){r.r(n),r.d(n,{metadata:()=>t,default:()=>d,frontMatter:()=>o,contentTitle:()=>s,toc:()=>l,assets:()=>p});var t=JSON.parse('{"id":"tracing/integrations/listing/spring-ai","title":"Tracing Spring AI","description":"Spring AI Tracing","source":"@site/docs/genai/tracing/integrations/listing/spring-ai.mdx","sourceDirName":"tracing/integrations/listing","slug":"/tracing/integrations/listing/spring-ai","permalink":"/mlflow-website/docs/latest/genai/tracing/integrations/listing/spring-ai","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7,"sidebar_label":"Spring AI"},"sidebar":"genAISidebar","previous":{"title":"Smolagents","permalink":"/mlflow-website/docs/latest/genai/tracing/integrations/listing/smolagents"},"next":{"title":"Strands Agents SDK","permalink":"/mlflow-website/docs/latest/genai/tracing/integrations/listing/strands"}}'),i=r(74848),a=r(28453);let o={sidebar_position:7,sidebar_label:"Spring AI"},s="Tracing Spring AI",p={},l=[{value:"Step 1: Create a Spring AI Project",id:"step-1-create-a-spring-ai-project",level:2},{value:"Step 2: Start the MLflow Tracking Server",id:"step-2-start-the-mlflow-tracking-server",level:2},{value:"Step 3: Configure OpenTelemetry",id:"step-3-configure-opentelemetry",level:2},{value:"Step 4: Create the Chat Service",id:"step-4-create-the-chat-service",level:2},{value:"Step 5: Create a Chat Controller",id:"step-5-create-a-chat-controller",level:2},{value:"Step 6: Run the Application",id:"step-6-run-the-application",level:2},{value:"Next Steps",id:"next-steps",level:2}];function c(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"tracing-spring-ai",children:"Tracing Spring AI"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Spring AI Tracing",src:r(1366).A+"",width:"3120",height:"2004"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"/genai/tracing",children:"MLflow Tracing"})," provides automatic tracing capability for ",(0,i.jsx)(n.a,{href:"https://spring.io/projects/spring-ai",children:"Spring AI"}),", the Spring framework for building AI applications. MLflow supports tracing for Spring AI through the ",(0,i.jsx)(n.a,{href:"/genai/tracing/opentelemetry",children:"OpenTelemetry"})," integration."]}),"\n",(0,i.jsx)(n.h2,{id:"step-1-create-a-spring-ai-project",children:"Step 1: Create a Spring AI Project"}),"\n",(0,i.jsx)(n.p,{children:"Create a new Spring AI project using Spring Initializr or add Spring AI to an existing project:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"spring init --dependencies=web --build=maven --java-version=17 spring-ai-demo\ncd spring-ai-demo\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Add the OpenTelemetry dependencies to your ",(0,i.jsx)(n.code,{children:"pom.xml"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"<properties>\n    <java.version>17</java.version>\n    <spring-ai.version>1.0.0-M3</spring-ai.version>\n    <opentelemetry.version>1.45.0</opentelemetry.version>\n</properties>\n\n<dependencyManagement>\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.ai</groupId>\n            <artifactId>spring-ai-bom</artifactId>\n            <version>${spring-ai.version}</version>\n            <type>pom</type>\n            <scope>import</scope>\n        </dependency>\n    </dependencies>\n</dependencyManagement>\n\n<dependencies>\n    \x3c!-- Spring Boot Actuator (required for observability) --\x3e\n    <dependency>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-actuator</artifactId>\n    </dependency>\n\n    \x3c!-- Spring AI OpenAI --\x3e\n    <dependency>\n        <groupId>org.springframework.ai</groupId>\n        <artifactId>spring-ai-openai-spring-boot-starter</artifactId>\n    </dependency>\n\n    \x3c!-- Micrometer to OpenTelemetry Bridge --\x3e\n    <dependency>\n        <groupId>io.micrometer</groupId>\n        <artifactId>micrometer-tracing-bridge-otel</artifactId>\n    </dependency>\n\n    \x3c!-- OpenTelemetry OTLP Exporter --\x3e\n    <dependency>\n        <groupId>io.opentelemetry</groupId>\n        <artifactId>opentelemetry-exporter-otlp</artifactId>\n        <version>${opentelemetry.version}</version>\n    </dependency>\n</dependencies>\n\n<repositories>\n    <repository>\n        <id>spring-milestones</id>\n        <name>Spring Milestones</name>\n        <url>https://repo.spring.io/milestone</url>\n        <snapshots>\n            <enabled>false</enabled>\n        </snapshots>\n    </repository>\n</repositories>\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Add the following to ",(0,i.jsx)(n.code,{children:"src/main/resources/application.properties"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-properties",children:"spring.application.name=spring-ai-demo\n\n# OpenAI Configuration\nspring.ai.openai.api-key=${OPENAI_API_KEY}\nspring.ai.openai.chat.options.model=gpt-4o-mini\n\n# Enable Spring AI Observations\nspring.ai.chat.observations.include-prompt=true\nspring.ai.chat.observations.include-completion=true\n\n# Tracing Configuration\nmanagement.tracing.sampling.probability=1.0\n"})}),"\n",(0,i.jsx)(n.h2,{id:"step-2-start-the-mlflow-tracking-server",children:"Step 2: Start the MLflow Tracking Server"}),"\n",(0,i.jsx)(n.p,{children:"Start the MLflow Tracking Server:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"mlflow server --port 5000\n"})}),"\n",(0,i.jsxs)(n.p,{children:["By default, MLflow uses SQLite as the backend store. To use other types of SQL databases such as PostgreSQL, MySQL, and MSSQL, change the store URI as described in the ",(0,i.jsx)(n.a,{href:"/self-hosting/architecture/backend-store",children:"backend store documentation"}),". OpenTelemetry ingestion is not supported with file-based backend stores."]}),"\n",(0,i.jsx)(n.h2,{id:"step-3-configure-opentelemetry",children:"Step 3: Configure OpenTelemetry"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"src/main/java/com/example/spring_ai_demo/config/MlflowTracingConfig.java"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'package com.example.spring_ai_demo.config;\n\nimport io.opentelemetry.api.OpenTelemetry;\nimport io.opentelemetry.api.common.AttributeKey;\nimport io.opentelemetry.api.common.Attributes;\nimport io.opentelemetry.exporter.otlp.http.trace.OtlpHttpSpanExporter;\nimport io.opentelemetry.sdk.OpenTelemetrySdk;\nimport io.opentelemetry.sdk.resources.Resource;\nimport io.opentelemetry.sdk.trace.SdkTracerProvider;\nimport io.opentelemetry.sdk.trace.export.SimpleSpanProcessor;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\n/**\n * OpenTelemetry configuration for MLflow tracing.\n *\n * Configure via environment variables:\n *   OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:5000/v1/traces\n *   OTEL_EXPORTER_OTLP_HEADERS=x-mlflow-experiment-id=0\n */\n@Configuration\npublic class MlflowTracingConfig {\n\n    private static final Logger log = LoggerFactory.getLogger(MlflowTracingConfig.class);\n\n    @Value("${OTEL_EXPORTER_OTLP_ENDPOINT:http://localhost:5000/v1/traces}")\n    private String otlpEndpoint;\n\n    @Value("${OTEL_EXPORTER_OTLP_HEADERS:x-mlflow-experiment-id=0}")\n    private String otlpHeaders;\n\n    @Value("${spring.application.name:spring-ai-demo}")\n    private String serviceName;\n\n    @Bean\n    public OpenTelemetry openTelemetry() {\n        log.info("Configuring MLflow tracing: endpoint={}", otlpEndpoint);\n\n        var exporterBuilder = OtlpHttpSpanExporter.builder()\n                .setEndpoint(otlpEndpoint);\n\n        // Parse headers from OTEL_EXPORTER_OTLP_HEADERS format (key=value,key2=value2)\n        if (otlpHeaders != null && !otlpHeaders.isEmpty()) {\n            for (String header : otlpHeaders.split(",")) {\n                String[] parts = header.split("=", 2);\n                if (parts.length == 2) {\n                    exporterBuilder.addHeader(parts[0].trim(), parts[1].trim());\n                }\n            }\n        }\n\n        OtlpHttpSpanExporter exporter = exporterBuilder.build();\n\n        SdkTracerProvider tracerProvider = SdkTracerProvider.builder()\n                .addSpanProcessor(SimpleSpanProcessor.create(exporter))\n                .setResource(Resource.create(Attributes.of(\n                        AttributeKey.stringKey("service.name"), serviceName)))\n                .build();\n\n        Runtime.getRuntime().addShutdownHook(new Thread(tracerProvider::close));\n\n        return OpenTelemetrySdk.builder()\n                .setTracerProvider(tracerProvider)\n                .build();\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"step-4-create-the-chat-service",children:"Step 4: Create the Chat Service"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"src/main/java/com/example/spring_ai_demo/service/ChatService.java"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"package com.example.spring_ai_demo.service;\n\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.model.ChatModel;\nimport org.springframework.stereotype.Service;\n\n@Service\npublic class ChatService {\n\n    private final ChatModel chatModel;\n\n    public ChatService(ChatModel chatModel) {\n        this.chatModel = chatModel;\n    }\n\n    public String chat(String userMessage) {\n        return ChatClient.create(chatModel)\n                .prompt()\n                .user(userMessage)\n                .call()\n                .content();\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"step-5-create-a-chat-controller",children:"Step 5: Create a Chat Controller"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"src/main/java/com/example/spring_ai_demo/controller/ChatController.java"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'package com.example.spring_ai_demo.controller;\n\nimport com.example.spring_ai_demo.service.ChatService;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.*;\n\nimport java.util.Map;\n\n@RestController\n@RequestMapping("/api/chat")\npublic class ChatController {\n\n    private final ChatService chatService;\n\n    public ChatController(ChatService chatService) {\n        this.chatService = chatService;\n    }\n\n    @PostMapping("/simple")\n    public ResponseEntity<Map<String, String>> simpleChat(@RequestBody Map<String, String> request) {\n        String prompt = request.get("prompt");\n        if (prompt == null || prompt.isBlank()) {\n            return ResponseEntity.badRequest()\n                .body(Map.of("error", "Prompt is required"));\n        }\n\n        String response = chatService.chat(prompt);\n        return ResponseEntity.ok(Map.of(\n            "prompt", prompt,\n            "response", response\n        ));\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"step-6-run-the-application",children:"Step 6: Run the Application"}),"\n",(0,i.jsx)(n.p,{children:"Set environment variables and run your Spring Boot application:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"export OPENAI_API_KEY=your-openai-api-key\nexport OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:5000/v1/traces\nexport OTEL_EXPORTER_OTLP_HEADERS=x-mlflow-experiment-id=0\n\nmvn spring-boot:run\n"})}),"\n",(0,i.jsxs)(n.p,{children:["After making chat requests, open the MLflow UI at ",(0,i.jsx)(n.code,{children:"http://localhost:5000"})," and navigate to the experiment to see the traces."]}),"\n",(0,i.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/genai/eval-monitor/running-evaluation/agents",children:"Evaluate the Agent"}),": Learn how to evaluate the agent's performance."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/genai/prompt-registry",children:"Manage Prompts"}),": Learn how to manage prompts for the agent."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/genai/prompt-registry/optimize-prompts",children:"Automatic Agent Optimization"}),": Learn how to automatically optimize the agent end-to-end with state-of-the-art optimization algorithms."]}),"\n"]})]})}function d(e={}){let{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},1366(e,n,r){r.d(n,{A:()=>t});let t=r.p+"assets/images/spring-ai-tracing-f802506208759be1fcd131364a71df3d.png"},28453(e,n,r){r.d(n,{R:()=>o,x:()=>s});var t=r(96540);let i={},a=t.createContext(i);function o(e){let n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);