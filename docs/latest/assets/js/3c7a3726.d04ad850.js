"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5383],{20723:(e,n,t)=>{t.d(n,{O:()=>s});var i=t(96540),o=t(74848);function s(e){let{children:n,href:t}=e;const s=(0,i.useCallback)((async e=>{if(e.preventDefault(),window.gtag)try{window.gtag("event","notebook-download",{href:t})}catch{}const n=await fetch(t),i=await n.blob(),o=window.URL.createObjectURL(i),s=document.createElement("a");s.style.display="none",s.href=o;const l=t.split("/").pop();s.download=l,document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(o),document.body.removeChild(s)}),[t]);return(0,o.jsx)("a",{className:"button button--primary",style:{marginBottom:"1rem",display:"block",width:"min-content"},href:t,download:!0,onClick:s,children:n})}},28339:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>p,frontMatter:()=>a,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"traditional-ml/creating-custom-pyfunc/notebooks/index","title":"Custom PyFuncs with MLflow - Notebooks","description":"If you would like to view the notebooks in this guide in their entirety, each notebook can viewed or downloaded directly below.","source":"@site/docs/traditional-ml/creating-custom-pyfunc/notebooks/index.mdx","sourceDirName":"traditional-ml/creating-custom-pyfunc/notebooks","slug":"/traditional-ml/creating-custom-pyfunc/notebooks/","permalink":"/docs/latest/traditional-ml/creating-custom-pyfunc/notebooks/","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"sidebar_label":"Full Notebooks"},"sidebar":"docsSidebar","previous":{"title":"Understanding PyFunc in MLflow","permalink":"/docs/latest/traditional-ml/creating-custom-pyfunc/part2-pyfunc-components/"},"next":{"title":"Introduction to MLflow Custom Pyfunc","permalink":"/docs/latest/traditional-ml/creating-custom-pyfunc/notebooks/basic-pyfunc"}}');var o=t(74848),s=t(28453),l=t(56289),r=t(20723);const a={sidebar_position:3,sidebar_label:"Full Notebooks"},d="Custom PyFuncs with MLflow - Notebooks",c={},h=[{value:"Basics of Creating a Custom Python Model with MLflow&#39;s Pyfunc",id:"basics-of-creating-a-custom-python-model-with-mlflows-pyfunc",level:2},{value:"Introduction",id:"introduction",level:3},{value:"What you will learn",id:"what-you-will-learn",level:3},{value:"Step-by-step Guide",id:"step-by-step-guide",level:3},{value:"Wrap Up",id:"wrap-up",level:3},{value:"Building a Basic Custom Python Model",id:"building-a-basic-custom-python-model",level:2},{value:"Introduction",id:"introduction-1",level:3},{value:"What you will learn",id:"what-you-will-learn-1",level:3},{value:"The <code>PythonModel</code> class",id:"the-pythonmodel-class",level:3},{value:"Lissajous Curves",id:"lissajous-curves",level:3},{value:"Step-by-step Guide",id:"step-by-step-guide-1",level:3},{value:"Wrap Up",id:"wrap-up-1",level:3},{value:"Overriding a model&#39;s prediction method",id:"overriding-a-models-prediction-method",level:2},{value:"Introduction",id:"introduction-2",level:3},{value:"What you will learn",id:"what-you-will-learn-2",level:3},{value:"Why Override <em>predict</em>?",id:"why-override-predict",level:3},{value:"Creating a Custom PyFunc",id:"creating-a-custom-pyfunc",level:3},{value:"Step-by-step Guide",id:"step-by-step-guide-2",level:3},{value:"Wrap Up",id:"wrap-up-2",level:3},{value:"Run the Notebooks in your Environment",id:"run-the-notebooks-in-your-environment",level:2}];function u(e){const n={admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"custom-pyfuncs-with-mlflow---notebooks",children:"Custom PyFuncs with MLflow - Notebooks"})}),"\n",(0,o.jsx)(n.p,{children:"If you would like to view the notebooks in this guide in their entirety, each notebook can viewed or downloaded directly below."}),"\n",(0,o.jsx)(n.h2,{id:"basics-of-creating-a-custom-python-model-with-mlflows-pyfunc",children:"Basics of Creating a Custom Python Model with MLflow's Pyfunc"}),"\n",(0,o.jsx)(n.h3,{id:"introduction",children:"Introduction"}),"\n",(0,o.jsxs)(n.p,{children:["In this initial tutorial, we'll introduce you to the foundational concepts of MLflow's ",(0,o.jsx)(n.em,{children:"pyfunc"}),". We'll illustrate the simplicity and\nadaptability of creating, saving, and invoking a custom Python function model within the MLflow ecosystem. By the end, you'll have a\nhands-on understanding of a model that adds a specified numeric value to DataFrame columns, highlighting the innate flexibility\nof the ",(0,o.jsx)(n.em,{children:"pyfunc"})," flavor."]}),"\n",(0,o.jsx)(n.h3,{id:"what-you-will-learn",children:"What you will learn"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Simplicity of Custom PyFunc Models"}),": Grasp the basic structure of the ",(0,o.jsx)(n.em,{children:"PythonModel"})," class and how it forms the backbone of custom models in MLflow."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Model Persistence"}),": Understand the straightforward process of saving and retrieving custom models."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Invoking Predictions"}),": Learn the mechanics of how to use a loaded custom ",(0,o.jsx)(n.em,{children:"pyfunc"})," model for predictions."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"step-by-step-guide",children:"Step-by-step Guide"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Model Definition"}),': Begin by crafting a Python class encapsulating the logic for our straightforward "Add N" model.']}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Persisting the Model"}),": Use MLflow's capabilities to save the defined model, ensuring it can be retrieved later."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Model Retrieval"}),": Load the model from its saved location and prepare it for predictions."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Model Evaluation"}),": Use the retrieved model on sample data to witness its functionality."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"wrap-up",children:"Wrap Up"}),"\n",(0,o.jsxs)(n.p,{children:["By the conclusion of this tutorial, you'll appreciate the ease and consistency that MLflow's custom ",(0,o.jsx)(n.em,{children:"pyfunc"})," offers, even for the simplest of models. It sets the stage for more advanced functionalities and use-cases you might explore in subsequent tutorials."]}),"\n",(0,o.jsx)(l.A,{className:"button button--primary",to:"introduction",children:(0,o.jsx)("span",{children:"View the Notebook"})}),"\n",(0,o.jsx)(n.h2,{id:"building-a-basic-custom-python-model",children:"Building a Basic Custom Python Model"}),"\n",(0,o.jsx)(n.h3,{id:"introduction-1",children:"Introduction"}),"\n",(0,o.jsxs)(n.p,{children:["In this tutorial, we deepen our understanding of MLflow's Custom Pyfunc. The ",(0,o.jsx)(n.code,{children:"PythonModel"})," class serves as the cornerstone, allowing\nyou to define, save, load, and predict using custom PyFunc models.\nWe'll be developing a very non-standard model; one that generates plotted figures in order to showcase the flexibility of custom PyFunc models.\nBy the end, we'll have a functional Lissajous curve generator, wrapped and managed within the Pyfunc framework."]}),"\n",(0,o.jsx)(n.h3,{id:"what-you-will-learn-1",children:"What you will learn"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Defining Custom PyFunc Models"}),": Explore the structure of the ",(0,o.jsx)(n.code,{children:"PythonModel"})," class and its essential methods."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Understanding Pyfunc Components"}),": Get acquainted with the foundational building blocks of the Pyfunc flavor."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Saving and Loading Models"}),": Experience the seamless integration of MLflow's storage and retrieval capabilities."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Predicting with Custom Logic"}),": Interface with the loaded custom Pyfunc to generate interesting Lissajous curve plots."]}),"\n"]}),"\n",(0,o.jsxs)(n.h3,{id:"the-pythonmodel-class",children:["The ",(0,o.jsx)(n.code,{children:"PythonModel"})," class"]}),"\n",(0,o.jsxs)(n.p,{children:["MLflow's commitment to flexibility and standardization shines through the ",(0,o.jsx)(n.code,{children:"PythonModel"})," class. This class, crucial to the Pyfunc\nflavor, provides the necessary scaffolding to define custom logic, load resources, and make predictions."]}),"\n",(0,o.jsx)(n.p,{children:"There are two primary ways to create an instance of the PythonModel:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Class-based approach"}),": Define a class with necessary methods and use it as a blueprint for the model."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Function-based approach"}),": Capture the entire prediction logic within a single function, letting MLflow handle the rest."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["For this tutorial, we'll focus on the class-based approach, delving into methods like ",(0,o.jsx)(n.code,{children:"load_context"})," and ",(0,o.jsx)(n.code,{children:"predict"})," and\nunderstanding their roles in the larger ecosystem."]}),"\n",(0,o.jsx)(n.h3,{id:"lissajous-curves",children:"Lissajous Curves"}),"\n",(0,o.jsx)(n.p,{children:"As our vehicle for understanding, we'll employ the Lissajous curves \u2013 sinusoidal parametric curves whose shapes and orientations are\ndetermined by their parameters. Instead of a conventional machine learning model, this mathematical curve will demonstrate the versatility\nand power of the Pyfunc flavor."}),"\n",(0,o.jsx)(n.h3,{id:"step-by-step-guide-1",children:"Step-by-step Guide"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Define the Custom PyFunc Model"}),": We start by creating a Python class encapsulating the logic for generating Lissajous curves."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Save the Model"}),": With the model defined, we leverage MLflow's capabilities to save it, ensuring future reproducibility."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Load the Model"}),": Retrieve the model from storage and prepare it for predictions."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Generate Curves"}),": Use the loaded model to create and visualize Lissajous curves, showcasing the end-to-end capabilities of the Pyfunc flavor."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"wrap-up-1",children:"Wrap Up"}),"\n",(0,o.jsx)(n.p,{children:"With a practical example under our belt, the power and flexibility of MLflow's Custom Pyfunc are evident. Whether you're working with\ntraditional machine learning models or unique use cases like the Lissajous curve generator, Pyfunc ensures a standardized, reproducible,\nand efficient workflow."}),"\n",(0,o.jsx)(l.A,{className:"button button--primary",to:"basic-pyfunc",children:(0,o.jsx)("span",{children:"View the Notebook"})}),"\n",(0,o.jsx)(n.h2,{id:"overriding-a-models-prediction-method",children:"Overriding a model's prediction method"}),"\n",(0,o.jsx)(n.h3,{id:"introduction-2",children:"Introduction"}),"\n",(0,o.jsxs)(n.p,{children:["Diving deeper into the realm of custom PyFuncs with MLflow, this tutorial addresses a common challenge in model deployment: retaining and\ncustomizing the behavior of a model's prediction method after serialization and deployment. Leveraging the power of MLflow's PyFunc flavor,\nwe'll learn how to override the default ",(0,o.jsx)(n.em,{children:"predict"})," behavior, ensuring our model retains all its original capabilities when deployed in\ndifferent environments."]}),"\n",(0,o.jsx)(n.h3,{id:"what-you-will-learn-2",children:"What you will learn"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"The Challenge with Default PyFuncs"}),": Recognize the limitations of default PyFunc behavior with complex models, especially when methods other than ",(0,o.jsx)(n.em,{children:"predict"})," are vital."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Customizing Predict Method"}),": Discover the technique to override the default ",(0,o.jsx)(n.em,{children:"predict"})," method, enabling the support of various prediction methodologies."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Harnessing Joblib with PyFunc"}),": Understand why ",(0,o.jsx)(n.em,{children:"joblib"})," is preferred over ",(0,o.jsx)(n.em,{children:"pickle"})," for serializing scikit-learn models and how to integrate it with PyFunc."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Dynamic Prediction with Params"}),": Learn to make the ",(0,o.jsx)(n.em,{children:"predict"})," method more versatile by accepting parameters that dictate the type of prediction."]}),"\n"]}),"\n",(0,o.jsxs)(n.h3,{id:"why-override-predict",children:["Why Override ",(0,o.jsx)(n.em,{children:"predict"}),"?"]}),"\n",(0,o.jsxs)(n.p,{children:["Models, especially in libraries like scikit-learn, often come with multiple methods for prediction, such as ",(0,o.jsx)(n.em,{children:"predict"}),", ",(0,o.jsx)(n.em,{children:"predict_proba"}),", and ",(0,o.jsx)(n.em,{children:"predict_log_proba"}),".\nWhen deploying such models, it's essential to retain the flexibility to choose the prediction methodology dynamically. This section sheds light\non the need for such flexibility and the challenges with default PyFunc deployments."]}),"\n",(0,o.jsx)(n.h3,{id:"creating-a-custom-pyfunc",children:"Creating a Custom PyFunc"}),"\n",(0,o.jsxs)(n.p,{children:["Venturing into the solution, we craft a custom PyFunc by extending MLflow's ",(0,o.jsx)(n.em,{children:"PythonModel"}),". This custom class serves as a wrapper around the\noriginal model, providing a flexible ",(0,o.jsx)(n.em,{children:"predict"})," method that can mimic the behavior of various original methods based on provided parameters."]}),"\n",(0,o.jsx)(n.h3,{id:"step-by-step-guide-2",children:"Step-by-step Guide"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Prepare a Basic Model"}),": Use the Iris dataset to create a simple Logistic Regression model, illustrating the different prediction methods."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Challenges with Default Deployment"}),": Recognize the limitations when deploying the model as a default PyFunc."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Crafting the Custom PyFunc"}),": Design a ModelWrapper class that can dynamically switch between prediction methods."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Saving and Loading the Custom Model"}),": Integrate with MLflow to save the custom PyFunc and load it for predictions."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Dynamic Predictions"}),": Test the loaded model, ensuring it supports all original prediction methods."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"wrap-up-2",children:"Wrap Up"}),"\n",(0,o.jsx)(n.p,{children:"Overcoming the challenges of default deployments, this tutorial showcases the prowess of custom PyFuncs in MLflow. The ability to override and\ncustomize prediction methods ensures that our deployed models remain as versatile and capable as their original incarnations. As ML workflows\ngrow in complexity, such customization becomes invaluable, ensuring our deployments are robust and adaptable."}),"\n",(0,o.jsx)(l.A,{className:"button button--primary",to:"override-predict",children:(0,o.jsx)("span",{children:"View the Notebook"})}),"\n",(0,o.jsx)(n.h2,{id:"run-the-notebooks-in-your-environment",children:"Run the Notebooks in your Environment"}),"\n",(0,o.jsx)(n.p,{children:"Additionally, if you would like to download a copy locally to run in your own environment, you can download by\nclicking the respective links to each notebook in this guide:"}),"\n",(0,o.jsx)(r.O,{href:"https://raw.githubusercontent.com/mlflow/mlflow/master/docs/source/traditional-ml/creating-custom-pyfunc/notebooks/introduction.ipynb",children:"Download the Introduction notebook"}),"\n",(0,o.jsx)("br",{}),"\n",(0,o.jsx)("br",{}),"\n",(0,o.jsx)(r.O,{href:"https://raw.githubusercontent.com/mlflow/mlflow/master/docs/source/traditional-ml/creating-custom-pyfunc/notebooks/basic-pyfunc.ipynb",children:"Download the Basic Pyfunc notebook"}),"\n",(0,o.jsx)("br",{}),"\n",(0,o.jsx)("br",{}),"\n",(0,o.jsx)(r.O,{href:"https://raw.githubusercontent.com/mlflow/mlflow/master/docs/source/traditional-ml/creating-custom-pyfunc/notebooks/override-predict.ipynb",children:"Download the Predict Override notebook"}),"\n",(0,o.jsx)("br",{}),"\n",(0,o.jsx)("br",{}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:["In order to run the notebooks, please ensure that you either have a local MLflow Tracking Server started or modify the\n",(0,o.jsx)(n.code,{children:"mlflow.set_tracking_uri()"})," values to point to a running instance of the MLflow Tracking Server. In order to interact with\nthe MLflow UI, ensure that you are either running the UI server locally or have a configured deployed MLflow UI server that\nyou are able to access."]})})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>r});var i=t(96540);const o={},s=i.createContext(o);function l(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);