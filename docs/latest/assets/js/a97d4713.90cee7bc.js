"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[9671],{28453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>i});var o=t(96540);const r={},s=o.createContext(r);function l(e){const n=o.useContext(s);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),o.createElement(s.Provider,{value:n},e.children)}},51135:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>d,frontMatter:()=>l,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"tracing/opentelemetry/ingest","title":"Collect OpenTelemetry Traces into MLflow","description":"OpenTelemetry trace ingestion is supported in MLflow 3.6.0 and above.","source":"@site/docs/genai/tracing/opentelemetry/ingest.mdx","sourceDirName":"tracing/opentelemetry","slug":"/tracing/opentelemetry/ingest","permalink":"/mlflow-website/docs/latest/genai/tracing/opentelemetry/ingest","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"genAISidebar","previous":{"title":"Overview","permalink":"/mlflow-website/docs/latest/genai/tracing/opentelemetry/"},"next":{"title":"Export MLflow Traces/Metrics via OTLP","permalink":"/mlflow-website/docs/latest/genai/tracing/opentelemetry/export"}}');var r=t(74848),s=t(28453);const l={},i="Collect OpenTelemetry Traces into MLflow",a={},c=[{value:"OpenTelemetry endpoint (OTLP)",id:"opentelemetry-endpoint-otlp",level:2},{value:"Basic Example",id:"basic-example",level:2},{value:"Using OpenTelemetry Collector",id:"using-opentelemetry-collector",level:2}];function p(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"collect-opentelemetry-traces-into-mlflow",children:"Collect OpenTelemetry Traces into MLflow"})}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["OpenTelemetry trace ingestion is supported in ",(0,r.jsx)(n.strong,{children:"MLflow 3.6.0 and above"}),"."]})}),"\n",(0,r.jsx)(n.h2,{id:"opentelemetry-endpoint-otlp",children:"OpenTelemetry endpoint (OTLP)"}),"\n",(0,r.jsxs)(n.p,{children:["MLflow Server exposes an OTLP endpoint at ",(0,r.jsx)(n.code,{children:"/v1/trace"})," (",(0,r.jsx)(n.a,{href:"https://opentelemetry.io/docs/specs/otlp/",children:"OTLP"}),"). This endpoint accepts traces from any native OpenTelemetry instrumentation, allowing you to trace applications written in other languages such as Java, Go, Rust, etc."]}),"\n",(0,r.jsx)(n.p,{children:"To use this endpoint, start MLflow Server with a SQL-based backend store. The following command starts MLflow Server with an SQLite backend store:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mlflow server --backend-store-uri sqlite:///mlflow.db\n"})}),"\n",(0,r.jsxs)(n.p,{children:["To use other types of SQL databases such as PostgreSQL, MySQL, and MSSQL, change the store URI as described in the ",(0,r.jsx)(n.a,{href:"/self-hosting/architecture/backend-store",children:"backend store documentation"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["In your application, configure the server endpoint and set the MLflow experiment ID in the OTLP header ",(0,r.jsx)(n.code,{children:"x-mlflow-experiment-id"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"export OTEL_EXPORTER_OTLP_TRACES_ENDPOINT=http://localhost:5000/v1/trace\nexport OTEL_EXPORTER_OTLP_TRACES_HEADERS=x-mlflow-experiment-id=123\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsx)(n.p,{children:"As of MLflow 3.6.0, MLflow Server supports only the OTLP/HTTP endpoint. The OTLP/gRPC endpoint is not yet supported."})}),"\n",(0,r.jsx)(n.h2,{id:"basic-example",children:"Basic Example"}),"\n",(0,r.jsx)(n.p,{children:"The following example shows how to collect traces from a FastAPI application using OpenTelemetry FastAPI instrumentation."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'import os\nimport uvicorn\nfrom fastapi import FastAPI\nfrom opentelemetry.instrumentation.fastapi import FastAPIInstrumentor\n\n# Set the endpoint and header\nMLFLOW_TRACKING_URI = "http://localhost:5000"\nMLFLOW_EXPERIMENT_ID = "123"\n\nos.environ["OTEL_EXPORTER_OTLP_TRACES_ENDPOINT"] = f"{MLFLOW_TRACKING_URI}/v1/trace"\nos.environ[\n    "OTEL_EXPORTER_OTLP_TRACES_HEADERS"\n] = f"x-mlflow-experiment-id={MLFLOW_EXPERIMENT_ID}"\n\n\napp = FastAPI()\nFastAPIInstrumentor.instrument_app(app)\n\n\n@app.get("/")\nasync def root():\n    return {"message": "Hello, World!"}\n\n\nif __name__ == "__main__":\n    uvicorn.run(app, host="0.0.0.0", port=8000)\n'})}),"\n",(0,r.jsx)(n.h2,{id:"using-opentelemetry-collector",children:"Using OpenTelemetry Collector"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://opentelemetry.io/docs/collector/",children:"OpenTelemetry Collector"})," is a vendor-agnostic agent that can be used to collect, process, and export traces to various observability platforms. To configure OpenTelemetry Collector to ingest traces into MLflow, use the following configuration:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"export MLFLOW_TRACKING_URI=http://localhost:5000\nexport MLFLOW_EXPERIMENT_ID=123\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="opentelemetry-collector.yaml"',children:"receivers:\n  otlp:\n    protocols:\n      grpc:\n        endpoint: 0.0.0.0:4317\n      http:\n        endpoint: 0.0.0.0:4318\n\nexporters:\n  otlp:\n    endpoint: ${MLFLOW_TRACKING_URI}/v1/trace\n    headers:\n      x-mlflow-experiment-id: ${MLFLOW_EXPERIMENT_ID}\n\nservice:\n  pipelines:\n    traces:\n      receivers: [otlp]\n      processors: [batch]\n      exporters: [otlp]\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker run -d --name opentelemetry-collector \\\n  -p 4317:4317 \\\n  -p 4318:4318 \\\n  -v $(pwd)/opentelemetry-collector.yaml:/etc/otel/collector/config.yaml \\\n  otel/opentelemetry-collector\n"})})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}}}]);