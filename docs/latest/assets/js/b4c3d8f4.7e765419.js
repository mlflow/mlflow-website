"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1597],{16734:(e,t,n)=>{n.d(t,{d:()=>l});var a=n(58069);const i="codeBlock_oJcR";var o=n(74848);const l=e=>{let{children:t,executionCount:n}=e;return(0,o.jsx)("div",{style:{flexGrow:1,minWidth:0,marginTop:"var(--padding-md)",width:"100%"},children:(0,o.jsx)(a.A,{className:i,language:"python",children:t})})}},20723:(e,t,n)=>{n.d(t,{O:()=>o});var a=n(96540),i=n(74848);function o(e){let{children:t,href:n}=e;const o=(0,a.useCallback)((async e=>{if(e.preventDefault(),window.gtag)try{window.gtag("event","notebook-download",{href:n})}catch{}const t=await fetch(n),a=await t.blob(),i=window.URL.createObjectURL(a),o=document.createElement("a");o.style.display="none",o.href=i;const l=n.split("/").pop();o.download=l,document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(i),document.body.removeChild(o)}),[n]);return(0,i.jsx)("a",{className:"button button--primary",style:{marginBottom:"1rem",display:"block",width:"min-content"},href:n,download:!0,onClick:o,children:t})}},61536:(e,t,n)=>{n.d(t,{p:()=>i});var a=n(74848);const i=e=>{let{children:t,isStderr:n}=e;return(0,a.jsx)("pre",{style:{margin:0,borderRadius:0,background:"none",fontSize:"0.85rem",flexGrow:1,padding:"var(--padding-sm)"},children:t})}},66790:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>m,contentTitle:()=>u,default:()=>p,frontMatter:()=>c,metadata:()=>a,toc:()=>h});const a=JSON.parse('{"id":"llms/llm-evaluate/notebooks/question-answering-evaluation-ipynb","title":"LLM Evaluation with MLflow Example Notebook","description":"Download this notebook","source":"@site/docs/llms/llm-evaluate/notebooks/question-answering-evaluation-ipynb.mdx","sourceDirName":"llms/llm-evaluate/notebooks","slug":"/llms/llm-evaluate/notebooks/question-answering-evaluation","permalink":"/docs/latest/llms/llm-evaluate/notebooks/question-answering-evaluation","draft":false,"unlisted":false,"editUrl":"https://github.com/mlflow/mlflow/edit/master/docs/docs/llms/llm-evaluate/notebooks/question-answering-evaluation.ipynb","tags":[],"version":"current","frontMatter":{"custom_edit_url":"https://github.com/mlflow/mlflow/edit/master/docs/docs/llms/llm-evaluate/notebooks/question-answering-evaluation.ipynb","slug":"question-answering-evaluation"},"sidebar":"docsSidebar","previous":{"title":"Evaluate a Hugging Face LLM with mlflow.evaluate()","permalink":"/docs/latest/llms/llm-evaluate/notebooks/huggingface-evaluation"},"next":{"title":"LLM RAG Evaluation with MLflow Example Notebook","permalink":"/docs/latest/llms/llm-evaluate/notebooks/rag-evaluation"}}');var i=n(74848),o=n(28453),l=n(16734),s=n(61536),r=n(86563),d=n(20723);const c={custom_edit_url:"https://github.com/mlflow/mlflow/edit/master/docs/docs/llms/llm-evaluate/notebooks/question-answering-evaluation.ipynb",slug:"question-answering-evaluation"},u="LLM Evaluation with MLflow Example Notebook",m={},h=[{value:"Basic Question-Answering Evaluation",id:"basic-question-answering-evaluation",level:2},{value:"LLM-judged correctness with OpenAI GPT-4",id:"llm-judged-correctness-with-openai-gpt-4",level:2},{value:"Custom LLM-judged metric for professionalism",id:"custom-llm-judged-metric-for-professionalism",level:2}];function f(e){const t={code:"code",h1:"h1",h2:"h2",header:"header",p:"p",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"llm-evaluation-with-mlflow-example-notebook",children:"LLM Evaluation with MLflow Example Notebook"})}),"\n",(0,i.jsx)(d.O,{href:"https://raw.githubusercontent.com/mlflow/mlflow/master/docs/docs/llms/llm-evaluate/notebooks/question-answering-evaluation.ipynb",children:"Download this notebook"}),"\n",(0,i.jsx)(t.p,{children:"In this notebook, we will demonstrate how to evaluate various LLMs and RAG systems with MLflow, leveraging simple metrics such as toxicity, as well as LLM-judged metrics such as relevance, and even custom LLM-judged metrics such as professionalism"}),"\n",(0,i.jsx)(t.p,{children:"We need to set our OpenAI API key, since we will be using GPT-4 for our LLM-judged metrics."}),"\n",(0,i.jsx)(t.p,{children:"In order to set your private key safely, please be sure to either export your key through a command-line terminal for your current instance, or, for a permanent addition to all user-based sessions, configure your favored environment management configuration file (i.e., .bashrc, .zshrc) to have the following entry:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.code,{children:"OPENAI_API_KEY=<your openai API key>"})}),"\n",(0,i.jsx)(l.d,{executionCount:3,children:"import openai\nimport pandas as pd\n\nimport mlflow"}),"\n",(0,i.jsx)(t.h2,{id:"basic-question-answering-evaluation",children:"Basic Question-Answering Evaluation"}),"\n",(0,i.jsxs)(t.p,{children:["Create a test case of ",(0,i.jsx)(t.code,{children:"inputs"})," that will be passed into the model and ",(0,i.jsx)(t.code,{children:"ground_truth"})," which will be used to compare against the generated output from the model."]}),"\n",(0,i.jsx)(l.d,{executionCount:4,children:'eval_df = pd.DataFrame(\n  {\n      "inputs": [\n          "How does useEffect() work?",\n          "What does the static keyword in a function mean?",\n          "What does the \'finally\' block in Python do?",\n          "What is the difference between multiprocessing and multithreading?",\n      ],\n      "ground_truth": [\n          "The useEffect() hook tells React that your component needs to do something after render. React will remember the function you passed (we\u2019ll refer to it as our \u201ceffect\u201d), and call it later after performing the DOM updates.",\n          "Static members belongs to the class, rather than a specific instance. This means that only one instance of a static member exists, even if you create multiple objects of the class, or if you don\'t create any. It will be shared by all objects.",\n          "\'Finally\' defines a block of code to run when the try... except...else block is final. The finally block will be executed no matter if the try block raises an error or not.",\n          "Multithreading refers to the ability of a processor to execute multiple threads concurrently, where each thread runs a process. Whereas multiprocessing refers to the ability of a system to run multiple processors in parallel, where each processor can run one or more threads.",\n      ],\n  }\n)'}),"\n",(0,i.jsxs)(t.p,{children:["Create a simple OpenAI model that asks gpt-4o to answer the question in two sentences. Call ",(0,i.jsx)(t.code,{children:"mlflow.evaluate()"})," with the model and evaluation dataframe."]}),"\n",(0,i.jsx)(l.d,{executionCount:5,children:'with mlflow.start_run() as run:\n  system_prompt = "Answer the following question in two sentences"\n  basic_qa_model = mlflow.openai.log_model(\n      model="gpt-4o-mini",\n      task=openai.chat.completions,\n      name="model",\n      messages=[\n          {"role": "system", "content": system_prompt},\n          {"role": "user", "content": "{question}"},\n      ],\n  )\n  results = mlflow.evaluate(\n      basic_qa_model.model_uri,\n      eval_df,\n      targets="ground_truth",  # specify which column corresponds to the expected output\n      model_type="question-answering",  # model type indicates which metrics are relevant for this task\n      evaluators="default",\n  )\nresults.metrics'}),"\n",(0,i.jsx)(s.p,{isStderr:!0,children:"2023/10/27 00:56:56 INFO mlflow.models.evaluation.base: Evaluating the model with the default evaluator.\n2023/10/27 00:56:56 INFO mlflow.models.evaluation.default_evaluator: Computing model predictions.\nUsing default facebook/roberta-hate-speech-dynabench-r4-target checkpoint\n2023/10/27 00:57:06 INFO mlflow.models.evaluation.default_evaluator: Evaluating builtin metrics: token_count\n2023/10/27 00:57:06 INFO mlflow.models.evaluation.default_evaluator: Evaluating builtin metrics: toxicity\n2023/10/27 00:57:06 INFO mlflow.models.evaluation.default_evaluator: Evaluating builtin metrics: flesch_kincaid_grade_level\n2023/10/27 00:57:06 INFO mlflow.models.evaluation.default_evaluator: Evaluating builtin metrics: ari_grade_level\n2023/10/27 00:57:06 INFO mlflow.models.evaluation.default_evaluator: Evaluating builtin metrics: exact_match"}),"\n",(0,i.jsx)(s.p,{children:"{'toxicity/v1/mean': 0.00020573455913108774,\n'toxicity/v1/variance': 3.4433758978645428e-09,\n'toxicity/v1/p90': 0.00027067282790085303,\n'toxicity/v1/ratio': 0.0,\n'flesch_kincaid_grade_level/v1/mean': 15.149999999999999,\n'flesch_kincaid_grade_level/v1/variance': 26.502499999999998,\n'flesch_kincaid_grade_level/v1/p90': 20.85,\n'ari_grade_level/v1/mean': 17.375,\n'ari_grade_level/v1/variance': 42.92187499999999,\n'ari_grade_level/v1/p90': 24.48,\n'exact_match/v1': 0.0}"}),"\n",(0,i.jsx)(t.p,{children:"Inspect the evaluation results table as a dataframe to see row-by-row metrics to further assess model performance"}),"\n",(0,i.jsx)(l.d,{executionCount:6,children:'results.tables["eval_results_table"]'}),"\n",(0,i.jsx)(s.p,{children:"Downloading artifacts:   0%|          | 0/1 [00:00<?, ?it/s]"}),"\n",(0,i.jsx)(r.Q,{children:(0,i.jsx)("div",{dangerouslySetInnerHTML:{__html:"<div>\n<style scoped>\n  .dataframe tbody tr th:only-of-type {\n      vertical-align: middle;\n  }\n\n  .dataframe tbody tr th {\n      vertical-align: top;\n  }\n\n  .dataframe thead th {\n      text-align: right;\n  }\n</style>\n<table border=\"1\" class=\"dataframe\">\n<thead>\n  <tr style=\"text-align: right;\">\n    <th></th>\n    <th>inputs</th>\n    <th>ground_truth</th>\n    <th>outputs</th>\n    <th>token_count</th>\n    <th>toxicity/v1/score</th>\n    <th>flesch_kincaid_grade_level/v1/score</th>\n    <th>ari_grade_level/v1/score</th>\n  </tr>\n</thead>\n<tbody>\n  <tr>\n    <th>0</th>\n    <td>How does useEffect() work?</td>\n    <td>The useEffect() hook tells React that your com...</td>\n    <td>useEffect() is a React hook that allows you to...</td>\n    <td>64</td>\n    <td>0.000243</td>\n    <td>14.2</td>\n    <td>15.8</td>\n  </tr>\n  <tr>\n    <th>1</th>\n    <td>What does the static keyword in a function mean?</td>\n    <td>Static members belongs to the class, rather th...</td>\n    <td>The static keyword in a function means that th...</td>\n    <td>32</td>\n    <td>0.000150</td>\n    <td>12.6</td>\n    <td>14.9</td>\n  </tr>\n  <tr>\n    <th>2</th>\n    <td>What does the 'finally' block in Python do?</td>\n    <td>'Finally' defines a block of code to run when ...</td>\n    <td>The 'finally' block in Python is used to speci...</td>\n    <td>46</td>\n    <td>0.000283</td>\n    <td>10.1</td>\n    <td>10.6</td>\n  </tr>\n  <tr>\n    <th>3</th>\n    <td>What is the difference between multiprocessing...</td>\n    <td>Multithreading refers to the ability of a proc...</td>\n    <td>The main difference between multiprocessing an...</td>\n    <td>34</td>\n    <td>0.000148</td>\n    <td>23.7</td>\n    <td>28.2</td>\n  </tr>\n</tbody>\n</table>\n</div>"}})}),"\n",(0,i.jsx)(t.h2,{id:"llm-judged-correctness-with-openai-gpt-4",children:"LLM-judged correctness with OpenAI GPT-4"}),"\n",(0,i.jsxs)(t.p,{children:["Construct an answer similarity metric using the ",(0,i.jsx)(t.code,{children:"answer_similarity()"})," metric factory function."]}),"\n",(0,i.jsx)(l.d,{executionCount:7,children:'from mlflow.metrics.genai import EvaluationExample, answer_similarity\n\n# Create an example to describe what answer_similarity means like for this problem.\nexample = EvaluationExample(\n  input="What is MLflow?",\n  output="MLflow is an open-source platform for managing machine "\n  "learning workflows, including experiment tracking, model packaging, "\n  "versioning, and deployment, simplifying the ML lifecycle.",\n  score=4,\n  justification="The definition effectively explains what MLflow is "\n  "its purpose, and its developer. It could be more concise for a 5-score.",\n  grading_context={\n      "targets": "MLflow is an open-source platform for managing "\n      "the end-to-end machine learning (ML) lifecycle. It was developed by Databricks, "\n      "a company that specializes in big data and machine learning solutions. MLflow is "\n      "designed to address the challenges that data scientists and machine learning "\n      "engineers face when developing, training, and deploying machine learning models."\n  },\n)\n\n# Construct the metric using OpenAI GPT-4 as the judge\nanswer_similarity_metric = answer_similarity(model="openai:/gpt-4", examples=[example])\n\nprint(answer_similarity_metric)'}),"\n",(0,i.jsx)(s.p,{children:"EvaluationMetric(name=answer_similarity, greater_is_better=True, long_name=answer_similarity, version=v1, metric_details=\nTask:\nYou are an impartial judge. You will be given an input that was sent to a machine\nlearning model, and you will be given an output that the model produced. You\nmay also be given additional information that was used by the model to generate the output.\n\nYour task is to determine a numerical score called answer_similarity based on the input and output.\nA definition of answer_similarity and a grading rubric are provided below.\nYou must use the grading rubric to determine your score. You must also justify your score.\n\nExamples could be included below for reference. Make sure to use them as references and to\nunderstand them before completing the task.\n\nInput:\n{input}\n\nOutput:\n{output}\n\n{grading_context_columns}\n\nMetric definition:\nAnswer similarity is evaluated on the degree of semantic similarity of the provided output to the provided targets, which is the ground truth. Scores can be assigned based on the gradual similarity in meaning and description to the provided targets, where a higher score indicates greater alignment between the provided output and provided targets.\n\nGrading rubric:\nAnswer similarity: Below are the details for different scores:\n- Score 1: the output has little to no semantic similarity to the provided targets.\n- Score 2: the output displays partial semantic similarity to the provided targets on some aspects.\n- Score 3: the output has moderate semantic similarity to the provided targets.\n- Score 4: the output aligns with the provided targets in most aspects and has substantial semantic similarity.\n- Score 5: the output closely aligns with the provided targets in all significant aspects.\n\nExamples:\n\nInput:\nWhat is MLflow?\n\nOutput:\nMLflow is an open-source platform for managing machine learning workflows, including experiment tracking, model packaging, versioning, and deployment, simplifying the ML lifecycle.\n\nAdditional information used by the model:\nkey: ground_truth\nvalue:\nMLflow is an open-source platform for managing the end-to-end machine learning (ML) lifecycle. It was developed by Databricks, a company that specializes in big data and machine learning solutions. MLflow is designed to address the challenges that data scientists and machine learning engineers face when developing, training, and deploying machine learning models.\n\nscore: 4\njustification: The definition effectively explains what MLflow is its purpose, and its developer. It could be more concise for a 5-score.\n      \n\nYou must return the following fields in your response one below the other:\nscore: Your numerical score for the model's answer_similarity based on the rubric\njustification: Your step-by-step reasoning about the model's answer_similarity score\n  )"}),"\n",(0,i.jsxs)(t.p,{children:["Call ",(0,i.jsx)(t.code,{children:"mlflow.evaluate()"})," again but with your new ",(0,i.jsx)(t.code,{children:"answer_similarity_metric"})]}),"\n",(0,i.jsx)(l.d,{executionCount:8,children:'with mlflow.start_run() as run:\n  results = mlflow.evaluate(\n      basic_qa_model.model_uri,\n      eval_df,\n      targets="ground_truth",\n      model_type="question-answering",\n      evaluators="default",\n      extra_metrics=[answer_similarity_metric],  # use the answer similarity metric created above\n  )\nresults.metrics'}),"\n",(0,i.jsx)(s.p,{isStderr:!0,children:"2023/10/27 00:57:07 INFO mlflow.models.evaluation.base: Evaluating the model with the default evaluator.\n2023/10/27 00:57:07 INFO mlflow.models.evaluation.default_evaluator: Computing model predictions.\n2023/10/27 00:57:13 INFO mlflow.models.evaluation.default_evaluator: Evaluating builtin metrics: token_count\n2023/10/27 00:57:13 INFO mlflow.models.evaluation.default_evaluator: Evaluating builtin metrics: toxicity\n2023/10/27 00:57:13 INFO mlflow.models.evaluation.default_evaluator: Evaluating builtin metrics: flesch_kincaid_grade_level\n2023/10/27 00:57:13 INFO mlflow.models.evaluation.default_evaluator: Evaluating builtin metrics: ari_grade_level\n2023/10/27 00:57:13 INFO mlflow.models.evaluation.default_evaluator: Evaluating builtin metrics: exact_match\n2023/10/27 00:57:13 INFO mlflow.models.evaluation.default_evaluator: Evaluating metrics: answer_similarity"}),"\n",(0,i.jsx)(s.p,{children:"{'toxicity/v1/mean': 0.00023413174494635314,\n'toxicity/v1/variance': 4.211776498455113e-09,\n'toxicity/v1/p90': 0.00029628578631673007,\n'toxicity/v1/ratio': 0.0,\n'flesch_kincaid_grade_level/v1/mean': 14.774999999999999,\n'flesch_kincaid_grade_level/v1/variance': 21.546875000000004,\n'flesch_kincaid_grade_level/v1/p90': 19.71,\n'ari_grade_level/v1/mean': 17.0,\n'ari_grade_level/v1/variance': 41.005,\n'ari_grade_level/v1/p90': 23.92,\n'exact_match/v1': 0.0,\n'answer_similarity/v1/mean': 3.75,\n'answer_similarity/v1/variance': 1.1875,\n'answer_similarity/v1/p90': 4.7}"}),"\n",(0,i.jsx)(t.p,{children:"See the row-by-row LLM-judged answer similarity score and justifications"}),"\n",(0,i.jsx)(l.d,{executionCount:9,children:'results.tables["eval_results_table"]'}),"\n",(0,i.jsx)(s.p,{children:"Downloading artifacts:   0%|          | 0/1 [00:00<?, ?it/s]"}),"\n",(0,i.jsx)(r.Q,{children:(0,i.jsx)("div",{dangerouslySetInnerHTML:{__html:"<div>\n<style scoped>\n  .dataframe tbody tr th:only-of-type {\n      vertical-align: middle;\n  }\n\n  .dataframe tbody tr th {\n      vertical-align: top;\n  }\n\n  .dataframe thead th {\n      text-align: right;\n  }\n</style>\n<table border=\"1\" class=\"dataframe\">\n<thead>\n  <tr style=\"text-align: right;\">\n    <th></th>\n    <th>inputs</th>\n    <th>ground_truth</th>\n    <th>outputs</th>\n    <th>token_count</th>\n    <th>toxicity/v1/score</th>\n    <th>flesch_kincaid_grade_level/v1/score</th>\n    <th>ari_grade_level/v1/score</th>\n    <th>answer_similarity/v1/score</th>\n    <th>answer_similarity/v1/justification</th>\n  </tr>\n</thead>\n<tbody>\n  <tr>\n    <th>0</th>\n    <td>How does useEffect() work?</td>\n    <td>The useEffect() hook tells React that your com...</td>\n    <td>useEffect() is a React hook that allows you to...</td>\n    <td>53</td>\n    <td>0.000299</td>\n    <td>12.1</td>\n    <td>12.1</td>\n    <td>4</td>\n    <td>The output provided by the model aligns well w...</td>\n  </tr>\n  <tr>\n    <th>1</th>\n    <td>What does the static keyword in a function mean?</td>\n    <td>Static members belongs to the class, rather th...</td>\n    <td>In C/C++, the static keyword in a function mea...</td>\n    <td>55</td>\n    <td>0.000141</td>\n    <td>12.5</td>\n    <td>14.4</td>\n    <td>2</td>\n    <td>The output provided by the model does correctl...</td>\n  </tr>\n  <tr>\n    <th>2</th>\n    <td>What does the 'finally' block in Python do?</td>\n    <td>'Finally' defines a block of code to run when ...</td>\n    <td>The 'finally' block in Python is used to defin...</td>\n    <td>64</td>\n    <td>0.000290</td>\n    <td>11.7</td>\n    <td>13.5</td>\n    <td>5</td>\n    <td>The output provided by the model aligns very c...</td>\n  </tr>\n  <tr>\n    <th>3</th>\n    <td>What is the difference between multiprocessing...</td>\n    <td>Multithreading refers to the ability of a proc...</td>\n    <td>Multiprocessing involves the execution of mult...</td>\n    <td>49</td>\n    <td>0.000207</td>\n    <td>22.8</td>\n    <td>28.0</td>\n    <td>4</td>\n    <td>The output provided by the model aligns well w...</td>\n  </tr>\n</tbody>\n</table>\n</div>"}})}),"\n",(0,i.jsx)(t.h2,{id:"custom-llm-judged-metric-for-professionalism",children:"Custom LLM-judged metric for professionalism"}),"\n",(0,i.jsxs)(t.p,{children:["Create a custom metric that will be used to determine professionalism of the model outputs. Use ",(0,i.jsx)(t.code,{children:"make_genai_metric"})," with a metric definition, grading prompt, grading example, and judge model configuration"]}),"\n",(0,i.jsx)(l.d,{executionCount:10,children:'from mlflow.metrics.genai import EvaluationExample, make_genai_metric\n\nprofessionalism_metric = make_genai_metric(\n  name="professionalism",\n  definition=(\n      "Professionalism refers to the use of a formal, respectful, and appropriate style of communication that is tailored to the context and audience. It often involves avoiding overly casual language, slang, or colloquialisms, and instead using clear, concise, and respectful language"\n  ),\n  grading_prompt=(\n      "Professionalism: If the answer is written using a professional tone, below "\n      "are the details for different scores: "\n      "- Score 1: Language is extremely casual, informal, and may include slang or colloquialisms. Not suitable for professional contexts."\n      "- Score 2: Language is casual but generally respectful and avoids strong informality or slang. Acceptable in some informal professional settings."\n      "- Score 3: Language is balanced and avoids extreme informality or formality. Suitable for most professional contexts. "\n      "- Score 4: Language is noticeably formal, respectful, and avoids casual elements. Appropriate for business or academic settings. "\n      "- Score 5: Language is excessively formal, respectful, and avoids casual elements. Appropriate for the most formal settings such as textbooks. "\n  ),\n  examples=[\n      EvaluationExample(\n          input="What is MLflow?",\n          output=(\n              "MLflow is like your friendly neighborhood toolkit for managing your machine learning projects. It helps you track experiments, package your code and models, and collaborate with your team, making the whole ML workflow smoother. It\'s like your Swiss Army knife for machine learning!"\n          ),\n          score=2,\n          justification=(\n              "The response is written in a casual tone. It uses contractions, filler words such as \'like\', and exclamation points, which make it sound less professional. "\n          ),\n      )\n  ],\n  version="v1",\n  model="openai:/gpt-4",\n  parameters={"temperature": 0.0},\n  grading_context_columns=[],\n  aggregations=["mean", "variance", "p90"],\n  greater_is_better=True,\n)\n\nprint(professionalism_metric)'}),"\n",(0,i.jsx)(s.p,{children:"EvaluationMetric(name=professionalism, greater_is_better=True, long_name=professionalism, version=v1, metric_details=\nTask:\nYou are an impartial judge. You will be given an input that was sent to a machine\nlearning model, and you will be given an output that the model produced. You\nmay also be given additional information that was used by the model to generate the output.\n\nYour task is to determine a numerical score called professionalism based on the input and output.\nA definition of professionalism and a grading rubric are provided below.\nYou must use the grading rubric to determine your score. You must also justify your score.\n\nExamples could be included below for reference. Make sure to use them as references and to\nunderstand them before completing the task.\n\nInput:\n{input}\n\nOutput:\n{output}\n\n{grading_context_columns}\n\nMetric definition:\nProfessionalism refers to the use of a formal, respectful, and appropriate style of communication that is tailored to the context and audience. It often involves avoiding overly casual language, slang, or colloquialisms, and instead using clear, concise, and respectful language\n\nGrading rubric:\nProfessionalism: If the answer is written using a professional tone, below are the details for different scores: - Score 1: Language is extremely casual, informal, and may include slang or colloquialisms. Not suitable for professional contexts.- Score 2: Language is casual but generally respectful and avoids strong informality or slang. Acceptable in some informal professional settings.- Score 3: Language is balanced and avoids extreme informality or formality. Suitable for most professional contexts. - Score 4: Language is noticeably formal, respectful, and avoids casual elements. Appropriate for business or academic settings. - Score 5: Language is excessively formal, respectful, and avoids casual elements. Appropriate for the most formal settings such as textbooks. \n\nExamples:\n\nInput:\nWhat is MLflow?\n\nOutput:\nMLflow is like your friendly neighborhood toolkit for managing your machine learning projects. It helps you track experiments, package your code and models, and collaborate with your team, making the whole ML workflow smoother. It's like your Swiss Army knife for machine learning!\n\n\n\nscore: 2\njustification: The response is written in a casual tone. It uses contractions, filler words such as 'like', and exclamation points, which make it sound less professional. \n      \n\nYou must return the following fields in your response one below the other:\nscore: Your numerical score for the model's professionalism based on the rubric\njustification: Your step-by-step reasoning about the model's professionalism score\n  )"}),"\n",(0,i.jsxs)(t.p,{children:["Call ",(0,i.jsx)(t.code,{children:"mlflow.evaluate"})," with your new professionalism metric."]}),"\n",(0,i.jsx)(l.d,{executionCount:11,children:'with mlflow.start_run() as run:\n  results = mlflow.evaluate(\n      basic_qa_model.model_uri,\n      eval_df,\n      model_type="question-answering",\n      evaluators="default",\n      extra_metrics=[professionalism_metric],  # use the professionalism metric we created above\n  )\nprint(results.metrics)'}),"\n",(0,i.jsx)(s.p,{isStderr:!0,children:"2023/10/27 00:57:20 INFO mlflow.models.evaluation.base: Evaluating the model with the default evaluator.\n2023/10/27 00:57:20 INFO mlflow.models.evaluation.default_evaluator: Computing model predictions.\n2023/10/27 00:57:24 INFO mlflow.models.evaluation.default_evaluator: Evaluating builtin metrics: token_count\n2023/10/27 00:57:24 INFO mlflow.models.evaluation.default_evaluator: Evaluating builtin metrics: toxicity\n2023/10/27 00:57:25 INFO mlflow.models.evaluation.default_evaluator: Evaluating builtin metrics: flesch_kincaid_grade_level\n2023/10/27 00:57:25 INFO mlflow.models.evaluation.default_evaluator: Evaluating builtin metrics: ari_grade_level\n2023/10/27 00:57:25 INFO mlflow.models.evaluation.default_evaluator: Evaluating builtin metrics: exact_match\n2023/10/27 00:57:25 INFO mlflow.models.evaluation.default_evaluator: Evaluating metrics: professionalism"}),"\n",(0,i.jsx)(s.p,{children:"{'toxicity/v1/mean': 0.0002044261127593927, 'toxicity/v1/variance': 1.8580601275034412e-09, 'toxicity/v1/p90': 0.00025343164161313326, 'toxicity/v1/ratio': 0.0, 'flesch_kincaid_grade_level/v1/mean': 13.649999999999999, 'flesch_kincaid_grade_level/v1/variance': 33.927499999999995, 'flesch_kincaid_grade_level/v1/p90': 19.92, 'ari_grade_level/v1/mean': 16.25, 'ari_grade_level/v1/variance': 51.927499999999995, 'ari_grade_level/v1/p90': 23.900000000000002, 'professionalism/v1/mean': 4.0, 'professionalism/v1/variance': 0.0, 'professionalism/v1/p90': 4.0}"}),"\n",(0,i.jsx)(l.d,{executionCount:12,children:'results.tables["eval_results_table"]'}),"\n",(0,i.jsx)(s.p,{children:"Downloading artifacts:   0%|          | 0/1 [00:00<?, ?it/s]"}),"\n",(0,i.jsx)(r.Q,{children:(0,i.jsx)("div",{dangerouslySetInnerHTML:{__html:"<div>\n<style scoped>\n  .dataframe tbody tr th:only-of-type {\n      vertical-align: middle;\n  }\n\n  .dataframe tbody tr th {\n      vertical-align: top;\n  }\n\n  .dataframe thead th {\n      text-align: right;\n  }\n</style>\n<table border=\"1\" class=\"dataframe\">\n<thead>\n  <tr style=\"text-align: right;\">\n    <th></th>\n    <th>inputs</th>\n    <th>ground_truth</th>\n    <th>outputs</th>\n    <th>token_count</th>\n    <th>toxicity/v1/score</th>\n    <th>flesch_kincaid_grade_level/v1/score</th>\n    <th>ari_grade_level/v1/score</th>\n    <th>professionalism/v1/score</th>\n    <th>professionalism/v1/justification</th>\n  </tr>\n</thead>\n<tbody>\n  <tr>\n    <th>0</th>\n    <td>How does useEffect() work?</td>\n    <td>The useEffect() hook tells React that your com...</td>\n    <td>useEffect() is a hook in React that allows you...</td>\n    <td>46</td>\n    <td>0.000218</td>\n    <td>11.1</td>\n    <td>12.7</td>\n    <td>4</td>\n    <td>The language used in the output is formal and ...</td>\n  </tr>\n  <tr>\n    <th>1</th>\n    <td>What does the static keyword in a function mean?</td>\n    <td>Static members belongs to the class, rather th...</td>\n    <td>The static keyword in a function means that th...</td>\n    <td>48</td>\n    <td>0.000158</td>\n    <td>9.7</td>\n    <td>12.3</td>\n    <td>4</td>\n    <td>The language used in the output is formal and ...</td>\n  </tr>\n  <tr>\n    <th>2</th>\n    <td>What does the 'finally' block in Python do?</td>\n    <td>'Finally' defines a block of code to run when ...</td>\n    <td>The 'finally' block in Python is used to defin...</td>\n    <td>45</td>\n    <td>0.000269</td>\n    <td>10.1</td>\n    <td>11.3</td>\n    <td>4</td>\n    <td>The language used in the output is formal and ...</td>\n  </tr>\n  <tr>\n    <th>3</th>\n    <td>What is the difference between multiprocessing...</td>\n    <td>Multithreading refers to the ability of a proc...</td>\n    <td>Multiprocessing involves running multiple proc...</td>\n    <td>33</td>\n    <td>0.000173</td>\n    <td>23.7</td>\n    <td>28.7</td>\n    <td>4</td>\n    <td>The language used in the output is formal and ...</td>\n  </tr>\n</tbody>\n</table>\n</div>"}})}),"\n",(0,i.jsxs)(t.p,{children:["Lets see if we can improve ",(0,i.jsx)(t.code,{children:"basic_qa_model"})," by creating a new model that could perform better by changing the system prompt."]}),"\n",(0,i.jsxs)(t.p,{children:["Call ",(0,i.jsx)(t.code,{children:"mlflow.evaluate()"})," using the new model. Observe that the professionalism score has increased!"]}),"\n",(0,i.jsx)(l.d,{executionCount:13,children:'with mlflow.start_run() as run:\n  system_prompt = "Answer the following question using extreme formality."\n  professional_qa_model = mlflow.openai.log_model(\n      model="gpt-4o-mini",\n      task=openai.chat.completions,\n      name="model",\n      messages=[\n          {"role": "system", "content": system_prompt},\n          {"role": "user", "content": "{question}"},\n      ],\n  )\n  results = mlflow.evaluate(\n      professional_qa_model.model_uri,\n      eval_df,\n      model_type="question-answering",\n      evaluators="default",\n      extra_metrics=[professionalism_metric],\n  )\nprint(results.metrics)'}),"\n",(0,i.jsx)(s.p,{isStderr:!0,children:'/Users/sunish.sheth/.local/lib/python3.8/site-packages/_distutils_hack/__init__.py:18: UserWarning: Distutils was imported before Setuptools, but importing Setuptools also replaces the `distutils` module in `sys.modules`. This may lead to undesirable behaviors or errors. To avoid these issues, avoid using distutils directly, ensure that setuptools is installed in the traditional way (e.g. not an editable install), and/or make sure that setuptools is always imported before distutils.\nwarnings.warn(\n/Users/sunish.sheth/.local/lib/python3.8/site-packages/_distutils_hack/__init__.py:33: UserWarning: Setuptools is replacing distutils.\nwarnings.warn("Setuptools is replacing distutils.")\n2023/10/27 00:57:30 INFO mlflow.models.evaluation.base: Evaluating the model with the default evaluator.\n2023/10/27 00:57:30 INFO mlflow.models.evaluation.default_evaluator: Computing model predictions.\n2023/10/27 00:57:37 INFO mlflow.models.evaluation.default_evaluator: Evaluating builtin metrics: token_count\n2023/10/27 00:57:37 INFO mlflow.models.evaluation.default_evaluator: Evaluating builtin metrics: toxicity\n2023/10/27 00:57:38 INFO mlflow.models.evaluation.default_evaluator: Evaluating builtin metrics: flesch_kincaid_grade_level\n2023/10/27 00:57:38 INFO mlflow.models.evaluation.default_evaluator: Evaluating builtin metrics: ari_grade_level\n2023/10/27 00:57:38 INFO mlflow.models.evaluation.default_evaluator: Evaluating builtin metrics: exact_match\n2023/10/27 00:57:38 INFO mlflow.models.evaluation.default_evaluator: Evaluating metrics: professionalism'}),"\n",(0,i.jsx)(s.p,{children:"{'toxicity/v1/mean': 0.00030383203556993976, 'toxicity/v1/variance': 9.482036560896618e-09, 'toxicity/v1/p90': 0.0003866828687023372, 'toxicity/v1/ratio': 0.0, 'flesch_kincaid_grade_level/v1/mean': 17.625, 'flesch_kincaid_grade_level/v1/variance': 2.9068750000000003, 'flesch_kincaid_grade_level/v1/p90': 19.54, 'ari_grade_level/v1/mean': 21.425, 'ari_grade_level/v1/variance': 3.6168750000000007, 'ari_grade_level/v1/p90': 23.6, 'professionalism/v1/mean': 4.5, 'professionalism/v1/variance': 0.25, 'professionalism/v1/p90': 5.0}"}),"\n",(0,i.jsx)(l.d,{executionCount:14,children:'results.tables["eval_results_table"]'}),"\n",(0,i.jsx)(s.p,{children:"Downloading artifacts:   0%|          | 0/1 [00:00<?, ?it/s]"}),"\n",(0,i.jsx)(r.Q,{children:(0,i.jsx)("div",{dangerouslySetInnerHTML:{__html:"<div>\n<style scoped>\n  .dataframe tbody tr th:only-of-type {\n      vertical-align: middle;\n  }\n\n  .dataframe tbody tr th {\n      vertical-align: top;\n  }\n\n  .dataframe thead th {\n      text-align: right;\n  }\n</style>\n<table border=\"1\" class=\"dataframe\">\n<thead>\n  <tr style=\"text-align: right;\">\n    <th></th>\n    <th>inputs</th>\n    <th>ground_truth</th>\n    <th>outputs</th>\n    <th>token_count</th>\n    <th>toxicity/v1/score</th>\n    <th>flesch_kincaid_grade_level/v1/score</th>\n    <th>ari_grade_level/v1/score</th>\n    <th>professionalism/v1/score</th>\n    <th>professionalism/v1/justification</th>\n  </tr>\n</thead>\n<tbody>\n  <tr>\n    <th>0</th>\n    <td>How does useEffect() work?</td>\n    <td>The useEffect() hook tells React that your com...</td>\n    <td>Certainly, I shall elucidate the mechanics of ...</td>\n    <td>386</td>\n    <td>0.000398</td>\n    <td>16.3</td>\n    <td>19.7</td>\n    <td>5</td>\n    <td>The response is written in an excessively form...</td>\n  </tr>\n  <tr>\n    <th>1</th>\n    <td>What does the static keyword in a function mean?</td>\n    <td>Static members belongs to the class, rather th...</td>\n    <td>The static keyword utilized in the context of ...</td>\n    <td>73</td>\n    <td>0.000143</td>\n    <td>16.4</td>\n    <td>20.0</td>\n    <td>4</td>\n    <td>The language used in the output is formal and ...</td>\n  </tr>\n  <tr>\n    <th>2</th>\n    <td>What does the 'finally' block in Python do?</td>\n    <td>'Finally' defines a block of code to run when ...</td>\n    <td>The 'finally' block in Python serves as an int...</td>\n    <td>97</td>\n    <td>0.000313</td>\n    <td>20.5</td>\n    <td>24.5</td>\n    <td>4</td>\n    <td>The language used in the output is formal and ...</td>\n  </tr>\n  <tr>\n    <th>3</th>\n    <td>What is the difference between multiprocessing...</td>\n    <td>Multithreading refers to the ability of a proc...</td>\n    <td>Allow me to elucidate upon the distinction bet...</td>\n    <td>324</td>\n    <td>0.000361</td>\n    <td>17.3</td>\n    <td>21.5</td>\n    <td>5</td>\n    <td>The response is written in an excessively form...</td>\n  </tr>\n</tbody>\n</table>\n</div>"}})})]})}function p(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(f,{...e})}):f(e)}},86563:(e,t,n)=>{n.d(t,{Q:()=>i});var a=n(74848);const i=e=>{let{children:t}=e;return(0,a.jsx)("div",{style:{flexGrow:1,minWidth:0,fontSize:"0.8rem",width:"100%"},children:t})}}}]);