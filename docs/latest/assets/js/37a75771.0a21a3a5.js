"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4677],{20723:(e,n,t)=>{t.d(n,{O:()=>a});var i=t(96540),o=t(74848);function a(e){let{children:n,href:t}=e;const a=(0,i.useCallback)((async e=>{if(e.preventDefault(),window.gtag)try{window.gtag("event","notebook-download",{href:t})}catch{}const n=await fetch(t),i=await n.blob(),o=window.URL.createObjectURL(i),a=document.createElement("a");a.style.display="none",a.href=o;const l=t.split("/").pop();a.download=l,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(o),document.body.removeChild(a)}),[t]);return(0,o.jsx)("a",{className:"button button--primary",style:{marginBottom:"1rem",display:"block",width:"min-content"},href:t,download:!0,onClick:a,children:n})}},28453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>s});var i=t(96540);const o={},a=i.createContext(o);function l(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),i.createElement(a.Provider,{value:n},e.children)}},31596:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/notebook-dangers-433eb6afa332607d1c3e7af4d59a3024.svg"},52895:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/plots-in-ui-a58dbe250b71f76b1c59fa89e871ea56.gif"},79220:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>g,frontMatter:()=>s,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"traditional-ml/hyperparameter-tuning-with-child-runs/part2-logging-plots/index","title":"Leveraging Visualizations and MLflow for In-depth Model Analysis","description":"Introduction","source":"@site/docs/traditional-ml/hyperparameter-tuning-with-child-runs/part2-logging-plots/index.mdx","sourceDirName":"traditional-ml/hyperparameter-tuning-with-child-runs/part2-logging-plots","slug":"/traditional-ml/hyperparameter-tuning-with-child-runs/part2-logging-plots/","permalink":"/docs/latest/traditional-ml/hyperparameter-tuning-with-child-runs/part2-logging-plots/","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"sidebar_label":"Logging plots with MLflow"},"sidebar":"docsSidebar","previous":{"title":"The Parent-Child relationship with runs","permalink":"/docs/latest/traditional-ml/hyperparameter-tuning-with-child-runs/part1-child-runs/"},"next":{"title":"Building Custom Python Function Models with MLflow","permalink":"/docs/latest/traditional-ml/creating-custom-pyfunc/"}}');var o=t(74848),a=t(28453),l=t(20723);const s={sidebar_position:3,sidebar_label:"Logging plots with MLflow"},r="Leveraging Visualizations and MLflow for In-depth Model Analysis",d={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Role of Visualizations in Model Analysis",id:"role-of-visualizations-in-model-analysis",level:2},{value:"A Warning about Procedural Generation of Plots",id:"a-warning-about-procedural-generation-of-plots",level:3},{value:"Benefits of Integrating Visualizations with MLflow",id:"benefits-of-integrating-visualizations-with-mlflow",level:2},{value:"Generating a Plot",id:"generating-a-plot",level:2},{value:"Defining a Plot",id:"defining-a-plot",level:3},{value:"Key Elements",id:"key-elements",level:4},{value:"Defining a Plot to be Saved Locally",id:"defining-a-plot-to-be-saved-locally",level:3},{value:"Key Insights",id:"key-insights",level:4},{value:"Logging plot images",id:"logging-plot-images",level:3},{value:"Viewing plots in the UI",id:"viewing-plots-in-the-ui",level:2},{value:"Challenge",id:"challenge",level:3},{value:"In Conclusion",id:"in-conclusion",level:2}];function h(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"leveraging-visualizations-and-mlflow-for-in-depth-model-analysis",children:"Leveraging Visualizations and MLflow for In-depth Model Analysis"})}),"\n",(0,o.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,o.jsx)(n.p,{children:"In any machine learning project, understanding the behavior, performance, and characteristics of the\ndeveloped models is important. Clear, informative visualizations play a crucial role in this understanding,\noffering insights into the model's patterns, errors, and efficiency."}),"\n",(0,o.jsx)(n.p,{children:"In this portion of the guide, we look at a notebook that is concerned with the generation and storage of\ncommon and useful plots associated with a regression task."}),"\n",(0,o.jsx)(n.p,{children:"We'll be looking at two primary means of logging plots along with our logged models:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Direct plot logging"})," via ",(0,o.jsx)(n.code,{children:"mlflow.log_figure()"})," we will use an in-memory figure reference to a generated plot."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Logging a local plot file"})," via ",(0,o.jsx)(n.code,{children:"mlflow.log_artifact()"})," to allow us to log a locally stored image to the run."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"role-of-visualizations-in-model-analysis",children:"Role of Visualizations in Model Analysis"}),"\n",(0,o.jsx)(n.p,{children:"Visualizations act as a window into the intricate world of machine learning models. They enable the exploration of various aspects:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Understanding Data"}),": Initial visualizations allow for a deep dive into the data, revealing patterns, anomalies, and relationships that can inform the entire modeling process."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Model Evaluation"}),": Plots such as residual plots and prediction error plots help in diagnosing issues with the model and evaluating its performance."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Hyperparameter Tuning"}),": Visualization aids in understanding the impact of different hyperparameters on the model's performance, guiding the selection process."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Error Analysis"}),": They help in analyzing the types and patterns of errors made by the model, providing insight into possible improvements."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"a-warning-about-procedural-generation-of-plots",children:"A Warning about Procedural Generation of Plots"}),"\n",(0,o.jsx)(n.p,{children:"In the accompanying notebook to this subsection of this guide, you will observe plots being declared\nwithin functions. This approach deviates from the typical examples seen in machine learning tutorials\nand guides, so it's essential to clarify why this method is chosen for the provided examples."}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"The Central Issue: Statefulness"})}),"\n",(0,o.jsx)("figure",{className:"center-div",style:{width:1024,maxWidth:"100%",textAlign:"center"},children:(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.img,{alt:"Notebook state",src:t(31596).A+"",width:"795",height:"686"}),"\n",(0,o.jsx)("figcaption",{children:"Failing to execute all cells in order can lead to misleading plots"})]})}),"\n",(0,o.jsx)(n.p,{children:"Notebooks inherently maintain a state across cells. While this feature can be beneficial, it poses\nsignificant challenges for ensuring the reliability and accuracy of code and output, especially for visualizations."}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"The Challenges of Out-of-Order Execution"})}),"\n",(0,o.jsx)(n.p,{children:"One of the most significant issues in notebook environments is the potential for out-of-order\nexecution. Cells can be run in any sequence, leading to a state where variables or outputs do not\nreflect the latest code changes. This problem is particularly acute for visualizations. If a plot\nis generated and then displayed in a separate cell, running the cells out of order can lead to\ndisplaying outdated or incorrect visualizations."}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Ensuring Accurate Visualizations"})}),"\n",(0,o.jsx)(n.p,{children:"For visualizations to serve their purpose of conveying accurate, clear, and reliable information,\nthey must correspond to the current state of the data and model. Ensuring this correspondence in a\nnotebook environment requires careful management of cell execution order and state, which can be cumbersome and error-prone."}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Why Use Functions to Generate Plots"})}),"\n",(0,o.jsx)(n.p,{children:"To mitigate these challenges, the example code opts for declaring plots within functions. This approach offers several advantages:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Encapsulation"}),": By encapsulating the plot generation within a function, the code ensures that the plot is generated with the current state of the data every time the function is called. This encapsulation avoids the pitfalls of out-of-order cell execution affecting the plot's accuracy."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Flexibility and Reusability"}),": Functions provide the flexibility to generate plots with different parameters and data without duplicating code. This reusability enhances code maintainability and readability."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Integration with MLflow"}),": Functions seamlessly integrate with MLflow, allowing for plots to be logged alongside metrics, parameters, and models, ensuring that the visualizations correspond to the specific run and model state. This integration provides a reliable and consolidated view of the model, metrics, and plots in the MLflow UI, avoiding the disjointed view that can occur in notebooks."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Avoiding Display in Stdout"}),": The function-based approach avoids direct printing of plots to the notebook's stdout. Direct printing can clutter the notebook, increase the saved notebook's size, and lead to confusion with multiple plots displayed in the notebook. By logging plots directly in MLflow, the example code keeps the notebook clean, ensures plots correspond to the specific model run, and leverages MLflow's UI for viewing and comparing plots."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["By encapsulating and scoping the generation of plots to within the training context (within ",(0,o.jsx)(n.code,{children:"mlflow.start_run()"}),"), we can get all\nof the flexibility, ease-of-use, and benefits of imperative iterative code development that notebooks bring without the risk of\nlogging stale, invalid, or inaccurate plots that do not reflect the actual state of the data or model which is logged."]}),"\n",(0,o.jsx)(n.h2,{id:"benefits-of-integrating-visualizations-with-mlflow",children:"Benefits of Integrating Visualizations with MLflow"}),"\n",(0,o.jsx)(n.p,{children:"Integrating visualizations with MLflow presents several substantial benefits:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Persistent Storage"}),": Storing visualizations alongside the model in MLflow ensures their availability for future reference, protecting against loss due to session termination or other issues."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Provenance"}),": It provides clear provenance for visualizations, ensuring that the insights they provide can always be traced back to the exact model version and dataset."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Consistency"}),": Ensures that the visualizations correspond to the correct version of the model, preventing confusion and errors."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Accessibility"}),": Makes visualizations easily accessible to all team members, enhancing collaboration and insight sharing."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"generating-a-plot",children:"Generating a Plot"}),"\n",(0,o.jsx)(n.p,{children:"In the companion notebook to this section of the guide, there are samples of many regression-relevant plots.\nSome, such as the correlation matrix plot, are relevant to the feature data set, while others, such as the coefficients plot, are relevant only after we have a trained model."}),"\n",(0,o.jsx)(n.p,{children:"Whether we're using a trained model or not, the approach is similar for logging these image artifacts."}),"\n",(0,o.jsx)(n.h3,{id:"defining-a-plot",children:"Defining a Plot"}),"\n",(0,o.jsxs)(n.p,{children:["In the intricate world of data visualization, the structured and organized presentation of plots is\nparamount. Below is an example of generating a box plot, which compares a continuous variable to a\ncategorical (ordinal) variable. The example utilizes a typical ",(0,o.jsx)(n.code,{children:"matplotlib"})," implementation,\nenhanced with ",(0,o.jsx)(n.code,{children:"seaborn"})," for a refined visual appearance. This structure is fundamental for ensuring\nclarity and legibility in our modeling code. By defining the plot generation as a separate,\ncallable function, we maintain a clean and organized codebase. This approach is essential,\nespecially in a notebook environment, to ensure that each training iteration has a specific and\nunambiguous reference to the plot generation, directly linked to the exact state of the data used\nin a training iteration. Such a method mitigates the risks associated with declaratively defined and\nmaterialized plots, which, if not regenerated after data modification, can lead to inconsistencies\nand errors in data representation."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'def plot_box_weekend(df, style="seaborn", plot_size=(10, 8)):\n    with plt.style.context(style=style):\n        fig, ax = plt.subplots(figsize=plot_size)\n        sns.boxplot(data=df, x="weekend", y="demand", ax=ax, color="lightgray")\n        sns.stripplot(\n            data=df,\n            x="weekend",\n            y="demand",\n            ax=ax,\n            hue="weekend",\n            palette={0: "blue", 1: "green"},\n            alpha=0.15,\n            jitter=0.3,\n            size=5,\n        )\n\n        ax.set_title("Box Plot of Demand on Weekends vs. Weekdays", fontsize=14)\n        ax.set_xlabel("Weekend (0: No, 1: Yes)", fontsize=12)\n        ax.set_ylabel("Demand", fontsize=12)\n        for i in ax.get_xticklabels() + ax.get_yticklabels():\n            i.set_fontsize(10)\n        ax.legend_.remove()\n        plt.tight_layout()\n    plt.close(fig)\n    return fig\n'})}),"\n",(0,o.jsx)(n.h4,{id:"key-elements",children:"Key Elements"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Title Application"}),": Including a title in the plot is not just a formality, it's a necessity for ensuring clarity and comprehensibility, especially within the MLflow UI. A well-crafted title provides a comprehensive overview, helping in immediate understanding and eliminating any ambiguity or confusion."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Override Default Sizing"}),": Adjusting default sizes for various elements like fonts and plot sizes is crucial for ensuring the legibility and visual appeal of the plot in the MLflow UI. It ensures that the plot remains readable and clear, irrespective of the viewing platform or screen size."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Axes Labeling"}),": Properly labeled axes are a pillar of understandable and self-sufficient plots. They offer clear information about the data dimensions, making the plot comprehensible without external references or explanations."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Figure Closure"}),": Closing the figure before returning it ensures a clean and uncluttered notebook environment. It prevents the inadvertent display of the plot within the notebook's standard output, avoiding confusion and maintaining the organization of the notebook."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Legend Removal"}),": Removing auto-generated legends from the plot enhances the visual clarity and readability. It prevents unnecessary clutter, making the plot more concise and to the point, ensuring that the focus remains on the vital data representations."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"defining-a-plot-to-be-saved-locally",children:"Defining a Plot to be Saved Locally"}),"\n",(0,o.jsx)(n.p,{children:"There are scenarios when saving a plot locally before logging to MLflow is more advantageous.\nThe example below illustrates the generation of a correlation matrix plot, saving the image when\ncalled, as opposed to returning an in-memory reference. This approach, though different,\nremains seamlessly compatible with MLflow, ensuring the same level of organization and access,\nwith additional flexibility in plot access and usage."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'def plot_correlation_matrix_and_save(\n    df, style="seaborn", plot_size=(10, 8), path="/tmp/corr_plot.png"\n):\n    with plt.style.context(style=style):\n        fig, ax = plt.subplots(figsize=plot_size)\n\n        # Calculate the correlation matrix\n        corr = df.corr()\n\n        # Generate a mask for the upper triangle\n        mask = np.triu(np.ones_like(corr, dtype=bool))\n\n        # Draw the heatmap with the mask and correct aspect ratio\n        sns.heatmap(\n            corr,\n            mask=mask,\n            cmap="coolwarm",\n            vmax=0.3,\n            center=0,\n            square=True,\n            linewidths=0.5,\n            annot=True,\n            fmt=".2f",\n        )\n\n        ax.set_title("Feature Correlation Matrix", fontsize=14)\n        plt.tight_layout()\n\n    plt.close(fig)\n    # convert to filesystem path spec for os compatibility\n    save_path = pathlib.Path(path)\n    fig.savefig(path)\n'})}),"\n",(0,o.jsx)(n.h4,{id:"key-insights",children:"Key Insights"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Heatmap for Correlation"}),": The use of a heatmap in this context provides a visually intuitive and effective representation of feature correlations. It allows for easy identification of relationships between different features, enhancing the understandability and analysis depth."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Title and Layout Adjustments"}),": Including a clear and descriptive title, along with layout adjustments, ensures clarity and a compact presentation, enhancing the plot's usability and interpretation ease."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Local Saving of Plot"}),": Saving the figure locally provides easy access and reference, ensuring it\u2019s not tied to the notebook\u2019s execution state. It offers flexibility in access and ensures that the plot remains available independently, contributing to more organized and efficient data analysis and model evaluation processes."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"logging-plot-images",children:"Logging plot images"}),"\n",(0,o.jsx)(n.p,{children:"In the below code snippet from the main notebook, we're executing our training and plot generations as a single atomic operation.\nAs mentioned before, this helps to ensure that regardless of the state of any other cell within the notebook, the plots that are\ngenerated are going to refer to the state of the training data that was used to both train and evaluate the model."}),"\n",(0,o.jsxs)(n.p,{children:["For all of the plots apart from the correlation matrix, we're using the direct ",(0,o.jsx)(n.code,{children:"matplotlib"})," ",(0,o.jsx)(n.code,{children:"Figure"})," object reference for the plot when\nwe call ",(0,o.jsx)(n.code,{children:"mlflow.log_figure()"}),". For the correlation matrix, we're operating on a locally saved ",(0,o.jsx)(n.code,{children:".png"})," image file. This requires the usage of\nthe more generic artifact writer (it supports any file type) ",(0,o.jsx)(n.code,{children:"mlflow.log_artifact()"}),"."]}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:["For simplicity, if you have a large volume of plots that you would like to log to a model, using the directory-scoped ",(0,o.jsx)(n.code,{children:"mlflow.log_artifacts()"}),"\nis recommended. This API will log all files in a given local directory path, without needing to explicitly name each one and make a large volume of\n",(0,o.jsx)(n.code,{children:"log_artifact()"})," calls. If using the directory-based ",(0,o.jsx)(n.code,{children:"log_artifacts()"}),", ensure that your local file names are relevant and expository enough to\ndisambiguate the content of the plot within the MLflow UI. While ",(0,o.jsx)(n.code,{children:"log_artifact()"})," permits you to rename the name of a given file when logging to MLflow,\nthe batch processing ",(0,o.jsx)(n.code,{children:"log_artifacts()"})," API does not (the file names will transfer over as-is)."]})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'mlflow.set_tracking_uri("http://127.0.0.1:8080")\n\nmlflow.set_experiment("Visualizations Demo")\n\nX = my_data.drop(columns=["demand", "date"])\ny = my_data["demand"]\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=0)\n\nfig1 = plot_time_series_demand(my_data, window_size=28)\nfig2 = plot_box_weekend(my_data)\nfig3 = plot_scatter_demand_price(my_data)\nfig4 = plot_density_weekday_weekend(my_data)\n\n# Execute the correlation plot, saving the plot to a local temporary directory\nplot_correlation_matrix_and_save(my_data)\n\n# Define our Ridge model\nmodel = Ridge(alpha=1.0)\n\n# Train the model\nmodel.fit(X_train, y_train)\n\n# Make predictions\ny_pred = model.predict(X_test)\n\n# Calculate error metrics\nmse = mean_squared_error(y_test, y_pred)\nrmse = math.sqrt(mse)\nmae = mean_absolute_error(y_test, y_pred)\nr2 = r2_score(y_test, y_pred)\nmsle = mean_squared_log_error(y_test, y_pred)\nmedae = median_absolute_error(y_test, y_pred)\n\n# Generate prediction-dependent plots\nfig5 = plot_residuals(y_test, y_pred)\nfig6 = plot_coefficients(model, X_test.columns)\nfig7 = plot_prediction_error(y_test, y_pred)\nfig8 = plot_qq(y_test, y_pred)\n\n# Start an MLflow run for logging metrics, parameters, the model, and our figures\nwith mlflow.start_run() as run:\n    # Log the model\n    mlflow.sklearn.log_model(sk_model=model, input_example=X_test, name="model")\n\n    # Log the metrics\n    mlflow.log_metrics(\n        {"mse": mse, "rmse": rmse, "mae": mae, "r2": r2, "msle": msle, "medae": medae}\n    )\n\n    # Log the hyperparameter\n    mlflow.log_param("alpha", 1.0)\n\n    # Log plots\n    mlflow.log_figure(fig1, "time_series_demand.png")\n    mlflow.log_figure(fig2, "box_weekend.png")\n    mlflow.log_figure(fig3, "scatter_demand_price.png")\n    mlflow.log_figure(fig4, "density_weekday_weekend.png")\n    mlflow.log_figure(fig5, "residuals_plot.png")\n    mlflow.log_figure(fig6, "coefficients_plot.png")\n    mlflow.log_figure(fig7, "prediction_errors.png")\n    mlflow.log_figure(fig8, "qq_plot.png")\n\n    # Log the saved correlation matrix plot by referring to the local file system location\n    mlflow.log_artifact("/tmp/corr_plot.png")\n'})}),"\n",(0,o.jsx)(n.h2,{id:"viewing-plots-in-the-ui",children:"Viewing plots in the UI"}),"\n",(0,o.jsxs)(n.p,{children:["If we head over to the MLflow UI after executing this training cell, we can see all of our plots that have been\ndefined within the artifact viewer pane. Whether the plots were logged with the ",(0,o.jsx)(n.code,{children:"log_figure()"})," API or were\nfetched from the local file system and logged via ",(0,o.jsx)(n.code,{children:"log_artifacts()"}),", we're able to see the run-relevant plots\nassociated with our data and our trained model, capturing the state at which the run was conducted."]}),"\n",(0,o.jsx)("figure",{className:"center-div",style:{width:1024,maxWidth:"100%",textAlign:"center"},children:(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.img,{alt:"Viewing plots in the UI",src:t(52895).A+"",width:"2048",height:"1640"}),"\n",(0,o.jsx)("figcaption",{children:"Viewing logged plots and figures in the MLflow UI"})]})}),"\n",(0,o.jsx)(n.h3,{id:"challenge",children:"Challenge"}),"\n",(0,o.jsx)(n.p,{children:"Can you think of some additional plots that would be relevant for data validation, regression modeling, or\npredictive quality in general?"}),"\n",(0,o.jsx)(n.p,{children:"If you're interested, get a copy of the notebook by clicking on the button below and follow along with the instructions."}),"\n",(0,o.jsx)("p",{children:(0,o.jsx)(l.O,{href:"https://raw.githubusercontent.com/mlflow/mlflow/master/docs/source/traditional-ml/hyperparameter-tuning-with-child-runs/notebooks/logging-plots-in-mlflow.ipynb",children:"Download the notebook"})}),"\n",(0,o.jsx)(n.p,{children:"After downloading the notebook and opening it with Jupyter:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Implement a few more plots that are representative of the visualizations you would want to see when training (or retraining) a model like this."}),"\n",(0,o.jsx)(n.li,{children:"Instead of returning the figures, save each plot to a common directory."}),"\n",(0,o.jsx)(n.li,{children:"Ensure that all plot file names are unique and indicative of the plot contents."}),"\n",(0,o.jsxs)(n.li,{children:["Use the ",(0,o.jsx)(n.code,{children:"mlflow.log_artifacts()"})," (not ",(0,o.jsx)(n.code,{children:"mlflow.log_artifact()"}),") to log the directory contents to the run."]}),"\n",(0,o.jsx)(n.li,{children:"Validate the rendering of the plots within the MLflow UI."}),"\n"]}),"\n",(0,o.jsx)(n.admonition,{title:"hint",type:"info",children:(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"log_artifacts()"})," API has an optional ",(0,o.jsx)(n.code,{children:"artifact_path"})," argument that can be overridden from the default of ",(0,o.jsx)(n.code,{children:"None"})," in to segregate these additional plots\nin their own directory within the MLflow artifact store (and the UI). This can be very beneficial if you're logging dozens of plots that have distinct categorical\ngroupings among them, without the need for filling the UI display pane in the artifact viewer with a large amount of files in the main root directory."]})}),"\n",(0,o.jsx)(n.h2,{id:"in-conclusion",children:"In Conclusion"}),"\n",(0,o.jsx)(n.p,{children:"Visualizations are a critical part of building high-quality models. With its native integration to log\nfigures, plots, and images, MLflow makes it very simple to incorporate visualizations for not only the\ndata being used for training, but the results of a training event."}),"\n",(0,o.jsx)(n.p,{children:"With simple, high-level APIs that can be scoped within the context where the model is being trained, inconsistencies\nin state can be eliminated, ensuring that each plot reflects exactly the state of the data and the model at the time of training."})]})}function g(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}}}]);