"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([["5285"],{60207(e,t,n){n.r(t),n.d(t,{metadata:()=>r,default:()=>m,frontMatter:()=>c,contentTitle:()=>d,toc:()=>u,assets:()=>h});var r=JSON.parse('{"id":"getting-started/deep-learning","title":"Deep Learning Quickstart","description":"Need help setting up tracking? Try MLflow Assistant - a powerful AI assistant that can help you set up MLflow tracking for your project.","source":"@site/docs/classic-ml/getting-started/deep-learning.mdx","sourceDirName":"getting-started","slug":"/getting-started/deep-learning","permalink":"/mlflow-website/docs/latest/ml/getting-started/deep-learning","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"toc_max_heading_level":4,"sidebar_label":"Deep Learning"},"sidebar":"classicMLSidebar","previous":{"title":"Hyperparameter Tuning","permalink":"/mlflow-website/docs/latest/ml/getting-started/hyperparameter-tuning/"},"next":{"title":"Overview","permalink":"/mlflow-website/docs/latest/ml/traditional-ml/"}}'),a=n(74848),s=n(28453),i=n(78010),l=n(57250),o=n(46077);let c={sidebar_position:2,toc_max_heading_level:4,sidebar_label:"Deep Learning"},d="Deep Learning Quickstart",h={},u=[{value:"Prerequisites: Set up MLflow and Pytorch",id:"prerequisites-set-up-mlflow-and-pytorch",level:2},{value:"Step 1: Create a new experiment",id:"step-1-create-a-new-experiment",level:2},{value:"Step 2: Prepare the dataset",id:"step-2-prepare-the-dataset",level:2},{value:"Step 3: Define the model and optimizer",id:"step-3-define-the-model-and-optimizer",level:2},{value:"Step 4: Train the model",id:"step-4-train-the-model",level:2},{value:"Step 5: View the training results in the MLflow UI",id:"step-5-view-the-training-results-in-the-mlflow-ui",level:2},{value:"Step 6: Load back the model and run inference",id:"step-6-load-back-the-model-and-run-inference",level:2},{value:"Next Steps",id:"next-steps",level:2}];function p(e){let t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"deep-learning-quickstart",children:"Deep Learning Quickstart"})}),"\n",(0,a.jsx)(t.admonition,{title:"MLflow Assistant",type:"tip",children:(0,a.jsxs)(t.p,{children:["Need help setting up tracking? Try ",(0,a.jsx)("ins",{children:(0,a.jsx)(t.a,{href:"/genai/getting-started/try-assistant",children:"MLflow Assistant"})})," - a powerful AI assistant that can help you set up MLflow tracking for your project."]})}),"\n",(0,a.jsx)(o.A,{src:"/images/tutorials/introductory/deep-learning/ui-system-metrics.png",alt:"MLflow UI System metrics page",width:"80%"}),"\n",(0,a.jsx)(t.p,{children:"In this tutorial, we demonstrate how to use MLflow to track deep learning experiments with Pytorch. By combining MLflow"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["Save ",(0,a.jsx)(t.strong,{children:"checkpoints"})," with metrics."]}),"\n",(0,a.jsxs)(t.li,{children:["Visualize the ",(0,a.jsx)(t.strong,{children:"loss curve"})," during training."]}),"\n",(0,a.jsxs)(t.li,{children:["Monitor ",(0,a.jsx)(t.strong,{children:"system metrics"})," such as GPU utilization, memory footprint, disk usage, network, etc."]}),"\n",(0,a.jsxs)(t.li,{children:["Record ",(0,a.jsx)(t.strong,{children:"hyperparameters"})," and optimizer settings."]}),"\n",(0,a.jsxs)(t.li,{children:["Snapshot ",(0,a.jsx)(t.strong,{children:"library versions"})," for reproducibility."]}),"\n"]}),"\n",(0,a.jsx)(t.h2,{id:"prerequisites-set-up-mlflow-and-pytorch",children:"Prerequisites: Set up MLflow and Pytorch"}),"\n",(0,a.jsx)(t.p,{children:"MLflow is available on PyPI. Install MLflow and Pytorch with:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"pip install mlflow torch torchvision\n"})}),"\n",(0,a.jsxs)(t.p,{children:["Then, follow the instructions in the ",(0,a.jsx)(t.a,{href:"/ml/getting-started/running-notebooks",children:"Set Up MLflow"})," guide to set up MLflow."]}),"\n",(0,a.jsx)(t.h2,{id:"step-1-create-a-new-experiment",children:"Step 1: Create a new experiment"}),"\n",(0,a.jsx)(t.p,{children:"Create a new MLflow experiment for the tutorial and enable system metrics monitoring. Here we set the monitoring interval to 1 second because the training will be quick, but for longer training runs, you can set it to a larger value."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-python",children:'import mlflow\n\n# The set_experiment API creates a new experiment if it doesn\'t exist.\nmlflow.set_experiment("Deep Learning Experiment")\n\n# IMPORTANT: Enable system metrics monitoring\nmlflow.config.enable_system_metrics_logging()\nmlflow.config.set_system_metrics_sampling_interval(1)\n'})}),"\n",(0,a.jsx)(t.h2,{id:"step-2-prepare-the-dataset",children:"Step 2: Prepare the dataset"}),"\n",(0,a.jsx)(t.p,{children:"In this example, we will use the FashionMNIST dataset, which is a collection of 28x28 grayscale images of 10 different types of clothing."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-python",children:'import torch\nimport torch.nn as nn\nimport torch.optim as optim\nfrom torch.utils.data import DataLoader\nfrom torchvision import datasets, transforms\n\n# Define device\ndevice = torch.device("cuda" if torch.cuda.is_available() else "cpu")\n\n# Load and prepare data\ntransform = transforms.Compose(\n    [transforms.ToTensor(), transforms.Normalize((0.1307,), (0.3081,))]\n)\ntrain_dataset = datasets.FashionMNIST(\n    "data", train=True, download=True, transform=transform\n)\ntest_dataset = datasets.FashionMNIST("data", train=False, transform=transform)\ntrain_loader = DataLoader(train_dataset, batch_size=64, shuffle=True)\ntest_loader = DataLoader(test_dataset, batch_size=1000)\n'})}),"\n",(0,a.jsx)(t.h2,{id:"step-3-define-the-model-and-optimizer",children:"Step 3: Define the model and optimizer"}),"\n",(0,a.jsx)(t.p,{children:"Define a simple MLP model with 2 hidden layers."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-python",children:"import torch.nn as nn\n\n\nclass NeuralNetwork(nn.Module):\n    def __init__(self):\n        super().__init__()\n        self.flatten = nn.Flatten()\n        self.linear_relu_stack = nn.Sequential(\n            nn.Linear(28 * 28, 512),\n            nn.ReLU(),\n            nn.Linear(512, 512),\n            nn.ReLU(),\n            nn.Linear(512, 10),\n        )\n\n    def forward(self, x):\n        x = self.flatten(x)\n        logits = self.linear_relu_stack(x)\n        return logits\n\n\nmodel = NeuralNetwork().to(device)\n"})}),"\n",(0,a.jsx)(t.p,{children:"Then, define the training parameters and optimizer."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-python",children:'# Training parameters\nparams = {\n    "epochs": 5,\n    "learning_rate": 1e-3,\n    "batch_size": 64,\n    "optimizer": "SGD",\n    "model_type": "MLP",\n    "hidden_units": [512, 512],\n}\n\n# Define optimizer and loss function\nloss_fn = nn.CrossEntropyLoss()\noptimizer = optim.SGD(model.parameters(), lr=params["learning_rate"])\n'})}),"\n",(0,a.jsx)(t.h2,{id:"step-4-train-the-model",children:"Step 4: Train the model"}),"\n",(0,a.jsx)(t.p,{children:"Now we are ready to train the model. Inside the training loop, we log the metrics and checkpoints to MLflow. The key points in this code are:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["Initiate an MLflow ",(0,a.jsx)(t.strong,{children:"run"})," context to start a new run that we will log the model and metadata to."]}),"\n",(0,a.jsxs)(t.li,{children:["Log training parameters using ",(0,a.jsx)(t.code,{children:"mlflow.log_params"}),"."]}),"\n",(0,a.jsxs)(t.li,{children:["Log various metrics using ",(0,a.jsx)(t.code,{children:"mlflow.log_metrics"}),"."]}),"\n",(0,a.jsxs)(t.li,{children:["Save checkpoints for each epoch using ",(0,a.jsx)(t.code,{children:"mlflow.pytorch.log_model"}),"."]}),"\n"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-python",children:'with mlflow.start_run() as run:\n    # Log training parameters\n    mlflow.log_params(params)\n\n    for epoch in range(params["epochs"]):\n        model.train()\n        train_loss, correct, total = 0, 0, 0\n\n        for batch_idx, (data, target) in enumerate(train_loader):\n            data, target = data.to(device), target.to(device)\n\n            # Forward pass\n            optimizer.zero_grad()\n            output = model(data)\n            loss = loss_fn(output, target)\n\n            # Backward pass\n            loss.backward()\n            optimizer.step()\n\n            # Calculate metrics\n            train_loss += loss.item()\n            _, predicted = output.max(1)\n            total += target.size(0)\n            correct += predicted.eq(target).sum().item()\n\n            # Log batch metrics (every 100 batches)\n            if batch_idx % 100 == 0:\n                batch_loss = train_loss / (batch_idx + 1)\n                batch_acc = 100.0 * correct / total\n                mlflow.log_metrics(\n                    {"batch_loss": batch_loss, "batch_accuracy": batch_acc},\n                    step=epoch * len(train_loader) + batch_idx,\n                )\n\n        # Calculate epoch metrics\n        epoch_loss = train_loss / len(train_loader)\n        epoch_acc = 100.0 * correct / total\n\n        # Validation\n        model.eval()\n        val_loss, val_correct, val_total = 0, 0, 0\n        with torch.no_grad():\n            for data, target in test_loader:\n                data, target = data.to(device), target.to(device)\n                output = model(data)\n                loss = loss_fn(output, target)\n\n                val_loss += loss.item()\n                _, predicted = output.max(1)\n                val_total += target.size(0)\n                val_correct += predicted.eq(target).sum().item()\n\n        # Calculate and log epoch validation metrics\n        val_loss = val_loss / len(test_loader)\n        val_acc = 100.0 * val_correct / val_total\n\n        # Log epoch metrics\n        mlflow.log_metrics(\n            {\n                "train_loss": epoch_loss,\n                "train_accuracy": epoch_acc,\n                "val_loss": val_loss,\n                "val_accuracy": val_acc,\n            },\n            step=epoch,\n        )\n        # Log checkpoint at the end of each epoch\n        mlflow.pytorch.log_model(model, name=f"checkpoint_{epoch}")\n\n        print(\n            f"Epoch {epoch+1}/{params[\'epochs\']}, "\n            f"Train Loss: {epoch_loss:.4f}, Train Acc: {epoch_acc:.2f}%, "\n            f"Val Loss: {val_loss:.4f}, Val Acc: {val_acc:.2f}%"\n        )\n\n    # Log the final trained model\n    model_info = mlflow.pytorch.log_model(model, name="final_model")\n'})}),"\n",(0,a.jsx)(t.h2,{id:"step-5-view-the-training-results-in-the-mlflow-ui",children:"Step 5: View the training results in the MLflow UI"}),"\n",(0,a.jsxs)(t.p,{children:["To see the results of training, you can access the MLflow UI by navigating to the URL of the Tracking Server. If you have not started one, open a new terminal and run the following command at the root of the MLflow project and access the UI at ",(0,a.jsx)(t.a,{href:"http://localhost:5000",children:"http://localhost:5000"})," (or the port number you specified)."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"mlflow server --port 5000\n"})}),"\n",(0,a.jsx)(t.p,{children:"When opening the site, you will see a screen similar to the following:"}),"\n",(0,a.jsx)(o.A,{src:"/images/tutorials/introductory/deep-learning/ui-home.png",alt:"MLflow UI Home page"}),"\n",(0,a.jsx)(t.p,{children:'The "Experiments" section shows a list of (recently created) experiments. Click on the "Deep Learning Experiment" experiment we\'ve created for this tutorial.'}),"\n",(0,a.jsx)(o.A,{src:"/images/tutorials/introductory/hyperparameter-tuning/ui-run-list.png",alt:"MLflow UI Run list page"}),"\n",(0,a.jsxs)(t.p,{children:["Click the Run in the table to view the details of the run. The overview page shows metadata such as the run duration, start time, training parameters, tags, etc. Navigate to the ",(0,a.jsx)(t.strong,{children:"Model metrics"})," and ",(0,a.jsx)(t.strong,{children:"System metrics"})," tabs to view the performance and system metrics logged during training."]}),"\n",(0,a.jsxs)(i.A,{children:[(0,a.jsx)(l.A,{value:"overview",label:"Overview",children:(0,a.jsx)(o.A,{src:"/images/tutorials/introductory/deep-learning/ui-run-overview.png",alt:"MLflow UI Overview page"})}),(0,a.jsx)(l.A,{value:"model-metrics",label:"Model Metrics",default:!0,children:(0,a.jsx)(o.A,{src:"/images/tutorials/introductory/deep-learning/ui-model-metrics.png",alt:"MLflow UI Model metrics page"})}),(0,a.jsx)(l.A,{value:"system-metrics",label:"System Metrics",children:(0,a.jsx)(o.A,{src:"/images/tutorials/introductory/deep-learning/ui-system-metrics.png",alt:"MLflow UI System metrics page"})})]}),"\n",(0,a.jsx)(t.h2,{id:"step-6-load-back-the-model-and-run-inference",children:"Step 6: Load back the model and run inference"}),"\n",(0,a.jsxs)(t.p,{children:["You can load the final model or checkpoint from MLflow using the ",(0,a.jsx)(t.code,{children:"mlflow.pytorch.load_model"})," function. Let's run the loaded model on the test set and evaluate the performance."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-python",children:'# Load the final model\nmodel = mlflow.pytorch.load_model("runs:/<run_id>/final_model")\n# or load a checkpoint\n# model = mlflow.pytorch.load_model("runs:/<run_id>/checkpoint_<epoch>")\nmodel.to(device)\nmodel.eval()\n\n# Resume the previous run to log test metrics\nwith mlflow.start_run(run_id=run.info.run_id) as run:\n    # Evaluate the model on the test set\n    test_loss, test_correct, test_total = 0, 0, 0\n    with torch.no_grad():\n        for data, target in test_loader:\n            data, target = data.to(device), target.to(device)\n        output = model(data)\n        loss = loss_fn(output, target)\n\n        test_loss += loss.item()\n        _, predicted = output.max(1)\n        test_total += target.size(0)\n        test_correct += predicted.eq(target).sum().item()\n\n    # Calculate and log final test metrics\n    test_loss = test_loss / len(test_loader)\n    test_acc = 100.0 * test_correct / test_total\n\n    mlflow.log_metrics({"test_loss": test_loss, "test_accuracy": test_acc})\n    print(f"Final Test Accuracy: {test_acc:.2f}%")\n'})}),"\n",(0,a.jsx)(t.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,a.jsx)(t.p,{children:"Congratulations on working through the MLflow Deep Learning Quickstart! You should now have a basic understanding of how to combine MLflow with deep learning frameworks such as PyTorch to track your experiments and models."}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.a,{href:"/ml/deep-learning",children:"MLflow for Deep Learning"}),": Learn more about MLflow integration with deep learning frameworks."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.a,{href:"/genai",children:"MLflow for GenAI"}),": Learn how to use MLflow for GenAI/LLM development."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.a,{href:"/ml/tracking/",children:"MLflow Tracking"}),": Learn more about the MLflow Tracking APIs."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.a,{href:"/self-hosting",children:"Self-hosting Guide"}),": Learn how to self-host the MLflow Tracking Server and set it up for team collaboration."]}),"\n"]})]})}function m(e={}){let{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}},57250(e,t,n){n.d(t,{A:()=>s});var r=n(74848);n(96540);var a=n(34164);function s({children:e,hidden:t,className:n}){return(0,r.jsx)("div",{role:"tabpanel",className:(0,a.A)("tabItem_Ymn6",n),hidden:t,children:e})}},78010(e,t,n){n.d(t,{A:()=>x});var r=n(74848),a=n(96540),s=n(34164),i=n(88287),l=n(28584),o=n(56347),c=n(99989),d=n(96629),h=n(80618),u=n(41367);function p(e){return a.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,a.isValidElement)(e)&&function(e){let{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function m({value:e,tabValues:t}){return t.some(t=>t.value===e)}var f=n(19863);function g({className:e,block:t,selectedValue:n,selectValue:a,tabValues:i}){let o=[],{blockElementScrollPositionUntilNextRender:c}=(0,l.a_)(),d=e=>{let t=e.currentTarget,r=i[o.indexOf(t)].value;r!==n&&(c(t),a(r))},h=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{let n=o.indexOf(e.currentTarget)+1;t=o[n]??o[0];break}case"ArrowLeft":{let n=o.indexOf(e.currentTarget)-1;t=o[n]??o[o.length-1]}}t?.focus()};return(0,r.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":t},e),children:i.map(({value:e,label:t,attributes:a})=>(0,r.jsx)("li",{role:"tab",tabIndex:n===e?0:-1,"aria-selected":n===e,ref:e=>{o.push(e)},onKeyDown:h,onClick:d,...a,className:(0,s.A)("tabs__item","tabItem_LNqP",a?.className,{"tabs__item--active":n===e}),children:t??e},e))})}function _({lazy:e,children:t,selectedValue:n}){let i=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){let e=i.find(e=>e.props.value===n);return e?(0,a.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,r.jsx)("div",{className:"margin-top--md",children:i.map((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==n}))})}function w(e){let t=function(e){let t,{defaultValue:n,queryString:r=!1,groupId:s}=e,i=function(e){let{values:t,children:n}=e;return(0,a.useMemo)(()=>{let e=t??p(n).map(({props:{value:e,label:t,attributes:n,default:r}})=>({value:e,label:t,attributes:n,default:r})),r=(0,h.XI)(e,(e,t)=>e.value===t.value);if(r.length>0)throw Error(`Docusaurus error: Duplicate values "${r.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`);return e},[t,n])}(e),[l,f]=(0,a.useState)(()=>(function({defaultValue:e,tabValues:t}){if(0===t.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:t}))throw Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${t.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}let n=t.find(e=>e.default)??t[0];if(!n)throw Error("Unexpected error: 0 tabValues");return n.value})({defaultValue:n,tabValues:i})),[g,_]=function({queryString:e=!1,groupId:t}){let n=(0,o.W6)(),r=function({queryString:e=!1,groupId:t}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!t)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:e,groupId:t});return[(0,d.aZ)(r),(0,a.useCallback)(e=>{if(!r)return;let t=new URLSearchParams(n.location.search);t.set(r,e),n.replace({...n.location,search:t.toString()})},[r,n])]}({queryString:r,groupId:s}),[w,x]=function({groupId:e}){let t=e?`docusaurus.tab.${e}`:null,[n,r]=(0,u.Dv)(t);return[n,(0,a.useCallback)(e=>{t&&r.set(e)},[t,r])]}({groupId:s}),v=m({value:t=g??w,tabValues:i})?t:null;return(0,c.A)(()=>{v&&f(v)},[v]),{selectedValue:l,selectValue:(0,a.useCallback)(e=>{if(!m({value:e,tabValues:i}))throw Error(`Can't select invalid tab value=${e}`);f(e),_(e),x(e)},[_,x,i]),tabValues:i}}(e);return(0,r.jsxs)("div",{className:(0,s.A)(i.G.tabs.container,"tabs-container","tabList__CuJ"),children:[(0,r.jsx)(g,{...t,...e}),(0,r.jsx)(_,{...t,...e})]})}function x(e){let t=(0,f.A)();return(0,r.jsx)(w,{...e,children:p(e.children)},String(t))}},46077(e,t,n){n.d(t,{A:()=>s});var r=n(74848);n(96540);var a=n(66497);function s({src:e,alt:t,width:n,caption:s,className:i}){return(0,r.jsxs)("div",{className:`container_JwLF ${i||""}`,children:[(0,r.jsx)("div",{className:"imageWrapper_RfGN",style:n?{width:n}:{},children:(0,r.jsx)("img",{src:(0,a.default)(e),alt:t,className:"image_bwOA"})}),s&&(0,r.jsx)("p",{className:"caption_jo2G",children:s})]})}},28453(e,t,n){n.d(t,{R:()=>i,x:()=>l});var r=n(96540);let a={},s=r.createContext(a);function i(e){let t=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),r.createElement(s.Provider,{value:t},e.children)}}}]);