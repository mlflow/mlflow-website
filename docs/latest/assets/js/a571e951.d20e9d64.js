"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[361],{10270:(e,l,r)=>{r.r(l),r.d(l,{assets:()=>d,contentTitle:()=>h,default:()=>f,frontMatter:()=>c,metadata:()=>n,toc:()=>m});const n=JSON.parse('{"id":"tracking/backend-stores/index","title":"Backend Stores","description":"The backend store is a core component in MLflow Tracking where MLflow stores metadata for","source":"@site/docs/classic-ml/tracking/backend-stores/index.mdx","sourceDirName":"tracking/backend-stores","slug":"/tracking/backend-stores/","permalink":"/docs/latest/ml/tracking/backend-stores/","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"classicMLSidebar","previous":{"title":"Artifact Store \ud83d\udce6","permalink":"/docs/latest/ml/tracking/artifact-stores/"},"next":{"title":"Tracking Experiments with Local Database","permalink":"/docs/latest/ml/tracking/tutorials/local-database/"}}');var t=r(74848),a=r(28453),i=r(28774),o=r(49374),s=r(72839);const c={},h="Backend Stores",d={},m=[{value:"Configure Backend Store",id:"configure-backend-store",level:2},{value:"Supported Store Types",id:"supported-store-types",level:2},{value:"Deletion Behavior",id:"deletion-behavior",level:2},{value:"SQLAlchemy Options",id:"sqlalchemy-options",level:2},{value:"MySQL SSL Options",id:"mysql-ssl-options",level:2},{value:"File Store Performance",id:"file-store-performance",level:2}];function p(e){const l={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.header,{children:(0,t.jsx)(l.h1,{id:"backend-stores",children:"Backend Stores"})}),"\n",(0,t.jsxs)(l.p,{children:["The backend store is a core component in ",(0,t.jsx)(l.a,{href:"/ml/tracking",children:"MLflow Tracking"})," where MLflow stores metadata for\n",(0,t.jsx)(l.a,{href:"/ml/tracking#runs",children:"Runs"}),", models and experiments such as:"]}),"\n",(0,t.jsxs)(l.ul,{children:["\n",(0,t.jsx)(l.li,{children:"Model ID"}),"\n",(0,t.jsx)(l.li,{children:"Run ID"}),"\n",(0,t.jsx)(l.li,{children:"Start & end time"}),"\n",(0,t.jsx)(l.li,{children:"Parameters"}),"\n",(0,t.jsx)(l.li,{children:"Metrics"}),"\n",(0,t.jsxs)(l.li,{children:["Code version (only if you launch runs from an ",(0,t.jsx)(l.a,{href:"/ml/projects",children:"MLflow Project"}),")."]}),"\n",(0,t.jsxs)(l.li,{children:["Source file name (only if you launch runs from an ",(0,t.jsx)(l.a,{href:"/ml/projects",children:"MLflow Project"}),")."]}),"\n"]}),"\n",(0,t.jsxs)(l.p,{children:["Note that large model artifacts such as model weight files are stored in ",(0,t.jsx)(l.a,{href:"/ml/tracking/artifact-stores",children:"artifact store"}),"."]}),"\n",(0,t.jsx)(l.h2,{id:"configure-backend-store",children:"Configure Backend Store"}),"\n",(0,t.jsxs)(l.p,{children:["By default, MLflow stores metadata in local files in the ",(0,t.jsx)(l.code,{children:"./mlruns"})," directory, but MLflow can store metadata to databases as well.\nYou can configure the location by passing the desired ",(0,t.jsx)(l.strong,{children:"tracking URI"})," to MLflow, via either of the following methods:"]}),"\n",(0,t.jsxs)(l.ul,{children:["\n",(0,t.jsxs)(l.li,{children:["Set the ",(0,t.jsx)(l.code,{children:"MLFLOW_TRACKING_URI"})," environment variable."]}),"\n",(0,t.jsxs)(l.li,{children:["Call ",(0,t.jsx)(o.B,{fn:"mlflow.set_tracking_uri"})," in your code."]}),"\n",(0,t.jsxs)(l.li,{children:["If you are running a ",(0,t.jsx)(l.a,{href:"/ml/tracking#tracking_server",children:"Tracking Server"}),", you can set the ",(0,t.jsx)(l.code,{children:"tracking_uri"})," option when starting the server, like ",(0,t.jsx)(l.code,{children:"mlflow server --backend-store-uri sqlite:///mydb.sqlite"})]}),"\n"]}),"\n",(0,t.jsxs)(l.p,{children:["Continue to the next section for the supported format of tracking URLs.\nAlso visit ",(0,t.jsx)(l.a,{href:"/ml/tracking#tracking_setup",children:"this guidance"})," for how to set up the backend store properly for your workflow."]}),"\n",(0,t.jsx)(l.h2,{id:"supported-store-types",children:"Supported Store Types"}),"\n",(0,t.jsx)(l.p,{children:"MLflow supports the following types of tracking URI for backend stores:"}),"\n",(0,t.jsxs)(l.ul,{children:["\n",(0,t.jsxs)(l.li,{children:["Local file path (specified as ",(0,t.jsx)(l.code,{children:"file:/my/local/dir"}),"), where data is just directly stored locally to a system disk where your code is executing."]}),"\n",(0,t.jsxs)(l.li,{children:["A Database, encoded as ",(0,t.jsx)(l.code,{children:"<dialect>+<driver>://<username>:<password>@<host>:<port>/<database>"}),". MLflow supports the dialects ",(0,t.jsx)(l.code,{children:"mysql"}),", ",(0,t.jsx)(l.code,{children:"mssql"}),", ",(0,t.jsx)(l.code,{children:"sqlite"}),", and ",(0,t.jsx)(l.code,{children:"postgresql"}),". For more details, see ",(0,t.jsx)(l.a,{href:"https://docs.sqlalchemy.org/en/latest/core/engines.html#database-urls",children:"SQLAlchemy database uri"}),"."]}),"\n",(0,t.jsxs)(l.li,{children:["HTTP server (specified as ",(0,t.jsx)(l.code,{children:"https://my-server:5000"}),"), which is a server hosting an ",(0,t.jsx)(l.a,{href:"/ml/tracking#tracking_server",children:"MLflow tracking server"}),"."]}),"\n",(0,t.jsxs)(l.li,{children:["Databricks workspace (specified as ",(0,t.jsx)(l.code,{children:"databricks"})," or as ",(0,t.jsx)(l.code,{children:"databricks://<profileName>"}),", a ",(0,t.jsx)(l.a,{href:"https://github.com/databricks/databricks-cli#installation",children:"Databricks CLI profile"}),").\nRefer to Access the MLflow tracking server from outside Databricks ",(0,t.jsx)(l.a,{href:"http://docs.databricks.com/applications/mlflow/access-hosted-tracking-server.html",children:"[AWS]"}),"\n",(0,t.jsx)(l.a,{href:"http://docs.microsoft.com/azure/databricks/applications/mlflow/access-hosted-tracking-server",children:"[Azure]"}),", or ",(0,t.jsx)(l.a,{href:"/ml/tracking/quickstart",children:"the quickstart"})," to\neasily get started with hosted MLflow on the Databricks Free Trial."]}),"\n"]}),"\n",(0,t.jsxs)(l.admonition,{title:"database-requirements",type:"warning",children:[(0,t.jsx)(l.p,{children:(0,t.jsx)(l.strong,{children:"Database-Backed Store Requirements"})}),(0,t.jsx)(l.p,{children:"When using database-backed stores, please note:"}),(0,t.jsxs)(l.ul,{children:["\n",(0,t.jsxs)(l.li,{children:["\n",(0,t.jsxs)(l.p,{children:[(0,t.jsx)(l.strong,{children:"Model Registry Integration"}),": ",(0,t.jsx)(l.a,{href:"/ml/model-registry",children:"Model Registry"})," functionality requires a database-backed store. See ",(0,t.jsx)(l.a,{href:"/ml/tracking#tracking-with-model-registry",children:"this FAQ"})," for more information."]}),"\n"]}),"\n",(0,t.jsxs)(l.li,{children:["\n",(0,t.jsxs)(l.p,{children:[(0,t.jsx)(l.strong,{children:"Schema Migrations"}),": ",(0,t.jsx)(l.code,{children:"mlflow server"})," will fail against a database with an out-of-date schema. Always run ",(0,t.jsx)(l.code,{children:"mlflow db upgrade [db_uri]"})," to upgrade your database schema before starting the server. Schema migrations can result in database downtime and may take longer on larger databases. ",(0,t.jsx)(l.strong,{children:"Always backup your database before running migrations."})]}),"\n"]}),"\n"]})]}),"\n",(0,t.jsx)(l.admonition,{title:"parameter-limits",type:"note",children:(0,t.jsxs)(l.p,{children:["In Sep 2023, we increased the max length for params recorded in a Run from 500 to 8k (but we limit param value max length to 6000 internally).\n",(0,t.jsx)(l.a,{href:"https://github.com/mlflow/mlflow/blob/master/mlflow/store/db_migrations/versions/2d6e25af4d3e_increase_max_param_val_length.py",children:"mlflow/2d6e25af4d3e_increase_max_param_val_length"}),"\nis a non-invertible migration script that increases the cap in existing database to 8k. Please be careful if you want to upgrade and backup your database before upgrading."]})}),"\n",(0,t.jsx)(l.h2,{id:"deletion-behavior",children:"Deletion Behavior"}),"\n",(0,t.jsxs)(l.p,{children:["In order to allow MLflow Runs to be restored, Run metadata and artifacts are not automatically removed\nfrom the backend store or artifact store when a Run is deleted. The ",(0,t.jsx)(i.A,{to:"/api_reference/cli.html",target:"_blank",children:"mlflow gc"})," CLI is provided\nfor permanently removing Run metadata and artifacts for deleted runs."]}),"\n",(0,t.jsx)(l.h2,{id:"sqlalchemy-options",children:"SQLAlchemy Options"}),"\n",(0,t.jsxs)(l.p,{children:["You can inject some ",(0,t.jsx)(l.a,{href:"https://docs.sqlalchemy.org/en/latest/core/pooling.html",children:"SQLAlchemy connection pooling options"})," using environment variables."]}),"\n",(0,t.jsxs)(s.X,{children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"MLflow Environment Variable"}),(0,t.jsx)("th",{children:"SQLAlchemy QueuePool Option"})]})}),(0,t.jsxs)("tbody",{children:[(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:(0,t.jsx)(l.code,{children:"MLFLOW_SQLALCHEMYSTORE_POOL_SIZE"})}),(0,t.jsx)("td",{children:(0,t.jsx)(l.code,{children:"pool_size"})})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:(0,t.jsx)(l.code,{children:"MLFLOW_SQLALCHEMYSTORE_POOL_RECYCLE"})}),(0,t.jsx)("td",{children:(0,t.jsx)(l.code,{children:"pool_recycle"})})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:(0,t.jsx)(l.code,{children:"MLFLOW_SQLALCHEMYSTORE_MAX_OVERFLOW"})}),(0,t.jsx)("td",{children:(0,t.jsx)(l.code,{children:"max_overflow"})})]})]})]}),"\n",(0,t.jsx)(l.h2,{id:"mysql-ssl-options",children:"MySQL SSL Options"}),"\n",(0,t.jsx)(l.p,{children:"When connecting to a MySQL database that requires SSL certificates, you can set the following environment variables:"}),"\n",(0,t.jsx)(l.pre,{children:(0,t.jsx)(l.code,{className:"language-bash",children:"# Path to SSL CA certificate file\nexport MLFLOW_MYSQL_SSL_CA=/path/to/ca.pem\n\n# Path to SSL client certificate file (if needed)\nexport MLFLOW_MYSQL_SSL_CERT=/path/to/client-cert.pem\n\n# Path to SSL client key file (if needed)\nexport MLFLOW_MYSQL_SSL_KEY=/path/to/client-key.pem\n"})}),"\n",(0,t.jsx)(l.p,{children:"Then start the MLflow server with your MySQL URI:"}),"\n",(0,t.jsx)(l.pre,{children:(0,t.jsx)(l.code,{className:"language-bash",children:'mlflow server --backend-store-uri="mysql+pymysql://username@hostname:port/database" --default-artifact-root=s3://your-bucket --host=0.0.0.0 --port=5000\n'})}),"\n",(0,t.jsx)(l.p,{children:"These environment variables will be used to configure the SSL connection to the MySQL server."}),"\n",(0,t.jsx)(l.h2,{id:"file-store-performance",children:"File Store Performance"}),"\n",(0,t.jsxs)(l.p,{children:["MLflow will automatically try to use ",(0,t.jsx)(l.a,{href:"https://pyyaml.org/wiki/LibYAML",children:"LibYAML"})," bindings if they are already installed.\nHowever, if you notice any performance issues when using ",(0,t.jsx)(l.em,{children:"file store"})," backend, it could mean LibYAML is not installed on your system.\nOn Linux or Mac you can easily install it using your system package manager:"]}),"\n",(0,t.jsx)(l.pre,{children:(0,t.jsx)(l.code,{className:"language-bash",children:"# On Ubuntu/Debian\napt-get install libyaml-cpp-dev libyaml-dev\n\n# On macOS using Homebrew\nbrew install yaml-cpp libyaml\n"})}),"\n",(0,t.jsx)(l.p,{children:"After installing LibYAML, you need to reinstall PyYAML:"}),"\n",(0,t.jsx)(l.pre,{children:(0,t.jsx)(l.code,{className:"language-bash",children:"# Reinstall PyYAML\npip --no-cache-dir install --force-reinstall -I pyyaml\n"})})]})}function f(e={}){const{wrapper:l}={...(0,a.R)(),...e.components};return l?(0,t.jsx)(l,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}},28453:(e,l,r)=>{r.d(l,{R:()=>i,x:()=>o});var n=r(96540);const t={},a=n.createContext(t);function i(e){const l=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(l):{...l,...e}}),[l,e])}function o(e){let l;return l=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),n.createElement(a.Provider,{value:l},e.children)}},49374:(e,l,r)=>{r.d(l,{B:()=>s});r(96540);const n=JSON.parse('{"mlflow.anthropic":"api_reference/python_api/mlflow.anthropic.html","mlflow.artifacts":"api_reference/python_api/mlflow.artifacts.html","mlflow.ag2":"api_reference/python_api/mlflow.ag2.html","mlflow.autogen":"api_reference/python_api/mlflow.autogen.html","mlflow.bedrock":"api_reference/python_api/mlflow.bedrock.html","mlflow.catboost":"api_reference/python_api/mlflow.catboost.html","mlflow.client":"api_reference/python_api/mlflow.client.html","mlflow.config":"api_reference/python_api/mlflow.config.html","mlflow.crewai":"api_reference/python_api/mlflow.crewai.html","mlflow.data":"api_reference/python_api/mlflow.data.html","mlflow.deployments":"api_reference/python_api/mlflow.deployments.html","mlflow.diviner":"api_reference/python_api/mlflow.diviner.html","mlflow.dspy":"api_reference/python_api/mlflow.dspy.html","mlflow.entities":"api_reference/python_api/mlflow.entities.html","mlflow.environment_variables":"api_reference/python_api/mlflow.environment_variables.html","mlflow.gateway":"api_reference/python_api/mlflow.gateway.html","mlflow.gemini":"api_reference/python_api/mlflow.gemini.html","mlflow.groq":"api_reference/python_api/mlflow.groq.html","mlflow.h2o":"api_reference/python_api/mlflow.h2o.html","mlflow.johnsnowlabs":"api_reference/python_api/mlflow.johnsnowlabs.html","mlflow.keras":"api_reference/python_api/mlflow.keras.html","mlflow.langchain":"api_reference/python_api/mlflow.langchain.html","mlflow.lightgbm":"api_reference/python_api/mlflow.lightgbm.html","mlflow.litellm":"api_reference/python_api/mlflow.litellm.html","mlflow.llama_index":"api_reference/python_api/mlflow.llama_index.html","mlflow.metrics":"api_reference/python_api/mlflow.metrics.html","mlflow.mistral":"api_reference/python_api/mlflow.mistral.html","mlflow.models":"api_reference/python_api/mlflow.models.html","mlflow.onnx":"api_reference/python_api/mlflow.onnx.html","mlflow.openai":"api_reference/python_api/mlflow.openai.html","mlflow.paddle":"api_reference/python_api/mlflow.paddle.html","mlflow.pmdarima":"api_reference/python_api/mlflow.pmdarima.html","mlflow.projects":"api_reference/python_api/mlflow.projects.html","mlflow.promptflow":"api_reference/python_api/mlflow.promptflow.html","mlflow.prophet":"api_reference/python_api/mlflow.prophet.html","mlflow.pyfunc":"api_reference/python_api/mlflow.pyfunc.html","mlflow.pyspark.ml":"api_reference/python_api/mlflow.pyspark.ml.html","mlflow.pytorch":"api_reference/python_api/mlflow.pytorch.html","mlflow":"api_reference/python_api/mlflow.html","mlflow.sagemaker":"api_reference/python_api/mlflow.sagemaker.html","mlflow.sentence_transformers":"api_reference/python_api/mlflow.sentence_transformers.html","mlflow.server":"api_reference/python_api/mlflow.server.html","mlflow.shap":"api_reference/python_api/mlflow.shap.html","mlflow.sklearn":"api_reference/python_api/mlflow.sklearn.html","mlflow.spacy":"api_reference/python_api/mlflow.spacy.html","mlflow.spark":"api_reference/python_api/mlflow.spark.html","mlflow.statsmodels":"api_reference/python_api/mlflow.statsmodels.html","mlflow.system_metrics":"api_reference/python_api/mlflow.system_metrics.html","mlflow.tensorflow":"api_reference/python_api/mlflow.tensorflow.html","mlflow.tracing":"api_reference/python_api/mlflow.tracing.html","mlflow.transformers":"api_reference/python_api/mlflow.transformers.html","mlflow.types":"api_reference/python_api/mlflow.types.html","mlflow.utils":"api_reference/python_api/mlflow.utils.html","mlflow.xgboost":"api_reference/python_api/mlflow.xgboost.html","mlflow.server.auth":"api_reference/auth/python-api.html"}');var t=r(86025),a=r(28774),i=r(74848);const o=e=>{const l=e.split(".");for(let r=l.length;r>0;r--){const e=l.slice(0,r).join(".");if(n[e])return e}return null};function s({fn:e,children:l}){const r=o(e);if(!r)return(0,i.jsx)(i.Fragment,{children:l});const s=(0,t.Ay)(`/${n[r]}#${e}`);return(0,i.jsx)(a.A,{to:s,target:"_blank",children:l??(0,i.jsxs)("code",{children:[e,"()"]})})}},72839:(e,l,r)=>{r.d(l,{X:()=>t});var n=r(74848);function t({children:e}){return(0,n.jsx)("div",{className:"w-full overflow-x-auto",children:(0,n.jsx)("table",{children:e})})}}}]);