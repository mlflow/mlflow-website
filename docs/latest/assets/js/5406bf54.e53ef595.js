"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[4461,8401],{16581:(e,t,n)=>{n.d(t,{p:()=>d});var o=n(74848);const d=({children:e,isStderr:t})=>(0,o.jsx)("pre",{style:{margin:0,borderRadius:0,background:"none",fontSize:"0.85rem",flexGrow:1,padding:"var(--padding-sm)"},children:e})},17965:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>m,default:()=>f,frontMatter:()=>r,metadata:()=>o,toc:()=>h});const o=JSON.parse('{"id":"traditional-ml/tutorials/creating-custom-pyfunc/notebooks/introduction-ipynb","title":"Creating a Custom Model: \\"Add N\\" Model","description":"Download this notebook","source":"@site/docs/classic-ml/traditional-ml/tutorials/creating-custom-pyfunc/notebooks/introduction-ipynb.mdx","sourceDirName":"traditional-ml/tutorials/creating-custom-pyfunc/notebooks","slug":"/traditional-ml/tutorials/creating-custom-pyfunc/notebooks/introduction","permalink":"/mlflow-website/docs/latest/ml/traditional-ml/tutorials/creating-custom-pyfunc/notebooks/introduction","draft":false,"unlisted":false,"editUrl":"https://github.com/mlflow/mlflow/edit/master/docs/docs/classic-ml/traditional-ml/tutorials/creating-custom-pyfunc/notebooks/introduction.ipynb","tags":[],"version":"current","frontMatter":{"custom_edit_url":"https://github.com/mlflow/mlflow/edit/master/docs/docs/classic-ml/traditional-ml/tutorials/creating-custom-pyfunc/notebooks/introduction.ipynb","slug":"introduction"},"sidebar":"classicMLSidebar","previous":{"title":"Introduction to PythonModel","permalink":"/mlflow-website/docs/latest/ml/traditional-ml/tutorials/creating-custom-pyfunc/notebooks/basic-pyfunc"},"next":{"title":"Customizing the `predict` method","permalink":"/mlflow-website/docs/latest/ml/traditional-ml/tutorials/creating-custom-pyfunc/notebooks/override-predict"}}');var d=n(74848),a=n(28453),i=n(75983),l=n(16581),s=n(81226),c=n(27594);const r={custom_edit_url:"https://github.com/mlflow/mlflow/edit/master/docs/docs/classic-ml/traditional-ml/tutorials/creating-custom-pyfunc/notebooks/introduction.ipynb",slug:"introduction"},m='Creating a Custom Model: "Add N" Model',u={},h=[{value:"Step 1: Define the Model Class",id:"step-1-define-the-model-class",level:4},{value:"Step 2: Save the Model",id:"step-2-save-the-model",level:4},{value:"Step 3: Load the Model",id:"step-3-load-the-model",level:4},{value:"Step 4: Evaluate the Model",id:"step-4-evaluate-the-model",level:4},{value:"Conclusion",id:"conclusion",level:4}];function p(e){const t={h1:"h1",h4:"h4",header:"header",p:"p",...(0,a.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(t.header,{children:(0,d.jsx)(t.h1,{id:"creating-a-custom-model-add-n-model",children:'Creating a Custom Model: "Add N" Model'})}),"\n",(0,d.jsxs)(t.p,{children:[(0,d.jsx)(c.O,{href:"https://raw.githubusercontent.com/mlflow/mlflow/master/docs/docs/classic-ml/traditional-ml/tutorials/creating-custom-pyfunc/notebooks/introduction.ipynb",children:"Download this notebook"}),"\nOur first example is simple yet illustrative. We'll create a model that adds a specified numeric value, n, to all columns of a Pandas DataFrame input. This will demonstrate the process of defining a custom model, saving it, loading it back, and performing predictions."]}),"\n",(0,d.jsx)(t.h4,{id:"step-1-define-the-model-class",children:"Step 1: Define the Model Class"}),"\n",(0,d.jsx)(t.p,{children:"We begin by defining a Python class for our model. This class should inherit from mlflow.pyfunc.PythonModel and implement the necessary methods."}),"\n",(0,d.jsx)(i.d,{executionCount:1,children:'import mlflow.pyfunc\n\n\nclass AddN(mlflow.pyfunc.PythonModel):\n  """\n  A custom model that adds a specified value `n` to all columns of the input DataFrame.\n\n  Attributes:\n  -----------\n  n : int\n      The value to add to input columns.\n  """\n\n  def __init__(self, n):\n      """\n      Constructor method. Initializes the model with the specified value `n`.\n\n      Parameters:\n      -----------\n      n : int\n          The value to add to input columns.\n      """\n      self.n = n\n\n  def predict(self, context, model_input, params=None):\n      """\n      Prediction method for the custom model.\n\n      Parameters:\n      -----------\n      context : Any\n          Ignored in this example. It\'s a placeholder for additional data or utility methods.\n\n      model_input : pd.DataFrame\n          The input DataFrame to which `n` should be added.\n\n      params : dict, optional\n          Additional prediction parameters. Ignored in this example.\n\n      Returns:\n      --------\n      pd.DataFrame\n          The input DataFrame with `n` added to all columns.\n      """\n      return model_input.apply(lambda column: column + self.n)'}),"\n",(0,d.jsx)(t.h4,{id:"step-2-save-the-model",children:"Step 2: Save the Model"}),"\n",(0,d.jsx)(t.p,{children:"Now that our model class is defined, we can instantiate it and save it using MLflow."}),"\n",(0,d.jsx)(i.d,{executionCount:2,children:'# Define the path to save the model\nmodel_path = "/tmp/add_n_model"\n\n# Create an instance of the model with `n=5`\nadd5_model = AddN(n=5)\n\n# Save the model using MLflow\nmlflow.pyfunc.save_model(path=model_path, python_model=add5_model)'}),"\n",(0,d.jsx)(l.p,{isStderr:!0,children:'/Users/benjamin.wilson/miniconda3/envs/mlflow-dev-env/lib/python3.8/site-packages/_distutils_hack/__init__.py:30: UserWarning: Setuptools is replacing distutils.\nwarnings.warn("Setuptools is replacing distutils.")'}),"\n",(0,d.jsx)(t.h4,{id:"step-3-load-the-model",children:"Step 3: Load the Model"}),"\n",(0,d.jsx)(t.p,{children:"With our model saved, we can load it back using MLflow and then use it for predictions."}),"\n",(0,d.jsx)(i.d,{executionCount:3,children:"# Load the saved model\nloaded_model = mlflow.pyfunc.load_model(model_path)"}),"\n",(0,d.jsx)(t.h4,{id:"step-4-evaluate-the-model",children:"Step 4: Evaluate the Model"}),"\n",(0,d.jsx)(t.p,{children:"Let's now use our loaded model to perform predictions on a sample input and verify its correctness."}),"\n",(0,d.jsx)(i.d,{executionCount:4,children:"import pandas as pd\n\n# Define a sample input DataFrame\nmodel_input = pd.DataFrame([range(10)])\n\n# Use the loaded model to make predictions\nmodel_output = loaded_model.predict(model_input)"}),"\n",(0,d.jsx)(i.d,{executionCount:5,children:"model_output"}),"\n",(0,d.jsx)(s.Q,{children:(0,d.jsx)("div",{dangerouslySetInnerHTML:{__html:'<div>\n<style scoped>\n  .dataframe tbody tr th:only-of-type {\n      vertical-align: middle;\n  }\n\n  .dataframe tbody tr th {\n      vertical-align: top;\n  }\n\n  .dataframe thead th {\n      text-align: right;\n  }\n</style>\n<table border="1" class="dataframe">\n<thead>\n  <tr style="text-align: right;">\n    <th></th>\n    <th>0</th>\n    <th>1</th>\n    <th>2</th>\n    <th>3</th>\n    <th>4</th>\n    <th>5</th>\n    <th>6</th>\n    <th>7</th>\n    <th>8</th>\n    <th>9</th>\n  </tr>\n</thead>\n<tbody>\n  <tr>\n    <th>0</th>\n    <td>5</td>\n    <td>6</td>\n    <td>7</td>\n    <td>8</td>\n    <td>9</td>\n    <td>10</td>\n    <td>11</td>\n    <td>12</td>\n    <td>13</td>\n    <td>14</td>\n  </tr>\n</tbody>\n</table>\n</div>'}})}),"\n",(0,d.jsx)(t.h4,{id:"conclusion",children:"Conclusion"}),"\n",(0,d.jsx)(t.p,{children:"This simple example demonstrates the power and flexibility of MLflow's custom pyfunc. By encapsulating arbitrary Python code and its dependencies, custom pyfunc models ensure a consistent and unified interface for a wide range of use cases. Whether you're working with a niche machine learning framework, need custom preprocessing steps, or want to integrate unique prediction logic, pyfunc is the tool for the job."})]})}function f(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,d.jsx)(t,{...e,children:(0,d.jsx)(p,{...e})}):p(e)}},25486:(e,t,n)=>{n.d(t,{A:()=>h});n(96540);var o=n(34164),d=n(34291),a=n(97795),i=n(6509),l=n(26120),s=n(93915);const c={codeBlockHeader:"codeBlockHeader_C_1e",languageLabel:"languageLabel_zr_I"};var r=n(74848);function m({language:e}){return(0,r.jsxs)("div",{className:(0,o.A)(c.codeBlockHeader),"aria-label":`Code block header for ${e} code with copy and toggle buttons`,children:[(0,r.jsx)("span",{className:c.languageLabel,children:e}),(0,r.jsx)(s.A,{})]})}const u={codeBlockContent:"codeBlockContent_bxn0",codeBlockTitle:"codeBlockTitle_d3dP",codeBlock:"codeBlock_tXDp"};function h({className:e}){const{metadata:t}=(0,d.Ph)(),n=t.language||"text";return(0,r.jsxs)(a.A,{as:"div",className:(0,o.A)(e,t.className),children:[t.title&&(0,r.jsx)("div",{className:u.codeBlockTitle,children:(0,r.jsx)(i.A,{children:t.title})}),(0,r.jsxs)("div",{className:u.codeBlockContent,children:[(0,r.jsx)(m,{language:n}),(0,r.jsx)(l.A,{})]})]})}},27594:(e,t,n)=>{n.d(t,{O:()=>a});var o=n(96540),d=n(74848);function a({children:e,href:t}){const n=(0,o.useCallback)(async e=>{if(e.preventDefault(),window.gtag)try{window.gtag("event","notebook-download",{href:t})}catch{}const n=await fetch(t),o=await n.blob(),d=window.URL.createObjectURL(o),a=document.createElement("a");a.style.display="none",a.href=d;const i=t.split("/").pop();a.download=i,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(d),document.body.removeChild(a)},[t]);return(0,d.jsx)("a",{className:"button button--primary",style:{marginBottom:"1rem",display:"block",width:"min-content"},href:t,download:!0,onClick:n,children:e})}},75983:(e,t,n)=>{n.d(t,{d:()=>i});var o=n(93461);const d="codeBlock_oJcR";var a=n(74848);const i=({children:e,executionCount:t})=>(0,a.jsx)("div",{style:{flexGrow:1,minWidth:0,marginTop:"var(--padding-md)",width:"100%"},children:(0,a.jsx)(o.A,{className:d,language:"python",children:e})})},81226:(e,t,n)=>{n.d(t,{Q:()=>d});var o=n(74848);const d=({children:e})=>(0,o.jsx)("div",{style:{flexGrow:1,minWidth:0,fontSize:"0.8rem",width:"100%"},children:e})}}]);