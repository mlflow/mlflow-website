"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([["1669"],{94688(e,n,i){i.r(n),i.d(n,{metadata:()=>t,default:()=>j,frontMatter:()=>m,contentTitle:()=>h,toc:()=>u,assets:()=>g});var t=JSON.parse('{"id":"eval-monitor/scorers/llm-judge/memalign","title":"MemAlign Optimizer (Experimental)","description":"MemAlign is an experimental optimizer. The API may change in future releases.","source":"@site/docs/genai/eval-monitor/scorers/llm-judge/memalign.mdx","sourceDirName":"eval-monitor/scorers/llm-judge","slug":"/eval-monitor/scorers/llm-judge/memalign","permalink":"/mlflow-website/docs/latest/genai/eval-monitor/scorers/llm-judge/memalign","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"genAISidebar","previous":{"title":"SIMBA Optimizer","permalink":"/mlflow-website/docs/latest/genai/eval-monitor/scorers/llm-judge/simba"},"next":{"title":"Custom Optimizers","permalink":"/mlflow-website/docs/latest/genai/eval-monitor/scorers/llm-judge/custom-optimizers"}}'),r=i(74848),l=i(28453),s=i(33508),a=i(46858),o=i(86589),d=i(47792),c=i(87073);let m={},h="MemAlign Optimizer (Experimental)",g={},u=[{value:"Requirements",id:"requirements",level:2},{value:"How MemAlign Works",id:"how-memalign-works",level:2},{value:"Installation",id:"installation",level:2},{value:"Basic Usage",id:"basic-usage",level:2},{value:"Parameters",id:"parameters",level:2},{value:"Inspecting Learned Knowledge",id:"inspecting-learned-knowledge",level:2},{value:"Removing Feedback (Unalignment)",id:"removing-feedback-unalignment",level:2},{value:"Debugging",id:"debugging",level:2}];function p(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"memalign-optimizer-experimental",children:"MemAlign Optimizer (Experimental)"})}),"\n",(0,r.jsx)(n.admonition,{title:"Experimental Feature",type:"warning",children:(0,r.jsx)(n.p,{children:"MemAlign is an experimental optimizer. The API may change in future releases."})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"MemAlign"})," is an experimental optimizer that uses a dual-memory system inspired by human cognition to learn from natural language feedback. It offers significant speed and cost advantages over traditional prompt optimizers."]}),"\n",(0,r.jsx)(s.A,{features:[{icon:a.A,title:"Fast Alignment",description:"Up to 100\xd7 faster than traditional prompt optimizers like SIMBA, enabling rapid iteration on judge quality."},{icon:o.A,title:"Lower Cost",description:"Significantly lower cost per alignment cycle compared to traditional prompt optimizers."},{icon:d.A,title:"Few-Shot Learning",description:"Shows visible improvement with just a handful of examples\u2014no need to front-load massive labeling efforts."},{icon:c.A,title:"Dual-Memory System",description:"Combines generalizable guidelines (semantic memory) with concrete examples (episodic memory) for robust alignment."}]}),"\n",(0,r.jsx)(n.h2,{id:"requirements",children:"Requirements"}),"\n",(0,r.jsx)(n.p,{children:"For alignment to work:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Traces must contain human assessments (labels) with the same name as the judge"}),"\n",(0,r.jsx)(n.li,{children:"Natural language feedback (rationale) is highly recommended for better alignment"}),"\n",(0,r.jsx)(n.li,{children:"A mix of positive and negative labels is recommended"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"how-memalign-works",children:"How MemAlign Works"}),"\n",(0,r.jsx)(n.p,{children:"MemAlign maintains two types of memory:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Semantic Memory"}),': Stores distilled guidelines extracted from feedback. When an expert explains their decision, MemAlign extracts generalizable rules like "Always evaluate safety based on intent, not just language."']}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Episodic Memory"}),": Holds specific examples, particularly edge cases where the judge made mistakes. These serve as concrete anchors for situations that resist easy generalization."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"When evaluating new inputs, MemAlign constructs a dynamic context by gathering all principles from semantic memory and retrieving the most relevant examples from episodic memory\u2014similar to how human judges reference both a rulebook and case history."}),"\n",(0,r.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,r.jsx)(n.p,{children:"MemAlign requires additional dependencies:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pip install mlflow[genai] dspy jinja2 tqdm\n"})}),"\n",(0,r.jsx)(n.h2,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,r.jsxs)(n.p,{children:["See ",(0,r.jsx)(n.a,{href:"/genai/eval-monitor/scorers/llm-judge/custom-judges",children:"make_judge documentation"})," for details on creating judges."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'import mlflow\nfrom mlflow.genai.judges import make_judge\nfrom mlflow.genai.judges.optimizers import MemAlignOptimizer\n\n# Create a judge\njudge = make_judge(\n    name="politeness",\n    instructions=(\n        "Given a user question, evaluate if the chatbot\'s response is polite and respectful. "\n        "Consider the tone, language, and context of the response.\\n\\n"\n        "Question: {{ inputs }}\\n"\n        "Response: {{ outputs }}"\n    ),\n    feedback_value_type=bool,\n    model="openai:/gpt-5-mini",\n)\n\n# Create the MemAlign optimizer\noptimizer = MemAlignOptimizer(\n    reflection_lm="openai:/gpt-5-mini",\n)\n\n# Retrieve traces with human feedback\ntraces = mlflow.search_traces(return_type="list")\n\n# Align the judge\naligned_judge = judge.align(traces=traces, optimizer=optimizer)\n'})}),"\n",(0,r.jsx)(n.h2,{id:"parameters",children:"Parameters"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Parameter"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"reflection_lm"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"str"})}),(0,r.jsx)(n.td,{children:"Required"}),(0,r.jsx)(n.td,{children:"Model used for extracting guidelines from feedback."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"retrieval_k"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"int"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"5"})}),(0,r.jsx)(n.td,{children:"Number of relevant examples to retrieve from episodic memory during inference."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"embedding_model"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"str"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:'"openai:/text-embedding-3-small"'})}),(0,r.jsxs)(n.td,{children:["Model for episodic memory retrieval. Must be in ",(0,r.jsx)(n.code,{children:"<provider>:/<model-name>"})," format."]})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:["Note: The number of parallel threads for LLM calls during guideline distillation can be configured via the ",(0,r.jsx)(n.code,{children:"MLFLOW_GENAI_OPTIMIZE_MAX_WORKERS"})," environment variable (default: 8)."]}),"\n",(0,r.jsx)(n.h2,{id:"inspecting-learned-knowledge",children:"Inspecting Learned Knowledge"}),"\n",(0,r.jsx)(n.p,{children:"After alignment, you can inspect what the judge has learned by viewing the updated instructions:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'# View the updated instructions with distilled guidelines\nprint(aligned_judge.instructions)\n# Output includes appended guidelines like:\n# "Distilled Guidelines (7):\n#   - Responses must be factually accurate...\n#   - Use neutral, descriptive language..."\n'})}),"\n",(0,r.jsx)(n.h2,{id:"removing-feedback-unalignment",children:"Removing Feedback (Unalignment)"}),"\n",(0,r.jsx)(n.p,{children:"If requirements change or feedback was incorrect, you can selectively remove learned knowledge:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'import mlflow\n\n# Retrieve traces with outdated or incorrect feedback\ntraces_to_forget: list[mlflow.entities.Trace] = mlflow.search_traces(\n    filter_string="tag.outdated = \'true\'",\n    return_type="list",\n)\n\n# Remove knowledge derived from those traces\nupdated_judge = aligned_judge.unalign(traces=traces_to_forget)\n'})}),"\n",(0,r.jsx)(n.h2,{id:"debugging",children:"Debugging"}),"\n",(0,r.jsx)(n.p,{children:"To debug the optimization process, enable DEBUG logging:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'import logging\n\nlogging.getLogger("mlflow.genai.judges.optimizers.memalign").setLevel(logging.DEBUG)\naligned_judge = judge.align(traces=traces, optimizer=optimizer)\n'})})]})}function j(e={}){let{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},75689(e,n,i){i.d(n,{A:()=>o});var t=i(96540);let r=e=>{let n=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,n,i)=>i?i.toUpperCase():n.toLowerCase());return n.charAt(0).toUpperCase()+n.slice(1)},l=(...e)=>e.filter((e,n,i)=>!!e&&""!==e.trim()&&i.indexOf(e)===n).join(" ").trim();var s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let a=(0,t.forwardRef)(({color:e="currentColor",size:n=24,strokeWidth:i=2,absoluteStrokeWidth:r,className:a="",children:o,iconNode:d,...c},m)=>(0,t.createElement)("svg",{ref:m,...s,width:n,height:n,stroke:e,strokeWidth:r?24*Number(i)/Number(n):i,className:l("lucide",a),...!o&&!(e=>{for(let n in e)if(n.startsWith("aria-")||"role"===n||"title"===n)return!0})(c)&&{"aria-hidden":"true"},...c},[...d.map(([e,n])=>(0,t.createElement)(e,n)),...Array.isArray(o)?o:[o]])),o=(e,n)=>{let i=(0,t.forwardRef)(({className:i,...s},o)=>(0,t.createElement)(a,{ref:o,iconNode:n,className:l(`lucide-${r(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,i),...s}));return i.displayName=r(e),i}},87073(e,n,i){i.d(n,{A:()=>t});let t=(0,i(75689).A)("brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]])},86589(e,n,i){i.d(n,{A:()=>t});let t=(0,i(75689).A)("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},47792(e,n,i){i.d(n,{A:()=>t});let t=(0,i(75689).A)("target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]])},46858(e,n,i){i.d(n,{A:()=>t});let t=(0,i(75689).A)("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]])},33508(e,n,i){i.d(n,{A:()=>r});var t=i(74848);i(96540);function r({features:e,col:n=2}){return(0,t.jsx)("div",{className:"featureHighlights_Ardf",style:{gridTemplateColumns:`repeat(${n}, 1fr)`},children:e.map((e,n)=>(0,t.jsxs)("div",{className:"highlightItem_XPnN",children:[e.icon&&(0,t.jsx)("div",{className:"highlightIcon_SUR8",children:(0,t.jsx)(e.icon,{size:24})}),(0,t.jsxs)("div",{className:"highlightContent_d0XP",children:[(0,t.jsx)("h4",{children:e.title}),(0,t.jsx)("p",{children:e.description})]})]},n))})}},28453(e,n,i){i.d(n,{R:()=>s,x:()=>a});var t=i(96540);let r={},l=t.createContext(r);function s(e){let n=t.useContext(l);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);