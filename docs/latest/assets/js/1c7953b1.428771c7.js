"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[9072],{28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>s});var r=t(96540);const i={},a=r.createContext(i);function o(e){const n=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(a.Provider,{value:n},e.children)}},42068:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>d,frontMatter:()=>s,metadata:()=>r,toc:()=>p});const r=JSON.parse('{"id":"tracing/app-instrumentation/opentelemetry","title":"Tracing with OpenTelemetry","description":"OpenTelemetry is a CNCF-backed project that provides vendor-neutral observability APIs and SDKs to collect telemetry data from your applications. MLflow Tracing is fully compatible with OpenTelemetry, making it free from vendor lock-in.","source":"@site/docs/genai/tracing/app-instrumentation/opentelemetry.mdx","sourceDirName":"tracing/app-instrumentation","slug":"/tracing/app-instrumentation/opentelemetry","permalink":"/mlflow-website/docs/latest/genai/tracing/app-instrumentation/opentelemetry","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"sidebar_label":"OpenTelemetry"},"sidebar":"genAISidebar","previous":{"title":"Typescript SDK","permalink":"/mlflow-website/docs/latest/genai/tracing/app-instrumentation/typescript-sdk"},"next":{"title":"Auto Tracing Integrations","permalink":"/mlflow-website/docs/latest/genai/tracing/integrations/"}}');var i=t(74848),a=t(28453),o=t(66927);const s={sidebar_position:4,sidebar_label:"OpenTelemetry"},l="Tracing with OpenTelemetry",c={},p=[{value:"Using the MLflow Tracing SDK",id:"using-the-mlflow-tracing-sdk",level:2},{value:"Using Other OpenTelemetry Libraries",id:"using-other-opentelemetry-libraries",level:2},{value:"Combining the OpenTelemetry SDK and the MLflow Tracing SDK",id:"combining-the-opentelemetry-sdk-and-the-mlflow-tracing-sdk",level:2}];function m(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"tracing-with-opentelemetry",children:"Tracing with OpenTelemetry"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://opentelemetry.io/",children:"OpenTelemetry"})," is a CNCF-backed project that provides vendor-neutral observability APIs and SDKs to collect telemetry data from your applications. MLflow Tracing is fully compatible with OpenTelemetry, making it free from vendor lock-in."]}),"\n",(0,i.jsx)(n.h2,{id:"using-the-mlflow-tracing-sdk",children:"Using the MLflow Tracing SDK"}),"\n",(0,i.jsxs)(n.p,{children:["The MLflow Tracing SDK is built on top of the OpenTelemetry SDK. If you want to instrument your AI applications with minimal effort, use the ",(0,i.jsx)(n.a,{href:"/genai/tracing/quickstart/python-openai",children:"MLflow Tracing SDK"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import mlflow\nfrom openai import OpenAI\n\nmlflow.openai.autolog()\n\nclient = OpenAI()\nresponse = client.responses.create(model="gpt-4o-mini", input="Hello, world!")\n'})}),"\n",(0,i.jsx)(n.h2,{id:"using-other-opentelemetry-libraries",children:"Using Other OpenTelemetry Libraries"}),"\n",(0,i.jsxs)(n.p,{children:["You may want to trace LLMs or frameworks that are not ",(0,i.jsx)(n.a,{href:"/genai/tracing/integrations",children:"supported"})," by the MLflow Tracing SDK, or instrument applications written in languages other than Python and TypeScript/JavaScript."]}),"\n",(0,i.jsxs)(n.p,{children:["MLflow Server exposes an OTLP endpoint at ",(0,i.jsx)(n.code,{children:"/v1/traces"})," (",(0,i.jsx)(n.a,{href:"https://opentelemetry.io/docs/specs/otlp/",children:"OTLP"}),") that accepts traces from any OpenTelemetry instrumentation, allowing you to trace applications written in other languages such as Java, Go, Rust, etc. To export traces to MLflow, set ",(0,i.jsx)(n.code,{children:"OTEL_EXPORTER_OTLP_TRACES_ENDPOINT"})," to the MLflow server endpoint and set the ",(0,i.jsx)(n.code,{children:"x-mlflow-experiment-id"})," header to the MLflow experiment ID."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"export OTEL_EXPORTER_OTLP_TRACES_ENDPOINT=http://localhost:5000/v1/traces\nexport OTEL_EXPORTER_OTLP_TRACES_HEADERS=x-mlflow-experiment-id=123\n"})}),"\n",(0,i.jsxs)(n.p,{children:["For more details about the MLflow OpenTelemetry integration, see ",(0,i.jsx)(n.a,{href:"/genai/tracing/opentelemetry/ingest",children:"Collect OpenTelemetry Traces into MLflow"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"combining-the-opentelemetry-sdk-and-the-mlflow-tracing-sdk",children:"Combining the OpenTelemetry SDK and the MLflow Tracing SDK"}),"\n",(0,i.jsxs)(n.p,{children:["Since the MLflow Tracing SDK is built on top of the OpenTelemetry SDK, you can combine them to get the best of both worlds. To use both SDKs in a single application, set the ",(0,i.jsx)(n.code,{children:"MLFLOW_USE_DEFAULT_TRACER_PROVIDER"})," environment variable to ",(0,i.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"The following example shows how to combine MLflow's OpenAI auto-tracing with OpenTelemetry's native FastAPI instrumentation."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import os\nimport mlflow\nfrom contextlib import asynccontextmanager\nfrom fastapi import FastAPI, Request, Response\nfrom openai import OpenAI\nfrom opentelemetry.instrumentation.fastapi import FastAPIInstrumentor\n\n# Use the OpenTelemetry tracer provider instead of MLflow\'s default tracer provider.\nos.environ["MLFLOW_USE_DEFAULT_TRACER_PROVIDER"] = "false"\n\n\n# Enable MLflow OpenAI auto-tracing at application startup.\n@asynccontextmanager\nasync def lifespan(app: FastAPI):\n    mlflow.set_tracking_uri("http://localhost:5000")\n    mlflow.set_experiment("FastAPI")\n    mlflow.openai.autolog()\n    yield\n\n\napp = FastAPI(lifespan=lifespan)\n# Enable FastAPI auto-instrumentation, which creates an OpenTelemetry span for each endpoint call.\nFastAPIInstrumentor.instrument_app(app)\n\n\n@app.post("/rag/v1/answer")\n@mlflow.trace\nasync def answer_question(query: Request) -> Response:\n    return ...\n'})}),"\n",(0,i.jsx)(n.p,{children:"Spans generated from both SDKs will be merged into a single trace."}),"\n",(0,i.jsx)(o.A,{src:"/images/llms/tracing/opentelemetry/mlflow-otel-combined.png",alt:"The MLflow UI showing the MLflow and OpenTelemetry combined spans",width:"100%"})]})}function d(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(m,{...e})}):m(e)}},66927:(e,n,t)=>{t.d(n,{A:()=>o});t(96540);const r={container:"container_JwLF",imageWrapper:"imageWrapper_RfGN",image:"image_bwOA",caption:"caption_jo2G"};var i=t(86025),a=t(74848);function o({src:e,alt:n,width:t,caption:o,className:s}){return(0,a.jsxs)("div",{className:`${r.container} ${s||""}`,children:[(0,a.jsx)("div",{className:r.imageWrapper,style:t?{width:t}:{},children:(0,a.jsx)("img",{src:(0,i.default)(e),alt:n,className:r.image})}),o&&(0,a.jsx)("p",{className:r.caption,children:o})]})}}}]);