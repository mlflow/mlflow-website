"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([["2970"],{88478(e,n,t){t.r(n),t.d(n,{metadata:()=>l,default:()=>h,frontMatter:()=>s,contentTitle:()=>c,toc:()=>f,assets:()=>p});var l=JSON.parse('{"id":"tracing/integrations/listing/crewai","title":"Tracing CrewAI","description":"CrewAI is an open-source framework for orchestrating role-playing, autonomous AI agent.","source":"@site/docs/genai/tracing/integrations/listing/crewai.mdx","sourceDirName":"tracing/integrations/listing","slug":"/tracing/integrations/listing/crewai","permalink":"/mlflow-website/docs/latest/genai/tracing/integrations/listing/crewai","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7,"sidebar_label":"CrewAI"},"sidebar":"genAISidebar","previous":{"title":"AutoGen","permalink":"/mlflow-website/docs/latest/genai/tracing/integrations/listing/autogen"},"next":{"title":"DSPy","permalink":"/mlflow-website/docs/latest/genai/tracing/integrations/listing/dspy"}}'),a=t(74848),o=t(28453),r=t(66497),i=t(54725);let s={sidebar_position:7,sidebar_label:"CrewAI"},c="Tracing CrewAI",p={},f=[{value:"Example Usage",id:"example-usage",level:3},{value:"Token usage",id:"token-usage",level:2},{value:"Disable auto-tracing",id:"disable-auto-tracing",level:3}];function m(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"tracing-crewai",children:"Tracing CrewAI"})}),"\n",(0,a.jsx)("video",{src:(0,r.default)("/images/llms/crewai/crewai-tracing.mp4"),controls:!0,loop:!0,autoPlay:!0,muted:!0,"aria-label":"CrewAI Tracing via autolog"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://www.crewai.com/",children:"CrewAI"})," is an open-source framework for orchestrating role-playing, autonomous AI agent."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"../../",children:"MLflow Tracing"})," provides automatic tracing capability for ",(0,a.jsx)(n.a,{href:"https://www.crewai.com/",children:"CrewAI"}),", an open source framework for building multi-agent applications. By enabling auto tracing\nfor CrewAI by calling the ",(0,a.jsx)(i.B,{fn:"mlflow.crewai.autolog"})," function, , MLflow will capture nested traces for CrewAI workflow execution and logged them to the active MLflow Experiment."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"import mlflow\n\nmlflow.crewai.autolog()\n"})}),"\n",(0,a.jsx)(n.p,{children:"MLflow trace automatically captures the following information about CrewAI agents:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Tasks and Agent who executes each task"}),"\n",(0,a.jsx)(n.li,{children:"Every LLM calls with input prompts, completion responses, and various metadata"}),"\n",(0,a.jsx)(n.li,{children:"Memory load and writes operations"}),"\n",(0,a.jsx)(n.li,{children:"Latency of each operation"}),"\n",(0,a.jsx)(n.li,{children:"Any exception if raised"}),"\n"]}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsx)(n.p,{children:"Currently, MLflow CrewAI integration only support tracing for synchronous task execution. Asynchronous task and kickoff are not supported right now."})}),"\n",(0,a.jsx)(n.h3,{id:"example-usage",children:"Example Usage"}),"\n",(0,a.jsx)(n.p,{children:"First, enable auto-tracing for CrewAI, and optionally create an MLflow experiment to write traces to. This helps organizing your traces better."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'import mlflow\n\n# Turn on auto tracing by calling mlflow.crewai.autolog()\nmlflow.crewai.autolog()\n\n\n# Optional: Set a tracking URI and an experiment\nmlflow.set_tracking_uri("http://localhost:5000")\nmlflow.set_experiment("CrewAI")\n'})}),"\n",(0,a.jsx)(n.p,{children:"Next, define a multi-agent workflow using CrewAI. The following example defines a trip planner agent that uses web search capability as a tool."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'from crewai import Agent, Crew, Task\nfrom crewai.knowledge.source.string_knowledge_source import StringKnowledgeSource\nfrom crewai_tools import SerperDevTool, WebsiteSearchTool\n\nfrom textwrap import dedent\n\ncontent = "Users name is John. He is 30 years old and lives in San Francisco."\nstring_source = StringKnowledgeSource(\n    content=content, metadata={"preference": "personal"}\n)\n\nsearch_tool = WebsiteSearchTool()\n\n\nclass TripAgents:\n    def city_selection_agent(self):\n        return Agent(\n            role="City Selection Expert",\n            goal="Select the best city based on weather, season, and prices",\n            backstory="An expert in analyzing travel data to pick ideal destinations",\n            tools=[\n                search_tool,\n            ],\n            verbose=True,\n        )\n\n    def local_expert(self):\n        return Agent(\n            role="Local Expert at this city",\n            goal="Provide the BEST insights about the selected city",\n            backstory="""A knowledgeable local guide with extensive information\n        about the city, it\'s attractions and customs""",\n            tools=[search_tool],\n            verbose=True,\n        )\n\n\nclass TripTasks:\n    def identify_task(self, agent, origin, cities, interests, range):\n        return Task(\n            description=dedent(\n                f"""\n                Analyze and select the best city for the trip based\n                on specific criteria such as weather patterns, seasonal\n                events, and travel costs. This task involves comparing\n                multiple cities, considering factors like current weather\n                conditions, upcoming cultural or seasonal events, and\n                overall travel expenses.\n                Your final answer must be a detailed\n                report on the chosen city, and everything you found out\n                about it, including the actual flight costs, weather\n                forecast and attractions.\n\n                Traveling from: {origin}\n                City Options: {cities}\n                Trip Date: {range}\n                Traveler Interests: {interests}\n            """\n            ),\n            agent=agent,\n            expected_output="Detailed report on the chosen city including flight costs, weather forecast, and attractions",\n        )\n\n    def gather_task(self, agent, origin, interests, range):\n        return Task(\n            description=dedent(\n                f"""\n                As a local expert on this city you must compile an\n                in-depth guide for someone traveling there and wanting\n                to have THE BEST trip ever!\n                Gather information about key attractions, local customs,\n                special events, and daily activity recommendations.\n                Find the best spots to go to, the kind of place only a\n                local would know.\n                This guide should provide a thorough overview of what\n                the city has to offer, including hidden gems, cultural\n                hotspots, must-visit landmarks, weather forecasts, and\n                high level costs.\n                The final answer must be a comprehensive city guide,\n                rich in cultural insights and practical tips,\n                tailored to enhance the travel experience.\n\n                Trip Date: {range}\n                Traveling from: {origin}\n                Traveler Interests: {interests}\n            """\n            ),\n            agent=agent,\n            expected_output="Comprehensive city guide including hidden gems, cultural hotspots, and practical travel tips",\n        )\n\n\nclass TripCrew:\n    def __init__(self, origin, cities, date_range, interests):\n        self.cities = cities\n        self.origin = origin\n        self.interests = interests\n        self.date_range = date_range\n\n    def run(self):\n        agents = TripAgents()\n        tasks = TripTasks()\n\n        city_selector_agent = agents.city_selection_agent()\n        local_expert_agent = agents.local_expert()\n\n        identify_task = tasks.identify_task(\n            city_selector_agent,\n            self.origin,\n            self.cities,\n            self.interests,\n            self.date_range,\n        )\n        gather_task = tasks.gather_task(\n            local_expert_agent, self.origin, self.interests, self.date_range\n        )\n\n        crew = Crew(\n            agents=[city_selector_agent, local_expert_agent],\n            tasks=[identify_task, gather_task],\n            verbose=True,\n            memory=True,\n            knowledge={\n                "collection_name": "crewai_example",\n                "sources": [string_source],\n                "metadata": {"preference": "personal"},\n            },\n        )\n\n        result = crew.kickoff()\n        return result\n\n\ntrip_crew = TripCrew("California", "Tokyo", "Dec 12 - Dec 20", "sports")\nresult = trip_crew.run()\n'})}),"\n",(0,a.jsx)(n.h2,{id:"token-usage",children:"Token usage"}),"\n",(0,a.jsxs)(n.p,{children:["MLflow >= 3.5.0 supports token usage tracking for CrewAI. The token usage for each LLM call will be logged in the ",(0,a.jsx)(n.code,{children:"mlflow.chat.tokenUsage"})," attribute. The total token usage throughout the trace will be\navailable in the ",(0,a.jsx)(n.code,{children:"token_usage"})," field of the trace info object."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'import json\nimport mlflow\n\nmlflow.crewai.autolog()\n\n# Run the tool calling agent defined in the previous section\ntrip_crew = TripCrew("California", "Tokyo", "Dec 12 - Dec 20", "sports")\nresult = trip_crew.run()\n\n# Get the trace object just created\nlast_trace_id = mlflow.get_last_active_trace_id()\ntrace = mlflow.get_trace(trace_id=last_trace_id)\n\n# Print the token usage\ntotal_usage = trace.info.token_usage\nprint("== Total token usage: ==")\nprint(f"  Input tokens: {total_usage[\'input_tokens\']}")\nprint(f"  Output tokens: {total_usage[\'output_tokens\']}")\nprint(f"  Total tokens: {total_usage[\'total_tokens\']}")\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"== Total token usage: ==\n  Input tokens: 32870\n  Output tokens: 1826\n  Total tokens: 34696\n\n== Detailed usage for each LLM call: ==\nLLM.call_1:\n  Input tokens: 295\n  Output tokens: 63\n  Total tokens: 358\nLLM.call_2:\n  Input tokens: 465\n  Output tokens: 65\n  Total tokens: 530\nLLM.call_3:\n  Input tokens: 4445\n  Output tokens: 76\n  Total tokens: 4521\n\n... (other modules)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"disable-auto-tracing",children:"Disable auto-tracing"}),"\n",(0,a.jsxs)(n.p,{children:["Auto tracing for CrewAI can be disabled globally by calling ",(0,a.jsx)(n.code,{children:"mlflow.crewai.autolog(disable=True)"})," or ",(0,a.jsx)(n.code,{children:"mlflow.autolog(disable=True)"}),"."]})]})}function h(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(m,{...e})}):m(e)}},54725(e,n,t){t.d(n,{B:()=>r});var l=t(74848);t(96540);var a=JSON.parse('{"mlflow.ag2":"api_reference/python_api/mlflow.ag2.html","mlflow.agno":"api_reference/python_api/mlflow.agno.html","mlflow.anthropic":"api_reference/python_api/mlflow.anthropic.html","mlflow.artifacts":"api_reference/python_api/mlflow.artifacts.html","mlflow.autogen":"api_reference/python_api/mlflow.autogen.html","mlflow.bedrock":"api_reference/python_api/mlflow.bedrock.html","mlflow.catboost":"api_reference/python_api/mlflow.catboost.html","mlflow.client":"api_reference/python_api/mlflow.client.html","mlflow.config":"api_reference/python_api/mlflow.config.html","mlflow.crewai":"api_reference/python_api/mlflow.crewai.html","mlflow.data":"api_reference/python_api/mlflow.data.html","mlflow.deployments":"api_reference/python_api/mlflow.deployments.html","mlflow.diviner":"api_reference/python_api/mlflow.diviner.html","mlflow.dspy":"api_reference/python_api/mlflow.dspy.html","mlflow.entities":"api_reference/python_api/mlflow.entities.html","mlflow.environment_variables":"api_reference/python_api/mlflow.environment_variables.html","mlflow.gateway":"api_reference/python_api/mlflow.gateway.html","mlflow.gemini":"api_reference/python_api/mlflow.gemini.html","mlflow.genai":"api_reference/python_api/mlflow.genai.html","mlflow.groq":"api_reference/python_api/mlflow.groq.html","mlflow.h2o":"api_reference/python_api/mlflow.h2o.html","mlflow.johnsnowlabs":"api_reference/python_api/mlflow.johnsnowlabs.html","mlflow.keras":"api_reference/python_api/mlflow.keras.html","mlflow.langchain":"api_reference/python_api/mlflow.langchain.html","mlflow.lightgbm":"api_reference/python_api/mlflow.lightgbm.html","mlflow.litellm":"api_reference/python_api/mlflow.litellm.html","mlflow.llama_index":"api_reference/python_api/mlflow.llama_index.html","mlflow.metrics":"api_reference/python_api/mlflow.metrics.html","mlflow.mistral":"api_reference/python_api/mlflow.mistral.html","mlflow.models":"api_reference/python_api/mlflow.models.html","mlflow.onnx":"api_reference/python_api/mlflow.onnx.html","mlflow.openai":"api_reference/python_api/mlflow.openai.html","mlflow.paddle":"api_reference/python_api/mlflow.paddle.html","mlflow.pmdarima":"api_reference/python_api/mlflow.pmdarima.html","mlflow.projects":"api_reference/python_api/mlflow.projects.html","mlflow.prophet":"api_reference/python_api/mlflow.prophet.html","mlflow.pydantic_ai":"api_reference/python_api/mlflow.pydantic_ai.html","mlflow.pyfunc":"api_reference/python_api/mlflow.pyfunc.html","mlflow.pyspark.ml":"api_reference/python_api/mlflow.pyspark.ml.html","mlflow.pytorch":"api_reference/python_api/mlflow.pytorch.html","mlflow":"api_reference/python_api/mlflow.html","mlflow.sagemaker":"api_reference/python_api/mlflow.sagemaker.html","mlflow.sentence_transformers":"api_reference/python_api/mlflow.sentence_transformers.html","mlflow.server":"api_reference/python_api/mlflow.server.html","mlflow.shap":"api_reference/python_api/mlflow.shap.html","mlflow.sklearn":"api_reference/python_api/mlflow.sklearn.html","mlflow.smolagents":"api_reference/python_api/mlflow.smolagents.html","mlflow.spacy":"api_reference/python_api/mlflow.spacy.html","mlflow.spark":"api_reference/python_api/mlflow.spark.html","mlflow.statsmodels":"api_reference/python_api/mlflow.statsmodels.html","mlflow.system_metrics":"api_reference/python_api/mlflow.system_metrics.html","mlflow.tensorflow":"api_reference/python_api/mlflow.tensorflow.html","mlflow.tracing":"api_reference/python_api/mlflow.tracing.html","mlflow.transformers":"api_reference/python_api/mlflow.transformers.html","mlflow.types":"api_reference/python_api/mlflow.types.html","mlflow.utils":"api_reference/python_api/mlflow.utils.html","mlflow.webhooks":"api_reference/python_api/mlflow.webhooks.html","mlflow.xgboost":"api_reference/python_api/mlflow.xgboost.html","mlflow.server.auth":"api_reference/auth/python-api.html","mlflow.server.cli":"api_reference/cli.html","mlflow.r":"api_reference/R-api.html","mlflow.java":"api_reference/java_api/index.html","mlflow.python":"api_reference/python_api/index.html","mlflow.rest":"api_reference/rest-api.html","mlflow.typescript":"api_reference/typescript_api/index.html","mlflow.llms.deployments.api":"api_reference/llms/deployments/api.html"}'),o=t(66497);function r({fn:e,children:n,hash:t}){let r=(e=>{let n=e.split(".");for(let e=n.length;e>0;e--){let t=n.slice(0,e).join(".");if(a[t])return t}return null})(e);if(!r)return(0,l.jsx)(l.Fragment,{children:n});let i=(0,o.default)(`/${a[r]}#${t??e}`);return(0,l.jsx)("a",{href:i,target:"_blank",children:n??(0,l.jsxs)("code",{children:[e,"()"]})})}},28453(e,n,t){t.d(n,{R:()=>r,x:()=>i});var l=t(96540);let a={},o=l.createContext(a);function r(e){let n=l.useContext(o);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),l.createElement(o.Provider,{value:n},e.children)}}}]);