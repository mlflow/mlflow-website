
  

<!DOCTYPE html>
<!-- source: docs/source/model/notebooks/signature_examples.ipynb -->
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>MLflow Signature Playground Notebook &mdash; MLflow 2.14.4.dev0 documentation</title>
  
   
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="canonical" href="https://mlflow.org/docs/latest/model/notebooks/signature_examples.html">
  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    

    

  
    
        <!-- Google Tag Manager -->
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer',"GTM-N6WMTTJ");</script>
        <!-- End Google Tag Manager -->
    

  

  
  
    

  

  
  
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600" rel="stylesheet">
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/cards.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/grids.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/mobile.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/simple-cards.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/tabs.css" type="text/css" />
    
  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="MLflow 2.14.4.dev0 documentation" href="../../index.html"/>
        <link rel="up" title="MLflow Model Signatures and Input Examples Guide" href="../signatures.html"/>
        <link rel="next" title="MLflow Model Registry" href="/../../model-registry.html"/>
        <link rel="prev" title="MLflow Model Signatures and Input Examples Guide" href="/../signatures.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>
<script type="text/javascript" src="../../_static/jquery.js"></script>
<script type="text/javascript" src="../../_static/underscore.js"></script>
<script type="text/javascript" src="../../_static/doctools.js"></script>
<script type="text/javascript" src="../../_static/languagesections.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/javascript" src="../../None"></script>

<body class="wy-body-for-nav" role="document">
  
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N6WMTTJ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
  

  
  <nav class="wy-nav-top header" role="navigation" aria-label="top navigation">
    <ul>
  <li class="menu-toggle">
    <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
    <a href="../../index.html" class="wy-nav-top-logo"
      ><img src="../../_static/MLflow-logo-final-black.png" alt="MLflow"
    /></a>
    <span class="version">2.14.4.dev0</span>
  </li>
</ul>
  </nav>
  <page>
    

    <nav data-toggle="wy-nav-shift" class="wy-nav-side relative">
      <div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
  </form>
</div>


    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../../index.html" class="main-navigation-home"><img src="../../_static/icons/nav-home.svg"> MLflow</a>
    

    
      

      
        <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">What is MLflow?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/index.html">Getting Started with MLflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../new-features/index.html">New Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../llms/index.html">LLMs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../model-evaluation/index.html">Model Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deep-learning/index.html">Deep Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../traditional-ml/index.html">Traditional ML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deployment/index.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tracking.html">MLflow Tracking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../system-metrics/index.html">System Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../projects.html">MLflow Projects</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../models.html">MLflow Models</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../models.html#storage-format">Storage Format</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models.html#managing-model-dependencies">Managing Model Dependencies</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../models.html#model-signatures-and-input-examples">Model Signatures And Input Examples</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../signatures.html">MLflow Model Signatures and Input Examples Guide</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../signatures.html#introduction-to-model-signatures-and-input-examples">Introduction to Model Signatures and Input Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="../signatures.html#why-are-these-important">Why are these important?</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../signatures.html#id1">Model Signature</a></li>
<li class="toctree-l4"><a class="reference internal" href="../signatures.html#model-signature-types">Model Signature Types</a></li>
<li class="toctree-l4"><a class="reference internal" href="../signatures.html#signature-enforcement">Signature Enforcement</a></li>
<li class="toctree-l4"><a class="reference internal" href="../signatures.html#how-to-log-models-with-signatures">How To Log Models With Signatures</a></li>
<li class="toctree-l4"><a class="reference internal" href="../signatures.html#how-to-set-signatures-on-models">How To Set Signatures on Models</a></li>
<li class="toctree-l4"><a class="reference internal" href="../signatures.html#setting-a-signature-on-a-registered-model">Setting a Signature on a Registered Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../signatures.html#input-example">Model Input Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../models.html#model-api">Model API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models.html#built-in-model-flavors">Built-In Model Flavors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models.html#model-evaluation">Model Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models.html#model-customization">Model Customization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models.html#built-in-deployment-tools">Built-In Deployment Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models.html#export-a-python-function-model-as-an-apache-spark-udf">Export a <code class="docutils literal notranslate"><span class="pre">python_function</span></code> model as an Apache Spark UDF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models.html#deployment-to-custom-targets">Deployment to Custom Targets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models.html#id11">Community Model Flavors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../model-registry.html">MLflow Model Registry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../recipes.html">MLflow Recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins.html">MLflow Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../auth/index.html">MLflow Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli.html">Command-Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../search-runs.html">Search Runs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../search-experiments.html">Search Experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python_api/index.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../R-api.html">R API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../java_api/index.html">Java API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rest-api.html">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docker.html">Official MLflow Docker Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community-model-flavors.html">Community Model Flavors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials-and-examples/index.html">Tutorials and Examples</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    

    <p>
      <a id='feedbacklink' href="https://github.com/mlflow/mlflow/blob/master/CONTRIBUTING.md" target="_blank">Contribute</a>
    </p>
  </div>
</div>
    </nav>

    <main class="wy-grid-for-nav">
      <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
        <div class="wy-nav-content">
          <div class="rst-content">
            










<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
        <li><a href="../../models.html">MLflow Models</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
        <li><a href="../signatures.html">MLflow Model Signatures and Input Examples Guide</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>MLflow Signature Playground Notebook</li>
    
    
    <!-- <li class="wy-breadcrumbs-aside">
      <a href="https://github.com/mlflow/mlflow/blob/master/docs/source/model/notebooks/signature_examples.ipynb" class="fa fa-github"> Edit on GitHub</a>
    </li> -->
    
  </ul>
</div>
            <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
              <div itemprop="articleBody">
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="MLflow-Signature-Playground-Notebook">
<h1>MLflow Signature Playground Notebook<a class="headerlink" href="#MLflow-Signature-Playground-Notebook" title="Permalink to this headline"> </a></h1>
<p>Welcome to the MLflow Signature Playground! This interactive Jupyter notebook is designed to guide you through the foundational concepts of <a class="reference external" href="https://mlflow.org/docs/latest/model/signatures.html">Model Signatures</a> within the MLflow ecosystem. As you progress through the notebook, you’ll gain practical experience with defining, enforcing, and utilizing model signatures—a critical aspect of model management that enhances reproducibility, reliability, and ease of use.</p>
<div class="section" id="Why-Model-Signatures-Matter">
<h2>Why Model Signatures Matter<a class="headerlink" href="#Why-Model-Signatures-Matter" title="Permalink to this headline"> </a></h2>
<p>In the realm of machine learning, defining the inputs and outputs of models with precision is key to ensuring smooth operations. Model signatures serve as the schema definition for the data your model expects and produces, acting as a blueprint for both model developers and users. This not only clarifies expectations but also facilitates automatic validation checks, streamlining the process from model training to deployment.</p>
</div>
<div class="section" id="Signature-Enforcement-in-Action">
<h2>Signature Enforcement in Action<a class="headerlink" href="#Signature-Enforcement-in-Action" title="Permalink to this headline"> </a></h2>
<p>By exploring the code cells in this notebook, you’ll witness firsthand how model signatures can enforce data integrity, prevent common errors, and provide descriptive feedback when discrepancies occur. This is invaluable for maintaining the quality and consistency of model inputs, especially when models are served in production environments.</p>
</div>
<div class="section" id="Practical-Examples-for-a-Deeper-Understanding">
<h2>Practical Examples for a Deeper Understanding<a class="headerlink" href="#Practical-Examples-for-a-Deeper-Understanding" title="Permalink to this headline"> </a></h2>
<p>The notebook includes a range of examples showcasing different data types and structures, from simple scalars to complex nested dictionaries. These examples demonstrate how signatures are inferred, logged, and updated, providing you with a comprehensive understanding of the signature lifecycle. As you interact with the provided PythonModel instances and invoke their predict methods, you’ll learn how to handle various input scenarios—accounting for both required and optional data fields—and how
to update existing models to include detailed signatures. Whether you’re a data scientist looking to refine your model management practices or a developer integrating MLflow into your workflow, this notebook is your sandbox for mastering model signatures. Let’s dive in and explore the robust capabilities of MLflow signatures!</p>
<blockquote>
<div><p>NOTE: Several of the features shown in this notebook are only available in version 2.10.0 and higher of MLflow. In particular, the support for the <code class="docutils literal notranslate"><span class="pre">Array</span></code> and <code class="docutils literal notranslate"><span class="pre">Object</span></code> types are not available prior to version 2.10.0.</p>
</div></blockquote>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">from</span> <span class="nn">mlflow.models.signature</span> <span class="kn">import</span> <span class="n">infer_signature</span><span class="p">,</span> <span class="n">set_signature</span>


<span class="k">def</span> <span class="nf">report_signature_info</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">output_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">inferred_signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">output_data</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

    <span class="n">report</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">The input data: </span><span class="se">\n\t</span><span class="si">{</span><span class="n">input_data</span><span class="si">}</span><span class="s2">.</span>
<span class="s2">The data is of type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span><span class="si">}</span><span class="s2">.</span>
<span class="s2">The inferred signature is:</span><span class="se">\n\n</span><span class="si">{</span><span class="n">inferred_signature</span><span class="si">}</span>
<span class="s2">&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Scalar-Support-in-MLflow-Signatures">
<h2>Scalar Support in MLflow Signatures<a class="headerlink" href="#Scalar-Support-in-MLflow-Signatures" title="Permalink to this headline"> </a></h2>
<p>In this segment of the tutorial, we explore the critical role of scalar data types in the context of MLflow’s model signatures. Scalar types, such as strings, integers, floats, doubles, booleans, and datetimes, are fundamental to defining the schema for a model’s input and output. Accurate representation of these types is essential for ensuring that models process data correctly, which directly impacts the reliability and accuracy of predictions.</p>
<p>By examining examples of various scalar types, this section demonstrates how MLflow infers and records the structure and nature of data. We’ll see how MLflow signatures cater to different scalar types, ensuring that the data fed into the model matches the expected format. This understanding is crucial for any machine learning practitioner, as it helps in preparing and validating data inputs, leading to smoother model operations and more reliable results.</p>
<p>Through practical examples, including lists of strings, floats, and other types, we illustrate how MLflow’s <code class="docutils literal notranslate"><span class="pre">infer_signature</span></code> function can accurately deduce the data format. This capability is a cornerstone in MLflow’s ability to handle diverse data inputs and forms the basis for more complex data structures in machine learning models. By the end of this section, you’ll have a clear grasp of how scalar data is represented within MLflow signatures and why this is important for your ML projects.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># List of strings</span>

<span class="n">report_signature_info</span><span class="p">([</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;list&quot;</span><span class="p">,</span> <span class="s2">&quot;of&quot;</span><span class="p">,</span> <span class="s2">&quot;strings&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

The input data:
        [&#39;a&#39;, &#39;list&#39;, &#39;of&#39;, &#39;strings&#39;].
The data is of type: &lt;class &#39;list&#39;&gt;.
The inferred signature is:

inputs:
  [string (required)]
outputs:
  None
params:
  None


</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># List of floats</span>

<span class="n">report_signature_info</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mf">0.117</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mf">1.99</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

The input data:
        [0.117, 1.99].
The data is of type: &lt;class &#39;list&#39;&gt;.
The inferred signature is:

inputs:
  [float (required)]
outputs:
  None
params:
  None


</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Adding a column header to a list of doubles</span>
<span class="n">my_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;input_data&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.117</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">1.99</span><span class="p">)]})</span>
<span class="n">report_signature_info</span><span class="p">(</span><span class="n">my_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

The input data:
           input_data
0       0.117
1       1.990.
The data is of type: &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;.
The inferred signature is:

inputs:
  [&#39;input_data&#39;: double (required)]
outputs:
  None
params:
  None


</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># List of Dictionaries</span>
<span class="n">report_signature_info</span><span class="p">([{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;a1&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="s2">&quot;b1&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;a2&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="s2">&quot;b2&quot;</span><span class="p">}])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

The input data:
        [{&#39;a&#39;: &#39;a1&#39;, &#39;b&#39;: &#39;b1&#39;}, {&#39;a&#39;: &#39;a2&#39;, &#39;b&#39;: &#39;b2&#39;}].
The data is of type: &lt;class &#39;list&#39;&gt;.
The inferred signature is:

inputs:
  [&#39;a&#39;: string (required), &#39;b&#39;: string (required)]
outputs:
  None
params:
  None


</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># List of Arrays of strings</span>
<span class="n">report_signature_info</span><span class="p">([[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

The input data:
        [[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;], [&#39;d&#39;, &#39;e&#39;, &#39;f&#39;]].
The data is of type: &lt;class &#39;list&#39;&gt;.
The inferred signature is:

inputs:
  [Array(string) (required)]
outputs:
  None
params:
  None


</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># List of Arrays of Dictionaries</span>
<span class="n">report_signature_info</span><span class="p">(</span>
    <span class="p">[[{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span><span class="p">}],</span> <span class="p">[{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span><span class="p">}]]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

The input data:
        [[{&#39;a&#39;: &#39;a&#39;, &#39;b&#39;: &#39;b&#39;}, {&#39;a&#39;: &#39;a&#39;, &#39;b&#39;: &#39;b&#39;}], [{&#39;a&#39;: &#39;a&#39;, &#39;b&#39;: &#39;b&#39;}, {&#39;a&#39;: &#39;a&#39;, &#39;b&#39;: &#39;b&#39;}]].
The data is of type: &lt;class &#39;list&#39;&gt;.
The inferred signature is:

inputs:
  [Array({a: string (required), b: string (required)}) (required)]
outputs:
  None
params:
  None


</pre></div></div>
</div>
</div>
<div class="section" id="Understanding-Type-Conversion:-Int-to-Long">
<h2>Understanding Type Conversion: Int to Long<a class="headerlink" href="#Understanding-Type-Conversion:-Int-to-Long" title="Permalink to this headline"> </a></h2>
<p>In this section of the tutorial, we observe an interesting aspect of type conversion in MLflow’s schema inference. When reporting the signature information for a list of integers, you might notice that the inferred data type is <code class="docutils literal notranslate"><span class="pre">long</span></code> instead of <code class="docutils literal notranslate"><span class="pre">int</span></code>. This conversion from int to long is not an error or bug but a valid and intentional type conversion within MLflow’s schema inference mechanism.</p>
<div class="section" id="Why-Integers-are-Inferred-as-Long">
<h3>Why Integers are Inferred as Long<a class="headerlink" href="#Why-Integers-are-Inferred-as-Long" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p><strong>Broader Compatibility:</strong> The conversion to <code class="docutils literal notranslate"><span class="pre">long</span></code> ensures compatibility across various platforms and systems. Since the size of an integer (int) can vary depending on the system architecture, using <code class="docutils literal notranslate"><span class="pre">long</span></code> (which has a more consistent size specification) avoids potential discrepancies and data overflow issues.</p></li>
<li><p><strong>Data Integrity:</strong> By inferring integers as long, MLflow ensures that larger integer values, which might exceed the typical capacity of an int, are accurately represented and handled without data loss or overflow.</p></li>
<li><p><strong>Consistency in Machine Learning Models:</strong> In many machine learning frameworks, especially those involving larger datasets or computations, long integers are often the standard data type for numerical operations. This standardization in the inferred schema aligns with common practices in the machine learning community.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># List of integers</span>
<span class="n">report_signature_info</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

The input data:
        [1, 2, 3].
The data is of type: &lt;class &#39;list&#39;&gt;.
The inferred signature is:

inputs:
  [long (required)]
outputs:
  None
params:
  None


</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/benjamin.wilson/repos/mlflow-fork/mlflow/mlflow/types/utils.py:378: UserWarning: Hint: Inferred schema contains integer column(s). Integer columns in Python cannot represent missing values. If your input data contains missing values at inference time, it will be encoded as floats and will cause a schema enforcement error. The best way to avoid this problem is to infer the model schema based on a realistic data sample (training dataset) that includes missing values. Alternatively, you can declare integer columns as doubles (float64) whenever these columns may have missing values. See `Handling Integers With Missing Values &lt;https://www.mlflow.org/docs/latest/models.html#handling-integers-with-missing-values&gt;`_ for more details.
  warnings.warn(
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># List of Booleans</span>
<span class="n">report_signature_info</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

The input data:
        [True, False, False, False, True].
The data is of type: &lt;class &#39;list&#39;&gt;.
The inferred signature is:

inputs:
  [boolean (required)]
outputs:
  None
params:
  None


</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># List of Datetimes</span>
<span class="n">report_signature_info</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s2">&quot;2023-12-24 11:59:59&quot;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s2">&quot;2023-12-25 00:00:00&quot;</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

The input data:
        [numpy.datetime64(&#39;2023-12-24T11:59:59&#39;), numpy.datetime64(&#39;2023-12-25T00:00:00&#39;)].
The data is of type: &lt;class &#39;list&#39;&gt;.
The inferred signature is:

inputs:
  [datetime (required)]
outputs:
  None
params:
  None


</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Complex list of Dictionaries</span>
<span class="n">report_signature_info</span><span class="p">([{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;d&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]}}])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

The input data:
        [{&#39;a&#39;: &#39;b&#39;, &#39;b&#39;: [1, 2, 3], &#39;c&#39;: {&#39;d&#39;: [4, 5, 6]}}].
The data is of type: &lt;class &#39;list&#39;&gt;.
The inferred signature is:

inputs:
  [&#39;a&#39;: string (required), &#39;b&#39;: Array(long) (required), &#39;c&#39;: {d: Array(long) (required)} (required)]
outputs:
  None
params:
  None


</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pandas DF input</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">],</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;d&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">},</span> <span class="s2">&quot;f&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;g&quot;</span><span class="p">:</span> <span class="s2">&quot;g&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;h&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}]},</span>
    <span class="p">{</span><span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">],</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;d&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">:</span> <span class="s2">&quot;f&quot;</span><span class="p">},</span> <span class="s2">&quot;f&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;g&quot;</span><span class="p">:</span> <span class="s2">&quot;g&quot;</span><span class="p">}]},</span>
<span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">report_signature_info</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

The input data:
             a          b                   c                       f
0    a  [a, b, c]  {&#39;d&#39;: 1, &#39;e&#39;: 0.1}  [{&#39;g&#39;: &#39;g&#39;}, {&#39;h&#39;: 1}]
1  NaN     [a, b]  {&#39;d&#39;: 2, &#39;f&#39;: &#39;f&#39;}            [{&#39;g&#39;: &#39;g&#39;}].
The data is of type: &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;.
The inferred signature is:

inputs:
  [&#39;a&#39;: string (optional), &#39;b&#39;: Array(string) (required), &#39;c&#39;: {d: long (required), e: double (optional), f: string (optional)} (required), &#39;f&#39;: Array({g: string (optional), h: long (optional)}) (required)]
outputs:
  None
params:
  None


</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Signature-Enforcement">
<h2>Signature Enforcement<a class="headerlink" href="#Signature-Enforcement" title="Permalink to this headline"> </a></h2>
<p>In this part of the tutorial, we focus on the practical application of signature enforcement in MLflow. Signature enforcement is a powerful feature that ensures the data provided to a model aligns with the defined input schema. This step is crucial in preventing errors and inconsistencies that can arise from mismatched or incorrectly formatted data.</p>
<p>Through hands-on examples, we will observe how MLflow enforces the conformity of data to the expected signature at runtime. We’ll use the <code class="docutils literal notranslate"><span class="pre">MyModel</span></code> class, a simple Python model, to demonstrate how MLflow checks the compatibility of input data against the model’s signature. This process helps in safeguarding the model against incompatible or erroneous inputs, thereby enhancing the robustness and reliability of model predictions.</p>
<p>This section also highlights the importance of precise data representation in MLflow and the implications it has on model performance. By testing with different types of data, including those that do not conform to the expected schema, we will see how MLflow validates data and provides informative feedback. This aspect of signature enforcement is invaluable for debugging data issues and refining model inputs, making it a key skill for anyone involved in deploying machine learning models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">PythonModel</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">model_input</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">model_input</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">],</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;d&quot;</span><span class="p">:</span> <span class="s2">&quot;d&quot;</span><span class="p">}},</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">],</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;d&quot;</span><span class="p">:</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">:</span> <span class="s2">&quot;e&quot;</span><span class="p">}}]</span>

<span class="n">report_signature_info</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

The input data:
        [{&#39;a&#39;: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;], &#39;b&#39;: &#39;b&#39;, &#39;c&#39;: {&#39;d&#39;: &#39;d&#39;}}, {&#39;a&#39;: [&#39;a&#39;], &#39;c&#39;: {&#39;d&#39;: &#39;d&#39;, &#39;e&#39;: &#39;e&#39;}}].
The data is of type: &lt;class &#39;list&#39;&gt;.
The inferred signature is:

inputs:
  [&#39;a&#39;: Array(string) (required), &#39;b&#39;: string (optional), &#39;c&#39;: {d: string (required), e: string (optional)} (required)]
outputs:
  None
params:
  None


</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate a prediction that will serve as the model output example for signature inference</span>
<span class="n">model_output</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">()</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model_input</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">model_info</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">python_model</span><span class="o">=</span><span class="n">MyModel</span><span class="p">(),</span>
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;test_model&quot;</span><span class="p">,</span>
        <span class="n">signature</span><span class="o">=</span><span class="n">infer_signature</span><span class="p">(</span><span class="n">model_input</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">model_output</span><span class="o">=</span><span class="n">model_output</span><span class="p">),</span>
    <span class="p">)</span>

<span class="n">loaded_model</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">model_info</span><span class="o">.</span><span class="n">model_uri</span><span class="p">)</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">loaded_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">prediction</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/benjamin.wilson/miniconda3/envs/mlflow-dev-env/lib/python3.8/site-packages/_distutils_hack/__init__.py:30: UserWarning: Setuptools is replacing distutils.
  warnings.warn(&#34;Setuptools is replacing distutils.&#34;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
      <th>b</th>
      <th>c</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[a, b, c]</td>
      <td>b</td>
      <td>{'d': 'd'}</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[a]</td>
      <td>NaN</td>
      <td>{'d': 'd', 'e': 'e'}</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>We can check the inferred signature directly from the logged model information that is returned from the call to <code class="docutils literal notranslate"><span class="pre">log_model()</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_info</span><span class="o">.</span><span class="n">signature</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
inputs:
  [&#39;a&#39;: Array(string) (required), &#39;b&#39;: string (optional), &#39;c&#39;: {d: string (required), e: string (optional)} (required)]
outputs:
  [&#39;a&#39;: Array(string) (required), &#39;b&#39;: string (optional), &#39;c&#39;: {d: string (required), e: string (optional)} (required)]
params:
  None
</pre></div></div>
</div>
<p>We can also quickly verify that the logged input signature matches the signature inference. While we’re at it, we can generate the output signature as well.</p>
<blockquote>
<div><p>NOTE: it is recommended to log both the input and output signatures with your models.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">report_signature_info</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">prediction</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

The input data:
        [{&#39;a&#39;: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;], &#39;b&#39;: &#39;b&#39;, &#39;c&#39;: {&#39;d&#39;: &#39;d&#39;}}, {&#39;a&#39;: [&#39;a&#39;], &#39;c&#39;: {&#39;d&#39;: &#39;d&#39;, &#39;e&#39;: &#39;e&#39;}}].
The data is of type: &lt;class &#39;list&#39;&gt;.
The inferred signature is:

inputs:
  [&#39;a&#39;: Array(string) (required), &#39;b&#39;: string (optional), &#39;c&#39;: {d: string (required), e: string (optional)} (required)]
outputs:
  [&#39;a&#39;: Array(string) (required), &#39;b&#39;: string (optional), &#39;c&#39;: {d: string (required), e: string (optional)} (required)]
params:
  None


</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using the model while not providing an optional input (note the output return structure and the non existent optional columns)</span>

<span class="n">loaded_model</span><span class="o">.</span><span class="n">predict</span><span class="p">([{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">],</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;d&quot;</span><span class="p">:</span> <span class="s2">&quot;d&quot;</span><span class="p">}}])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
      <th>c</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[a, b, c]</td>
      <td>{'d': 'd'}</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using the model while omitting the input of required fields (this will raise an Exception from schema enforcement,</span>
<span class="c1"># stating that the required fields &quot;a&quot; and &quot;c&quot; are missing)</span>

<span class="n">loaded_model</span><span class="o">.</span><span class="n">predict</span><span class="p">([{</span><span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span><span class="p">}])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">MlflowException</span>                           Traceback (most recent call last)
<span class="ansi-green-fg">~/repos/mlflow-fork/mlflow/mlflow/pyfunc/__init__.py</span> in <span class="ansi-cyan-fg">predict</span><span class="ansi-blue-fg">(self, data, params)</span>
<span class="ansi-green-intense-fg ansi-bold">    469</span>             <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 470</span><span class="ansi-red-fg">                 </span>data <span class="ansi-blue-fg">=</span> _enforce_schema<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">,</span> input_schema<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    471</span>             <span class="ansi-green-fg">except</span> Exception <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/repos/mlflow-fork/mlflow/mlflow/models/utils.py</span> in <span class="ansi-cyan-fg">_enforce_schema</span><span class="ansi-blue-fg">(pf_input, input_schema)</span>
<span class="ansi-green-intense-fg ansi-bold">    939</span>                 message <span class="ansi-blue-fg">+=</span> <span class="ansi-blue-fg">f&#34; Note that there were extra inputs: {extra_cols}&#34;</span>
<span class="ansi-green-fg">--&gt; 940</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">raise</span> MlflowException<span class="ansi-blue-fg">(</span>message<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    941</span>     <span class="ansi-green-fg">elif</span> <span class="ansi-green-fg">not</span> input_schema<span class="ansi-blue-fg">.</span>is_tensor_spec<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">MlflowException</span>: Model is missing inputs [&#39;a&#39;, &#39;c&#39;].

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">MlflowException</span>                           Traceback (most recent call last)
<span class="ansi-green-fg">/var/folders/cd/n8n0rm2x53l_s0xv_j_xklb00000gp/T/ipykernel_97464/1628231496.py</span> in <span class="ansi-cyan-fg">&lt;cell line: 4&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> <span class="ansi-red-fg"># stating that the required fields &#34;a&#34; and &#34;c&#34; are missing)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>
<span class="ansi-green-fg">----&gt; 4</span><span class="ansi-red-fg"> </span>loaded_model<span class="ansi-blue-fg">.</span>predict<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">{</span><span class="ansi-blue-fg">&#34;b&#34;</span><span class="ansi-blue-fg">:</span> <span class="ansi-blue-fg">&#34;b&#34;</span><span class="ansi-blue-fg">}</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/repos/mlflow-fork/mlflow/mlflow/pyfunc/__init__.py</span> in <span class="ansi-cyan-fg">predict</span><span class="ansi-blue-fg">(self, data, params)</span>
<span class="ansi-green-intense-fg ansi-bold">    471</span>             <span class="ansi-green-fg">except</span> Exception <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    472</span>                 <span class="ansi-red-fg"># Include error in message for backwards compatibility</span>
<span class="ansi-green-fg">--&gt; 473</span><span class="ansi-red-fg">                 raise MlflowException.invalid_parameter_value(
</span><span class="ansi-green-intense-fg ansi-bold">    474</span>                     <span class="ansi-blue-fg">f&#34;Failed to enforce schema of data &#39;{data}&#39; &#34;</span>
<span class="ansi-green-intense-fg ansi-bold">    475</span>                     <span class="ansi-blue-fg">f&#34;with schema &#39;{input_schema}&#39;. &#34;</span>

<span class="ansi-red-fg">MlflowException</span>: Failed to enforce schema of data &#39;[{&#39;b&#39;: &#39;b&#39;}]&#39; with schema &#39;[&#39;a&#39;: Array(string) (required), &#39;b&#39;: string (optional), &#39;c&#39;: {d: string (required), e: string (optional)} (required)]&#39;. Error: Model is missing inputs [&#39;a&#39;, &#39;c&#39;].
</pre></div></div>
</div>
</div>
<div class="section" id="Updating-Signatures">
<h2>Updating Signatures<a class="headerlink" href="#Updating-Signatures" title="Permalink to this headline"> </a></h2>
<p>This section of the tutorial addresses the dynamic nature of data and models, focusing on the crucial task of updating an MLflow model’s signature. As datasets evolve and requirements change, it becomes necessary to modify the signature of a model to align with the new data structure or inputs. This ability to update a signature is key to maintaining the accuracy and relevance of your model over time.</p>
<p>We will demonstrate how to identify when a signature update is needed and walk through the process of creating and applying a new signature to an existing model. This section highlights the flexibility of MLflow in accommodating changes in data formats and structures without the need to re-save the entire model. However, for registered models in MLflow, updating the signature requires re-registering the model to reflect the changes in the registered version.</p>
<p>By exploring the steps to update a model’s signature, you will learn how to update the model signature in the event that you manually defined a signature that is invalid or if you failed to define one while logging and need to update the model with a valid signature.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Updating an existing model that wasn&#39;t saved with a signature</span>


<span class="k">class</span> <span class="nc">MyTypeCheckerModel</span><span class="p">(</span><span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">PythonModel</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">model_input</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">model_input</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">model_input</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_input</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The input must be a list.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;Input is valid.&quot;</span>


<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">model_info</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">python_model</span><span class="o">=</span><span class="n">MyTypeCheckerModel</span><span class="p">(),</span>
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;test_model&quot;</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">loaded_model</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">model_info</span><span class="o">.</span><span class="n">model_uri</span><span class="p">)</span>

<span class="n">loaded_model</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">signature</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_data</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;we are expecting strings&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="s2">&quot;and only strings&quot;</span><span class="p">},</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
<span class="n">loaded_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;list&#39;&gt;
[{&#39;a&#39;: &#39;we are expecting strings&#39;, &#39;b&#39;: &#39;and only strings&#39;}, [1, 2, 3]]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Input is valid.&#39;
</pre></div></div>
</div>
</div>
<div class="section" id="The-Necessity-of-Schema-Enforcement-in-MLflow">
<h2>The Necessity of Schema Enforcement in MLflow<a class="headerlink" href="#The-Necessity-of-Schema-Enforcement-in-MLflow" title="Permalink to this headline"> </a></h2>
<p>In this part of the tutorial, we address a common challenge in machine learning model deployment: the clarity and interpretability of error messages. Without schema enforcement, models can often return cryptic or misleading error messages. This occurs because, in the absence of a well-defined schema, the model attempts to process inputs that may not align with its expectations, leading to ambiguous or hard-to-diagnose errors.</p>
<div class="section" id="Why-Schema-Enforcement-Matters">
<h3>Why Schema Enforcement Matters<a class="headerlink" href="#Why-Schema-Enforcement-Matters" title="Permalink to this headline"> </a></h3>
<p>Schema enforcement acts as a gatekeeper, ensuring that the data fed into a model precisely matches the expected format. This not only reduces the likelihood of runtime errors but also makes any errors that do occur much easier to understand and rectify. Without such enforcement, diagnosing issues becomes a time-consuming and complex task, often requiring deep dives into the model’s internal logic.</p>
</div>
<div class="section" id="Updating-Model-Signature-for-Clearer-Error-Messages">
<h3>Updating Model Signature for Clearer Error Messages<a class="headerlink" href="#Updating-Model-Signature-for-Clearer-Error-Messages" title="Permalink to this headline"> </a></h3>
<p>To illustrate the value of schema enforcement, we will update the signature of a saved model to match an expected data structure. This process involves defining the expected data structure, using the <code class="docutils literal notranslate"><span class="pre">infer_signature</span></code> function to generate the appropriate signature, and then applying this signature to the model using <code class="docutils literal notranslate"><span class="pre">set_signature</span></code>. By doing so, we ensure that any future errors are more informative and aligned with the data structure we anticipate, simplifying troubleshooting and enhancing
model reliability.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expected_data_structure</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="s2">&quot;another string&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">}]</span>

<span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">expected_data_structure</span><span class="p">,</span> <span class="n">loaded_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">expected_data_structure</span><span class="p">))</span>

<span class="n">set_signature</span><span class="p">(</span><span class="n">model_info</span><span class="o">.</span><span class="n">model_uri</span><span class="p">,</span> <span class="n">signature</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;list&#39;&gt;
[{&#39;a&#39;: &#39;string&#39;, &#39;b&#39;: &#39;another string&#39;}, {&#39;a&#39;: &#39;string&#39;}]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">loaded_with_signature</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">model_info</span><span class="o">.</span><span class="n">model_uri</span><span class="p">)</span>

<span class="n">loaded_with_signature</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">signature</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
inputs:
  [&#39;a&#39;: string (required), &#39;b&#39;: string (optional)]
outputs:
  [string (required)]
params:
  None
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">loaded_with_signature</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">expected_data_structure</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
        a               b
0  string  another string
1  string             NaN
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Input is valid.&#39;
</pre></div></div>
</div>
</div>
<div class="section" id="Validating-that-schema-enforcement-will-not-permit-a-flawed-input">
<h3>Validating that schema enforcement will not permit a flawed input<a class="headerlink" href="#Validating-that-schema-enforcement-will-not-permit-a-flawed-input" title="Permalink to this headline"> </a></h3>
<p>Now that we’ve set our signature correctly and updated the model definition, let’s ensure that the previous flawed input type will raise a useful error message!</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">loaded_with_signature</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AttributeError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">~/repos/mlflow-fork/mlflow/mlflow/pyfunc/__init__.py</span> in <span class="ansi-cyan-fg">predict</span><span class="ansi-blue-fg">(self, data, params)</span>
<span class="ansi-green-intense-fg ansi-bold">    469</span>             <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 470</span><span class="ansi-red-fg">                 </span>data <span class="ansi-blue-fg">=</span> _enforce_schema<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">,</span> input_schema<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    471</span>             <span class="ansi-green-fg">except</span> Exception <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/repos/mlflow-fork/mlflow/mlflow/models/utils.py</span> in <span class="ansi-cyan-fg">_enforce_schema</span><span class="ansi-blue-fg">(pf_input, input_schema)</span>
<span class="ansi-green-intense-fg ansi-bold">    907</span>         <span class="ansi-green-fg">elif</span> isinstance<span class="ansi-blue-fg">(</span>pf_input<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">(</span>list<span class="ansi-blue-fg">,</span> np<span class="ansi-blue-fg">.</span>ndarray<span class="ansi-blue-fg">,</span> pd<span class="ansi-blue-fg">.</span>Series<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 908</span><span class="ansi-red-fg">             </span>pf_input <span class="ansi-blue-fg">=</span> pd<span class="ansi-blue-fg">.</span>DataFrame<span class="ansi-blue-fg">(</span>pf_input<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    909</span>

<span class="ansi-green-fg">~/miniconda3/envs/mlflow-dev-env/lib/python3.8/site-packages/pandas/core/frame.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, data, index, columns, dtype, copy)</span>
<span class="ansi-green-intense-fg ansi-bold">    781</span>                         columns <span class="ansi-blue-fg">=</span> ensure_index<span class="ansi-blue-fg">(</span>columns<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 782</span><span class="ansi-red-fg">                     arrays, columns, index = nested_data_to_arrays(
</span><span class="ansi-green-intense-fg ansi-bold">    783</span>                         <span class="ansi-red-fg"># error: Argument 3 to &#34;nested_data_to_arrays&#34; has incompatible</span>

<span class="ansi-green-fg">~/miniconda3/envs/mlflow-dev-env/lib/python3.8/site-packages/pandas/core/internals/construction.py</span> in <span class="ansi-cyan-fg">nested_data_to_arrays</span><span class="ansi-blue-fg">(data, columns, index, dtype)</span>
<span class="ansi-green-intense-fg ansi-bold">    497</span>
<span class="ansi-green-fg">--&gt; 498</span><span class="ansi-red-fg">     </span>arrays<span class="ansi-blue-fg">,</span> columns <span class="ansi-blue-fg">=</span> to_arrays<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">,</span> columns<span class="ansi-blue-fg">,</span> dtype<span class="ansi-blue-fg">=</span>dtype<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    499</span>     columns <span class="ansi-blue-fg">=</span> ensure_index<span class="ansi-blue-fg">(</span>columns<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/miniconda3/envs/mlflow-dev-env/lib/python3.8/site-packages/pandas/core/internals/construction.py</span> in <span class="ansi-cyan-fg">to_arrays</span><span class="ansi-blue-fg">(data, columns, dtype)</span>
<span class="ansi-green-intense-fg ansi-bold">    831</span>     <span class="ansi-green-fg">elif</span> isinstance<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> abc<span class="ansi-blue-fg">.</span>Mapping<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 832</span><span class="ansi-red-fg">         </span>arr<span class="ansi-blue-fg">,</span> columns <span class="ansi-blue-fg">=</span> _list_of_dict_to_arrays<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">,</span> columns<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    833</span>     <span class="ansi-green-fg">elif</span> isinstance<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> ABCSeries<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/miniconda3/envs/mlflow-dev-env/lib/python3.8/site-packages/pandas/core/internals/construction.py</span> in <span class="ansi-cyan-fg">_list_of_dict_to_arrays</span><span class="ansi-blue-fg">(data, columns)</span>
<span class="ansi-green-intense-fg ansi-bold">    911</span>         sort <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">not</span> any<span class="ansi-blue-fg">(</span>isinstance<span class="ansi-blue-fg">(</span>d<span class="ansi-blue-fg">,</span> dict<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">for</span> d <span class="ansi-green-fg">in</span> data<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 912</span><span class="ansi-red-fg">         </span>pre_cols <span class="ansi-blue-fg">=</span> lib<span class="ansi-blue-fg">.</span>fast_unique_multiple_list_gen<span class="ansi-blue-fg">(</span>gen<span class="ansi-blue-fg">,</span> sort<span class="ansi-blue-fg">=</span>sort<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    913</span>         columns <span class="ansi-blue-fg">=</span> ensure_index<span class="ansi-blue-fg">(</span>pre_cols<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/miniconda3/envs/mlflow-dev-env/lib/python3.8/site-packages/pandas/_libs/lib.pyx</span> in <span class="ansi-cyan-fg">pandas._libs.lib.fast_unique_multiple_list_gen</span><span class="ansi-blue-fg">()</span>

<span class="ansi-green-fg">~/miniconda3/envs/mlflow-dev-env/lib/python3.8/site-packages/pandas/core/internals/construction.py</span> in <span class="ansi-cyan-fg">&lt;genexpr&gt;</span><span class="ansi-blue-fg">(.0)</span>
<span class="ansi-green-intense-fg ansi-bold">    909</span>     <span class="ansi-green-fg">if</span> columns <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 910</span><span class="ansi-red-fg">         </span>gen <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">(</span>list<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">.</span>keys<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">for</span> x <span class="ansi-green-fg">in</span> data<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    911</span>         sort <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">not</span> any<span class="ansi-blue-fg">(</span>isinstance<span class="ansi-blue-fg">(</span>d<span class="ansi-blue-fg">,</span> dict<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">for</span> d <span class="ansi-green-fg">in</span> data<span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">AttributeError</span>: &#39;list&#39; object has no attribute &#39;keys&#39;

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">MlflowException</span>                           Traceback (most recent call last)
<span class="ansi-green-fg">/var/folders/cd/n8n0rm2x53l_s0xv_j_xklb00000gp/T/ipykernel_97464/2586525788.py</span> in <span class="ansi-cyan-fg">&lt;cell line: 1&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>loaded_with_signature<span class="ansi-blue-fg">.</span>predict<span class="ansi-blue-fg">(</span>test_data<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/repos/mlflow-fork/mlflow/mlflow/pyfunc/__init__.py</span> in <span class="ansi-cyan-fg">predict</span><span class="ansi-blue-fg">(self, data, params)</span>
<span class="ansi-green-intense-fg ansi-bold">    471</span>             <span class="ansi-green-fg">except</span> Exception <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    472</span>                 <span class="ansi-red-fg"># Include error in message for backwards compatibility</span>
<span class="ansi-green-fg">--&gt; 473</span><span class="ansi-red-fg">                 raise MlflowException.invalid_parameter_value(
</span><span class="ansi-green-intense-fg ansi-bold">    474</span>                     <span class="ansi-blue-fg">f&#34;Failed to enforce schema of data &#39;{data}&#39; &#34;</span>
<span class="ansi-green-intense-fg ansi-bold">    475</span>                     <span class="ansi-blue-fg">f&#34;with schema &#39;{input_schema}&#39;. &#34;</span>

<span class="ansi-red-fg">MlflowException</span>: Failed to enforce schema of data &#39;[{&#39;a&#39;: &#39;we are expecting strings&#39;, &#39;b&#39;: &#39;and only strings&#39;}, [1, 2, 3]]&#39; with schema &#39;[&#39;a&#39;: string (required), &#39;b&#39;: string (optional)]&#39;. Error: &#39;list&#39; object has no attribute &#39;keys&#39;
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Wrapping-Up:-Insights-and-Best-Practices-from-the-MLflow-Signature-Playground">
<h2>Wrapping Up: Insights and Best Practices from the MLflow Signature Playground<a class="headerlink" href="#Wrapping-Up:-Insights-and-Best-Practices-from-the-MLflow-Signature-Playground" title="Permalink to this headline"> </a></h2>
<p>As we conclude our journey through the MLflow Signature Playground Notebook, we’ve gained invaluable insights into the intricacies of model signatures within the MLflow ecosystem. This tutorial has equipped you with the knowledge and practical skills needed to effectively manage and utilize model signatures, ensuring the robustness and accuracy of your machine learning models.</p>
<p>Key takeaways include the importance of accurately defining scalar types, the significance of enforcing and adhering to model signatures for data integrity, and the flexibility offered by MLflow in updating an invalid model signature. These concepts are not just theoretical but are fundamental to successful model deployment and management in real-world scenarios.</p>
<p>Whether you’re a data scientist refining your models or a developer integrating machine learning into your applications, understanding and utilizing model signatures is crucial. We hope this tutorial has provided you with a solid foundation in MLflow signatures, empowering you to implement these best practices in your future ML projects.</p>
</div>
</div>


              </div>
            </div>
            <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../signatures.html" class="btn btn-neutral" title="MLflow Model Signatures and Input Examples Guide" accesskey="p"><span class="db-icon db-icon-chevron-left"></span> Previous</a>
      
      
        <a href="../../model-registry.html" class="btn btn-neutral" title="MLflow Model Registry" accesskey="n">Next <span class="db-icon db-icon-chevron-right"></span></a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
      <p class="copyright">
          &copy; MLflow Project, a Series of LF Projects, LLC. All rights reserved.
      </p>

  </div> 

</footer>
          </div>
        </div>
      </section>
    </main>
  </page>

  


  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT:'../../',
      VERSION:'2.14.4.dev0',
      COLLAPSE_INDEX:false,
      FILE_SUFFIX:'.html',
      LINK_SUFFIX: '.html',
      HAS_SOURCE:  true
    };
  </script>

  

  <script type="text/javascript" src="../../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../../_static/js/jquery.waypoints.min.js"></script>

  
  
  
  <script type="text/javascript">var CLIPPY_SVG_PATH = "../../_static/clippy.svg";</script>
  <script type="text/javascript" src="../../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  

  
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
        }
        // Get the code block designator class entries
        const allHighlights = document.querySelectorAll('.highlight');
        // Disable copyable links for notebook cell numbering and for cell outputs
        const highlights = Array.from(allHighlights).filter(highlight => !highlight.closest('.highlight-none') && 
            !highlight.closest('.nboutput'));
    
        highlights.forEach(function(highlight) {
            const copyIcon = document.createElement('span');
            copyIcon.classList.add('copy-icon');
            copyIcon.innerHTML = '&#xf0ea;';

            copyIcon.addEventListener('click', function() {
                const code = highlight.querySelector('pre').textContent;
                copyToClipboard(code);

                // Flash effect on click
                this.style.color = '#0194E2';
                setTimeout(() => {
                    this.style.color = ''; 
                }, 100);

                // Display "Code copied to clipboard" near the clicked icon
                const message = document.createElement('span');
                message.textContent = "Copied!";
                message.classList.add('copy-message'); 

                // Append the message to the icon
                this.appendChild(message);

                setTimeout(() => {
                    this.removeChild(message);
                }, 500);
            });

            highlight.appendChild(copyIcon);
        });
    });
  </script>


<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
        // Force download for notebook-download-btn
        const downloadButtons = document.querySelectorAll('.notebook-download-btn');
        downloadButtons.forEach(function(button) {
            button.addEventListener('click', function(event) {
                event.preventDefault(); // Prevent default behavior

                // Fetch the raw content of the notebook from GitHub
                fetch(button.href)
                    .then(response => response.blob())
                    .then(blob => {
                        const url = window.URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.style.display = 'none';
                        link.href = url;
                        const filename = button.href.split('/').pop();
                        link.download = filename; 

                        document.body.appendChild(link);
                        link.click();

                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(link);
                    })
                    .catch(err => console.error('Error fetching the notebook:', err));
            });
        });
    });
</script> 
</body>
</html>