
  

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>MLflow Model Signatures and Input Examples Guide &mdash; MLflow 2.9.3.dev0 documentation</title>
  
   
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="canonical" href="https://mlflow.org/docs/latest/model/signatures.html">
  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    

    

  
    

  

  
  
    

  

  
  
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600" rel="stylesheet">
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/cards.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/grids.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/mobile.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/simple-cards.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/tabs.css" type="text/css" />
    
  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="MLflow 2.9.3.dev0 documentation" href="../index.html"/>
        <link rel="up" title="MLflow Models" href="../models.html"/>
        <link rel="next" title="MLflow Signature Playground Notebook" href="/notebooks/signature_examples.html"/>
        <link rel="prev" title="Managing Dependencies in MLflow Models" href="/dependencies.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>
<script type="text/javascript" src="../_static/jquery.js"></script>
<script type="text/javascript" src="../_static/underscore.js"></script>
<script type="text/javascript" src="../_static/doctools.js"></script>
<script type="text/javascript" src="../_static/languagesections.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>

<body class="wy-body-for-nav" role="document">
  

  
  <nav class="wy-nav-top header" role="navigation" aria-label="top navigation">
    <ul>
  <li class="menu-toggle">
    <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
    <a href="../index.html" class="wy-nav-top-logo"
      ><img src="../_static/MLflow-logo-final-black.png" alt="MLflow"
    /></a>
    <span class="version">2.9.3.dev0</span>
  </li>
</ul>
  </nav>
  <page>
    

    <nav data-toggle="wy-nav-shift" class="wy-nav-side relative">
      <div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
  </form>
</div>


    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../index.html" class="main-navigation-home"><img src="../_static/icons/nav-home.svg"> MLflow</a>
    

    
      

      
        <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">What is MLflow?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/index.html">Getting Started with MLflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../new-features/index.html">New Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../llms/index.html">LLMs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model-evaluation/index.html">Model Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deep-learning/index.html">Deep Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../traditional-ml/index.html">Traditional ML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment/index.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tracking.html">MLflow Tracking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../system-metrics/index.html">System Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projects.html">MLflow Projects</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../models.html">MLflow Models</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../models.html#storage-format">Storage Format</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models.html#managing-model-dependencies">Managing Model Dependencies</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../models.html#model-signatures-and-input-examples">Model Signatures And Input Examples</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">MLflow Model Signatures and Input Examples Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction-to-model-signatures-and-input-examples">Introduction to Model Signatures and Input Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#why-are-these-important">Why are these important?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id1">Model Signature</a></li>
<li class="toctree-l4"><a class="reference internal" href="#model-signature-types">Model Signature Types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#signature-enforcement">Signature Enforcement</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-to-log-models-with-signatures">How To Log Models With Signatures</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-to-set-signatures-on-models">How To Set Signatures on Models</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-a-signature-on-a-registered-model">Setting a Signature on a Registered Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#input-example">Model Input Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../models.html#model-api">Model API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models.html#built-in-model-flavors">Built-In Model Flavors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models.html#model-evaluation">Model Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models.html#model-customization">Model Customization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models.html#built-in-deployment-tools">Built-In Deployment Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models.html#export-a-python-function-model-as-an-apache-spark-udf">Export a <code class="docutils literal notranslate"><span class="pre">python_function</span></code> model as an Apache Spark UDF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models.html#deployment-to-custom-targets">Deployment to Custom Targets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models.html#id10">Community Model Flavors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../model-registry.html">MLflow Model Registry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../recipes.html">MLflow Recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins.html">MLflow Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../auth/index.html">MLflow Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">Command-Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../search-runs.html">Search Runs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../search-experiments.html">Search Experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python_api/index.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../R-api.html">R API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../java_api/index.html">Java API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rest-api.html">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docker.html">Official MLflow Docker Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community-model-flavors.html">Community Model Flavors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials-and-examples/index.html">Tutorials and Examples</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    

    <p>
      <a id='feedbacklink' href="https://github.com/mlflow/mlflow/blob/master/CONTRIBUTING.md" target="_blank">Contribute</a>
    </p>
  </div>
</div>
    </nav>

    <main class="wy-grid-for-nav">
      <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
        <div class="wy-nav-content">
          <div class="rst-content">
            










<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
        <li><a href="../models.html">MLflow Models</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>MLflow Model Signatures and Input Examples Guide</li>
    
    
    <!-- <li class="wy-breadcrumbs-aside">
      <a href="https://github.com/mlflow/mlflow/blob/master/docs/source/model/signatures.rst" class="fa fa-github"> Edit on GitHub</a>
    </li> -->
    
  </ul>
</div>
            <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
              <div itemprop="articleBody">
                
  <div class="section" id="mlflow-model-signatures-and-input-examples-guide">
<h1>MLflow Model Signatures and Input Examples Guide<a class="headerlink" href="#mlflow-model-signatures-and-input-examples-guide" title="Permalink to this headline"> </a></h1>
<div class="section" id="introduction-to-model-signatures-and-input-examples">
<span id="intro-model-signature-input-example"></span><h2>Introduction to Model Signatures and Input Examples<a class="headerlink" href="#introduction-to-model-signatures-and-input-examples" title="Permalink to this headline"> </a></h2>
<p>In MLflow, the concepts of <em>Model Signature</em> and <em>Model Input Example</em> are essential for effectively working with machine learning models.
These components do more than just provide metadata; they establish crucial guidelines for model interaction, enhancing integration and
usability within MLflow’s ecosystem.</p>
<div class="section" id="model-signature">
<h3><strong>Model Signature</strong><a class="headerlink" href="#model-signature" title="Permalink to this headline"> </a></h3>
<p>The <a class="reference internal" href="#id1"><span class="std std-ref">Model Signature</span></a> in MLflow is integral to the clear and accurate operation of models. It defines the expected
format for model inputs and outputs, including any additional parameters needed for inference. This specification acts as a
definitive guide, ensuring seamless model integration with MLflow’s tools and external services.</p>
</div>
<div class="section" id="model-input-example">
<h3><strong>Model Input Example</strong><a class="headerlink" href="#model-input-example" title="Permalink to this headline"> </a></h3>
<p>Complementing the Model Signature, the <a class="reference internal" href="#input-example"><span class="std std-ref">Model Input Example</span></a> gives a concrete instance of what valid model input
looks like. This hands-on example is invaluable for developers, offering a clear understanding of the required data format and structure
for effective model testing and real-world application.</p>
</div>
</div>
<div class="section" id="why-are-these-important">
<h2>Why are these important?<a class="headerlink" href="#why-are-these-important" title="Permalink to this headline"> </a></h2>
<div class="figure align-center" style="width: 90%">
<img alt="../_images/signature-vs-no-signature.png" src="../_images/signature-vs-no-signature.png" />
</div>
<p>Model signatures and input examples are foundational to robust ML workflows, offering a blueprint for model interactions that ensures consistency,
accuracy, and ease of use. They act as a contract between the model and its users, providing a definitive guide to the expected data format,
thus preventing miscommunication and errors that can arise from incorrect or unexpected inputs.</p>
</div>
<div class="section" id="id1">
<span id="id2"></span><h2>Model Signature<a class="headerlink" href="#id1" title="Permalink to this headline"> </a></h2>
<p>In MLflow, a model signature precisely defines the schema for model inputs, outputs, and any additional parameters required for effective model
operation. This definition serves as a uniform interface, guiding users in the appropriate and accurate use of their models. Model signatures are
integral to the MLflow ecosystem, enabling both the MLflow Tracking UI and Model Registry UI to clearly display the model’s required inputs,
outputs, and parameters. Additionally, <a class="reference internal" href="../models.html#built-in-deployment"><span class="std std-ref">MLflow model deployment tools</span></a> utilize these signatures to ensure that
the data used at inference aligns with the model’s established specifications, thus maintaining the model’s integrity and performance. For
more insights into how these signatures enforce data accuracy, see the <a class="reference internal" href="#signature-enforcement"><span class="std std-ref">Signature enforcement</span></a> section.</p>
<p>Embedding a signature in your model is a straightforward process in MLflow. When using functions like <a class="reference internal" href="../python_api/mlflow.sklearn.html#mlflow.sklearn.log_model" title="mlflow.sklearn.log_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">sklearn.log_model()</span></code></a>
to log or save a model, simply include a <a class="reference internal" href="#input-example"><span class="std std-ref">model input example</span></a>. This action enables MLflow to <strong>automatically infer the model’s signature</strong>.
Detailed instructions on this process can be found in the <a class="reference internal" href="#how-to-log-models-with-signatures"><span class="std std-ref">How to log models with signatures</span></a> section.
The inferred signatures, along with other essential model metadata, are stored in a JSON format within the <a class="reference internal" href="../python_api/mlflow.pyfunc.html#pyfunc-model-config"><span class="std std-ref">MLmodel file</span></a> of
your model artifacts. If there’s a need to add a signature to a model that has already been logged or saved, the
<a class="reference internal" href="../python_api/mlflow.models.html#mlflow.models.set_signature" title="mlflow.models.set_signature"><code class="xref py py-func docutils literal notranslate"><span class="pre">set_signature()</span></code></a> API is available for this purpose. Consult the
<a class="reference internal" href="#how-to-set-signatures-on-models"><span class="std std-ref">How to set signatures on models</span></a> section for a detailed guide on implementing this functionality.</p>
<div class="section" id="model-signature-components">
<h3>Model Signature Components<a class="headerlink" href="#model-signature-components" title="Permalink to this headline"> </a></h3>
<p>The structure of a model signature in MLflow is composed of three distinct schema types: <strong>(1) inputs</strong>, <strong>(2) outputs</strong>, and <strong>(3) parameters (params)</strong>.
The <strong>inputs</strong> and <strong>outputs</strong> schemas specify the data structure that the model expects to receive and produce, respectively. These can be tailored to handle
a variety of data formats, including columnar data and tensors, as well as Array and Object type inputs, catering to the diverse needs of different models.</p>
<p><strong>Parameters (params)</strong>, on the other hand, refer to the additional, often optional, parameters that are crucial during the model’s inference stage.
These parameters provide added flexibility, allowing for fine-tuning and customization of the inference process.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The capability to handle Objects and Arrays in model signatures was introduced in <strong>MLflow version 2.10.0</strong> and onwards. In versions prior to 2.10.0,
column-based signatures were limited to scalar input types and certain conditional types specific to lists and dictionary inputs, with support primarily
for the <a class="reference external" href="../../llms/transformers/index.html">transformers</a> flavor. This enhancement in later versions significantly broadens the scope of data types and
structures that MLflow can seamlessly accommodate.</p>
</div>
</div>
<div class="section" id="signature-playground">
<h3>Signature Playground<a class="headerlink" href="#signature-playground" title="Permalink to this headline"> </a></h3>
<div class="toctree-wrapper compound">
</div>
<p>In order to aid in understanding how data structures will be automatically inferred as a valid signature, as well as to provide extensive examples of
valid signatures, we’ve created a notebook that you can view, showing different examples and their resulting inferred signatures.
You can <a class="reference external" href="notebooks/signature_examples.html">view the notebook here</a>.</p>
<p>Alternatively, if you’d like to download the notebook locally and test it out with your own data structures, you can download it below.</p>
<a href="https://raw.githubusercontent.com/mlflow/mlflow/master/docs/source/model/notebooks/signature_examples.ipynb" class="notebook-download-btn">
    <i class="fas fa-download"></i>Download the Signature Playground Notebook</a><br/></div>
<div class="section" id="required-vs-optional-input-fields">
<h3>Required vs. Optional Input fields<a class="headerlink" href="#required-vs-optional-input-fields" title="Permalink to this headline"> </a></h3>
<p>There are certain conditions that determine enforcement of signatures that are important to consider when defining your model signatures. One of the
most notable is the concept of required vs. optional with regards to input data.</p>
<p>Required fields are those that must be present in the input data in order for the model to be able to make a prediction. If a required field is missing,
the signature enforcement validation will raise an exception stating that the required input field is missing.</p>
<p>In order to configure a field as optional, you must pass in a value of <cite>None</cite> or <cite>np.nan</cite> for that field when using the <a class="reference internal" href="../python_api/mlflow.models.html#mlflow.models.infer_signature" title="mlflow.models.infer_signature"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.models.infer_signature()</span></code></a>
function. Alternatively, you can manually define the signature and set the <cite>required</cite> field to <cite>false</cite> for that field.</p>
</div>
</div>
<div class="section" id="model-signature-types">
<h2>Model Signature Types<a class="headerlink" href="#model-signature-types" title="Permalink to this headline"> </a></h2>
<p>MLflow supports two primary types of signatures: a column-based signature for tabular-based data, and a tensor-based signature for tensor data.</p>
<div class="section" id="column-based-signatures">
<h3>Column-based Signatures<a class="headerlink" href="#column-based-signatures" title="Permalink to this headline"> </a></h3>
<p>Column-based signatures are commonly utilized in traditional machine learning models that require tabular data inputs, such as a Pandas DataFrame.
These signatures consist of a series of columns, each potentially having a name and a specified data type. The type of each column in both input
and output corresponds to one of the <a class="reference internal" href="#supported-data-types-column"><span class="std std-ref">supported data types</span></a>, and columns can be optionally named. Additionally,
columns in the input schema can be designated as <code class="docutils literal notranslate"><span class="pre">optional</span></code>, indicating that their inclusion in the model’s input is not mandatory and they can be
left out if necessary (see <a class="reference internal" href="#optional-column"><span class="std std-ref">Optional Column</span></a> for more details).</p>
<div class="section" id="supported-data-types">
<span id="supported-data-types-column"></span><h4>Supported Data Types<a class="headerlink" href="#supported-data-types" title="Permalink to this headline"> </a></h4>
<p>Column-based signatures support data primitives defined within the <a class="reference internal" href="../python_api/mlflow.types.html#mlflow.types.DataType" title="mlflow.types.DataType"><code class="xref py py-class docutils literal notranslate"><span class="pre">MLflow</span> <span class="pre">DataType</span></code></a> specification:</p>
<ul class="simple">
<li><p>string</p></li>
<li><p>integer <sup>1</sup></p></li>
<li><p>long</p></li>
<li><p>float</p></li>
<li><p>double</p></li>
<li><p>boolean</p></li>
<li><p>datetime</p></li>
</ul>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 39%" />
<col style="width: 61%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Input (Python)</p></td>
<td><p>Inferred Signature</p></td>
</tr>
<tr class="row-even"><td><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mlflow.models</span> <span class="kn">import</span> <span class="n">infer_signature</span>

 <span class="n">infer_signature</span><span class="p">(</span><span class="n">model_input</span><span class="o">=</span><span class="p">{</span>
     <span class="s2">&quot;long_col&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
     <span class="s2">&quot;str_col&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span>
      <span class="s2">&quot;bool_col&quot;</span><span class="p">:</span> <span class="kc">True</span>
 <span class="p">})</span>
</pre></div>
</div>
</td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">signature</span><span class="p">:</span>
<span class="w">    </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;[</span>
<span class="w">        </span><span class="s">{&quot;name&quot;:</span><span class="nv"> </span><span class="s">&quot;long_col&quot;,</span><span class="nv"> </span><span class="s">&quot;type&quot;:</span><span class="nv"> </span><span class="s">&quot;long&quot;,</span><span class="nv">    </span><span class="s">&quot;required&quot;:</span><span class="nv"> </span><span class="s">&quot;true&quot;},</span>
<span class="w">        </span><span class="s">{&quot;name&quot;:</span><span class="nv"> </span><span class="s">&quot;str_col&quot;,</span><span class="nv">  </span><span class="s">&quot;type&quot;:</span><span class="nv"> </span><span class="s">&quot;string&quot;,</span><span class="nv">  </span><span class="s">&quot;required&quot;:</span><span class="nv"> </span><span class="s">&quot;true&quot;},</span>
<span class="w">        </span><span class="s">{&quot;name&quot;:</span><span class="nv"> </span><span class="s">&quot;bool_col&quot;,</span><span class="nv"> </span><span class="s">&quot;type&quot;:</span><span class="nv"> </span><span class="s">&quot;boolean&quot;,</span><span class="nv"> </span><span class="s">&quot;required&quot;:</span><span class="nv"> </span><span class="s">&quot;true&quot;}</span>
<span class="w">    </span><span class="s">]&#39;</span>
<span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">    </span><span class="nt">params</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><sup>1</sup> Python often represents missing values in integer data as floats, causing type variability in integer columns and potential schema
enforcement errors in MLflow. To avoid such issues, particularly when using Python in MLflow for model serving and Spark deployments,
define integer columns with missing values as doubles (float64).</p>
</div>
<p>Column-based signature also support composite data types of these primitives.</p>
<ul class="simple">
<li><p>Array (list, numpy arrays)</p></li>
<li><p>Object (dictionary)</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Support for Array and Object types was introduced in MLflow version <strong>2.10.0</strong>. These types will not be recognized in previous versions of MLflow.
If you are saving a model that uses these signature types, you should ensure that any other environment that attempts to load these models
has a version of MLflow installed that is at least 2.10.0.</p>
</div>
<p>Additional examples for composite data types can be seen by viewing the <a class="reference external" href="notebooks/signature_examples.html">signature examples notebook</a>.</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 35%" />
<col style="width: 65%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Input (Python)</p></td>
<td><p>Inferred Signature</p></td>
</tr>
<tr class="row-even"><td><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mlflow.models</span> <span class="kn">import</span> <span class="n">infer_signature</span>

<span class="n">infer_signature</span><span class="p">(</span><span class="n">model_input</span><span class="o">=</span><span class="p">{</span>
    <span class="c1"># Python list</span>
    <span class="s2">&quot;list_col&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">],</span>
    <span class="c1"># Numpy array</span>
    <span class="s2">&quot;numpy_col&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]),</span>
    <span class="c1"># Dictionary</span>
    <span class="s2">&quot;obj_col&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;long_prop&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;array_prop&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">],</span>
    <span class="p">},</span>
<span class="p">})</span>
</pre></div>
</div>
</td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">signature</span><span class="p">:</span>
<span class="w">    </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;[</span>
<span class="w">        </span><span class="s">{&quot;name&quot;:</span><span class="nv"> </span><span class="s">&quot;list_col&quot;,</span><span class="nv"> </span><span class="s">&quot;type&quot;:</span><span class="nv"> </span><span class="s">&quot;Array(string)&quot;,</span><span class="nv"> </span><span class="s">&quot;required&quot;:</span><span class="nv"> </span><span class="s">&quot;true&quot;},</span>
<span class="w">        </span><span class="s">{&quot;name&quot;:</span><span class="nv"> </span><span class="s">&quot;numpy_col&quot;,</span><span class="nv"> </span><span class="s">&quot;type&quot;:</span><span class="nv"> </span><span class="s">&quot;Array(Array(long))&quot;,</span><span class="nv"> </span><span class="s">&quot;required&quot;:</span><span class="nv"> </span><span class="s">&quot;true&quot;},</span>
<span class="w">        </span><span class="s">{</span>
<span class="w">            </span><span class="s">&quot;name&quot;:</span><span class="nv"> </span><span class="s">&quot;obj_col&quot;,</span>
<span class="w">            </span><span class="s">&quot;type&quot;:</span><span class="nv"> </span><span class="s">{</span>
<span class="w">                </span><span class="s">&quot;long_prop&quot;:</span><span class="nv">  </span><span class="s">long</span><span class="nv"> </span><span class="s">(required)</span>
<span class="w">                </span><span class="s">&quot;array_prop&quot;:</span><span class="nv"> </span><span class="s">Array(str)</span><span class="nv"> </span><span class="s">(required)</span>
<span class="w">            </span><span class="s">}</span>
<span class="w">            </span><span class="s">&quot;required&quot;:</span><span class="nv"> </span><span class="s">&quot;true&quot;</span>
<span class="w">        </span><span class="s">}</span>
<span class="w">    </span><span class="s">]&#39;</span>
<span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">    </span><span class="nt">params</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="optional-column">
<span id="id3"></span><h4>Optional Column<a class="headerlink" href="#optional-column" title="Permalink to this headline"> </a></h4>
<p>Columns that contain <cite>None</cite> or <cite>np.nan</cite> values within the input data will be inferred as <cite>optional</cite> (i.e. <cite>required=False</cite>)</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 39%" />
<col style="width: 61%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Input (Python)</p></td>
<td><p>Inferred Signature</p></td>
</tr>
<tr class="row-even"><td><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mlflow.models</span> <span class="kn">import</span> <span class="n">infer_signature</span>

<span class="n">infer_signature</span><span class="p">(</span><span class="n">model_input</span><span class="o">=</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s2">&quot;col&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="p">})</span>
<span class="p">})</span>
</pre></div>
</div>
</td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">signature</span><span class="p">:</span>
<span class="w">    </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;[</span>
<span class="w">        </span><span class="s">{&quot;name&quot;:</span><span class="nv"> </span><span class="s">&quot;col&quot;,</span><span class="nv"> </span><span class="s">&quot;type&quot;:</span><span class="nv"> </span><span class="s">&quot;double&quot;,</span><span class="nv"> </span><span class="s">&quot;required&quot;:</span><span class="nv"> </span><span class="s">false}</span>
<span class="w">    </span><span class="s">]&#39;</span>
<span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">    </span><span class="nt">params</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Nested arrays can contain an empty list, and it does not make the column <cite>optional</cite> as it represents an empty set (∅). In such case,
the schema will be inferred from the other elements of the list, assuming they have homogeneous types. If you want to make a column optional,
pass <cite>None</cite> instead.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 36%" />
<col style="width: 64%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Input (Python)</p></td>
<td><p>Inferred Signature</p></td>
</tr>
<tr class="row-even"><td><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">infer_signature</span><span class="p">(</span><span class="n">model_input</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">&quot;list_with_empty&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">],</span> <span class="p">[]],</span>
    <span class="s2">&quot;list_with_none&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
<span class="p">})</span>
</pre></div>
</div>
</td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">signature</span><span class="p">:</span>
<span class="w">    </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;[</span>
<span class="w">        </span><span class="s">{&quot;name&quot;:</span><span class="nv"> </span><span class="s">&quot;list_with_empty&quot;,</span><span class="nv"> </span><span class="s">&quot;type&quot;:</span><span class="nv"> </span><span class="s">&quot;Array(str)&quot;,</span><span class="nv"> </span><span class="s">&quot;required&quot;:</span><span class="nv"> </span><span class="s">&quot;true&quot;</span><span class="nv"> </span><span class="s">},</span>
<span class="w">        </span><span class="s">{&quot;name&quot;:</span><span class="nv"> </span><span class="s">&quot;list_with_none&quot;</span><span class="nv"> </span><span class="s">,</span><span class="nv"> </span><span class="s">&quot;type&quot;:</span><span class="nv"> </span><span class="s">&quot;Array(str)&quot;,</span><span class="nv"> </span><span class="s">&quot;required&quot;:</span><span class="nv"> </span><span class="s">&quot;false&quot;},</span>
<span class="w">    </span><span class="s">]&#39;</span>
<span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">    </span><span class="nt">params</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section" id="tensor-based-signatures">
<h3>Tensor-based Signatures<a class="headerlink" href="#tensor-based-signatures" title="Permalink to this headline"> </a></h3>
<p>Tensor-based signatures are primarily employed in models that process tensor inputs, commonly found in deep learning applications involving images,
audio data, and similar formats. These schemas consist of sequences of tensors, each potentially named and defined by a specific
<a class="reference external" href="https://numpy.org/devdocs/user/basics.types.html">numpy data type</a>.</p>
<p>In a tensor-based signature, each input and output tensor is characterized by three attributes: a <strong>dtype</strong> (data type, aligning with
<a class="reference external" href="https://numpy.org/devdocs/user/basics.types.html">numpy data types</a>), a <strong>shape</strong>, and an optional <strong>name</strong>. It’s important to note that
tensor-based signatures do not accommodate optional inputs. The shape attribute often uses -1 for any dimension whose size may vary,
commonly seen in batch processing.</p>
<p>Consider a classification model trained on the <a class="reference external" href="http://yann.lecun.com/exdb/mnist/">MNIST dataset</a>. An example of its model signature would feature
an input tensor representing an image as a 28 × 28 × 1 array of float32 numbers. The model’s output might be a tensor signifying the probability
for each of the 10 target classes. In such cases, the first dimension, representing the batch size, is typically set to -1, allowing the model
to handle batches of varying sizes.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">signature</span><span class="p">:</span>
<span class="w">    </span><span class="nt">inputs</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;[{&quot;name&quot;:</span><span class="nv"> </span><span class="s">&quot;images&quot;,</span><span class="nv"> </span><span class="s">&quot;dtype&quot;:</span><span class="nv"> </span><span class="s">&quot;uint8&quot;,</span><span class="nv"> </span><span class="s">&quot;shape&quot;:</span><span class="nv"> </span><span class="s">[-1,</span><span class="nv"> </span><span class="s">28,</span><span class="nv"> </span><span class="s">28,</span><span class="nv"> </span><span class="s">1]}]&#39;</span>
<span class="w">    </span><span class="nt">outputs</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;[{&quot;shape&quot;:</span><span class="nv"> </span><span class="s">[-1,</span><span class="nv"> </span><span class="s">10],</span><span class="nv"> </span><span class="s">&quot;dtype&quot;:</span><span class="nv"> </span><span class="s">&quot;float32&quot;}]&#39;</span>
<span class="w">    </span><span class="nt">params</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</pre></div>
</div>
<div class="section" id="supported-data-types-tensor">
<span id="id4"></span><h4>Supported Data Types<a class="headerlink" href="#supported-data-types-tensor" title="Permalink to this headline"> </a></h4>
<p>Tensor-based schemas support <a class="reference external" href="https://numpy.org/devdocs/user/basics.types.html">numpy data types</a>.</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 39%" />
<col style="width: 61%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Input (Python)</p></td>
<td><p>Inferred Signature</p></td>
</tr>
<tr class="row-even"><td><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mlflow.models</span> <span class="kn">import</span> <span class="n">infer_signature</span>

<span class="n">infer_signature</span><span class="p">(</span><span class="n">model_input</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]],</span>
    <span class="p">[[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span>
<span class="p">])</span>
</pre></div>
</div>
</td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">signature</span><span class="p">:</span>
<span class="w">    </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;[&quot;dtype&quot;:</span><span class="nv"> </span><span class="s">&quot;int64&quot;,</span><span class="nv"> </span><span class="s">&quot;shape&quot;:</span><span class="nv"> </span><span class="s">[-1,</span><span class="nv"> </span><span class="s">2,</span><span class="nv"> </span><span class="s">3]}]&#39;</span>
<span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">None</span>
<span class="w">    </span><span class="nt">params</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">None</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Tensor-based schemas do not support optional inputs. You can pass an array with <cite>None</cite> or <cite>np.nan</cite> values,
but the schema doesn’t flag them as optional.</p>
</div>
</div>
</div>
<div class="section" id="model-signatures-with-inference-params">
<span id="inference-params"></span><h3>Model Signatures with Inference Params<a class="headerlink" href="#model-signatures-with-inference-params" title="Permalink to this headline"> </a></h3>
<p>Inference parameters (or ‘params’) are additional settings passed to models during the inference stage. Common examples include parameters
like <code class="docutils literal notranslate"><span class="pre">temperature</span></code> and <code class="docutils literal notranslate"><span class="pre">max_length</span></code> in Language Learning Models (LLMs). These params, not typically required during training, play a crucial role in
tailoring the behavior of a model at the time of inference. This kind of configuration becomes increasingly important with foundational models,
as the same model might need different parameter settings for various inference scenarios.</p>
<p>MLflow’s <strong>2.6.0</strong> release introduced the specification of a dictionary of inference params during model inference. This feature enhances the flexibility
and control over the inference outcomes, enabling more nuanced model behavior adjustments.</p>
<p>To leverage params at inference time, they must be incorporated into the <a class="reference internal" href="#id1"><span class="std std-ref">Model Signature</span></a>. The schema for params is
defined as a sequence of <a class="reference internal" href="../python_api/mlflow.types.html#mlflow.types.ParamSpec" title="mlflow.types.ParamSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParamSpec</span></code></a> elements, each comprising:</p>
<ul class="simple">
<li><p><strong>name</strong>: The identifier of the parameter, e.g., <code class="docutils literal notranslate"><span class="pre">temperature</span></code>.</p></li>
<li><p><strong>type</strong>: The data type of the parameter, which must align with one of the <a class="reference internal" href="#supported-data-types-params"><span class="std std-ref">supported data types</span></a>.</p></li>
<li><p><strong>default</strong>: The default value for the parameter, ensuring a fallback option if a specific value isn’t provided.</p></li>
<li><p><strong>shape</strong>: The shape of the parameter, typically <code class="docutils literal notranslate"><span class="pre">None</span></code> for scalar values and <code class="docutils literal notranslate"><span class="pre">(-1,)</span></code> for lists.</p></li>
</ul>
<p>This feature marks a significant advancement in how MLflow handles model inference, offering a more dynamic and adaptable approach to model parameterization.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">signature</span><span class="p">:</span>
<span class="w">    </span><span class="nt">inputs</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;[{&quot;name&quot;:</span><span class="nv"> </span><span class="s">&quot;input&quot;,</span><span class="nv"> </span><span class="s">&quot;type&quot;:</span><span class="nv"> </span><span class="s">&quot;string&quot;}]&#39;</span>
<span class="w">    </span><span class="nt">outputs</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;[{&quot;name&quot;:</span><span class="nv"> </span><span class="s">&quot;output&quot;,</span><span class="nv"> </span><span class="s">&quot;type&quot;:</span><span class="nv"> </span><span class="s">&quot;string&quot;}]&#39;</span>
<span class="w">    </span><span class="nt">params</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;[</span>
<span class="w">        </span><span class="s">{</span>
<span class="w">            </span><span class="s">&quot;name&quot;:</span><span class="nv"> </span><span class="s">&quot;temperature&quot;,</span>
<span class="w">            </span><span class="s">&quot;type&quot;:</span><span class="nv"> </span><span class="s">&quot;float&quot;,</span>
<span class="w">            </span><span class="s">&quot;default&quot;:</span><span class="nv"> </span><span class="s">0.5,</span>
<span class="w">            </span><span class="s">&quot;shape&quot;:</span><span class="nv"> </span><span class="s">null</span>
<span class="w">        </span><span class="s">},</span>
<span class="w">        </span><span class="s">{</span>
<span class="w">            </span><span class="s">&quot;name&quot;:</span><span class="nv"> </span><span class="s">&quot;suppress_tokens&quot;,</span>
<span class="w">            </span><span class="s">&quot;type&quot;:</span><span class="nv"> </span><span class="s">&quot;integer&quot;,</span>
<span class="w">            </span><span class="s">&quot;default&quot;:</span><span class="nv"> </span><span class="s">[101,</span><span class="nv"> </span><span class="s">102],</span>
<span class="w">             </span><span class="s">&quot;shape&quot;:</span><span class="nv"> </span><span class="s">[-1]</span>
<span class="w">        </span><span class="s">}</span>
<span class="w">    </span><span class="s">]&#39;</span>
</pre></div>
</div>
<p>The inference parameters are supplied to the model in the form of a dictionary during the inference stage. Each parameter value is subject to
validation to ensure it matches the type specified in the model’s signature. The example below illustrates the process of defining parameters
within a model signature and demonstrates their application in model inference.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">from</span> <span class="nn">mlflow.models</span> <span class="kn">import</span> <span class="n">infer_signature</span>


<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">PythonModel</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">model_input</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>


<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;suppress_tokens&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">102</span><span class="p">]}</span>
<span class="c1"># params&#39; default values are saved with ModelSignature</span>
<span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">([</span><span class="s2">&quot;input&quot;</span><span class="p">],</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">model_info</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">python_model</span><span class="o">=</span><span class="n">MyModel</span><span class="p">(),</span> <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;my_model&quot;</span><span class="p">,</span> <span class="n">signature</span><span class="o">=</span><span class="n">signature</span>
    <span class="p">)</span>

<span class="n">loaded_model</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">model_info</span><span class="o">.</span><span class="n">model_uri</span><span class="p">)</span>

<span class="c1"># Not passing params -- predict with default values</span>
<span class="n">loaded_predict</span> <span class="o">=</span> <span class="n">loaded_model</span><span class="o">.</span><span class="n">predict</span><span class="p">([</span><span class="s2">&quot;input&quot;</span><span class="p">])</span>
<span class="k">assert</span> <span class="n">loaded_predict</span> <span class="o">==</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">102</span><span class="p">]]</span>

<span class="c1"># Passing some params -- override passed-in params</span>
<span class="n">loaded_predict</span> <span class="o">=</span> <span class="n">loaded_model</span><span class="o">.</span><span class="n">predict</span><span class="p">([</span><span class="s2">&quot;input&quot;</span><span class="p">],</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">})</span>
<span class="k">assert</span> <span class="n">loaded_predict</span> <span class="o">==</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">102</span><span class="p">]]</span>

<span class="c1"># Passing all params -- override all params</span>
<span class="n">loaded_predict</span> <span class="o">=</span> <span class="n">loaded_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">],</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;suppress_tokens&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">103</span><span class="p">]}</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="n">loaded_predict</span> <span class="o">==</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="p">[</span><span class="mi">103</span><span class="p">]]</span>
</pre></div>
</div>
<div class="section" id="supported-data-types-for-params">
<span id="supported-data-types-params"></span><h4>Supported Data Types for Params<a class="headerlink" href="#supported-data-types-for-params" title="Permalink to this headline"> </a></h4>
<p>Parameters in MLflow are defined to accept values of the <a class="reference internal" href="../python_api/mlflow.types.html#mlflow.types.DataType" title="mlflow.types.DataType"><code class="xref py py-class docutils literal notranslate"><span class="pre">MLflow</span> <span class="pre">DataType</span></code></a>, including a one-dimensional
list of these data types. Currently, MLflow supports only 1D lists for parameters.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When validating param values, the values will be converted to python native types.
For example, <code class="docutils literal notranslate"><span class="pre">np.float32(0.1)</span></code> will be converted to <code class="docutils literal notranslate"><span class="pre">float(0.1)</span></code>.</p>
</div>
</div>
</div>
</div>
<div class="section" id="signature-enforcement">
<span id="id6"></span><h2>Signature Enforcement<a class="headerlink" href="#signature-enforcement" title="Permalink to this headline"> </a></h2>
<p>MLflow’s schema enforcement rigorously validates the provided inputs and parameters against the model’s signature. It raises an exception
if the inputs are incompatible and either issues a warning or raises an exception for incompatible parameters. This enforcement is applied
prior to invoking the underlying model implementation and throughout the model inference process. Note, however, that this enforcement is
specific to scenarios where <a class="reference internal" href="../models.html#built-in-deployment"><span class="std std-ref">MLflow model deployment tools</span></a> are used or when models are loaded as <code class="docutils literal notranslate"><span class="pre">python_function</span></code>.
It does not apply to models loaded in their native format, such as through <a class="reference internal" href="../python_api/mlflow.sklearn.html#mlflow.sklearn.load_model" title="mlflow.sklearn.load_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.sklearn.load_model()</span></code></a>.</p>
<div class="figure align-center" style="width: 90%">
<img alt="../_images/signature-enforcement.png" src="../_images/signature-enforcement.png" />
</div>
<div class="section" id="name-ordering-enforcement">
<h3>Name Ordering Enforcement<a class="headerlink" href="#name-ordering-enforcement" title="Permalink to this headline"> </a></h3>
<p>In MLflow, input names are verified against the model signature. Missing required inputs trigger an exception, whereas missing optional inputs do
not. Inputs not declared in the signature are disregarded. When the input schema in the signature specifies input names, matching is conducted by
name, and inputs are reordered accordingly. If the schema lacks input names, matching is based on the order of inputs, with MLflow checking only
the number of inputs provided.</p>
</div>
<div class="section" id="input-type-enforcement">
<h3>Input Type Enforcement<a class="headerlink" href="#input-type-enforcement" title="Permalink to this headline"> </a></h3>
<p>MLflow enforces input types as defined in the model’s signature. For column-based signature models (such as those using DataFrame inputs), MLflow
performs safe type conversions where necessary, allowing only lossless conversions. For example, converting int to long or int to double is
permissible, but converting long to double is not. In cases where types cannot be made compatible, MLflow will raise an error.</p>
<p>For tensor-based signature models, type checking is more stringent. An exception is thrown if the input type does not align with the schema-specified type.</p>
</div>
<div class="section" id="params-type-and-shape-enforcement">
<h3>Params Type and Shape Enforcement<a class="headerlink" href="#params-type-and-shape-enforcement" title="Permalink to this headline"> </a></h3>
<p>In MLflow, the types and shapes of parameters (params) are meticulously checked against the model’s signature. During inference, each parameter’s type
and shape are validated to ensure they align with the specifications in the signature. Scalar values are expected to have a shape of <code class="docutils literal notranslate"><span class="pre">None</span></code>, while list
values should have a shape of <code class="docutils literal notranslate"><span class="pre">(-1,)</span></code>. If a parameter’s type or shape is found to be incompatible, MLflow raises an exception. Additionally, the parameter’s
value undergoes a validation check against its designated type in the signature. If the conversion to the specified type fails, an <cite>MlflowException</cite> is
triggered. For a comprehensive list of valid params, refer to the <a class="reference internal" href="#inference-params"><span class="std std-ref">Model Inference Params</span></a> section.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Models with signatures that receive undeclared params during inference will trigger a warning for each request, and any invalid params will be disregarded.</p>
</div>
</div>
<div class="section" id="handling-integers-with-missing-values">
<h3>Handling Integers With Missing Values<a class="headerlink" href="#handling-integers-with-missing-values" title="Permalink to this headline"> </a></h3>
<p>In Python, integer data with missing values is often represented as floats. This leads to variability in the data types of integer columns, potentially
causing schema enforcement errors during runtime, as integers and floats are not inherently compatible. For instance, if a column ‘c’ in your training data
is entirely integers, it will be recognized as such. However, if a missing value is introduced in ‘c’, it will be represented as a float. If the model’s
signature expects ‘c’ to be an integer, MLflow will raise an error due to the inability to convert float to int. To mitigate this issue, especially since
MLflow uses Python for model serving and Spark deployments, it’s advisable to define integer columns with missing values as doubles (float64).</p>
</div>
<div class="section" id="handling-date-and-timestamp">
<h3>Handling Date and Timestamp<a class="headerlink" href="#handling-date-and-timestamp" title="Permalink to this headline"> </a></h3>
<p>Python’s datetime types come with built-in precision, such as <code class="docutils literal notranslate"><span class="pre">datetime64[D]</span></code> for day precision and <code class="docutils literal notranslate"><span class="pre">datetime64[ns]</span></code> for nanosecond precision.
While this precision detail is disregarded in column-based model signatures, it is enforced in tensor-based signatures.</p>
</div>
<div class="section" id="handling-ragged-arrays">
<h3>Handling Ragged Arrays<a class="headerlink" href="#handling-ragged-arrays" title="Permalink to this headline"> </a></h3>
<p>Ragged arrays in numpy, characterized by a shape of (-1,) and a dtype of object, are automatically managed when using <code class="docutils literal notranslate"><span class="pre">infer_signature</span></code>. This results
in a signature like <code class="docutils literal notranslate"><span class="pre">Tensor('object',</span> <span class="pre">(-1,))</span></code>. For a more detailed representation, a signature can be manually created to reflect the specific nature
of a ragged array, such as <code class="docutils literal notranslate"><span class="pre">Tensor('float64',</span> <span class="pre">(-1,</span> <span class="pre">-1,</span> <span class="pre">-1,</span> <span class="pre">3))</span></code>. Enforcement is then applied as detailed in the signature, accommodating ragged input arrays.</p>
</div>
</div>
<div class="section" id="how-to-log-models-with-signatures">
<span id="id7"></span><h2>How To Log Models With Signatures<a class="headerlink" href="#how-to-log-models-with-signatures" title="Permalink to this headline"> </a></h2>
<p>Including a signature with your model in MLflow is straightforward. Simply provide a <a class="reference internal" href="#input-example"><span class="std std-ref">model input example</span></a> when making a
call to either the log_model or save_model functions, such as with <a class="reference internal" href="../python_api/mlflow.sklearn.html#mlflow.sklearn.log_model" title="mlflow.sklearn.log_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">sklearn.log_model()</span></code></a>. MLflow will then
automatically infer the model’s signature based on this input example and the model’s predicted output for the given example.</p>
<p>Alternatively, you can explicitly attach a signature object to your model. This is done by passing a <a class="reference internal" href="../python_api/mlflow.models.html#mlflow.models.ModelSignature" title="mlflow.models.ModelSignature"><code class="xref py py-class docutils literal notranslate"><span class="pre">signature</span> <span class="pre">object</span></code></a>
to your log_model or save_model function. You can manually create a model signature object or use the <a class="reference internal" href="../python_api/mlflow.models.html#mlflow.models.infer_signature" title="mlflow.models.infer_signature"><code class="xref py py-func docutils literal notranslate"><span class="pre">infer_signature</span></code></a>
function to generate it from datasets with valid model inputs (for instance, a training dataset minus the target column), valid model outputs (such as
predictions made on the training dataset), and valid model parameters (like a dictionary of parameters used for model inference, commonly seen in
<a class="reference external" href="https://huggingface.co/docs/transformers/main_classes/text_generation#transformers.GenerationConfig">Generation Configs for transformers</a>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Model signatures play a crucial role in <a class="reference internal" href="../models.html#built-in-deployment"><span class="std std-ref">MLflow model deployment tools</span></a>, particularly for serving models in the Python
Function (PyFunc) flavor. Therefore, when attaching a signature to your log_model or save_model call, it’s important to ensure that the signature
accurately reflects the inputs and outputs expected by the model’s PyFunc representation. This consideration becomes especially significant if the
model’s input schema, when loaded as a PyFunc, differs from that of the dataset used for testing (an example of this scenario is with the
<a class="reference internal" href="../models.html#pmdarima-flavor"><span class="std std-ref">pmdarima model flavor</span></a>).</p>
</div>
<div class="section" id="column-based-signature-example">
<h3>Column-based Signature Example<a class="headerlink" href="#column-based-signature-example" title="Permalink to this headline"> </a></h3>
<p>The following example demonstrates how to store a model signature for a simple classifier trained
on the <code class="docutils literal notranslate"><span class="pre">Iris</span> <span class="pre">dataset</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">import</span> <span class="nn">mlflow</span>

<span class="n">iris</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">load_iris</span><span class="p">()</span>
<span class="n">iris_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">iris</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">iris</span><span class="o">.</span><span class="n">feature_names</span><span class="p">)</span>
<span class="n">clf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">iris_train</span><span class="p">,</span> <span class="n">iris</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
    <span class="c1"># Take the first row of the training dataset as the model input example.</span>
    <span class="n">input_example</span> <span class="o">=</span> <span class="n">iris_train</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="c1"># The signature is automatically inferred from the input example and its predicted output.</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="s2">&quot;iris_rf&quot;</span><span class="p">,</span> <span class="n">input_example</span><span class="o">=</span><span class="n">input_example</span><span class="p">)</span>
</pre></div>
</div>
<p>The same signature can be explicitly created and logged as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mlflow.models</span> <span class="kn">import</span> <span class="n">ModelSignature</span><span class="p">,</span> <span class="n">infer_signature</span>
<span class="kn">from</span> <span class="nn">mlflow.types.schema</span> <span class="kn">import</span> <span class="n">Schema</span><span class="p">,</span> <span class="n">ColSpec</span>

<span class="c1"># Option 1: Manually construct the signature object</span>
<span class="n">input_schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">ColSpec</span><span class="p">(</span><span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="s2">&quot;sepal length (cm)&quot;</span><span class="p">),</span>
        <span class="n">ColSpec</span><span class="p">(</span><span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="s2">&quot;sepal width (cm)&quot;</span><span class="p">),</span>
        <span class="n">ColSpec</span><span class="p">(</span><span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="s2">&quot;petal length (cm)&quot;</span><span class="p">),</span>
        <span class="n">ColSpec</span><span class="p">(</span><span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="s2">&quot;petal width (cm)&quot;</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">output_schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">([</span><span class="n">ColSpec</span><span class="p">(</span><span class="s2">&quot;long&quot;</span><span class="p">)])</span>
<span class="n">signature</span> <span class="o">=</span> <span class="n">ModelSignature</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">input_schema</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">output_schema</span><span class="p">)</span>

<span class="c1"># Option 2: Infer the signature</span>
<span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">iris_train</span><span class="p">,</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">iris_train</span><span class="p">))</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="s2">&quot;iris_rf&quot;</span><span class="p">,</span> <span class="n">signature</span><span class="o">=</span><span class="n">signature</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="tensor-based-signature-example">
<h3>Tensor-based Signature Example<a class="headerlink" href="#tensor-based-signature-example" title="Permalink to this headline"> </a></h3>
<p>The following example demonstrates how to store a model signature for a simple classifier trained
on the <code class="docutils literal notranslate"><span class="pre">MNIST</span> <span class="pre">dataset</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">mlflow</span>

<span class="n">mnist</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">mnist</span>
<span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">),</span> <span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span> <span class="o">=</span> <span class="n">mnist</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>
<span class="n">x_train</span><span class="p">,</span> <span class="n">x_test</span> <span class="o">=</span> <span class="n">x_train</span> <span class="o">/</span> <span class="mf">255.0</span><span class="p">,</span> <span class="n">x_test</span> <span class="o">/</span> <span class="mf">255.0</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Flatten</span><span class="p">(</span><span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">)),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;relu&quot;</span><span class="p">),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">loss_fn</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">SparseCategoricalCrossentropy</span><span class="p">(</span><span class="n">from_logits</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;adam&quot;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="n">loss_fn</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">])</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="c1"># Take the first three training examples as the model input example.</span>
    <span class="n">input_example</span> <span class="o">=</span> <span class="n">x_train</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">tensorflow</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;mnist_cnn&quot;</span><span class="p">,</span> <span class="n">input_example</span><span class="o">=</span><span class="n">input_example</span><span class="p">)</span>
</pre></div>
</div>
<p>The same signature can be explicitly created and logged as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">mlflow.models</span> <span class="kn">import</span> <span class="n">ModelSignature</span><span class="p">,</span> <span class="n">infer_signature</span>
<span class="kn">from</span> <span class="nn">mlflow.types.schema</span> <span class="kn">import</span> <span class="n">Schema</span><span class="p">,</span> <span class="n">TensorSpec</span>

<span class="c1"># Option 1: Manually construct the signature object</span>
<span class="n">input_schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">TensorSpec</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">output_schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">([</span><span class="n">TensorSpec</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">))])</span>
<span class="n">signature</span> <span class="o">=</span> <span class="n">ModelSignature</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">input_schema</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">output_schema</span><span class="p">)</span>

<span class="c1"># Option 2: Infer the signature</span>
<span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">testX</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">testX</span><span class="p">))</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">tensorflow</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;mnist_cnn&quot;</span><span class="p">,</span> <span class="n">signature</span><span class="o">=</span><span class="n">signature</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="signature-with-params-example">
<h3>Signature with params Example<a class="headerlink" href="#signature-with-params-example" title="Permalink to this headline"> </a></h3>
<p>The following example demonstrates how to store a model signature with params
for a simple transformers model:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">from</span> <span class="nn">mlflow.models</span> <span class="kn">import</span> <span class="n">infer_signature</span>
<span class="kn">import</span> <span class="nn">transformers</span>

<span class="n">architecture</span> <span class="o">=</span> <span class="s2">&quot;mrm8488/t5-base-finetuned-common_gen&quot;</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">transformers</span><span class="o">.</span><span class="n">pipeline</span><span class="p">(</span>
    <span class="n">task</span><span class="o">=</span><span class="s2">&quot;text2text-generation&quot;</span><span class="p">,</span>
    <span class="n">tokenizer</span><span class="o">=</span><span class="n">transformers</span><span class="o">.</span><span class="n">T5TokenizerFast</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">architecture</span><span class="p">),</span>
    <span class="n">model</span><span class="o">=</span><span class="n">transformers</span><span class="o">.</span><span class="n">T5ForConditionalGeneration</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">architecture</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;pencil draw paper&quot;</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;top_k&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s2">&quot;num_beams&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;max_length&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
    <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="mf">0.62</span><span class="p">,</span>
    <span class="s2">&quot;top_p&quot;</span><span class="p">:</span> <span class="mf">0.85</span><span class="p">,</span>
    <span class="s2">&quot;repetition_penalty&quot;</span><span class="p">:</span> <span class="mf">1.15</span><span class="p">,</span>
    <span class="s2">&quot;begin_suppress_tokens&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
<span class="p">}</span>

<span class="c1"># infer signature with params</span>
<span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">transformers</span><span class="o">.</span><span class="n">generate_signature_output</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">),</span>
    <span class="n">params</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># save model with signature</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">transformers</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="s2">&quot;text2text&quot;</span><span class="p">,</span>
    <span class="n">signature</span><span class="o">=</span><span class="n">signature</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">pyfunc_loaded</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;text2text&quot;</span><span class="p">)</span>

<span class="c1"># predict with params</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">pyfunc_loaded</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
<p>The same signature can be created explicitly as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mlflow.models</span> <span class="kn">import</span> <span class="n">ModelSignature</span>
<span class="kn">from</span> <span class="nn">mlflow.types.schema</span> <span class="kn">import</span> <span class="n">ColSpec</span><span class="p">,</span> <span class="n">ParamSchema</span><span class="p">,</span> <span class="n">ParamSpec</span><span class="p">,</span> <span class="n">Schema</span>

<span class="n">input_schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">([</span><span class="n">ColSpec</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">)])</span>
<span class="n">output_schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">([</span><span class="n">ColSpec</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">)])</span>
<span class="n">params_schema</span> <span class="o">=</span> <span class="n">ParamSchema</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">ParamSpec</span><span class="p">(</span><span class="s2">&quot;top_k&quot;</span><span class="p">,</span> <span class="s2">&quot;long&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="n">ParamSpec</span><span class="p">(</span><span class="s2">&quot;num_beams&quot;</span><span class="p">,</span> <span class="s2">&quot;long&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="n">ParamSpec</span><span class="p">(</span><span class="s2">&quot;max_length&quot;</span><span class="p">,</span> <span class="s2">&quot;long&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
        <span class="n">ParamSpec</span><span class="p">(</span><span class="s2">&quot;temperature&quot;</span><span class="p">,</span> <span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="mf">0.62</span><span class="p">),</span>
        <span class="n">ParamSpec</span><span class="p">(</span><span class="s2">&quot;top_p&quot;</span><span class="p">,</span> <span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">),</span>
        <span class="n">ParamSpec</span><span class="p">(</span><span class="s2">&quot;repetition_penalty&quot;</span><span class="p">,</span> <span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">),</span>
        <span class="n">ParamSpec</span><span class="p">(</span><span class="s2">&quot;begin_suppress_tokens&quot;</span><span class="p">,</span> <span class="s2">&quot;long&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,)),</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">signature</span> <span class="o">=</span> <span class="n">ModelSignature</span><span class="p">(</span>
    <span class="n">inputs</span><span class="o">=</span><span class="n">input_schema</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">output_schema</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params_schema</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="how-to-set-signatures-on-models">
<span id="id8"></span><h2>How To Set Signatures on Models<a class="headerlink" href="#how-to-set-signatures-on-models" title="Permalink to this headline"> </a></h2>
<p>Models can be saved without model signatures or with incorrect ones. To add or update a signature for an existing logged model,
use the <a class="reference internal" href="../python_api/mlflow.models.html#mlflow.models.set_signature" title="mlflow.models.set_signature"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.models.set_signature()</span></code></a> API. Below are some examples demonstrating its usage.</p>
<div class="section" id="setting-a-signature-on-a-logged-model">
<h3>Setting a Signature on a Logged Model<a class="headerlink" href="#setting-a-signature-on-a-logged-model" title="Permalink to this headline"> </a></h3>
<p>The following example demonstrates how to set a model signature on an already-logged sklearn model.
Suppose that you’ve logged a sklearn model without a signature like below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">import</span> <span class="nn">mlflow</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">load_iris</span><span class="p">(</span><span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">as_frame</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">clf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">()</span> <span class="k">as</span> <span class="n">run</span><span class="p">:</span>
    <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="s2">&quot;iris_rf&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can set a signature on the logged model as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">from</span> <span class="nn">mlflow.models.model</span> <span class="kn">import</span> <span class="n">get_model_info</span>
<span class="kn">from</span> <span class="nn">mlflow.models</span> <span class="kn">import</span> <span class="n">infer_signature</span><span class="p">,</span> <span class="n">set_signature</span>

<span class="c1"># load the logged model</span>
<span class="n">model_uri</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;runs:/</span><span class="si">{</span><span class="n">run</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">run_id</span><span class="si">}</span><span class="s2">/iris_rf&quot;</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">model_uri</span><span class="p">)</span>

<span class="c1"># construct the model signature from test dataset</span>
<span class="n">X_test</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">load_iris</span><span class="p">(</span><span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">as_frame</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>

<span class="c1"># set the signature for the logged model</span>
<span class="n">set_signature</span><span class="p">(</span><span class="n">model_uri</span><span class="p">,</span> <span class="n">signature</span><span class="p">)</span>

<span class="c1"># now when you load the model again, it will have the desired signature</span>
<span class="k">assert</span> <span class="n">get_model_info</span><span class="p">(</span><span class="n">model_uri</span><span class="p">)</span><span class="o">.</span><span class="n">signature</span> <span class="o">==</span> <span class="n">signature</span>
</pre></div>
</div>
<p>Note that model signatures can also be set on model artifacts saved outside of MLflow Tracking. For instance,
you can easily set a signature on a locally saved iris model by altering the model_uri
variable in the previous code snippet to point to the model’s local directory.</p>
</div>
</div>
<div class="section" id="setting-a-signature-on-a-registered-model">
<span id="set-signature-on-mv"></span><h2>Setting a Signature on a Registered Model<a class="headerlink" href="#setting-a-signature-on-a-registered-model" title="Permalink to this headline"> </a></h2>
<p>As MLflow Model Registry artifacts are meant to be read-only, you cannot directly set a signature on
a model version or model artifacts represented by <code class="docutils literal notranslate"><span class="pre">models:/</span></code> URI schemes. Instead, you should first set
the signature on the source model artifacts and generate a new model version using the updated
model artifacts. The following example illustrates how this can be done.</p>
<p>Supposed you have created the following model version without a signature like below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">from</span> <span class="nn">mlflow.client</span> <span class="kn">import</span> <span class="n">MlflowClient</span>

<span class="n">model_name</span> <span class="o">=</span> <span class="s2">&quot;add_signature_model&quot;</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">()</span> <span class="k">as</span> <span class="n">run</span><span class="p">:</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">RandomForestClassifier</span><span class="p">(),</span> <span class="s2">&quot;sklearn-model&quot;</span><span class="p">)</span>

<span class="n">model_uri</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;runs:/</span><span class="si">{</span><span class="n">run</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">run_id</span><span class="si">}</span><span class="s2">/sklearn-model&quot;</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">register_model</span><span class="p">(</span><span class="n">model_uri</span><span class="o">=</span><span class="n">model_uri</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">model_name</span><span class="p">)</span>
</pre></div>
</div>
<p>To set a signature on the model version, create a duplicate model version with the new signature
as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">from</span> <span class="nn">mlflow.store.artifact.models_artifact_repo</span> <span class="kn">import</span> <span class="n">ModelsArtifactRepository</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">MlflowClient</span><span class="p">()</span>
<span class="n">model_name</span> <span class="o">=</span> <span class="s2">&quot;add_signature_model&quot;</span>
<span class="n">model_version</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">mv</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_model_version</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">model_version</span><span class="p">)</span>

<span class="c1"># set a dummy signature on the model version source</span>
<span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">set_signature</span><span class="p">(</span><span class="n">mv</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">signature</span><span class="p">)</span>

<span class="c1"># create a new model version with the updated source</span>
<span class="n">client</span><span class="o">.</span><span class="n">create_model_version</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">mv</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">mv</span><span class="o">.</span><span class="n">run_id</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that this process overwrites the model artifacts from the source run of model version 1
with a new model signature.</p>
</div>
<div class="section" id="input-example">
<span id="id9"></span><h2>Model Input Example<a class="headerlink" href="#input-example" title="Permalink to this headline"> </a></h2>
<p>A model input example provides an instance of a valid model input. Input examples are stored with
the model as separate artifacts and are referenced in the <a class="reference internal" href="../python_api/mlflow.pyfunc.html#pyfunc-model-config"><span class="std std-ref">MLmodel file</span></a>.
To include an input example with your model, add it to the appropriate log_model call, e.g.
<a class="reference internal" href="../python_api/mlflow.sklearn.html#mlflow.sklearn.log_model" title="mlflow.sklearn.log_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">sklearn.log_model()</span></code></a>. Input examples are also used to infer
model signatures in log_model calls when signatures aren’t specified.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Including an input example while logging a model offers dual benefits. Firstly, it aids in inferring the model’s signature.
Secondly, and just as importantly, it <strong>validates the model’s requirements</strong>. This input example is utilized to execute a prediction
using the model that is about to be logged, thereby enhancing the accuracy in identifying model requirement dependencies.
It is <strong>highly recommended</strong> to always include an input example along with your models when you log them.</p>
</div>
<p>By default, if input example is a dictionary, we convert it to pandas DataFrame format when saving.
Note that for langchain, openai, pyfunc and transformers flavors, input example could be saved without
conversion by setting <code class="docutils literal notranslate"><span class="pre">example_no_conversion</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<p>Similar to model signatures, model inputs can be column-based (i.e DataFrames), tensor-based
(i.e numpy.ndarrays) or json object (i.e python dictionary). We offer support for input_example
with params by using tuple to combine model inputs and params. See examples below:</p>
<div class="section" id="how-to-log-model-with-column-based-example">
<h3>How To Log Model With Column-based Example<a class="headerlink" href="#how-to-log-model-with-column-based-example" title="Permalink to this headline"> </a></h3>
<p>For models accepting column-based inputs, an example can be a single record or a batch of records. The
sample input can be in the following formats:</p>
<ul class="simple">
<li><p>Pandas DataFrame</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dict</span></code> (of scalars, strings, or lists of scalar values)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">list</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">str</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bytes</span></code></p></li>
</ul>
<p>The given example will be converted to a Pandas DataFrame and then serialized to json using the Pandas split-oriented
format. Bytes are base64-encoded. The following example demonstrates how you can log a column-based
input example with your model:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">input_example</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;sepal length (cm)&quot;</span><span class="p">:</span> <span class="mf">5.1</span><span class="p">,</span>
    <span class="s2">&quot;sepal width (cm)&quot;</span><span class="p">:</span> <span class="mf">3.5</span><span class="p">,</span>
    <span class="s2">&quot;petal length (cm)&quot;</span><span class="p">:</span> <span class="mf">1.4</span><span class="p">,</span>
    <span class="s2">&quot;petal width (cm)&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">input_example</span><span class="o">=</span><span class="n">input_example</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-log-models-with-a-tensor-based-example">
<h3>How To Log Models With a Tensor-based Example<a class="headerlink" href="#how-to-log-models-with-a-tensor-based-example" title="Permalink to this headline"> </a></h3>
<p>For models accepting tensor-based inputs, an example must be a batch of inputs. By default, the axis 0
is the batch axis unless specified otherwise in the model signature. The sample input can be passed in
as any of the following formats:</p>
<ul class="simple">
<li><p>numpy ndarray</p></li>
<li><p>Python <code class="docutils literal notranslate"><span class="pre">dict</span></code> mapping a string to a numpy array</p></li>
<li><p>Scipy <code class="docutils literal notranslate"><span class="pre">csr_matrix</span></code> (sparse matrix)</p></li>
<li><p>Scipy <code class="docutils literal notranslate"><span class="pre">csc_matrix</span></code> (sparse matrix).</p></li>
</ul>
<p>The following example demonstrates how you can log a tensor-based input example with your model:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># each input has shape (4, 4)</span>
<span class="n">input_example</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">134</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">56</span><span class="p">],</span> <span class="p">[</span><span class="mi">253</span><span class="p">,</span> <span class="mi">242</span><span class="p">,</span> <span class="mi">195</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">93</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">82</span><span class="p">]],</span>
        <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">33</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">166</span><span class="p">],</span> <span class="p">[</span><span class="mi">76</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span> <span class="p">[</span><span class="mi">33</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">82</span><span class="p">]],</span>
    <span class="p">],</span>
    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">tensorflow</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">input_example</span><span class="o">=</span><span class="n">input_example</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-log-models-using-a-json-object-example">
<h3>How To Log Models Using a JSON Object Example<a class="headerlink" href="#how-to-log-models-using-a-json-object-example" title="Permalink to this headline"> </a></h3>
<p>For models accepting python dictionary inputs instead of pandas DataFrame, we support saving the example
directly as it is. To enable this, <code class="docutils literal notranslate"><span class="pre">example_no_conversion</span></code> should be set to <code class="docutils literal notranslate"><span class="pre">True</span></code> when logging the model.
This feature is only supported for langchain, openai, pyfunc and transformers flavors, where saving the example
directly is useful for inference and model serving.
By default, <code class="docutils literal notranslate"><span class="pre">example_no_conversion</span></code> is set to <code class="docutils literal notranslate"><span class="pre">False</span></code> for backwards compatibility.</p>
<p>The following example demonstrates how you can log a json object input example with your model:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">input_example</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are a helpful assistant.&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;What would you like to ask?&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Who owns MLflow?&quot;</span><span class="p">},</span>
    <span class="p">]</span>
<span class="p">}</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">langchain</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">input_example</span><span class="o">=</span><span class="n">input_example</span><span class="p">,</span> <span class="n">example_no_conversion</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-log-model-with-an-example-that-contains-params">
<h3>How To Log Model With an Example that Contains Params<a class="headerlink" href="#how-to-log-model-with-an-example-that-contains-params" title="Permalink to this headline"> </a></h3>
<p>For models that require additional parameters during inference, you can include an input_example
containing params when saving or logging the model. To achieve this, the sample input should be
provided as a <code class="docutils literal notranslate"><span class="pre">tuple</span></code>. The first element of the tuple is the input data example, and the
second element is a <code class="docutils literal notranslate"><span class="pre">dict</span></code> of params. A comprehensive list of valid params is documented in
<a class="reference internal" href="#inference-params"><span class="std std-ref">Model Inference Params</span></a> section.</p>
<ul class="simple">
<li><p>Python <code class="docutils literal notranslate"><span class="pre">tuple</span></code>: (input_data, params)</p></li>
</ul>
<p>The following example demonstrates how to log a model with an example containing params:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># input_example could be column-based or tensor-based example as shown above</span>
<span class="c1"># params must be a valid dictionary of params</span>
<span class="n">input_data</span> <span class="o">=</span> <span class="s2">&quot;Hello, Dolly!&quot;</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;top_k&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">input_example</span> <span class="o">=</span> <span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">transformers</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">input_example</span><span class="o">=</span><span class="n">input_example</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


              </div>
            </div>
            <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="dependencies.html" class="btn btn-neutral" title="Managing Dependencies in MLflow Models" accesskey="p"><span class="db-icon db-icon-chevron-left"></span> Previous</a>
      
      
        <a href="notebooks/signature_examples.html" class="btn btn-neutral" title="MLflow Signature Playground Notebook" accesskey="n">Next <span class="db-icon db-icon-chevron-right"></span></a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
      <p class="copyright">
          &copy; MLflow Project, a Series of LF Projects, LLC. All rights reserved.
      </p>

  </div> 

</footer>
          </div>
        </div>
      </section>
    </main>
  </page>

  


  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT:'../',
      VERSION:'2.9.3.dev0',
      COLLAPSE_INDEX:false,
      FILE_SUFFIX:'.html',
      LINK_SUFFIX: '.html',
      HAS_SOURCE:  true
    };
  </script>

  

  <script type="text/javascript" src="../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../_static/js/jquery.waypoints.min.js"></script>

  
  
  
  <script type="text/javascript">var CLIPPY_SVG_PATH = "../_static/clippy.svg";</script>
  <script type="text/javascript" src="../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  

  
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
        }
        // Get the code block designator class entries
        const allHighlights = document.querySelectorAll('.highlight');
        // Disable copyable links for notebook cell numbering and for cell outputs
        const highlights = Array.from(allHighlights).filter(highlight => !highlight.closest('.highlight-none') && 
            !highlight.closest('.nboutput'));
    
        highlights.forEach(function(highlight) {
            const copyIcon = document.createElement('span');
            copyIcon.classList.add('copy-icon');
            copyIcon.innerHTML = '&#xf0ea;';

            copyIcon.addEventListener('click', function() {
                const code = highlight.querySelector('pre').textContent;
                copyToClipboard(code);

                // Flash effect on click
                this.style.color = '#0194E2';
                setTimeout(() => {
                    this.style.color = ''; 
                }, 100);

                // Display "Code copied to clipboard" near the clicked icon
                const message = document.createElement('span');
                message.textContent = "Copied!";
                message.classList.add('copy-message'); 

                // Append the message to the icon
                this.appendChild(message);

                setTimeout(() => {
                    this.removeChild(message);
                }, 500);
            });

            highlight.appendChild(copyIcon);
        });
    });
  </script>


<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
        // Force download for notebook-download-btn
        const downloadButtons = document.querySelectorAll('.notebook-download-btn');
        downloadButtons.forEach(function(button) {
            button.addEventListener('click', function(event) {
                event.preventDefault(); // Prevent default behavior

                // Fetch the raw content of the notebook from GitHub
                fetch(button.href)
                    .then(response => response.blob())
                    .then(blob => {
                        const url = window.URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.style.display = 'none';
                        link.href = url;
                        const filename = button.href.split('/').pop();
                        link.download = filename; 

                        document.body.appendChild(link);
                        link.click();

                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(link);
                    })
                    .catch(err => console.error('Error fetching the notebook:', err));
            });
        });
    });
</script> 
</body>
</html>