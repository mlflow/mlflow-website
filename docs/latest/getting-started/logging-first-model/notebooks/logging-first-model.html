
  

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Initializing the MLflow Client &mdash; MLflow 2.9.3.dev0 documentation</title>
  
   
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="canonical" href="https://mlflow.org/docs/latest/getting-started/logging-first-model/notebooks/logging-first-model.html">
  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    

    

  
    

  

  
  
    

  

  
  
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600" rel="stylesheet">
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/cards.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/grids.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/mobile.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/simple-cards.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/tabs.css" type="text/css" />
    
  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="MLflow 2.9.3.dev0 documentation" href="../../../index.html"/>
        <link rel="up" title="Logging Your First MLflow Model Notebook" href="index.html"/>
        <link rel="next" title="New Features" href="/../../../new-features/index.html"/>
        <link rel="prev" title="Logging Your First MLflow Model Notebook" href="/index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>
<script type="text/javascript" src="../../../_static/jquery.js"></script>
<script type="text/javascript" src="../../../_static/underscore.js"></script>
<script type="text/javascript" src="../../../_static/doctools.js"></script>
<script type="text/javascript" src="../../../_static/languagesections.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/javascript" src="../../../None"></script>

<body class="wy-body-for-nav" role="document">
  

  
  <nav class="wy-nav-top header" role="navigation" aria-label="top navigation">
    <ul>
  <li class="menu-toggle">
    <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
    <a href="../../../index.html" class="wy-nav-top-logo"
      ><img src="../../../_static/MLflow-logo-final-black.png" alt="MLflow"
    /></a>
    <span class="version">2.9.3.dev0</span>
  </li>
</ul>
  </nav>
  <page>
    

    <nav data-toggle="wy-nav-shift" class="wy-nav-side relative">
      <div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
  </form>
</div>


    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../../../index.html" class="main-navigation-home"><img src="../../../_static/icons/nav-home.svg"> MLflow</a>
    

    
      

      
        <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/index.html">What is MLflow?</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Getting Started with MLflow</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../index.html#guidance-on-running-tutorials">Guidance on Running Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#getting-started-guides">Getting Started Guides</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html#further-learning-what-s-next">Further Learning - What’s Next?</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">Tutorial Overview</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../step1-tracking-server.html">Starting the MLflow Tracking Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="../step2-mlflow-client.html">Using the MLflow Client API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../step3-create-experiment.html">Creating Experiments</a></li>
<li class="toctree-l4"><a class="reference internal" href="../step4-experiment-search.html">Searching Experiments</a></li>
<li class="toctree-l4"><a class="reference internal" href="../step5-synthetic-data.html">Create a dataset about apples</a></li>
<li class="toctree-l4"><a class="reference internal" href="../step6-logging-a-run.html">Logging our first runs with MLflow</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="index.html">Logging Your First MLflow Model Notebook</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../new-features/index.html">New Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../llms/index.html">LLMs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../model-evaluation/index.html">Model Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../deep-learning/index.html">Deep Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../traditional-ml/index.html">Traditional ML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../deployment/index.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tracking.html">MLflow Tracking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../system-metrics/index.html">System Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../projects.html">MLflow Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../models.html">MLflow Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../model-registry.html">MLflow Model Registry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../recipes.html">MLflow Recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../plugins.html">MLflow Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auth/index.html">MLflow Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cli.html">Command-Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../search-runs.html">Search Runs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../search-experiments.html">Search Experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python_api/index.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../R-api.html">R API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../java_api/index.html">Java API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rest-api.html">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docker.html">Official MLflow Docker Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../community-model-flavors.html">Community Model Flavors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials-and-examples/index.html">Tutorials and Examples</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    

    <p>
      <a id='feedbacklink' href="https://github.com/mlflow/mlflow/blob/master/CONTRIBUTING.md" target="_blank">Contribute</a>
    </p>
  </div>
</div>
    </nav>

    <main class="wy-grid-for-nav">
      <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
        <div class="wy-nav-content">
          <div class="rst-content">
            










<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
        <li><a href="../../index.html">Getting Started with MLflow</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
        <li><a href="../index.html">Tutorial Overview</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
        <li><a href="index.html">Logging Your First MLflow Model Notebook</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>Initializing the MLflow Client</li>
    
    
    <!-- <li class="wy-breadcrumbs-aside">
      <a href="https://github.com/mlflow/mlflow/blob/master/docs/source/getting-started/logging-first-model/notebooks/logging-first-model.ipynb" class="fa fa-github"> Edit on GitHub</a>
    </li> -->
    
  </ul>
</div>
            <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
              <div itemprop="articleBody">
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mlflow</span> <span class="kn">import</span> <span class="n">MlflowClient</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
</pre></div>
</div>
</div>
<div class="section" id="Initializing-the-MLflow-Client">
<h1>Initializing the MLflow Client<a class="headerlink" href="#Initializing-the-MLflow-Client" title="Permalink to this headline"> </a></h1>
<p>Depending on where you are running this notebook, your configuration may vary for how you initialize the MLflow Client in the following cell.</p>
<p>For this example, we’re using a locally running tracking server, but other options are available (The easiest is to use the free managed service within <a class="reference external" href="https://community.cloud.databricks.com/">Databricks Community Edition</a>).</p>
<p>Please see <a class="reference external" href="https://www.mlflow.org/docs/latest/getting-started/running-notebooks/index.html">the guide to running notebooks here</a> for more information on setting the tracking server uri and configuring access to either managed or self-managed MLflow tracking servers.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NOTE: review the links mentioned above for guidance on connecting to a managed tracking server, such as the free Databricks Community Edition</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">MlflowClient</span><span class="p">(</span><span class="n">tracking_uri</span><span class="o">=</span><span class="s2">&quot;http://127.0.0.1:8080&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Search-Experiments-with-the-MLflow-Client-API">
<h2>Search Experiments with the MLflow Client API<a class="headerlink" href="#Search-Experiments-with-the-MLflow-Client-API" title="Permalink to this headline"> </a></h2>
<p>Let’s take a look at the Default Experiment that is created for us.</p>
<p>This safe ‘fallback’ experiment will store Runs that we create if we don’t specify a new experiment.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Search experiments without providing query terms behaves effectively as a &#39;list&#39; action</span>

<span class="n">all_experiments</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">search_experiments</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">all_experiments</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;Experiment: artifact_location=&#39;./mlruns/0&#39;, creation_time=None, experiment_id=&#39;0&#39;, last_update_time=None, lifecycle_stage=&#39;active&#39;, name=&#39;Default&#39;, tags={}&gt;]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract the experiment name and lifecycle_stage</span>

<span class="n">default_experiment</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">experiment</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;lifecycle_stage&quot;</span><span class="p">:</span> <span class="n">experiment</span><span class="o">.</span><span class="n">lifecycle_stage</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">experiment</span> <span class="ow">in</span> <span class="n">all_experiments</span>
    <span class="k">if</span> <span class="n">experiment</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Default&quot;</span>
<span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="n">pprint</span><span class="p">(</span><span class="n">default_experiment</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;lifecycle_stage&#39;: &#39;active&#39;, &#39;name&#39;: &#39;Default&#39;}
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Creating-a-new-Experiment">
<h1>Creating a new Experiment<a class="headerlink" href="#Creating-a-new-Experiment" title="Permalink to this headline"> </a></h1>
<p>In this section, we’ll:</p>
<ul class="simple">
<li><p>create a new MLflow Experiment</p></li>
<li><p>apply metadata in the form of Experiment Tags</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">experiment_description</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;This is the grocery forecasting project. &quot;</span>
    <span class="s2">&quot;This experiment contains the produce models for apples.&quot;</span>
<span class="p">)</span>

<span class="n">experiment_tags</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;project_name&quot;</span><span class="p">:</span> <span class="s2">&quot;grocery-forecasting&quot;</span><span class="p">,</span>
    <span class="s2">&quot;store_dept&quot;</span><span class="p">:</span> <span class="s2">&quot;produce&quot;</span><span class="p">,</span>
    <span class="s2">&quot;team&quot;</span><span class="p">:</span> <span class="s2">&quot;stores-ml&quot;</span><span class="p">,</span>
    <span class="s2">&quot;project_quarter&quot;</span><span class="p">:</span> <span class="s2">&quot;Q3-2023&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mlflow.note.content&quot;</span><span class="p">:</span> <span class="n">experiment_description</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">produce_apples_experiment</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_experiment</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Apple_Models&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">experiment_tags</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use search_experiments() to search on the project_name tag key</span>

<span class="n">apples_experiment</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">search_experiments</span><span class="p">(</span>
    <span class="n">filter_string</span><span class="o">=</span><span class="s2">&quot;tags.`project_name` = &#39;grocery-forecasting&#39;&quot;</span>
<span class="p">)</span>

<span class="n">pprint</span><span class="p">(</span><span class="n">apples_experiment</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Experiment: artifact_location=&#39;mlflow-artifacts:/977454266300166282&#39;, creation_time=1696346036899, experiment_id=&#39;977454266300166282&#39;, last_update_time=1696346036899, lifecycle_stage=&#39;active&#39;, name=&#39;Apple_Models&#39;, tags={&#39;mlflow.note.content&#39;: &#39;This is the grocery forecasting project. This &#39;
                        &#39;experiment contains the produce models for apples.&#39;,
 &#39;project_name&#39;: &#39;grocery-forecasting&#39;,
 &#39;project_quarter&#39;: &#39;Q3-2023&#39;,
 &#39;store_dept&#39;: &#39;produce&#39;,
 &#39;team&#39;: &#39;stores-ml&#39;}&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Access individual tag data</span>

<span class="nb">print</span><span class="p">(</span><span class="n">apples_experiment</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
stores-ml
</pre></div></div>
</div>
</div>
<div class="section" id="Running-our-first-model-training">
<h1>Running our first model training<a class="headerlink" href="#Running-our-first-model-training" title="Permalink to this headline"> </a></h1>
<p>In this section, we’ll:</p>
<ul class="simple">
<li><p>create a synthetic data set that is relevant to a simple demand forecasting task</p></li>
<li><p>start an MLflow run</p></li>
<li><p>log metrics, parameters, and tags to the run</p></li>
<li><p>save the model to the run</p></li>
<li><p>register the model during model logging</p></li>
</ul>
<div class="section" id="Synthetic-data-generator-for-demand-of-apples">
<h2>Synthetic data generator for demand of apples<a class="headerlink" href="#Synthetic-data-generator-for-demand-of-apples" title="Permalink to this headline"> </a></h2>
<p>Keep in mind that this is purely for demonstration purposes.</p>
<p>The demand value is purely artificial and is deliberately covariant with the features. This is not a particularly realistic real-world scenario (if it were, we wouldn’t need Data Scientists!).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>


<span class="k">def</span> <span class="nf">generate_apple_sales_data_with_promo_adjustment</span><span class="p">(</span><span class="n">base_demand</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">n_rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a synthetic dataset for predicting apple sales demand with seasonality and inflation.</span>

<span class="sd">    This function creates a pandas DataFrame with features relevant to apple sales.</span>
<span class="sd">    The features include date, average_temperature, rainfall, weekend flag, holiday flag,</span>
<span class="sd">    promotional flag, price_per_kg, and the previous day&#39;s demand. The target variable,</span>
<span class="sd">    &#39;demand&#39;, is generated based on a combination of these features with some added noise.</span>

<span class="sd">    Args:</span>
<span class="sd">        base_demand (int, optional): Base demand for apples. Defaults to 1000.</span>
<span class="sd">        n_rows (int, optional): Number of rows (days) of data to generate. Defaults to 5000.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: DataFrame with features and target variable for apple sales prediction.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; df = generate_apple_sales_data_with_seasonality(base_demand=1200, n_rows=6000)</span>
<span class="sd">        &gt;&gt;&gt; df.head()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Set seed for reproducibility</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">9999</span><span class="p">)</span>

    <span class="c1"># Create date range</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">)]</span>
    <span class="n">dates</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

    <span class="c1"># Generate features</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">dates</span><span class="p">,</span>
            <span class="s2">&quot;average_temperature&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="n">n_rows</span><span class="p">),</span>
            <span class="s2">&quot;rainfall&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_rows</span><span class="p">),</span>
            <span class="s2">&quot;weekend&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="n">date</span><span class="o">.</span><span class="n">weekday</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">],</span>
            <span class="s2">&quot;holiday&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">n_rows</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.97</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">]),</span>
            <span class="s2">&quot;price_per_kg&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">n_rows</span><span class="p">),</span>
            <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">date</span><span class="o">.</span><span class="n">month</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">],</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># Introduce inflation over time (years)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;inflation_multiplier&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">*</span> <span class="mf">0.03</span>

    <span class="c1"># Incorporate seasonality due to apple harvests</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;harvest_effect&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span>
        <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">9</span><span class="p">)</span> <span class="o">/</span> <span class="mi">12</span>
    <span class="p">)</span>

    <span class="c1"># Modify the price_per_kg based on harvest effect</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;price_per_kg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;price_per_kg&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;harvest_effect&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.5</span>

    <span class="c1"># Adjust promo periods to coincide with periods lagging peak harvest by 1 month</span>
    <span class="n">peak_months</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>  <span class="c1"># months following the peak availability</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;promo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">peak_months</span><span class="p">),</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">n_rows</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">]),</span>
    <span class="p">)</span>

    <span class="c1"># Generate target variable based on features</span>
    <span class="n">base_price_effect</span> <span class="o">=</span> <span class="o">-</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;price_per_kg&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">50</span>
    <span class="n">seasonality_effect</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;harvest_effect&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">50</span>
    <span class="n">promo_effect</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;promo&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">200</span>

    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;demand&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">base_demand</span>
        <span class="o">+</span> <span class="n">base_price_effect</span>
        <span class="o">+</span> <span class="n">seasonality_effect</span>
        <span class="o">+</span> <span class="n">promo_effect</span>
        <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;weekend&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">300</span>
        <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">n_rows</span><span class="p">)</span>
    <span class="p">)</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span>
        <span class="s2">&quot;inflation_multiplier&quot;</span>
    <span class="p">]</span>  <span class="c1"># adding random noise</span>

    <span class="c1"># Add previous day&#39;s demand</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;previous_days_demand&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;demand&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;previous_days_demand&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;bfill&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># fill the first row</span>

    <span class="c1"># Drop temporary columns</span>
    <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;inflation_multiplier&quot;</span><span class="p">,</span> <span class="s2">&quot;harvest_effect&quot;</span><span class="p">,</span> <span class="s2">&quot;month&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate the dataset!</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">generate_apple_sales_data_with_promo_adjustment</span><span class="p">(</span><span class="n">base_demand</span><span class="o">=</span><span class="mi">1_000</span><span class="p">,</span> <span class="n">n_rows</span><span class="o">=</span><span class="mi">1_000</span><span class="p">)</span>

<span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">20</span><span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>average_temperature</th>
      <th>rainfall</th>
      <th>weekend</th>
      <th>holiday</th>
      <th>price_per_kg</th>
      <th>promo</th>
      <th>demand</th>
      <th>previous_days_demand</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>980</th>
      <td>2023-09-14 11:13:56.948267</td>
      <td>34.130183</td>
      <td>1.454065</td>
      <td>0</td>
      <td>0</td>
      <td>1.449177</td>
      <td>0</td>
      <td>971.802447</td>
      <td>1001.085782</td>
    </tr>
    <tr>
      <th>981</th>
      <td>2023-09-15 11:13:56.948267</td>
      <td>32.353643</td>
      <td>9.462859</td>
      <td>0</td>
      <td>0</td>
      <td>2.856503</td>
      <td>0</td>
      <td>818.951553</td>
      <td>971.802447</td>
    </tr>
    <tr>
      <th>982</th>
      <td>2023-09-16 11:13:56.948266</td>
      <td>18.816833</td>
      <td>0.391470</td>
      <td>1</td>
      <td>0</td>
      <td>1.326429</td>
      <td>0</td>
      <td>1281.352029</td>
      <td>818.951553</td>
    </tr>
    <tr>
      <th>983</th>
      <td>2023-09-17 11:13:56.948265</td>
      <td>34.533012</td>
      <td>2.120477</td>
      <td>1</td>
      <td>0</td>
      <td>0.970131</td>
      <td>0</td>
      <td>1357.385504</td>
      <td>1281.352029</td>
    </tr>
    <tr>
      <th>984</th>
      <td>2023-09-18 11:13:56.948265</td>
      <td>23.057202</td>
      <td>2.365705</td>
      <td>0</td>
      <td>0</td>
      <td>1.049931</td>
      <td>0</td>
      <td>991.427049</td>
      <td>1357.385504</td>
    </tr>
    <tr>
      <th>985</th>
      <td>2023-09-19 11:13:56.948264</td>
      <td>34.810165</td>
      <td>3.089005</td>
      <td>0</td>
      <td>0</td>
      <td>2.035149</td>
      <td>0</td>
      <td>974.971149</td>
      <td>991.427049</td>
    </tr>
    <tr>
      <th>986</th>
      <td>2023-09-20 11:13:56.948263</td>
      <td>29.208905</td>
      <td>3.673292</td>
      <td>0</td>
      <td>0</td>
      <td>2.518098</td>
      <td>0</td>
      <td>1056.249547</td>
      <td>974.971149</td>
    </tr>
    <tr>
      <th>987</th>
      <td>2023-09-21 11:13:56.948263</td>
      <td>16.428676</td>
      <td>4.077782</td>
      <td>0</td>
      <td>0</td>
      <td>1.268979</td>
      <td>0</td>
      <td>1063.118915</td>
      <td>1056.249547</td>
    </tr>
    <tr>
      <th>988</th>
      <td>2023-09-22 11:13:56.948262</td>
      <td>32.067512</td>
      <td>2.734454</td>
      <td>0</td>
      <td>0</td>
      <td>0.762317</td>
      <td>0</td>
      <td>1040.492007</td>
      <td>1063.118915</td>
    </tr>
    <tr>
      <th>989</th>
      <td>2023-09-23 11:13:56.948261</td>
      <td>31.938203</td>
      <td>13.883486</td>
      <td>1</td>
      <td>0</td>
      <td>1.153301</td>
      <td>0</td>
      <td>1285.040470</td>
      <td>1040.492007</td>
    </tr>
    <tr>
      <th>990</th>
      <td>2023-09-24 11:13:56.948261</td>
      <td>18.024055</td>
      <td>7.544061</td>
      <td>1</td>
      <td>0</td>
      <td>0.610703</td>
      <td>0</td>
      <td>1366.644564</td>
      <td>1285.040470</td>
    </tr>
    <tr>
      <th>991</th>
      <td>2023-09-25 11:13:56.948260</td>
      <td>20.681067</td>
      <td>18.820490</td>
      <td>0</td>
      <td>0</td>
      <td>1.533488</td>
      <td>0</td>
      <td>973.934924</td>
      <td>1366.644564</td>
    </tr>
    <tr>
      <th>992</th>
      <td>2023-09-26 11:13:56.948259</td>
      <td>16.010132</td>
      <td>7.705941</td>
      <td>0</td>
      <td>0</td>
      <td>1.632498</td>
      <td>1</td>
      <td>1188.291256</td>
      <td>973.934924</td>
    </tr>
    <tr>
      <th>993</th>
      <td>2023-09-27 11:13:56.948259</td>
      <td>18.766455</td>
      <td>6.274840</td>
      <td>0</td>
      <td>0</td>
      <td>2.806554</td>
      <td>0</td>
      <td>930.089438</td>
      <td>1188.291256</td>
    </tr>
    <tr>
      <th>994</th>
      <td>2023-09-28 11:13:56.948258</td>
      <td>27.948793</td>
      <td>23.705246</td>
      <td>0</td>
      <td>0</td>
      <td>0.829464</td>
      <td>0</td>
      <td>1060.576311</td>
      <td>930.089438</td>
    </tr>
    <tr>
      <th>995</th>
      <td>2023-09-29 11:13:56.948257</td>
      <td>28.661072</td>
      <td>10.329865</td>
      <td>0</td>
      <td>0</td>
      <td>2.290591</td>
      <td>0</td>
      <td>910.690776</td>
      <td>1060.576311</td>
    </tr>
    <tr>
      <th>996</th>
      <td>2023-09-30 11:13:56.948256</td>
      <td>10.821693</td>
      <td>3.575645</td>
      <td>1</td>
      <td>0</td>
      <td>0.897473</td>
      <td>0</td>
      <td>1306.363801</td>
      <td>910.690776</td>
    </tr>
    <tr>
      <th>997</th>
      <td>2023-10-01 11:13:56.948256</td>
      <td>21.108560</td>
      <td>6.221089</td>
      <td>1</td>
      <td>0</td>
      <td>1.093864</td>
      <td>1</td>
      <td>1564.422372</td>
      <td>1306.363801</td>
    </tr>
    <tr>
      <th>998</th>
      <td>2023-10-02 11:13:56.948254</td>
      <td>29.451301</td>
      <td>5.021463</td>
      <td>0</td>
      <td>0</td>
      <td>2.493085</td>
      <td>1</td>
      <td>1164.303256</td>
      <td>1564.422372</td>
    </tr>
    <tr>
      <th>999</th>
      <td>2023-10-03 11:13:56.948248</td>
      <td>19.261458</td>
      <td>0.438381</td>
      <td>0</td>
      <td>0</td>
      <td>2.610422</td>
      <td>1</td>
      <td>1067.963448</td>
      <td>1164.303256</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
</div>
<div class="section" id="Train-and-log-the-model">
<h1>Train and log the model<a class="headerlink" href="#Train-and-log-the-model" title="Permalink to this headline"> </a></h1>
<p>We’re now ready to import our model class and train a <code class="docutils literal notranslate"><span class="pre">RandomForestRegressor</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>


<span class="c1"># Use the fluent API to set the tracking uri and the active experiment</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="s2">&quot;http://127.0.0.1:8080&quot;</span><span class="p">)</span>

<span class="c1"># Sets the current active experiment to the &quot;Apple_Models&quot; experiment and returns the Experiment metadata</span>
<span class="n">apple_experiment</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Apple_Models&quot;</span><span class="p">)</span>

<span class="c1"># Define a run name for this iteration of training.</span>
<span class="c1"># If this is not set, a unique name will be auto-generated for your run.</span>
<span class="n">run_name</span> <span class="o">=</span> <span class="s2">&quot;apples_rf_test&quot;</span>

<span class="c1"># Define an artifact path that the model will be saved to.</span>
<span class="n">artifact_path</span> <span class="o">=</span> <span class="s2">&quot;rf_apples&quot;</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Split the data into features and target and drop irrelevant date field and target field</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;demand&quot;</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;demand&quot;</span><span class="p">]</span>

<span class="c1"># Split the data into training and validation sets</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_val</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;n_estimators&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="s2">&quot;min_samples_split&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s2">&quot;min_samples_leaf&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s2">&quot;bootstrap&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;oob_score&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;random_state&quot;</span><span class="p">:</span> <span class="mi">888</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Train the RandomForestRegressor</span>
<span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

<span class="c1"># Fit the model on the training data</span>
<span class="n">rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Predict on the validation set</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">rf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>

<span class="c1"># Calculate error metrics</span>
<span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="c1"># Assemble the metrics we&#39;re going to write into a collection</span>
<span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;mae&quot;</span><span class="p">:</span> <span class="n">mae</span><span class="p">,</span> <span class="s2">&quot;mse&quot;</span><span class="p">:</span> <span class="n">mse</span><span class="p">,</span> <span class="s2">&quot;rmse&quot;</span><span class="p">:</span> <span class="n">rmse</span><span class="p">,</span> <span class="s2">&quot;r2&quot;</span><span class="p">:</span> <span class="n">r2</span><span class="p">}</span>

<span class="c1"># Initiate the MLflow run context</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="n">run_name</span><span class="p">)</span> <span class="k">as</span> <span class="n">run</span><span class="p">:</span>
    <span class="c1"># Log the parameters used for the model fit</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># Log the error metrics that were calculated during validation</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>

    <span class="c1"># Log an instance of the trained model for later use</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">sk_model</span><span class="o">=</span><span class="n">rf</span><span class="p">,</span> <span class="n">input_example</span><span class="o">=</span><span class="n">X_val</span><span class="p">,</span> <span class="n">artifact_path</span><span class="o">=</span><span class="n">artifact_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/benjamin.wilson/miniconda3/envs/mlflow-dev-env/lib/python3.8/site-packages/mlflow/models/signature.py:333: UserWarning: Hint: Inferred schema contains integer column(s). Integer columns in Python cannot represent missing values. If your input data contains missing values at inference time, it will be encoded as floats and will cause a schema enforcement error. The best way to avoid this problem is to infer the model schema based on a realistic data sample (training dataset) that includes missing values. Alternatively, you can declare integer columns as doubles (float64) whenever these columns may have missing values. See `Handling Integers With Missing Values &lt;https://www.mlflow.org/docs/latest/models.html#handling-integers-with-missing-values&gt;`_ for more details.
  input_schema = _infer_schema(input_ex)
/Users/benjamin.wilson/miniconda3/envs/mlflow-dev-env/lib/python3.8/site-packages/_distutils_hack/__init__.py:30: UserWarning: Setuptools is replacing distutils.
  warnings.warn(&#34;Setuptools is replacing distutils.&#34;)
</pre></div></div>
</div>
<div class="section" id="Success!">
<h2>Success!<a class="headerlink" href="#Success!" title="Permalink to this headline"> </a></h2>
<p>You’ve just logged your first MLflow model!</p>
<p>Navigate to the MLflow UI to see the run that was just created (named “apples_rf_test”, logged to the Experiment “Apple_Models”).</p>
</div>
</div>


              </div>
            </div>
            <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="index.html" class="btn btn-neutral" title="Logging Your First MLflow Model Notebook" accesskey="p"><span class="db-icon db-icon-chevron-left"></span> Previous</a>
      
      
        <a href="../../../new-features/index.html" class="btn btn-neutral" title="New Features" accesskey="n">Next <span class="db-icon db-icon-chevron-right"></span></a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
      <p class="copyright">
          &copy; MLflow Project, a Series of LF Projects, LLC. All rights reserved.
      </p>

  </div> 

</footer>
          </div>
        </div>
      </section>
    </main>
  </page>

  


  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT:'../../../',
      VERSION:'2.9.3.dev0',
      COLLAPSE_INDEX:false,
      FILE_SUFFIX:'.html',
      LINK_SUFFIX: '.html',
      HAS_SOURCE:  true
    };
  </script>

  

  <script type="text/javascript" src="../../../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../../../_static/js/jquery.waypoints.min.js"></script>

  
  
  
  <script type="text/javascript">var CLIPPY_SVG_PATH = "../../../_static/clippy.svg";</script>
  <script type="text/javascript" src="../../../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  

  
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
        }
        // Get the code block designator class entries
        const allHighlights = document.querySelectorAll('.highlight');
        // Disable copyable links for notebook cell numbering and for cell outputs
        const highlights = Array.from(allHighlights).filter(highlight => !highlight.closest('.highlight-none') && 
            !highlight.closest('.nboutput'));
    
        highlights.forEach(function(highlight) {
            const copyIcon = document.createElement('span');
            copyIcon.classList.add('copy-icon');
            copyIcon.innerHTML = '&#xf0ea;';

            copyIcon.addEventListener('click', function() {
                const code = highlight.querySelector('pre').textContent;
                copyToClipboard(code);

                // Flash effect on click
                this.style.color = '#0194E2';
                setTimeout(() => {
                    this.style.color = ''; 
                }, 100);

                // Display "Code copied to clipboard" near the clicked icon
                const message = document.createElement('span');
                message.textContent = "Copied!";
                message.classList.add('copy-message'); 

                // Append the message to the icon
                this.appendChild(message);

                setTimeout(() => {
                    this.removeChild(message);
                }, 500);
            });

            highlight.appendChild(copyIcon);
        });
    });
  </script>


<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
        // Force download for notebook-download-btn
        const downloadButtons = document.querySelectorAll('.notebook-download-btn');
        downloadButtons.forEach(function(button) {
            button.addEventListener('click', function(event) {
                event.preventDefault(); // Prevent default behavior

                // Fetch the raw content of the notebook from GitHub
                fetch(button.href)
                    .then(response => response.blob())
                    .then(blob => {
                        const url = window.URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.style.display = 'none';
                        link.href = url;
                        const filename = button.href.split('/').pop();
                        link.download = filename; 

                        document.body.appendChild(link);
                        link.click();

                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(link);
                    })
                    .catch(err => console.error('Error fetching the notebook:', err));
            });
        });
    });
</script> 
</body>
</html>