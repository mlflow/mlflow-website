<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-traditional-ml/hyperparameter-tuning-with-child-runs/notebooks/hyperparameter-tuning-with-child-runs-ipynb" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">MLflow with Optuna: Hyperparameter Optimization and Tracking | MLflow</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://mlflow.org/docs/latest/traditional-ml/hyperparameter-tuning-with-child-runs/notebooks/hyperparameter-tuning-with-child-runs"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="MLflow with Optuna: Hyperparameter Optimization and Tracking | MLflow"><meta data-rh="true" name="description" content="Download this notebook"><meta data-rh="true" property="og:description" content="Download this notebook"><link data-rh="true" rel="icon" href="/docs/latest/images/favicon.ico"><link data-rh="true" rel="canonical" href="https://mlflow.org/docs/latest/traditional-ml/hyperparameter-tuning-with-child-runs/notebooks/hyperparameter-tuning-with-child-runs"><link data-rh="true" rel="alternate" href="https://mlflow.org/docs/latest/traditional-ml/hyperparameter-tuning-with-child-runs/notebooks/hyperparameter-tuning-with-child-runs" hreflang="en"><link data-rh="true" rel="alternate" href="https://mlflow.org/docs/latest/traditional-ml/hyperparameter-tuning-with-child-runs/notebooks/hyperparameter-tuning-with-child-runs" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://XKVLO8P882-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-N6WMTTJ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-N6WMTTJ",{anonymize_ip:!0}),gtag("config","AW-16857946923",{anonymize_ip:!0})</script>
<link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var g=t.getElementsByTagName(a)[0],m=t.createElement(a);m.async=!0,m.src="https://www.googletagmanager.com/gtm.js?id=GTM-N6WMTTJ",g.parentNode.insertBefore(m,g)}(window,document,"script","dataLayer")</script>



<link rel="search" type="application/opensearchdescription+xml" title="MLflow" href="/docs/latest/opensearch.xml">

<script src="/docs/latest/js/runllm.js" defer="defer"></script><link rel="stylesheet" href="/docs/latest/assets/css/styles.504e3d8b.css">
<script src="/docs/latest/assets/js/runtime~main.e257ea22.js" defer="defer"></script>
<script src="/docs/latest/assets/js/main.f3dd3600.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N6WMTTJ" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/latest/"><div class="navbar__logo"><img src="/docs/latest/images/logo-light.svg" alt="MLflow Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs/latest/images/logo-dark.svg" alt="MLflow Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/latest/">Docs</a><a href="https://mlflow.org/docs/latest/api_reference/index.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API Reference</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/mlflow/mlflow" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item sidebar-top-level-category"><a class="menu__link" href="/docs/latest/">MLflow</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-top-level-category"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/latest/mlflow-3/">MLflow 3.0</a><button aria-label="Expand sidebar category &#x27;MLflow 3.0&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-top-level-category"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/latest/getting-started/">Getting Started</a><button aria-label="Expand sidebar category &#x27;Getting Started&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item sidebar-top-level-category"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/latest/llms/">Machine Learning 🧠</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/latest/llms/">LLM / GenAI</a><button aria-label="Expand sidebar category &#x27;LLM / GenAI&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/latest/deep-learning/">Deep Learning</a><button aria-label="Expand sidebar category &#x27;Deep Learning&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/latest/traditional-ml/">Traditional ML</a><button aria-label="Collapse sidebar category &#x27;Traditional ML&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/traditional-ml/">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/latest/traditional-ml/hyperparameter-tuning-with-child-runs/">Hyperparameter Tuning with MLflow and Optuna</a><button aria-label="Collapse sidebar category &#x27;Hyperparameter Tuning with MLflow and Optuna&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/latest/traditional-ml/hyperparameter-tuning-with-child-runs/notebooks/">Full Notebooks</a><button aria-label="Collapse sidebar category &#x27;Full Notebooks&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/latest/traditional-ml/hyperparameter-tuning-with-child-runs/notebooks/hyperparameter-tuning-with-child-runs">MLflow with Optuna: Hyperparameter Optimization and Tracking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/traditional-ml/hyperparameter-tuning-with-child-runs/notebooks/logging-plots-in-mlflow">Logging Visualizations with MLflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/traditional-ml/hyperparameter-tuning-with-child-runs/notebooks/parent-child-runs">Leveraging Child Runs in MLflow for Hyperparameter Tuning</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/traditional-ml/hyperparameter-tuning-with-child-runs/part1-child-runs/">The Parent-Child relationship with runs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/traditional-ml/hyperparameter-tuning-with-child-runs/part2-logging-plots/">Logging plots with MLflow</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/latest/traditional-ml/creating-custom-pyfunc/">Building Custom Python Function Models with MLflow</a><button aria-label="Expand sidebar category &#x27;Building Custom Python Function Models with MLflow&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/latest/traditional-ml/serving-multiple-models-with-pyfunc/">Serving Multiple Models on a Single Endpoint with a Custom PyFunc Model</a><button aria-label="Expand sidebar category &#x27;Serving Multiple Models on a Single Endpoint with a Custom PyFunc Model&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item sidebar-top-level-category"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/latest/tracking/">Build 🔨 </a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/latest/tracking/">MLflow Tracking</a><button aria-label="Expand sidebar category &#x27;MLflow Tracking&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/latest/model/">MLflow Model</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/latest/prompts/">MLflow Prompts 🆕</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item sidebar-top-level-category"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/latest/model-evaluation/">Evaluate &amp; Monitor 📊</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/model-evaluation/">MLflow Evaluation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/latest/tracing/">MLflow Tracing (Observability)</a><button aria-label="Expand sidebar category &#x27;MLflow Tracing (Observability)&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/dataset/">MLflow Dataset</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item sidebar-top-level-category"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/latest/model-registry/">Deploy 🚀</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/model-registry/">MLflow Model Registry</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/latest/deployment/">MLflow Serving</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/latest/llms/deployments/">MLflow AI Gateway</a><button aria-label="Expand sidebar category &#x27;MLflow AI Gateway&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-top-level-category"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/latest/tracking/#tracking-setup">Team Collaboration 👥</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-top-level-category"><div class="menu__list-item-collapsible"><a href="https://mlflow.org/docs/latest/api_reference/python_api/index.html" target="_blank" rel="noopener noreferrer" class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false">API References</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-top-level-category"><div class="menu__list-item-collapsible"><a href="https://github.com/mlflow/mlflow/blob/master/CONTRIBUTING.md" target="_blank" rel="noopener noreferrer" class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false">More</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs/latest/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Machine Learning 🧠</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/latest/traditional-ml/"><span itemprop="name">Traditional ML</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/latest/traditional-ml/hyperparameter-tuning-with-child-runs/"><span itemprop="name">Hyperparameter Tuning with MLflow and Optuna</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/latest/traditional-ml/hyperparameter-tuning-with-child-runs/notebooks/"><span itemprop="name">Full Notebooks</span></a><meta itemprop="position" content="4"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">MLflow with Optuna: Hyperparameter Optimization and Tracking</span><meta itemprop="position" content="5"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>MLflow with Optuna: Hyperparameter Optimization and Tracking</h1></header>
<a class="button button--primary" style="margin-bottom:1rem;display:block;width:min-content" href="https://raw.githubusercontent.com/mlflow/mlflow/master/docs/docs/traditional-ml/hyperparameter-tuning-with-child-runs/notebooks/hyperparameter-tuning-with-child-runs.ipynb" download="">Download this notebook</a>
<p>A critical part of building production-grade models is ensuring that a given model&#x27;s parameters are selected to create the best inference set possible. However, the sheer number of combinations and their resultant metrics can become overwhelming to track manually. That&#x27;s where tools like MLflow and Optuna come into play.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="objective">Objective:<a href="#objective" class="hash-link" aria-label="Direct link to Objective:" title="Direct link to Objective:">​</a></h3>
<p>In this notebook, you&#x27;ll learn how to integrate MLflow with Optuna for hyperparameter optimization. We&#x27;ll guide you through the process of:</p>
<ul>
<li>Setting up your environment with MLflow tracking.</li>
<li>Generating our training and evaluation data sets.</li>
<li>Defining a partial function that fits a machine learning model.</li>
<li>Using Optuna for hyperparameter tuning.</li>
<li>Leveraging child runs within MLflow to keep track of each iteration during the hyperparameter tuning process.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-optuna">Why Optuna?<a href="#why-optuna" class="hash-link" aria-label="Direct link to Why Optuna?" title="Direct link to Why Optuna?">​</a></h3>
<p>Optuna is an open-source hyperparameter optimization framework in Python. It provides an efficient approach to searching over hyperparameters, incorporating the latest research and techniques. With its integration into MLflow, every trial can be systematically recorded.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="child-runs-in-mlflow">Child Runs in MLflow:<a href="#child-runs-in-mlflow" class="hash-link" aria-label="Direct link to Child Runs in MLflow:" title="Direct link to Child Runs in MLflow:">​</a></h3>
<p>One of the core features we will be emphasizing is the concept of &#x27;child runs&#x27; in MLflow. When performing hyperparameter tuning, each iteration (or trial) in Optuna can be considered a &#x27;child run&#x27;. This allows us to group all the runs under one primary &#x27;parent run&#x27;, ensuring that the MLflow UI remains organized and interpretable. Each child run will track the specific hyperparameters used and the resulting metrics, providing a consolidated view of the entire optimization process.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="whats-ahead">What&#x27;s Ahead?<a href="#whats-ahead" class="hash-link" aria-label="Direct link to What&#x27;s Ahead?" title="Direct link to What&#x27;s Ahead?">​</a></h3>
<p><strong>Data Preparation</strong>: We&#x27;ll start by loading and preprocessing our dataset.</p>
<p><strong>Model Definition</strong>: Defining a machine learning model that we aim to optimize.</p>
<p><strong>Optuna Study</strong>: Setting up an Optuna study to find the best hyperparameters for our model.</p>
<p><strong>MLflow Integration</strong>: Tracking each Optuna trial as a child run in MLflow.</p>
<p><strong>Analysis</strong>: Reviewing the tracked results in the MLflow UI.</p>
<p>By the end of this notebook, you&#x27;ll have hands-on experience in setting up an advanced hyperparameter tuning workflow, emphasizing best practices and clean organization using MLflow and Optuna.</p>
<p><strong>Let&#x27;s dive in!</strong></p>
<div style="flex-grow:1;min-width:0;margin-top:var(--padding-md);width:100%"><div class="codeBlock_oJcR language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> math</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> datetime </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timedelta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> optuna</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> pd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> xgboost </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> xgb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metrics </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> mean_squared_error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model_selection </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> train_test_split</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> mlflow</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-the-tracking-server-uri">Configure the tracking server uri<a href="#configure-the-tracking-server-uri" class="hash-link" aria-label="Direct link to Configure the tracking server uri" title="Direct link to Configure the tracking server uri">​</a></h3>
<p>Depending on where you are running this notebook, your configuration may vary for how you initialize the interface with the MLflow Tracking Server.</p>
<p>For this example, we&#x27;re using a locally running tracking server, but other options are available (The easiest is to use the free managed service within <a href="https://mlflow.org/docs/latest/getting-started/databricks-trial.html" target="_blank" rel="noopener noreferrer">Databricks Free Trial</a>).</p>
<p>Please see <a href="https://www.mlflow.org/docs/latest/getting-started/running-notebooks/" target="_blank" rel="noopener noreferrer">the guide to running notebooks here</a> for more information on setting the tracking server uri and configuring access to either managed or self-managed MLflow tracking servers.</p>
<div style="flex-grow:1;min-width:0;margin-top:var(--padding-md);width:100%"><div class="codeBlock_oJcR language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># NOTE: review the links mentioned above for guidance on connecting to a managed tracking server, such as the Databricks managed MLflow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_tracking_uri</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;http://localhost:8080&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="generate-our-synthetic-training-data">Generate our synthetic training data<a href="#generate-our-synthetic-training-data" class="hash-link" aria-label="Direct link to Generate our synthetic training data" title="Direct link to Generate our synthetic training data">​</a></h3>
<p>If you&#x27;ve followed along with the introductory tutorial &quot;Logging your first model with MLflow&quot;, then you&#x27;re familiar with the apples sales data generator that we created for that tutorial.</p>
<p>Here, we&#x27;re expanding upon the data to create a slightly more complex dataset that should have improved correlation effects between the features and the target variable (the demand).</p>
<div style="flex-grow:1;min-width:0;margin-top:var(--padding-md);width:100%"><div class="codeBlock_oJcR language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">generate_apple_sales_data_with_promo_adjustment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  base_demand</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  n_rows</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  competitor_price_effect</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">50.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  Generates a synthetic dataset for predicting apple sales demand with multiple</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  influencing factors.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  This function creates a pandas DataFrame with features relevant to apple sales.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  The features include date, average_temperature, rainfall, weekend flag, holiday flag,</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  promotional flag, price_per_kg, competitor&#x27;s price, marketing intensity, stock availability,</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  and the previous day&#x27;s demand. The target variable, &#x27;demand&#x27;, is generated based on a</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  combination of these features with some added noise.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  Args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">      base_demand (int, optional): Base demand for apples. Defaults to 1000.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">      n_rows (int, optional): Number of rows (days) of data to generate. Defaults to 5000.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">      competitor_price_effect (float, optional): Effect of competitor&#x27;s price being lower</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">                                                 on our sales. Defaults to -50.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  Returns:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">      pd.DataFrame: DataFrame with features and target variable for apple sales prediction.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  Example:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">      &gt;&gt;&gt; df = generate_apple_sales_data_with_promo_adjustment(base_demand=1200, n_rows=6000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">      &gt;&gt;&gt; df.head()</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Set seed for reproducibility</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">seed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">9999</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Create date range</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dates </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">datetime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> timedelta</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">days</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n_rows</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dates</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reverse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Generate features</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&quot;date&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> dates</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&quot;average_temperature&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">uniform</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">35</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n_rows</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&quot;rainfall&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exponential</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n_rows</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&quot;weekend&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">date</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">weekday</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> date </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> dates</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&quot;holiday&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">choice</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n_rows</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> p</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0.97</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.03</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&quot;price_per_kg&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">uniform</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n_rows</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&quot;month&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">date</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">month </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> date </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> dates</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Introduce inflation over time (years)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;inflation_multiplier&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;date&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">year </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;date&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">year</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.03</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Incorporate seasonality due to apple harvests</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;harvest_effect&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pi </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;month&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pi </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;month&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Modify the price_per_kg based on harvest effect</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;price_per_kg&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;price_per_kg&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;harvest_effect&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Adjust promo periods to coincide with periods lagging peak harvest by 1 month</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  peak_months </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># months following the peak availability</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;promo&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">where</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;month&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">isin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">peak_months</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">choice</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n_rows</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> p</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0.85</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.15</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Generate target variable based on features</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  base_price_effect </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;price_per_kg&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  seasonality_effect </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;harvest_effect&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  promo_effect </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;promo&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;demand&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      base_demand</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> base_price_effect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> seasonality_effect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> promo_effect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;weekend&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">300</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">normal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n_rows</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;inflation_multiplier&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># adding random noise</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Add previous day&#x27;s demand</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;previous_days_demand&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;demand&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shift</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;previous_days_demand&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fillna</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">method</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;bfill&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> inplace</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># fill the first row</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Introduce competitor pricing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;competitor_price_per_kg&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">uniform</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n_rows</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;competitor_price_effect&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;competitor_price_per_kg&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;price_per_kg&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> competitor_price_effect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Stock availability based on past sales price (3 days lag with logarithmic decay)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  log_decay </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;price_per_kg&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shift</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;stock_available&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">clip</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">log_decay</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.7</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Marketing intensity based on stock availability</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Identify where stock is above threshold</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  high_stock_indices </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;stock_available&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.95</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">index</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># For each high stock day, increase marketing intensity for the next week</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> idx </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> high_stock_indices</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">idx </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">idx </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n_rows </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;marketing_intensity&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">uniform</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.7</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># If the marketing_intensity column already has values, this will preserve them;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#  if not, it sets default values</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fill_values </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Series</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">uniform</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n_rows</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> index</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;marketing_intensity&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fillna</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fill_values</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> inplace</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Adjust demand with new factors</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;demand&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;demand&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;competitor_price_effect&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;marketing_intensity&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Drop temporary columns</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">drop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      columns</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&quot;inflation_multiplier&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&quot;harvest_effect&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&quot;month&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&quot;competitor_price_effect&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&quot;stock_available&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      inplace</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> df</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<div style="flex-grow:1;min-width:0;margin-top:var(--padding-md);width:100%"><div class="codeBlock_oJcR language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> generate_apple_sales_data_with_promo_adjustment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">base_demand</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1_000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n_rows</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<div style="flex-grow:1;min-width:0;font-size:0.8rem;width:100%"><div><div>
<style scoped>
  .dataframe tbody tr th:only-of-type {
      vertical-align: middle;
  }

  .dataframe tbody tr th {
      vertical-align: top;
  }

  .dataframe thead th {
      text-align: right;
  }
</style>
<table border="1" class="dataframe">
<thead>
  <tr style="text-align: right;">
    <th></th>
    <th>date</th>
    <th>average_temperature</th>
    <th>rainfall</th>
    <th>weekend</th>
    <th>holiday</th>
    <th>price_per_kg</th>
    <th>promo</th>
    <th>demand</th>
    <th>previous_days_demand</th>
    <th>competitor_price_per_kg</th>
    <th>marketing_intensity</th>
  </tr>
</thead>
<tbody>
  <tr>
    <th>0</th>
    <td>2010-01-14 11:52:20.662955</td>
    <td>30.584727</td>
    <td>1.199291</td>
    <td>0</td>
    <td>0</td>
    <td>1.726258</td>
    <td>0</td>
    <td>851.375336</td>
    <td>851.276659</td>
    <td>1.935346</td>
    <td>0.098677</td>
  </tr>
  <tr>
    <th>1</th>
    <td>2010-01-15 11:52:20.662954</td>
    <td>15.465069</td>
    <td>1.037626</td>
    <td>0</td>
    <td>0</td>
    <td>0.576471</td>
    <td>0</td>
    <td>906.855943</td>
    <td>851.276659</td>
    <td>2.344720</td>
    <td>0.019318</td>
  </tr>
  <tr>
    <th>2</th>
    <td>2010-01-16 11:52:20.662954</td>
    <td>10.786525</td>
    <td>5.656089</td>
    <td>1</td>
    <td>0</td>
    <td>2.513328</td>
    <td>0</td>
    <td>1108.304909</td>
    <td>906.836626</td>
    <td>0.998803</td>
    <td>0.409485</td>
  </tr>
  <tr>
    <th>3</th>
    <td>2010-01-17 11:52:20.662953</td>
    <td>23.648154</td>
    <td>12.030937</td>
    <td>1</td>
    <td>0</td>
    <td>1.839225</td>
    <td>0</td>
    <td>1099.833810</td>
    <td>1157.895424</td>
    <td>0.761740</td>
    <td>0.872803</td>
  </tr>
  <tr>
    <th>4</th>
    <td>2010-01-18 11:52:20.662952</td>
    <td>13.861391</td>
    <td>4.303812</td>
    <td>0</td>
    <td>0</td>
    <td>1.531772</td>
    <td>0</td>
    <td>983.949061</td>
    <td>1148.961007</td>
    <td>2.123436</td>
    <td>0.820779</td>
  </tr>
  <tr>
    <th>...</th>
    <td>...</td>
    <td>...</td>
    <td>...</td>
    <td>...</td>
    <td>...</td>
    <td>...</td>
    <td>...</td>
    <td>...</td>
    <td>...</td>
    <td>...</td>
    <td>...</td>
  </tr>
  <tr>
    <th>4995</th>
    <td>2023-09-18 11:52:20.659592</td>
    <td>21.643051</td>
    <td>3.821656</td>
    <td>0</td>
    <td>0</td>
    <td>2.391010</td>
    <td>0</td>
    <td>1140.210762</td>
    <td>1563.064082</td>
    <td>1.504432</td>
    <td>0.756489</td>
  </tr>
  <tr>
    <th>4996</th>
    <td>2023-09-19 11:52:20.659591</td>
    <td>13.808813</td>
    <td>1.080603</td>
    <td>0</td>
    <td>1</td>
    <td>0.898693</td>
    <td>0</td>
    <td>1285.149505</td>
    <td>1189.454273</td>
    <td>1.343586</td>
    <td>0.742145</td>
  </tr>
  <tr>
    <th>4997</th>
    <td>2023-09-20 11:52:20.659590</td>
    <td>11.698227</td>
    <td>1.911000</td>
    <td>0</td>
    <td>0</td>
    <td>2.839860</td>
    <td>0</td>
    <td>965.171368</td>
    <td>1284.407359</td>
    <td>2.771896</td>
    <td>0.742145</td>
  </tr>
  <tr>
    <th>4998</th>
    <td>2023-09-21 11:52:20.659589</td>
    <td>18.052081</td>
    <td>1.000521</td>
    <td>0</td>
    <td>0</td>
    <td>1.188440</td>
    <td>0</td>
    <td>1368.369501</td>
    <td>1014.429223</td>
    <td>2.564075</td>
    <td>0.742145</td>
  </tr>
  <tr>
    <th>4999</th>
    <td>2023-09-22 11:52:20.659584</td>
    <td>17.017294</td>
    <td>0.650213</td>
    <td>0</td>
    <td>0</td>
    <td>2.131694</td>
    <td>0</td>
    <td>1261.301286</td>
    <td>1367.627356</td>
    <td>0.785727</td>
    <td>0.833140</td>
  </tr>
</tbody>
</table>
<p>5000 rows × 11 columns</p>
</div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="examining-feature-target-correlations">Examining Feature-Target Correlations<a href="#examining-feature-target-correlations" class="hash-link" aria-label="Direct link to Examining Feature-Target Correlations" title="Direct link to Examining Feature-Target Correlations">​</a></h3>
<p>Before delving into the model building process, it&#x27;s essential to understand the relationships between our features and the target variable. The upcoming function will display a plot indicating the correlation coefficient for each feature in relation to the target. Here&#x27;s why this step is crucial:</p>
<ol>
<li>
<p><strong>Avoiding Data Leakage</strong>: We must ensure that no feature perfectly correlates with the target (a correlation coefficient of 1.0). If such a correlation exists, it&#x27;s a sign that our dataset might be &quot;leaking&quot; information about the target. Using such data for hyperparameter tuning would mislead the model, as it could easily achieve a perfect score without genuinely learning the underlying patterns.</p>
</li>
<li>
<p><strong>Ensuring Meaningful Relationships</strong>: Ideally, our features should have some degree of correlation with the target. If all features have correlation coefficients close to zero, it suggests a weak linear relationship. Although this doesn&#x27;t automatically render the features useless, it does introduce challenges:</p>
<ul>
<li><em>Predictive Power</em>: The model might struggle to make accurate predictions.</li>
<li><em>Overfitting Risk</em>: With weak correlations, there&#x27;s a heightened risk of the model fitting to noise rather than genuine patterns, leading to overfitting.</li>
<li><em>Complexity</em>: Demonstrating non-linear relationships or interactions between features would necessitate more intricate visualizations and evaluations.</li>
</ul>
</li>
<li>
<p><strong>Auditing and Traceability</strong>: Logging this correlation visualization with our main MLflow run ensures traceability. It provides a snapshot of the data characteristics at the time of the model training, which is invaluable for auditing and replicability purposes.</p>
</li>
</ol>
<p>As we proceed, remember that while understanding correlations is a powerful tool, it&#x27;s just one piece of the puzzle. Let&#x27;s visualize these relationships to gain more insights!</p>
<div style="flex-grow:1;min-width:0;margin-top:var(--padding-md);width:100%"><div class="codeBlock_oJcR language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> matplotlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pyplot </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> plt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> seaborn </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> sns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">plot_correlation_with_demand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> save_path</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># noqa: D417</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  Plots the correlation of each variable in the dataframe with the &#x27;demand&#x27; column.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  Args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  - df (pd.DataFrame): DataFrame containing the data, including a &#x27;demand&#x27; column.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  - save_path (str, optional): Path to save the generated plot. If not specified, plot won&#x27;t be saved.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  Returns:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  - None (Displays the plot on a Jupyter window)</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Compute correlations between all variables and &#x27;demand&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  correlations </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">corr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;demand&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">drop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;demand&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sort_values</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Generate a color palette from red to green</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  colors </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sns</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">diverging_palette</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">130</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> as_cmap</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  color_mapped </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> correlations</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">colors</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Set Seaborn style</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sns</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_style</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;whitegrid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;axes.facecolor&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;#c2c4c2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;grid.linewidth&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.5</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Light grey background and thicker grid lines</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Create bar plot</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fig </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">figure</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">figsize</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">barh</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">correlations</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> correlations</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">values</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> color</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">color_mapped</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Set labels and title with increased font size</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">title</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Correlation with Demand&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fontsize</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">18</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlabel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Correlation Coefficient&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fontsize</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ylabel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Variable&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fontsize</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xticks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fontsize</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">14</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">yticks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fontsize</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">14</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">grid</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">axis</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;x&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tight_layout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Save the plot if save_path is specified</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> save_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">savefig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">save_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">format</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;png&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dpi</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">600</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># prevent matplotlib from displaying the chart every time we call this function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fig</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> fig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Test the function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">correlation_plot </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> plot_correlation_with_demand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> save_path</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;correlation_plot.png&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<pre style="margin:0;border-radius:0;background:none;font-size:0.85rem;flex-grow:1;padding:var(--padding-sm)">&lt;Figure size 432x288 with 0 Axes&gt;</pre>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="investigating-feature-correlation-with-the-target-variable">Investigating Feature Correlation with the Target Variable<a href="#investigating-feature-correlation-with-the-target-variable" class="hash-link" aria-label="Direct link to Investigating Feature Correlation with the Target Variable" title="Direct link to Investigating Feature Correlation with the Target Variable">​</a></h4>
<p>In the code above, we&#x27;ve intentionally disabled the automatic display of the plot generated by Matplotlib. During machine learning experimentation, it&#x27;s often not useful to display figures directly within the notebook for several reasons. Instead, we aim to associate this plot with the results of an iterative experiment run. To achieve this, we&#x27;ll save the plot to our MLflow tracking system. This provides us with a detailed record, linking the state of the dataset to the logged model, its parameters, and performance metrics.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="why-not-display-plots-directly-in-the-notebook">Why Not Display Plots Directly in the Notebook?<a href="#why-not-display-plots-directly-in-the-notebook" class="hash-link" aria-label="Direct link to Why Not Display Plots Directly in the Notebook?" title="Direct link to Why Not Display Plots Directly in the Notebook?">​</a></h5>
<p>Choosing not to display plots within the notebook is a deliberate decision, and the reasons are multiple. Some of the key points include:</p>
<ul>
<li>
<p><strong>Ephemerality of Notebooks</strong>: Notebooks are inherently transient; they are not designed to be a permanent record of your work.</p>
</li>
<li>
<p><strong>Risk of Obsolescence</strong>: If you rerun portions of your notebook, the plot displayed could become outdated or misleading, posing a risk when interpreting results.</p>
</li>
<li>
<p><strong>Loss of Previous State</strong>: If you happen to rerun the entire notebook, the plot will be lost. While some plugins can recover previous cell states, setting this up can be cumbersome and time-consuming.</p>
</li>
</ul>
<p>In contrast, logging the plot to MLflow ensures that we have a permanent, easily accessible record that correlates directly with other experiment data. This is invaluable for maintaining the integrity and reproducibility of your machine learning experiments.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="displaying-the-plot-for-this-guide">Displaying the Plot for This Guide<a href="#displaying-the-plot-for-this-guide" class="hash-link" aria-label="Direct link to Displaying the Plot for This Guide" title="Direct link to Displaying the Plot for This Guide">​</a></h5>
<p>For the purposes of this guide, we&#x27;ll still take a moment to examine the plot. We can do this by explicitly calling the figure object we&#x27;ve returned from our function.</p>
<div style="flex-grow:1;min-width:0;margin-top:var(--padding-md);width:100%"><div class="codeBlock_oJcR language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">correlation_plot</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" alt="" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="visualizing-model-residuals-for-diagnostic-insights">Visualizing Model Residuals for Diagnostic Insights<a href="#visualizing-model-residuals-for-diagnostic-insights" class="hash-link" aria-label="Direct link to Visualizing Model Residuals for Diagnostic Insights" title="Direct link to Visualizing Model Residuals for Diagnostic Insights">​</a></h4>
<p>The <code>plot_residuals</code> function serves to visualize the residuals—the differences between the model&#x27;s predictions and the actual values in the validation set. Residual plots are crucial diagnostic tools in machine learning, as they can reveal patterns that suggest our model is either failing to capture some aspect of the data or that there&#x27;s a systematic issue with the model itself.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="why-residual-plots">Why Residual Plots?<a href="#why-residual-plots" class="hash-link" aria-label="Direct link to Why Residual Plots?" title="Direct link to Why Residual Plots?">​</a></h5>
<p>Residual plots offer several advantages:</p>
<ul>
<li>
<p><strong>Identifying Bias</strong>: If residuals show a trend (not centered around zero), it might indicate that your model is systematically over- or under-predicting the target variable.</p>
</li>
<li>
<p><strong>Heteroskedasticity</strong>: Varying spread of residuals across the range of the predicted values can indicate &#x27;Heteroskedasticity,&#x27; which can violate assumptions in some modeling techniques.</p>
</li>
<li>
<p><strong>Outliers</strong>: Points far away from the zero line can be considered as outliers and might warrant further investigation.</p>
</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="auto-saving-the-plot">Auto-saving the Plot<a href="#auto-saving-the-plot" class="hash-link" aria-label="Direct link to Auto-saving the Plot" title="Direct link to Auto-saving the Plot">​</a></h5>
<p>Just like with the correlation plot, this function allows you to save the residual plot to a specific path. This feature aligns with our broader strategy of logging important figures to MLflow for more effective model tracking and auditing.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="plot-structure">Plot Structure<a href="#plot-structure" class="hash-link" aria-label="Direct link to Plot Structure" title="Direct link to Plot Structure">​</a></h5>
<p>In the scatter plot, each point represents the residual for a specific observation in the validation set. The red horizontal line at zero serves as a reference, indicating where residuals would lie if the model&#x27;s predictions were perfect.</p>
<p>For the sake of this guide, we will be generating this plot, but not examining it until later when we see it within the MLflow UI.</p>
<div style="flex-grow:1;min-width:0;margin-top:var(--padding-md);width:100%"><div class="codeBlock_oJcR language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">plot_residuals</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dvalid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> valid_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> save_path</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># noqa: D417</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  Plots the residuals of the model predictions against the true values.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  Args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  - model: The trained XGBoost model.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  - dvalid (xgb.DMatrix): The validation data in XGBoost DMatrix format.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  - valid_y (pd.Series): The true values for the validation set.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  - save_path (str, optional): Path to save the generated plot. If not specified, plot won&#x27;t be saved.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  Returns:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  - None (Displays the residuals plot on a Jupyter window)</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Predict using the model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  preds </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dvalid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Calculate residuals</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  residuals </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> valid_y </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> preds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Set Seaborn style</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sns</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_style</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;whitegrid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;axes.facecolor&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;#c2c4c2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;grid.linewidth&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.5</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Create scatter plot</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fig </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">figure</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">figsize</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">scatter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">valid_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> residuals</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> color</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;blue&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> alpha</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">axhline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> color</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;r&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> linestyle</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;-&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Set labels, title and other plot properties</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">title</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Residuals vs True Values&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fontsize</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">18</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlabel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;True Values&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fontsize</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ylabel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Residuals&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fontsize</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xticks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fontsize</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">14</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">yticks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fontsize</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">14</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">grid</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">axis</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;y&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tight_layout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Save the plot if save_path is specified</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> save_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">savefig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">save_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">format</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;png&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dpi</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">600</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Show the plot</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fig</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> fig</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="understanding-feature-importance-with-xgboost">Understanding Feature Importance with XGBoost<a href="#understanding-feature-importance-with-xgboost" class="hash-link" aria-label="Direct link to Understanding Feature Importance with XGBoost" title="Direct link to Understanding Feature Importance with XGBoost">​</a></h4>
<p>The <code>plot_feature_importance</code> function is designed to visualize the importance of each feature used in our XGBoost model. Understanding feature importance can offer critical insights into the model&#x27;s decision-making process and can aid in feature selection, engineering, and interpretation.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="types-of-feature-importance">Types of Feature Importance<a href="#types-of-feature-importance" class="hash-link" aria-label="Direct link to Types of Feature Importance" title="Direct link to Types of Feature Importance">​</a></h5>
<p>XGBoost offers multiple ways to interpret feature importance. This function supports:</p>
<ul>
<li><strong>Weight</strong>: Number of times a feature appears in a tree across the ensemble of trees (for <code>gblinear</code> booster).</li>
<li><strong>Gain</strong>: Average gain (or improvement to the model) of the feature when it is used in trees (for other booster types).</li>
</ul>
<p>We automatically select the appropriate importance type based on the booster used in the XGBoost model.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="why-feature-importance-matters">Why Feature Importance Matters<a href="#why-feature-importance-matters" class="hash-link" aria-label="Direct link to Why Feature Importance Matters" title="Direct link to Why Feature Importance Matters">​</a></h5>
<p>Understanding feature importance offers several advantages:</p>
<ul>
<li><strong>Interpretability</strong>: Knowing which features are most influential helps us understand the model better.</li>
<li><strong>Feature Selection</strong>: Unimportant features can potentially be dropped to simplify the model.</li>
<li><strong>Domain Understanding</strong>: Aligns the model&#x27;s importance scale with domain-specific knowledge or intuition.</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="saving-and-accessing-the-plot">Saving and Accessing the Plot<a href="#saving-and-accessing-the-plot" class="hash-link" aria-label="Direct link to Saving and Accessing the Plot" title="Direct link to Saving and Accessing the Plot">​</a></h5>
<p>This function returns a Matplotlib figure object that you can further manipulate or save. Like the previous plots, it is advisable to log this plot in MLflow for an immutable record of your model&#x27;s interpretive characteristics.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="navigating-the-plot">Navigating the Plot<a href="#navigating-the-plot" class="hash-link" aria-label="Direct link to Navigating the Plot" title="Direct link to Navigating the Plot">​</a></h5>
<p>In the resulting plot, each bar represents a feature used in the model. The length of the bar corresponds to the feature&#x27;s importance, as calculated by the selected importance type.</p>
<p>We need a model to be trained in order to generate this plot. As such, we&#x27;ll be generating, but not displaying the plot when we train the model. The resulting figure will be logged to MLflow and visible within the UI.</p>
<div style="flex-grow:1;min-width:0;margin-top:var(--padding-md);width:100%"><div class="codeBlock_oJcR language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">plot_feature_importance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> booster</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># noqa: D417</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  Plots feature importance for an XGBoost model.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  Args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  - model: A trained XGBoost model</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  Returns:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  - fig: The matplotlib figure object</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subplots</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">figsize</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  importance_type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;weight&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> booster </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;gblinear&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;gain&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  xgb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">plot_importance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      importance_type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">importance_type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ax</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ax</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      title</span><span class="token operator" style="color:#393A34">=</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Feature Importance based on </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">importance_type</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tight_layout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fig</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> fig</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-the-mlflow-experiment">Setting Up the MLflow Experiment<a href="#setting-up-the-mlflow-experiment" class="hash-link" aria-label="Direct link to Setting Up the MLflow Experiment" title="Direct link to Setting Up the MLflow Experiment">​</a></h3>
<p>Before we start our hyperparameter tuning process, we need to designate a specific &quot;experiment&quot; within MLflow to track and log our results. An experiment in MLflow is essentially a named set of runs. Each run within an experiment tracks its own parameters, metrics, tags, and artifacts.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="why-create-a-new-experiment">Why create a new experiment?<a href="#why-create-a-new-experiment" class="hash-link" aria-label="Direct link to Why create a new experiment?" title="Direct link to Why create a new experiment?">​</a></h4>
<ol>
<li><strong>Organization</strong>: It helps in keeping our runs organized under a specific task or project, making it easier to compare and analyze results.</li>
<li><strong>Isolation</strong>: By isolating different tasks or projects into separate experiments, we prevent accidental overwrites or misinterpretations of results.</li>
</ol>
<p>The <code>get_or_create_experiment</code> function we&#x27;ve defined below aids in this process. It checks if an experiment with the specified name already exists. If yes, it retrieves its ID. If not, it creates a new experiment and returns its ID.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="how-will-we-use-the-experiment_id">How will we use the experiment_id?<a href="#how-will-we-use-the-experiment_id" class="hash-link" aria-label="Direct link to How will we use the experiment_id?" title="Direct link to How will we use the experiment_id?">​</a></h4>
<p>The retrieved or created experiment_id becomes crucial when we initiate our hyperparameter tuning. As we start the parent run for tuning, the experiment_id ensures that the run, along with its nested child runs, gets logged under the correct experiment. It provides a structured way to navigate, compare, and analyze our tuning results within the MLflow UI.</p>
<p>When we want to try additional parameter ranges, different parameters, or a slightly modified dataset, we can use this Experiment to log all parent runs to keep our MLflow Tracking UI clean and easy to navigate.</p>
<p>Let&#x27;s proceed and set up our experiment!</p>
<div style="flex-grow:1;min-width:0;margin-top:var(--padding-md);width:100%"><div class="codeBlock_oJcR language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_or_create_experiment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">experiment_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  Retrieve the ID of an existing MLflow experiment or create a new one if it doesn&#x27;t exist.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  This function checks if an experiment with the given name exists within MLflow.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  If it does, the function returns its ID. If not, it creates a new experiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  with the provided name and returns its ID.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  Parameters:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  - experiment_name (str): Name of the MLflow experiment.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  Returns:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  - str: ID of the existing or newly created MLflow experiment.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> experiment </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_experiment_by_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">experiment_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> experiment</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">experiment_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">create_experiment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">experiment_name</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-an-experiment-for-our-hyperparameter-tuning-runs">Create an experiment for our hyperparameter tuning runs<a href="#create-an-experiment-for-our-hyperparameter-tuning-runs" class="hash-link" aria-label="Direct link to Create an experiment for our hyperparameter tuning runs" title="Direct link to Create an experiment for our hyperparameter tuning runs">​</a></h4>
<div style="flex-grow:1;min-width:0;margin-top:var(--padding-md);width:100%"><div class="codeBlock_oJcR language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">experiment_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> get_or_create_experiment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Apples Demand&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<p>We can view the <code>experiment_id</code> that was either generated or fetched to see how this unique reference key looks. The value generated here is also visible within the MLflow UI.</p>
<div style="flex-grow:1;min-width:0;margin-top:var(--padding-md);width:100%"><div class="codeBlock_oJcR language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">experiment_id</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<pre style="margin:0;border-radius:0;background:none;font-size:0.85rem;flex-grow:1;padding:var(--padding-sm)">&#x27;908436739760555869&#x27;</pre>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-mlflow-and-data-preprocessing-for-model-training">Setting Up MLflow and Data Preprocessing for Model Training<a href="#setting-up-mlflow-and-data-preprocessing-for-model-training" class="hash-link" aria-label="Direct link to Setting Up MLflow and Data Preprocessing for Model Training" title="Direct link to Setting Up MLflow and Data Preprocessing for Model Training">​</a></h4>
<p>This section of the code accomplishes two major tasks: initializing an MLflow experiment for usage in run tracking and preparing the dataset for model training and validation.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="mlflow-initialization">MLflow Initialization<a href="#mlflow-initialization" class="hash-link" aria-label="Direct link to MLflow Initialization" title="Direct link to MLflow Initialization">​</a></h5>
<p>We start by setting the MLflow experiment using the <code>set_experiment</code> function. The <code>experiment_id</code> serves as a unique identifier for the experiment, allowing us to segregate and manage different runs and their associated data efficiently.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="data-preprocessing">Data Preprocessing<a href="#data-preprocessing" class="hash-link" aria-label="Direct link to Data Preprocessing" title="Direct link to Data Preprocessing">​</a></h5>
<p>The next steps involve preparing the dataset for model training:</p>
<ol>
<li>
<p><strong>Feature Selection</strong>: We drop the columns &#x27;date&#x27; and &#x27;demand&#x27; from our DataFrame, retaining only the feature columns in <code>X</code>.</p>
</li>
<li>
<p><strong>Target Variable</strong>: The &#x27;demand&#x27; column is designated as our target variable <code>y</code>.</p>
</li>
<li>
<p><strong>Data Splitting</strong>: We split the dataset into training (<code>train_x</code>, <code>train_y</code>) and validation (<code>valid_x</code>, <code>valid_y</code>) sets using a 75-25 split.</p>
</li>
<li>
<p><strong>XGBoost Data Format</strong>: Finally, we convert the training and validation datasets into XGBoost&#x27;s DMatrix format. This optimized data structure speeds up the training process and is required for using XGBoost&#x27;s advanced functionalities.</p>
</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="why-these-steps-matter">Why These Steps Matter<a href="#why-these-steps-matter" class="hash-link" aria-label="Direct link to Why These Steps Matter" title="Direct link to Why These Steps Matter">​</a></h5>
<ul>
<li>
<p><strong>MLflow Tracking</strong>: Initializing the MLflow experiment ensures that all subsequent model runs, metrics, and artifacts are logged under the same experiment, making it easier to compare and analyze different models. While we are using the <code>fluent API</code> to do this here, you can also specify the <code>experiment_id</code> within a <code>start_run()</code> context.</p>
</li>
<li>
<p><strong>Data Preparation</strong>: Properly preparing your data ensures that the model training process will proceed without issues and that the results will be as accurate as possible.</p>
</li>
</ul>
<p>In the next steps, we&#x27;ll proceed to model training and evaluation, and all these preparation steps will come into play.</p>
<div style="flex-grow:1;min-width:0;margin-top:var(--padding-md);width:100%"><div class="codeBlock_oJcR language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Set the current active MLflow experiment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_experiment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">experiment_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">experiment_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Preprocess the dataset</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">drop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">columns</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;date&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;demand&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;demand&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">train_x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> valid_x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> train_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> valid_y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> train_test_split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">X</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> test_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.25</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dtrain </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> xgb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DMatrix</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> label</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">train_y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dvalid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> xgb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DMatrix</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">valid_x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> label</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">valid_y</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="hyperparameter-tuning-and-model-training-using-optuna-and-mlflow">Hyperparameter Tuning and Model Training using Optuna and MLflow<a href="#hyperparameter-tuning-and-model-training-using-optuna-and-mlflow" class="hash-link" aria-label="Direct link to Hyperparameter Tuning and Model Training using Optuna and MLflow" title="Direct link to Hyperparameter Tuning and Model Training using Optuna and MLflow">​</a></h4>
<p>The <code>objective</code> function serves as the core of our hyperparameter tuning process using Optuna. Additionally, it trains an XGBoost model using the selected hyperparameters and logs metrics and parameters to MLflow.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="mlflow-nested-runs">MLflow Nested Runs<a href="#mlflow-nested-runs" class="hash-link" aria-label="Direct link to MLflow Nested Runs" title="Direct link to MLflow Nested Runs">​</a></h5>
<p>The function starts a new nested run in MLflow. Nested runs are useful for organizing hyperparameter tuning experiments as they allow you to group individual runs under a parent run.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="defining-hyperparameters">Defining Hyperparameters<a href="#defining-hyperparameters" class="hash-link" aria-label="Direct link to Defining Hyperparameters" title="Direct link to Defining Hyperparameters">​</a></h5>
<p>Optuna&#x27;s <code>trial.suggest_*</code> methods are used to define a range of possible values for hyperparameters. Here&#x27;s what each hyperparameter does:</p>
<ul>
<li><code>objective</code> and <code>eval_metric</code>: Define the loss function and evaluation metric.</li>
<li><code>booster</code>: Type of boosting to be used (<code>gbtree</code>, <code>gblinear</code>, or <code>dart</code>).</li>
<li><code>lambda</code> and <code>alpha</code>: Regularization parameters.</li>
<li>Additional parameters like <code>max_depth</code>, <code>eta</code>, and <code>gamma</code> are specific to tree-based models (<code>gbtree</code> and <code>dart</code>).</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="model-training">Model Training<a href="#model-training" class="hash-link" aria-label="Direct link to Model Training" title="Direct link to Model Training">​</a></h5>
<p>An XGBoost model is trained using the chosen hyperparameters and the preprocessed training dataset (<code>dtrain</code>). Predictions are made on the validation set (<code>dvalid</code>), and the mean squared error (<code>mse</code>) is calculated.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="logging-with-mlflow">Logging with MLflow<a href="#logging-with-mlflow" class="hash-link" aria-label="Direct link to Logging with MLflow" title="Direct link to Logging with MLflow">​</a></h5>
<p>All the selected hyperparameters and metrics (<code>mse</code> and <code>rmse</code>) are logged to MLflow for later analysis and comparison.</p>
<ul>
<li><code>mlflow.log_params</code>: Logs the hyperparameters.</li>
<li><code>mlflow.log_metric</code>: Logs the metrics.</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="why-this-function-is-important">Why This Function is Important<a href="#why-this-function-is-important" class="hash-link" aria-label="Direct link to Why This Function is Important" title="Direct link to Why This Function is Important">​</a></h5>
<ul>
<li><strong>Automated Tuning</strong>: Optuna automates the process of finding the best hyperparameters.</li>
<li><strong>Experiment Tracking</strong>: MLflow allows us to keep track of each run&#x27;s hyperparameters and performance metrics, making it easier to analyze, compare, and reproduce experiments later.</li>
</ul>
<p>In the next step, this objective function will be used by Optuna to find the optimal set of hyperparameters for our XGBoost model.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="housekeeping-streamlining-logging-for-optuna-trials">Housekeeping: Streamlining Logging for Optuna Trials<a href="#housekeeping-streamlining-logging-for-optuna-trials" class="hash-link" aria-label="Direct link to Housekeeping: Streamlining Logging for Optuna Trials" title="Direct link to Housekeeping: Streamlining Logging for Optuna Trials">​</a></h4>
<p>As we embark on our hyperparameter tuning journey with Optuna, it&#x27;s essential to understand that the process can generate a multitude of runs. In fact, so many that the standard output (stdout) from the default logger can quickly become inundated, producing pages upon pages of log reports.</p>
<p>While the verbosity of the default logging configuration is undeniably valuable during the code development phase, initiating a full-scale trial can result in an overwhelming amount of information. Considering this, logging every single detail to stdout becomes less practical, especially when we have dedicated tools like MLflow to meticulously track our experiments.</p>
<p>To strike a balance, we&#x27;ll utilize callbacks to tailor our logging behavior.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="implementing-a-logging-callback">Implementing a Logging Callback:<a href="#implementing-a-logging-callback" class="hash-link" aria-label="Direct link to Implementing a Logging Callback:" title="Direct link to Implementing a Logging Callback:">​</a></h5>
<p>The callback we&#x27;re about to introduce will modify the default reporting behavior. Instead of logging every trial, we&#x27;ll only receive updates when a new hyperparameter combination yields an improvement over the best metric value recorded thus far.</p>
<p>This approach offers two salient benefits:</p>
<ol>
<li>
<p><strong>Enhanced Readability</strong>: By filtering out the extensive log details and focusing only on the trials that show improvement, we can gauge the efficacy of our hyperparameter search. For instance, if we observe a diminishing frequency of &#x27;best result&#x27; reports early on, it might suggest that fewer iterations would suffice to pinpoint an optimal hyperparameter set. On the other hand, a consistent rate of improvement might indicate that our feature set requires further refinement.</p>
</li>
<li>
<p><strong>Progress Indicators</strong>: Especially pertinent for extensive trials that span hours or even days, receiving periodic updates provides assurance that the process is still in motion. These &#x27;heartbeat&#x27; notifications affirm that our system is diligently at work, even if it&#x27;s not flooding stdout with every minute detail.</p>
</li>
</ol>
<p>Moreover, MLflow&#x27;s user interface (UI) complements this strategy. As each trial concludes, MLflow logs the child run, making it accessible under the umbrella of the parent run.</p>
<p>In the ensuing code, we:</p>
<ol>
<li>Adjust Optuna&#x27;s logging level to report only errors, ensuring a decluttered stdout.</li>
<li>Define a <code>champion_callback</code> function, tailored to log only when a trial surpasses the previously recorded best metric.</li>
</ol>
<p>Let&#x27;s dive into the implementation:</p>
<div style="flex-grow:1;min-width:0;margin-top:var(--padding-md);width:100%"><div class="codeBlock_oJcR language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># override Optuna&#x27;s default logging to ERROR only</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">optuna</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_verbosity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">optuna</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ERROR</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># define a logging callback that will report on only new challenger parameter configurations if a</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># trial has usurped the state of &#x27;best conditions&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">champion_callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">study</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> frozen_trial</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  Logging callback that will report when a new trial iteration improves upon existing</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  best trial values.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  Note: This callback is not intended for use in distributed computing systems such as Spark</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  or Ray due to the micro-batch iterative implementation for distributing trials to a cluster&#x27;s</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  workers or agents.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  The race conditions with file system state management for distributed trials will render</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  inconsistent values with this callback.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">  &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  winner </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> study</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">user_attrs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;winner&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> study</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">best_value </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> winner </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> study</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">best_value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      study</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_user_attr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;winner&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> study</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">best_value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> winner</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          improvement_percent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">abs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">winner </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> study</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">best_value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> study</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">best_value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Trial </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">frozen_trial</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">number</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> achieved value: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">frozen_trial</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">value</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> with &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">improvement_percent</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec"> .4f</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">% improvement&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Initial trial </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">frozen_trial</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">number</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> achieved value: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">frozen_trial</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">value</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<div style="flex-grow:1;min-width:0;margin-top:var(--padding-md);width:100%"><div class="codeBlock_oJcR language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">objective</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">trial</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">start_run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nested</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Define hyperparameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&quot;objective&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;reg:squarederror&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&quot;eval_metric&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rmse&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&quot;booster&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> trial</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">suggest_categorical</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;booster&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;gbtree&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;gblinear&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;dart&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&quot;lambda&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> trial</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">suggest_float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;lambda&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e-8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> log</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&quot;alpha&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> trial</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">suggest_float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;alpha&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e-8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> log</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> params</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;booster&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;gbtree&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"> params</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;booster&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;dart&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          params</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;max_depth&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> trial</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">suggest_int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;max_depth&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          params</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;eta&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> trial</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">suggest_float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;eta&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e-8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> log</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          params</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;gamma&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> trial</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">suggest_float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;gamma&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e-8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> log</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          params</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;grow_policy&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> trial</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">suggest_categorical</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token string" style="color:#e3116c">&quot;grow_policy&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;depthwise&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;lossguide&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Train XGBoost model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      bst </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> xgb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">train</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">params</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dtrain</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      preds </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bst</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dvalid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      error </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mean_squared_error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">valid_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> preds</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Log to MLflow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">log_params</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">params</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">log_metric</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;mse&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">log_metric</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;rmse&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sqrt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> error</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="orchestrating-hyperparameter-tuning-model-training-and-logging-with-mlflow">Orchestrating Hyperparameter Tuning, Model Training, and Logging with MLflow<a href="#orchestrating-hyperparameter-tuning-model-training-and-logging-with-mlflow" class="hash-link" aria-label="Direct link to Orchestrating Hyperparameter Tuning, Model Training, and Logging with MLflow" title="Direct link to Orchestrating Hyperparameter Tuning, Model Training, and Logging with MLflow">​</a></h4>
<p>This section of the code serves as the orchestration layer, bringing together Optuna for hyperparameter tuning and MLflow for experiment tracking.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="initiating-parent-run">Initiating Parent Run<a href="#initiating-parent-run" class="hash-link" aria-label="Direct link to Initiating Parent Run" title="Direct link to Initiating Parent Run">​</a></h5>
<p>We begin by starting a parent MLflow run with the name &quot;Best Run&quot;. All subsequent operations, including Optuna&#x27;s trials, are nested under this parent run, providing a structured way to organize our experiments.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="hyperparameter-tuning-with-optuna">Hyperparameter Tuning with Optuna<a href="#hyperparameter-tuning-with-optuna" class="hash-link" aria-label="Direct link to Hyperparameter Tuning with Optuna" title="Direct link to Hyperparameter Tuning with Optuna">​</a></h5>
<ul>
<li><code>study = optuna.create_study(direction=&#x27;minimize&#x27;)</code>: We create an Optuna study object aiming to minimize our objective function.</li>
<li><code>study.optimize(objective, n_trials=10)</code>: The <code>objective</code> function is optimized over 10 trials.</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="logging-best-parameters-and-metrics">Logging Best Parameters and Metrics<a href="#logging-best-parameters-and-metrics" class="hash-link" aria-label="Direct link to Logging Best Parameters and Metrics" title="Direct link to Logging Best Parameters and Metrics">​</a></h5>
<p>After Optuna finds the best hyperparameters, we log these, along with the best mean squared error (<code>mse</code>) and root mean squared error (<code>rmse</code>), to MLflow.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="logging-additional-metadata">Logging Additional Metadata<a href="#logging-additional-metadata" class="hash-link" aria-label="Direct link to Logging Additional Metadata" title="Direct link to Logging Additional Metadata">​</a></h5>
<p>Using <code>mlflow.set_tags</code>, we log additional metadata like the project name, optimization engine, model family, and feature set version. This helps in better categorizing and understanding the context of the model run.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="model-training-and-artifact-logging">Model Training and Artifact Logging<a href="#model-training-and-artifact-logging" class="hash-link" aria-label="Direct link to Model Training and Artifact Logging" title="Direct link to Model Training and Artifact Logging">​</a></h5>
<ul>
<li>We train an XGBoost model using the best hyperparameters.</li>
<li>Various plots—correlation with demand, feature importance, and residuals—are generated and logged as artifacts in MLflow.</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="model-serialization-and-logging">Model Serialization and Logging<a href="#model-serialization-and-logging" class="hash-link" aria-label="Direct link to Model Serialization and Logging" title="Direct link to Model Serialization and Logging">​</a></h5>
<p>Finally, the trained model is logged to MLflow using <code>mlflow.xgboost.log_model</code>, along with an example input and additional metadata. The model is stored in a specified artifact path and its URI is retrieved.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="why-this-block-is-crucial">Why This Block is Crucial<a href="#why-this-block-is-crucial" class="hash-link" aria-label="Direct link to Why This Block is Crucial" title="Direct link to Why This Block is Crucial">​</a></h5>
<ul>
<li><strong>End-to-End Workflow</strong>: This code block represents an end-to-end machine learning workflow, from hyperparameter tuning to model evaluation and logging.</li>
<li><strong>Reproducibility</strong>: All details about the model, including hyperparameters, metrics, and visual diagnostics, are logged, ensuring that the experiment is fully reproducible.</li>
<li><strong>Analysis and Comparison</strong>: With all data logged in MLflow, it becomes easier to analyze the performance of various runs and choose the best model for deployment.</li>
</ul>
<p>In the next steps, we&#x27;ll explore how to retrieve and use the logged model for inference.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="setting-a-descriptive-name-for-the-model-run">Setting a Descriptive Name for the Model Run<a href="#setting-a-descriptive-name-for-the-model-run" class="hash-link" aria-label="Direct link to Setting a Descriptive Name for the Model Run" title="Direct link to Setting a Descriptive Name for the Model Run">​</a></h4>
<p>Before proceeding with model training and hyperparameter tuning, it&#x27;s beneficial to assign a descriptive name to our MLflow run. This name serves as a human-readable identifier, making it easier to track, compare, and analyze different runs.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="the-importance-of-naming-runs">The Importance of Naming Runs:<a href="#the-importance-of-naming-runs" class="hash-link" aria-label="Direct link to The Importance of Naming Runs:" title="Direct link to The Importance of Naming Runs:">​</a></h5>
<ul>
<li>
<p><strong>Reference by Name</strong>: While MLflow provides unique identifying keys like <code>run_id</code> for each run, having a descriptive name allows for more intuitive referencing, especially when using particular APIs and navigating the MLflow UI.</p>
</li>
<li>
<p><strong>Clarity and Context</strong>: A well-chosen run name can provide context about the hypothesis being tested or the specific modifications made, aiding in understanding the purpose and rationale of a particular run.</p>
</li>
<li>
<p><strong>Automatic Naming</strong>: If you don&#x27;t specify a run name, MLflow will generate a unique fun name for you. However, this might lack the context and clarity of a manually chosen name.</p>
</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices">Best Practices:<a href="#best-practices" class="hash-link" aria-label="Direct link to Best Practices:" title="Direct link to Best Practices:">​</a></h5>
<p>When naming your runs, consider the following:</p>
<ol>
<li><strong>Relevance to Code Changes</strong>: The name should reflect any code or parameter modifications made for that run.</li>
<li><strong>Iterative Runs</strong>: If you&#x27;re executing multiple runs iteratively, it&#x27;s a good idea to update the run name for each iteration to avoid confusion.</li>
</ol>
<p>In the subsequent steps, we will set a name for our parent run. Remember, if you execute the model training multiple times, consider updating the run name for clarity.</p>
<div style="flex-grow:1;min-width:0;margin-top:var(--padding-md);width:100%"><div class="codeBlock_oJcR language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">run_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;first_attempt&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<div style="flex-grow:1;min-width:0;margin-top:var(--padding-md);width:100%"><div class="codeBlock_oJcR language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Initiate the parent run and call the hyperparameter tuning child run logic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">start_run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">experiment_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">experiment_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> run_name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">run_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> nested</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Initialize the Optuna study</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  study </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> optuna</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">create_study</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">direction</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;minimize&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Execute the hyperparameter optimization trials.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Note the addition of the `champion_callback` inclusion to control our logging</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  study</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">optimize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">objective</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n_trials</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">500</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> callbacks</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">champion_callback</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">log_params</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">study</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">best_params</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">log_metric</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;best_mse&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> study</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">best_value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">log_metric</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;best_rmse&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sqrt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">study</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">best_value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Log tags</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_tags</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tags</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&quot;project&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Apple Demand Project&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&quot;optimizer_engine&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;optuna&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&quot;model_family&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;xgboost&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&quot;feature_set_version&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Log a fit model instance</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  model </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> xgb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">train</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">study</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">best_params</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dtrain</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Log the correlation plot</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">log_figure</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">figure</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">correlation_plot</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> artifact_file</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;correlation_plot.png&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Log the feature importances plot</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  importances </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> plot_feature_importance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> booster</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">study</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">best_params</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;booster&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">log_figure</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">figure</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">importances</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> artifact_file</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;feature_importances.png&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Log the residuals plot</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  residuals </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> plot_residuals</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dvalid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> valid_y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">log_figure</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">figure</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">residuals</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> artifact_file</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;residuals.png&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  artifact_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;model&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xgboost</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">log_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      xgb_model</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">artifact_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      input_example</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">train_x</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">iloc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      model_format</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;ubj&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      metadata</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;model_data_version&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Get the logged model uri so that we can load it from the artifact store</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  model_uri </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_artifact_uri</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">artifact_path</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<pre style="margin:0;border-radius:0;background:none;font-size:0.85rem;flex-grow:1;padding:var(--padding-sm)">Initial trial 0 achieved value: 1593256.879424474
Trial 1 achieved value: 1593250.8071099266 with  0.0004% improvement
Trial 2 achieved value: 30990.735000917906 with  5041.0552% improvement
Trial 5 achieved value: 22804.947010998963 with  35.8948% improvement
Trial 7 achieved value: 18232.507769997483 with  25.0785% improvement
Trial 10 achieved value: 15670.64645523901 with  16.3482% improvement
Trial 11 achieved value: 15561.843005727616 with  0.6992% improvement
Trial 21 achieved value: 15144.954353687495 with  2.7527% improvement
Trial 23 achieved value: 14846.71981618512 with  2.0088% improvement
Trial 55 achieved value: 14570.287261018764 with  1.8972% improvement</pre>
<pre style="margin:0;border-radius:0;background:none;font-size:0.85rem;flex-grow:1;padding:var(--padding-sm)">/Users/benjamin.wilson/repos/mlflow-fork/mlflow/mlflow/models/signature.py:333: UserWarning: Hint: Inferred schema contains integer column(s). Integer columns in Python cannot represent missing values. If your input data contains missing values at inference time, it will be encoded as floats and will cause a schema enforcement error. The best way to avoid this problem is to infer the model schema based on a realistic data sample (training dataset) that includes missing values. Alternatively, you can declare integer columns as doubles (float64) whenever these columns may have missing values. See `Handling Integers With Missing Values &lt;https://www.mlflow.org/docs/latest/models.html#handling-integers-with-missing-values&gt;`_ for more details.
input_schema = _infer_schema(input_ex)
/Users/benjamin.wilson/miniconda3/envs/mlflow-dev-env/lib/python3.8/site-packages/_distutils_hack/__init__.py:30: UserWarning: Setuptools is replacing distutils.
warnings.warn(&quot;Setuptools is replacing distutils.&quot;)</pre>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="understanding-the-artifact-uri-in-mlflow">Understanding the Artifact URI in MLflow<a href="#understanding-the-artifact-uri-in-mlflow" class="hash-link" aria-label="Direct link to Understanding the Artifact URI in MLflow" title="Direct link to Understanding the Artifact URI in MLflow">​</a></h4>
<p>The output &#x27;mlflow-artifacts:/908436739760555869/c8d64ce51f754eb698a3c09239bcdcee/artifacts/model&#x27; represents a unique Uniform Resource Identifier (URI) for the trained model artifacts within MLflow. This URI is a crucial component of MLflow&#x27;s architecture, and here&#x27;s why:</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="simplified-access-to-model-artifacts">Simplified Access to Model Artifacts<a href="#simplified-access-to-model-artifacts" class="hash-link" aria-label="Direct link to Simplified Access to Model Artifacts" title="Direct link to Simplified Access to Model Artifacts">​</a></h5>
<p>The <code>model_uri</code> abstracts away the underlying storage details, providing a consistent and straightforward way to reference model artifacts, regardless of where they are stored. Whether your artifacts are on a local filesystem, in a cloud storage bucket, or on a network mount, the URI remains a consistent reference point.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="abstraction-of-storage-details">Abstraction of Storage Details<a href="#abstraction-of-storage-details" class="hash-link" aria-label="Direct link to Abstraction of Storage Details" title="Direct link to Abstraction of Storage Details">​</a></h5>
<p>MLflow is designed to be storage-agnostic. This means that while you might switch the backend storage from, say, a local directory to an Amazon S3 bucket, the way you interact with MLflow remains consistent. The URI ensures that you don&#x27;t need to know the specifics of the storage backend; you only need to reference the model&#x27;s URI.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="associated-information-and-metadata">Associated Information and Metadata<a href="#associated-information-and-metadata" class="hash-link" aria-label="Direct link to Associated Information and Metadata" title="Direct link to Associated Information and Metadata">​</a></h5>
<p>Beyond just the model files, the URI provides access to associated metadata, the model artifact, and other logged artifacts (files and images). This ensures that you have a comprehensive set of information about the model, aiding in reproducibility, analysis, and deployment.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="in-summary">In Summary<a href="#in-summary" class="hash-link" aria-label="Direct link to In Summary" title="Direct link to In Summary">​</a></h5>
<p>The <code>model_uri</code> serves as a consistent, abstracted reference to your model and its associated data. It simplifies interactions with MLflow, ensuring that users don&#x27;t need to worry about the specifics of underlying storage mechanisms and can focus on the machine learning workflow.</p>
<div style="flex-grow:1;min-width:0;margin-top:var(--padding-md);width:100%"><div class="codeBlock_oJcR language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">model_uri</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<pre style="margin:0;border-radius:0;background:none;font-size:0.85rem;flex-grow:1;padding:var(--padding-sm)">&#x27;mlflow-artifacts:/908436739760555869/c28196b19e1843bca7e22f07d796e740/artifacts/model&#x27;</pre>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="loading-the-trained-model-with-mlflow">Loading the Trained Model with MLflow<a href="#loading-the-trained-model-with-mlflow" class="hash-link" aria-label="Direct link to Loading the Trained Model with MLflow" title="Direct link to Loading the Trained Model with MLflow">​</a></h4>
<p>With the line:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">loaded </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xgboost</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model_uri</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>we&#x27;re leveraging MLflow&#x27;s native model loader for XGBoost. Instead of using the generic pyfunc loader, which provides a universal Python function interface for models, we&#x27;re using the XGBoost-specific loader.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="benefits-of-native-loading">Benefits of Native Loading:<a href="#benefits-of-native-loading" class="hash-link" aria-label="Direct link to Benefits of Native Loading:" title="Direct link to Benefits of Native Loading:">​</a></h5>
<ul>
<li>
<p><strong>Fidelity</strong>: Loading the model using the native loader ensures that you&#x27;re working with the exact same model object as it was during training. This means all nuances, specifics, and intricacies of the original model are preserved.</p>
</li>
<li>
<p><strong>Functionality</strong>: With the native model object in hand, you can utilize all of its inherent methods and properties. This allows for more flexibility, especially when you need advanced features or fine-grained control during inference.</p>
</li>
<li>
<p><strong>Performance</strong>: Using the native model object might offer performance benefits, especially when performing batch inference or deploying the model in environments optimized for the specific machine learning framework.</p>
</li>
</ul>
<p>In essence, by loading the model natively, we ensure maximum compatibility and functionality, allowing for a seamless transition from training to inference.</p>
<div style="flex-grow:1;min-width:0;margin-top:var(--padding-md);width:100%"><div class="codeBlock_oJcR language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">loaded </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xgboost</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model_uri</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<pre style="margin:0;border-radius:0;background:none;font-size:0.85rem;flex-grow:1;padding:var(--padding-sm)">Downloading artifacts:   0%|          | 0/6 [00:00&lt;?, ?it/s]</pre>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-batch-inference-using-the-loaded-model">Example: Batch Inference Using the Loaded Model<a href="#example-batch-inference-using-the-loaded-model" class="hash-link" aria-label="Direct link to Example: Batch Inference Using the Loaded Model" title="Direct link to Example: Batch Inference Using the Loaded Model">​</a></h4>
<p>After loading the model natively, performing batch inference is straightforward.</p>
<p>In the following cell, we&#x27;re going to perform a prediction based on the entire source feature set.
Although doing an inference action on the entire training and validation dataset features is of very limited utility in a real-world application, we&#x27;ll use our generated synthetic data here to illustrate using the native model for inference.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="performing-batch-inference-and-augmenting-data">Performing Batch Inference and Augmenting Data<a href="#performing-batch-inference-and-augmenting-data" class="hash-link" aria-label="Direct link to Performing Batch Inference and Augmenting Data" title="Direct link to Performing Batch Inference and Augmenting Data">​</a></h4>
<p>In this section, we&#x27;re taking our entire dataset and performing batch inference using our loaded XGBoost model. We&#x27;ll then append these predictions back into our original dataset to compare, analyze, or further process.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="steps-explained">Steps Explained:<a href="#steps-explained" class="hash-link" aria-label="Direct link to Steps Explained:" title="Direct link to Steps Explained:">​</a></h5>
<ol>
<li>
<p><strong>Creating a DMatrix</strong>: <code>batch_dmatrix = xgb.DMatrix(X)</code>: We first convert our features (<code>X</code>) into XGBoost&#x27;s optimized DMatrix format. This data structure is specifically designed for efficiency and speed in XGBoost.</p>
</li>
<li>
<p><strong>Predictions</strong>: <code>inference = loaded.predict(batch_dmatrix)</code>: Using the previously loaded model (<code>loaded</code>), we perform batch inference on the entire dataset.</p>
</li>
<li>
<p><strong>Creating a New DataFrame</strong>: <code>infer_df = df.copy()</code>: We create a copy of the original DataFrame to ensure that we&#x27;re not modifying our original data.</p>
</li>
<li>
<p><strong>Appending Predictions</strong>: <code>infer_df[&quot;predicted_demand&quot;] = inference</code>: The predictions are then added as a new column, <code>predicted_demand</code>, to this DataFrame.</p>
</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices-1">Best Practices:<a href="#best-practices-1" class="hash-link" aria-label="Direct link to Best Practices:" title="Direct link to Best Practices:">​</a></h5>
<ul>
<li>
<p><strong>Always Copy Data</strong>: When augmenting or modifying datasets, it&#x27;s generally a good idea to work with a copy. This ensures that the original data remains unchanged, preserving data integrity.</p>
</li>
<li>
<p><strong>Batch Inference</strong>: When predicting on large datasets, using batch inference (as opposed to individual predictions) can offer significant speed improvements.</p>
</li>
<li>
<p><strong>DMatrix Conversion</strong>: While converting to DMatrix might seem like an extra step, it&#x27;s crucial for performance when working with XGBoost. It ensures that predictions are made as quickly as possible.</p>
</li>
</ul>
<p>In the subsequent steps, we can further analyze the differences between the actual demand and our model&#x27;s predicted demand, potentially visualizing the results or calculating performance metrics.</p>
<div style="flex-grow:1;min-width:0;margin-top:var(--padding-md);width:100%"><div class="codeBlock_oJcR language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">batch_dmatrix </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> xgb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DMatrix</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">X</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">inference </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> loaded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">batch_dmatrix</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">infer_df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">copy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">infer_df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;predicted_demand&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> inference</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="visualizing-the-augmented-dataframe">Visualizing the Augmented DataFrame<a href="#visualizing-the-augmented-dataframe" class="hash-link" aria-label="Direct link to Visualizing the Augmented DataFrame" title="Direct link to Visualizing the Augmented DataFrame">​</a></h4>
<p>Below, we display the <code>infer_df</code> DataFrame. This augmented dataset now includes both the actual demand (<code>demand</code>) and the model&#x27;s predictions (<code>predicted_demand</code>). By examining this table, we can get a quick sense of how well our model&#x27;s predictions align with the actual demand values.</p>
<div style="flex-grow:1;min-width:0;margin-top:var(--padding-md);width:100%"><div class="codeBlock_oJcR language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">infer_df</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<div style="flex-grow:1;min-width:0;font-size:0.8rem;width:100%"><div><div>
<style scoped>
  .dataframe tbody tr th:only-of-type {
      vertical-align: middle;
  }

  .dataframe tbody tr th {
      vertical-align: top;
  }

  .dataframe thead th {
      text-align: right;
  }
</style>
<table border="1" class="dataframe">
<thead>
  <tr style="text-align: right;">
    <th></th>
    <th>date</th>
    <th>average_temperature</th>
    <th>rainfall</th>
    <th>weekend</th>
    <th>holiday</th>
    <th>price_per_kg</th>
    <th>promo</th>
    <th>demand</th>
    <th>previous_days_demand</th>
    <th>competitor_price_per_kg</th>
    <th>marketing_intensity</th>
    <th>predicted_demand</th>
  </tr>
</thead>
<tbody>
  <tr>
    <th>0</th>
    <td>2010-01-14 11:52:20.662955</td>
    <td>30.584727</td>
    <td>1.199291</td>
    <td>0</td>
    <td>0</td>
    <td>1.726258</td>
    <td>0</td>
    <td>851.375336</td>
    <td>851.276659</td>
    <td>1.935346</td>
    <td>0.098677</td>
    <td>953.708496</td>
  </tr>
  <tr>
    <th>1</th>
    <td>2010-01-15 11:52:20.662954</td>
    <td>15.465069</td>
    <td>1.037626</td>
    <td>0</td>
    <td>0</td>
    <td>0.576471</td>
    <td>0</td>
    <td>906.855943</td>
    <td>851.276659</td>
    <td>2.344720</td>
    <td>0.019318</td>
    <td>1013.409973</td>
  </tr>
  <tr>
    <th>2</th>
    <td>2010-01-16 11:52:20.662954</td>
    <td>10.786525</td>
    <td>5.656089</td>
    <td>1</td>
    <td>0</td>
    <td>2.513328</td>
    <td>0</td>
    <td>1108.304909</td>
    <td>906.836626</td>
    <td>0.998803</td>
    <td>0.409485</td>
    <td>1152.382446</td>
  </tr>
  <tr>
    <th>3</th>
    <td>2010-01-17 11:52:20.662953</td>
    <td>23.648154</td>
    <td>12.030937</td>
    <td>1</td>
    <td>0</td>
    <td>1.839225</td>
    <td>0</td>
    <td>1099.833810</td>
    <td>1157.895424</td>
    <td>0.761740</td>
    <td>0.872803</td>
    <td>1352.879272</td>
  </tr>
  <tr>
    <th>4</th>
    <td>2010-01-18 11:52:20.662952</td>
    <td>13.861391</td>
    <td>4.303812</td>
    <td>0</td>
    <td>0</td>
    <td>1.531772</td>
    <td>0</td>
    <td>983.949061</td>
    <td>1148.961007</td>
    <td>2.123436</td>
    <td>0.820779</td>
    <td>1121.233032</td>
  </tr>
  <tr>
    <th>...</th>
    <td>...</td>
    <td>...</td>
    <td>...</td>
    <td>...</td>
    <td>...</td>
    <td>...</td>
    <td>...</td>
    <td>...</td>
    <td>...</td>
    <td>...</td>
    <td>...</td>
    <td>...</td>
  </tr>
  <tr>
    <th>4995</th>
    <td>2023-09-18 11:52:20.659592</td>
    <td>21.643051</td>
    <td>3.821656</td>
    <td>0</td>
    <td>0</td>
    <td>2.391010</td>
    <td>0</td>
    <td>1140.210762</td>
    <td>1563.064082</td>
    <td>1.504432</td>
    <td>0.756489</td>
    <td>1070.676636</td>
  </tr>
  <tr>
    <th>4996</th>
    <td>2023-09-19 11:52:20.659591</td>
    <td>13.808813</td>
    <td>1.080603</td>
    <td>0</td>
    <td>1</td>
    <td>0.898693</td>
    <td>0</td>
    <td>1285.149505</td>
    <td>1189.454273</td>
    <td>1.343586</td>
    <td>0.742145</td>
    <td>1156.580688</td>
  </tr>
  <tr>
    <th>4997</th>
    <td>2023-09-20 11:52:20.659590</td>
    <td>11.698227</td>
    <td>1.911000</td>
    <td>0</td>
    <td>0</td>
    <td>2.839860</td>
    <td>0</td>
    <td>965.171368</td>
    <td>1284.407359</td>
    <td>2.771896</td>
    <td>0.742145</td>
    <td>1086.527710</td>
  </tr>
  <tr>
    <th>4998</th>
    <td>2023-09-21 11:52:20.659589</td>
    <td>18.052081</td>
    <td>1.000521</td>
    <td>0</td>
    <td>0</td>
    <td>1.188440</td>
    <td>0</td>
    <td>1368.369501</td>
    <td>1014.429223</td>
    <td>2.564075</td>
    <td>0.742145</td>
    <td>1085.064087</td>
  </tr>
  <tr>
    <th>4999</th>
    <td>2023-09-22 11:52:20.659584</td>
    <td>17.017294</td>
    <td>0.650213</td>
    <td>0</td>
    <td>0</td>
    <td>2.131694</td>
    <td>0</td>
    <td>1261.301286</td>
    <td>1367.627356</td>
    <td>0.785727</td>
    <td>0.833140</td>
    <td>1047.954102</td>
  </tr>
</tbody>
</table>
<p>5000 rows × 12 columns</p>
</div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="wrapping-up-reflecting-on-our-comprehensive-machine-learning-workflow">Wrapping Up: Reflecting on Our Comprehensive Machine Learning Workflow<a href="#wrapping-up-reflecting-on-our-comprehensive-machine-learning-workflow" class="hash-link" aria-label="Direct link to Wrapping Up: Reflecting on Our Comprehensive Machine Learning Workflow" title="Direct link to Wrapping Up: Reflecting on Our Comprehensive Machine Learning Workflow">​</a></h4>
<p>Throughout this guide, we embarked on a detailed exploration of an end-to-end machine learning workflow. We began with data preprocessing, delved deeply into hyperparameter tuning with Optuna, leveraged MLflow for structured experiment tracking, and concluded with batch inference.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="key-takeaways">Key Takeaways:<a href="#key-takeaways" class="hash-link" aria-label="Direct link to Key Takeaways:" title="Direct link to Key Takeaways:">​</a></h5>
<ul>
<li>
<p><strong>Hyperparameter Tuning with Optuna</strong>: We harnessed the power of Optuna to systematically search for the best hyperparameters for our XGBoost model, aiming to optimize its performance.</p>
</li>
<li>
<p><strong>Structured Experiment Tracking with MLflow</strong>: MLflow&#x27;s capabilities shone through as we logged experiments, metrics, parameters, and artifacts. We also explored the benefits of nested child runs, allowing us to logically group and structure our experiment iterations.</p>
</li>
<li>
<p><strong>Model Interpretation</strong>: Various plots and metrics equipped us with insights into our model&#x27;s behavior. We learned to appreciate its strengths and identify potential areas for refinement.</p>
</li>
<li>
<p><strong>Batch Inference</strong>: The nuances of batch predictions on extensive datasets were explored, alongside methods to seamlessly integrate these predictions back into our primary data.</p>
</li>
<li>
<p><strong>Logging Visual Artifacts</strong>: A significant portion of our journey emphasized the importance of logging visual artifacts, like plots, to MLflow. These visuals serve as invaluable references, capturing the state of the model, its performance, and any alterations to the feature set that might sway the model&#x27;s performance metrics.</p>
</li>
</ul>
<p>By the end of this guide, you should possess a robust understanding of a well-structured machine learning workflow. This foundation not only empowers you to craft effective models but also ensures that each step, from data wrangling to predictions, is transparent, reproducible, and efficient.</p>
<p>We&#x27;re grateful you accompanied us on this comprehensive journey. The practices and insights gleaned will undoubtedly be pivotal in all your future machine learning endeavors!</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/mlflow/mlflow/edit/master/docs/docs/traditional-ml/hyperparameter-tuning-with-child-runs/notebooks/hyperparameter-tuning-with-child-runs.ipynb" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/latest/traditional-ml/hyperparameter-tuning-with-child-runs/notebooks/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Full Notebooks</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/latest/traditional-ml/hyperparameter-tuning-with-child-runs/notebooks/logging-plots-in-mlflow"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Logging Visualizations with MLflow</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#objective" class="table-of-contents__link toc-highlight">Objective:</a></li><li><a href="#why-optuna" class="table-of-contents__link toc-highlight">Why Optuna?</a></li><li><a href="#child-runs-in-mlflow" class="table-of-contents__link toc-highlight">Child Runs in MLflow:</a></li><li><a href="#whats-ahead" class="table-of-contents__link toc-highlight">What&#39;s Ahead?</a></li><li><a href="#configure-the-tracking-server-uri" class="table-of-contents__link toc-highlight">Configure the tracking server uri</a></li><li><a href="#generate-our-synthetic-training-data" class="table-of-contents__link toc-highlight">Generate our synthetic training data</a></li><li><a href="#examining-feature-target-correlations" class="table-of-contents__link toc-highlight">Examining Feature-Target Correlations</a></li><li><a href="#setting-up-the-mlflow-experiment" class="table-of-contents__link toc-highlight">Setting Up the MLflow Experiment</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/mlflow" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/mlflow-org" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://x.com/mlflow" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/latest/">Docs</a></li><li class="footer__item"><a href="https://mlflow.org/releases" target="_blank" rel="noopener noreferrer" class="footer__link-item">Releases</a></li><li class="footer__item"><a href="https://mlflow.org/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 MLflow Project, a Series of LF Projects, LLC.</div></div></div></footer></div>
</body>
</html>