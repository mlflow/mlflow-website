<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-genai docs-version-current docs-doc-page docs-doc-id-prompt-registry/optimize-prompts" data-has-hydrated=false><head><meta charset=UTF-8><meta name=generator content="Docusaurus v3.9.2"><title data-rh=true>Optimize Prompts (Experimental) | MLflow</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"/><meta data-rh=true name=twitter:card content=summary_large_image /><meta data-rh=true property=og:url content=https://mlflow.org/mlflow-website/docs/latest/genai/prompt-registry/optimize-prompts/ /><meta data-rh=true property=og:locale content=en /><meta data-rh=true name=docusaurus_locale content=en /><meta data-rh=true name=docsearch:language content=en /><meta data-rh=true name=docusaurus_version content=current /><meta data-rh=true name=docusaurus_tag content=docs-genai-current /><meta data-rh=true name=docsearch:version content=current /><meta data-rh=true name=docsearch:docusaurus_tag content=docs-genai-current /><meta data-rh=true property=og:title content="Optimize Prompts (Experimental) | MLflow"/><meta data-rh=true name=description content="The simple way to continuously improve your AI agents and prompts."/><meta data-rh=true property=og:description content="The simple way to continuously improve your AI agents and prompts."/><link data-rh=true rel=icon href=/mlflow-website/docs/latest/images/favicon.ico /><link data-rh=true rel=canonical href=https://mlflow.org/mlflow-website/docs/latest/genai/prompt-registry/optimize-prompts/ /><link data-rh=true rel=alternate href=https://mlflow.org/mlflow-website/docs/latest/genai/prompt-registry/optimize-prompts/ hreflang=en /><link data-rh=true rel=alternate href=https://mlflow.org/mlflow-website/docs/latest/genai/prompt-registry/optimize-prompts/ hreflang=x-default /><link data-rh=true rel=preconnect href=https://XKVLO8P882-dsn.algolia.net crossorigin=anonymous /><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://mlflow.org/mlflow-website/docs/latest/genai/prompt-registry/","name":"Prompt Management","position":1},{"@type":"ListItem","item":"https://mlflow.org/mlflow-website/docs/latest/genai/prompt-registry/optimize-prompts","name":"Optimize Prompts","position":2}]}</script><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=GTM-N6WMTTJ"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-N6WMTTJ",{anonymize_ip:!0}),gtag("config","AW-16857946923",{anonymize_ip:!0})</script><link rel=preconnect href=https://www.googletagmanager.com><script>window.dataLayer=window.dataLayer||[],function(e,t,a,n,r){e[n]=e[n]||[],e[n].push({"gtm.start":new Date().getTime(),event:"gtm.js"});var d=t.getElementsByTagName(a)[0],g=t.createElement(a);g.async=!0,g.src="https://www.googletagmanager.com/gtm.js?id="+r+("dataLayer"!=n?"&l="+n:""),d.parentNode.insertBefore(g,d)}(window,document,"script","dataLayer","GTM-N6WMTTJ")</script><link rel=search type=application/opensearchdescription+xml title=MLflow href=/mlflow-website/docs/latest/opensearch.xml><script src=/mlflow-website/docs/latest/js/runllm.js defer></script><link rel=stylesheet href=/mlflow-website/docs/latest/assets/css/styles.65681509.css /><script src=/mlflow-website/docs/latest/assets/js/runtime~main.a0db6d66.js defer></script><script src=/mlflow-website/docs/latest/assets/js/main.15be5f24.js defer></script></head><body class=navigation-with-keyboard><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N6WMTTJ" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript>


<svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="theme-layout-navbar navbar navbar--fixed-top"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/mlflow-website/docs/latest/><div class=navbar__logo><img src=/mlflow-website/docs/latest/images/logo-light.svg alt="MLflow Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"/><img src=/mlflow-website/docs/latest/images/logo-dark.svg alt="MLflow Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"/></div></a><div class="navbar__item dropdown dropdown--hoverable"><a href=# aria-haspopup=true aria-expanded=false role=button class="navbar__link docsDropdown_VGp6" data-active=genai><div style=display:flex;gap:8px;align-items:center><div class=dropdownCircle_n91F style=width:10px;height:10px;background-color:var(--genai-color-primary);border-radius:4px></div>GenAI Docs</div></a><ul class=dropdown__menu><li><a class="dropdown__link ml-docs-link" href=/mlflow-website/docs/latest/ml/><div style=display:flex;gap:8px;align-items:center><div style=width:10px;height:10px;background-color:var(--ml-color-primary);border-radius:4px></div>ML Docs</div></a><li><a aria-current=page class="dropdown__link genai-docs-link dropdown__link--active" href=/mlflow-website/docs/latest/genai/><div style=display:flex;gap:8px;align-items:center><div style=width:10px;height:10px;background-color:var(--genai-color-primary);border-radius:4px></div>GenAI Docs</div></a></ul></div><a href=https://mlflow.org/docs/latest/api_reference/index.html target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">API Reference</a><a class="navbar__item navbar__link" href=/mlflow-website/docs/latest/self-hosting/>Self-Hosting</a><a class="navbar__item navbar__link" href=/mlflow-website/docs/latest/community/>Community</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href=https://github.com/mlflow/mlflow target=_blank rel="noopener noreferrer" class="navbar__item navbar__link github-link">GitHub<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts=Meta+k><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 24 24" aria-hidden=true><circle cx=11 cy=11 r=8 stroke=currentColor fill=none stroke-width=1.4 /><path d="m21 21-4.3-4.3" stroke=currentColor fill=none stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item sidebar-overview"><a class=menu__link href=/mlflow-website/docs/latest/genai/><span title=Overview class=linkLabel_WmDU>Overview</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menuHtmlItem_M9Kj menu__list-item"><b>Getting Started</b><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item sidebar-top-level-category"><a class=menu__link href=/mlflow-website/docs/latest/genai/getting-started/connect-environment/><span title="Set Up MLflow Server" class=linkLabel_WmDU>Set Up MLflow Server</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item sidebar-top-level-category"><a class=menu__link href=/mlflow-website/docs/latest/genai/tracing/quickstart/><span title="Start Tracing" class=linkLabel_WmDU>Start Tracing</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item sidebar-top-level-category"><a class=menu__link href=/mlflow-website/docs/latest/genai/eval-monitor/quickstart/><span title="Evaluate LLMs and Agents" class=linkLabel_WmDU>Evaluate LLMs and Agents</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item sidebar-top-level-category"><a class=menu__link href=/mlflow-website/docs/latest/genai/getting-started/try-assistant/><span title="Try MLflow Assistant" class=linkLabel_WmDU>Try MLflow Assistant</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menuHtmlItem_M9Kj menu__list-item"><b>Core Components</b><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-top-level-category"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/mlflow-website/docs/latest/genai/tracing/><span title="Tracing (Observability)" class=categoryLinkLabel_W154>Tracing (Observability)</span></a><button aria-label="Expand sidebar category 'Tracing (Observability)'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-top-level-category"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/mlflow-website/docs/latest/genai/eval-monitor/><span title="Evaluate & Monitor" class=categoryLinkLabel_W154>Evaluate & Monitor</span></a><button aria-label="Expand sidebar category 'Evaluate & Monitor'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item sidebar-top-level-category"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href=/mlflow-website/docs/latest/genai/prompt-registry/><span title="Prompt Management" class=categoryLinkLabel_W154>Prompt Management</span></a><button aria-label="Collapse sidebar category 'Prompt Management'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/mlflow-website/docs/latest/genai/prompt-registry/create-and-edit-prompts/><span title="Create and Edit Prompts" class=linkLabel_WmDU>Create and Edit Prompts</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/mlflow-website/docs/latest/genai/prompt-registry/evaluate-prompts/><span title="Evaluating Prompts" class=linkLabel_WmDU>Evaluating Prompts</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/mlflow-website/docs/latest/genai/prompt-registry/manage-prompt-lifecycles-with-aliases/><span title="Manage Prompt Lifecycles" class=linkLabel_WmDU>Manage Prompt Lifecycles</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/mlflow-website/docs/latest/genai/prompt-registry/use-prompts-in-apps/><span title="Use Prompts in Apps" class=linkLabel_WmDU>Use Prompts in Apps</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/mlflow-website/docs/latest/genai/prompt-registry/log-with-model/><span title="Log Prompts with Models" class=linkLabel_WmDU>Log Prompts with Models</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/mlflow-website/docs/latest/genai/prompt-registry/structured-output/><span title="Structured Output" class=linkLabel_WmDU>Structured Output</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible menu__list-item-collapsible--active"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" aria-current=page tabindex=0 href=/mlflow-website/docs/latest/genai/prompt-registry/optimize-prompts/><span title="Optimize Prompts" class=categoryLinkLabel_W154>Optimize Prompts</span></a><button aria-label="Collapse sidebar category 'Optimize Prompts'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/mlflow-website/docs/latest/genai/prompt-registry/optimize-prompts/langchain-optimization/><span title="LangChain Optimization" class=linkLabel_WmDU>LangChain Optimization</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/mlflow-website/docs/latest/genai/prompt-registry/optimize-prompts/langgraph-optimization/><span title="LangGraph Optimization" class=linkLabel_WmDU>LangGraph Optimization</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/mlflow-website/docs/latest/genai/prompt-registry/optimize-prompts/openai-agent-optimization/><span title="OpenAI Agent Optimization" class=linkLabel_WmDU>OpenAI Agent Optimization</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/mlflow-website/docs/latest/genai/prompt-registry/optimize-prompts/pydantic-ai-optimization/><span title="Pydantic AI Optimization" class=linkLabel_WmDU>Pydantic AI Optimization</span></a></ul><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/mlflow-website/docs/latest/genai/prompt-registry/rewrite-prompts/><span title="Auto-rewrite Prompts for New Models ðŸ†•" class=linkLabel_WmDU>Auto-rewrite Prompts for New Models ðŸ†•</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/mlflow-website/docs/latest/genai/prompt-registry/prompt-engineering/><span title="Prompt Engineering UI" class=linkLabel_WmDU>Prompt Engineering UI</span></a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-top-level-category"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/mlflow-website/docs/latest/genai/governance/ai-gateway/><span title="AI Gateway" class=categoryLinkLabel_W154>AI Gateway</span></a><button aria-label="Expand sidebar category 'AI Gateway'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menuHtmlItem_M9Kj menu__list-item"><b>More Features</b><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-top-level-category"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/mlflow-website/docs/latest/genai/version-tracking/><span title="Version Tracking" class=categoryLinkLabel_W154>Version Tracking</span></a><button aria-label="Expand sidebar category 'Version Tracking'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-top-level-category"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/mlflow-website/docs/latest/genai/flavors/><span title="Packaging & Deployment" class=categoryLinkLabel_W154>Packaging & Deployment</span></a><button aria-label="Expand sidebar category 'Packaging & Deployment'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-top-level-category"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/mlflow-website/docs/latest/genai/mcp/><span title=MCP class=categoryLinkLabel_W154>MCP</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-top-level-category"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/mlflow-website/docs/latest/genai/serving/><span title="Model Serving" class=categoryLinkLabel_W154>Model Serving</span></a><button aria-label="Expand sidebar category 'Model Serving'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menuHtmlItem_M9Kj menu__list-item"><b>References</b><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-top-level-category"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/mlflow-website/docs/latest/genai/concepts/trace/><span title=Concepts class=categoryLinkLabel_W154>Concepts</span></a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item sidebar-top-level-category"><a class=menu__link href=/mlflow-website/docs/latest/genai/references/request-features/><span title="Request Features" class=linkLabel_WmDU>Request Features</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item sidebar-top-level-category"><a class=menu__link href=/mlflow-website/docs/latest/genai/getting-started/databricks-trial/><span title="Managed MLflow" class=linkLabel_WmDU>Managed MLflow</span></a></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><div class=breadcrumbsWrapper_xlkt><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/mlflow-website/docs/latest/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class=breadcrumbs__item><a class=breadcrumbs__link href=/mlflow-website/docs/latest/genai/prompt-registry/><span>Prompt Management</span></a><li class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link>Optimize Prompts</span></ul></nav></div><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Optimize Prompts (Experimental)</h1></header>
<p><strong>The simple way to continuously improve your AI agents and prompts.</strong></p>
<p>MLflow's prompt optimization lets you systematically enhance your AI applications with minimal code changes. Whether you're building with LangChain, OpenAI Agent, CrewAI, or your own custom implementation, MLflow provides a universal path from initial prototyping to steady improvement.</p>
<p><strong>Minimum rewrites, no lock-in, just better prompts.</strong></p>
<p>MLflow supports multiple optimization algorithms to improve your prompts:</p>
<ul>
<li class=""><strong><a href=https://arxiv.org/abs/2507.19457 target=_blank rel="noopener noreferrer" class="">GEPA</a></strong> (<a href=/mlflow-website/docs/latest/api_reference/python_api/mlflow.genai.html#mlflow.genai.optimize.GepaPromptOptimizer target=_blank><code>GepaPromptOptimizer</code></a>): Iteratively refines prompts using LLM-driven reflection and automated feedback, achieving systematic improvements through trial-and-error learning.</li>
<li class=""><strong>Metaprompting</strong> (<a href=/mlflow-website/docs/latest/api_reference/python_api/mlflow.genai.html#mlflow.genai.optimize.MetaPromptOptimizer target=_blank><code>MetaPromptOptimizer</code></a>): Restructures prompts to be more systematic and effective, working in both zero-shot mode (without training data) and few-shot mode (learning from your examples).</li>
</ul>
<p>See <a href=#choosing-your-optimizer class="">Choosing Your Optimizer</a> for guidance on which optimizer to use for your specific needs.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>Why Use MLflow Prompt Optimization?</div><div class=admonitionContent_BuS1><ul>
<li class=""><strong>Zero Framework Lock-in</strong>: Works with ANY agent frameworkâ€”LangChain, OpenAI Agent, CrewAI, or custom solutions</li>
<li class=""><strong>Minimal Code Changes</strong>: Add a few lines to start optimizing; no architectural rewrites needed</li>
<li class=""><strong>Data-Driven Improvement</strong>: Automatically learn from your evaluation data and custom metrics</li>
<li class=""><strong>Multi-Prompt Optimization</strong>: Jointly optimize multiple prompts for complex agent workflows</li>
<li class=""><strong>Granular Control</strong>: Optimize single prompts or entire multi-prompt workflowsâ€”you decide what to improve</li>
<li class=""><strong>Production-Ready</strong>: Built-in version control and registry for seamless deployment</li>
<li class=""><strong>Extensible</strong>: Bring your own optimization algorithms with simple base class extension</li>
</ul></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"/></svg></span>Version Requirements</div><div class=admonitionContent_BuS1><p>The <code>optimize_prompts</code> API requires <strong>MLflow >= 3.5.0</strong>.</div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=quick-start>Quick Start<a href=#quick-start class=hash-link aria-label="Direct link to Quick Start" title="Direct link to Quick Start" translate=no>â€‹</a></h2>
<p>Here's a realistic example of optimizing a prompt for medical paper section classification:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_bxn0><div class=codeBlockHeader_C_1e aria-label="Code block header for python code with copy and toggle buttons"><span class=languageLabel_zr_I>python</span></div><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> mlflow</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> openai</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">genai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">optimize </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> GepaPromptOptimizer</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">genai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">scorers </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> Correctness</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Register initial prompt for classifying medical paper sections</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">prompt </span><span class="token operator">=</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">genai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">register_prompt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    name</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"medical_section_classifier"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    template</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"Classify this medical research paper sentence into one of these sections: CONCLUSIONS, RESULTS, METHODS, OBJECTIVE, BACKGROUND.\n\nSentence: {{sentence}}"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Define your prediction function</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">predict_fn</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">sentence</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    prompt </span><span class="token operator">=</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">genai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">load_prompt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"prompts:/medical_section_classifier/1"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    completion </span><span class="token operator">=</span><span class="token plain"> openai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">OpenAI</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">chat</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">completions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">create</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        model</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"gpt-5-nano"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># load prompt template using PromptVersion.format()</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        messages</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"role"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"user"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"content"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> prompt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">format</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">sentence</span><span class="token operator">=</span><span class="token plain">sentence</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> completion</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">choices</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">content</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Training data with medical paper sentences and ground truth labels</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># fmt: off</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">raw_data </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"The emergence of HIV as a chronic condition means that people living with HIV are required to take more responsibility for the self-management of their condition , including making physical , emotional and social adjustments ."</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"BACKGROUND"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"This paper describes the design and evaluation of Positive Outlook , an online program aiming to enhance the self-management skills of gay men living with HIV ."</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"BACKGROUND"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"This study is designed as a randomised controlled trial in which men living with HIV in Australia will be assigned to either an intervention group or usual care control group ."</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"METHODS"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"The intervention group will participate in the online group program ` Positive Outlook ' ."</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"METHODS"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"The program is based on self-efficacy theory and uses a self-management approach to enhance skills , confidence and abilities to manage the psychosocial issues associated with HIV in daily life ."</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"METHODS"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Participants will access the program for a minimum of 90 minutes per week over seven weeks ."</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"METHODS"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Primary outcomes are domain specific self-efficacy , HIV related quality of life , and outcomes of health education ."</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"METHODS"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Secondary outcomes include : depression , anxiety and stress ; general health and quality of life ; adjustment to HIV ; and social support ."</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"METHODS"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Data collection will take place at baseline , completion of the intervention ( or eight weeks post randomisation ) and at 12 week follow-up ."</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"METHODS"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Results of the Positive Outlook study will provide information regarding the effectiveness of online group programs improving health related outcomes for men living with HIV ."</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"CONCLUSIONS"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"The aim of this study was to evaluate the efficacy , safety and complications of orbital steroid injection versus oral steroid therapy in the management of thyroid-related ophthalmopathy ."</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"OBJECTIVE"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"A total of 29 patients suffering from thyroid ophthalmopathy were included in this study ."</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"METHODS"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Patients were randomized into two groups : group I included 15 patients treated with oral prednisolone and group II included 14 patients treated with peribulbar triamcinolone orbital injection ."</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"METHODS"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Both groups showed improvement in symptoms and in clinical evidence of inflammation with improvement of eye movement and proptosis in most cases ."</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"RESULTS"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Mean exophthalmometry value before treatment was 22.6 1.98 mm that decreased to 18.6 0.996 mm in group I , compared with 23 1.86 mm that decreased to 19.08 1.16 mm in group II ."</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"RESULTS"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"There was no change in the best-corrected visual acuity in both groups ."</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"RESULTS"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"There was an increase in body weight , blood sugar , blood pressure and gastritis in group I in 66.7 % , 33.3 % , 50 % and 75 % , respectively , compared with 0 % , 0 % , 8.3 % and 8.3 % in group II ."</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"RESULTS"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Orbital steroid injection for thyroid-related ophthalmopathy is effective and safe ."</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"CONCLUSIONS"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"It eliminates the adverse reactions associated with oral corticosteroid use ."</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"CONCLUSIONS"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"The aim of this prospective randomized study was to examine whether active counseling and more liberal oral fluid intake decrease postoperative pain , nausea and vomiting in pediatric ambulatory tonsillectomy ."</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"OBJECTIVE"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># fmt: on</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Format dataset for optimization</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">dataset </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"inputs"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"sentence"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> sentence</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"expectations"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"expected_response"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> label</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> sentence</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> label </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> raw_data</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Optimize the prompt</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">result </span><span class="token operator">=</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">genai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">optimize_prompts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    predict_fn</span><span class="token operator">=</span><span class="token plain">predict_fn</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    train_data</span><span class="token operator">=</span><span class="token plain">dataset</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    prompt_uris</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">prompt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">uri</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    optimizer</span><span class="token operator">=</span><span class="token plain">GepaPromptOptimizer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        reflection_model</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"openai:/gpt-5"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> max_metric_calls</span><span class="token operator">=</span><span class="token number">300</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    scorers</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Correctness</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">model</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"openai:/gpt-5-mini"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Use the optimized prompt</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">optimized_prompt </span><span class="token operator">=</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">optimized_prompts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Optimized template: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">optimized_prompt</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string-interpolation interpolation">template</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br/></span></code></pre></div></div>
<p>The API will automatically improve the prompt to better classify medical paper sections by learning from the training examples.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=choosing-your-optimizer>Choosing Your Optimizer<a href=#choosing-your-optimizer class=hash-link aria-label="Direct link to Choosing Your Optimizer" title="Direct link to Choosing Your Optimizer" translate=no>â€‹</a></h2>
<p>MLflow currently supports two optimization algorithms: <strong>GEPA</strong> and <strong>Metaprompting</strong>. Each uses different strategies to improve your prompts.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=gepa-genetic-pareto>GEPA (Genetic-Pareto)<a href=#gepa-genetic-pareto class=hash-link aria-label="Direct link to GEPA (Genetic-Pareto)" title="Direct link to GEPA (Genetic-Pareto)" translate=no>â€‹</a></h3>
<p>GEPA is a prompt optimization technique that uses natural language reflection to iteratively improve LLM performance through trial-and-error learning. It's particularly effective at extracting rich learning signals from system behavior by analyzing failures in natural language.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li class=""><strong>Natural Language Reflection</strong>: Leverages interpretable language to extract learning signals from execution traces, reasoning chains, and tool interactions</li>
<li class=""><strong>High Efficiency</strong>: Achieves superior results with dramatically fewer iterations (up to 35x fewer rollouts compared to traditional methods like GRPO)</li>
<li class=""><strong>Pareto Synthesis</strong>: Smartly picks the past prompt to mutate and improve</li>
<li class=""><strong>Strong Performance</strong>: Demonstrates reliable gains on a wide range of tasks, e.g., context compression, Q&A agents, etc.</li>
</ul>
<p><strong>Best For:</strong></p>
<ul>
<li class="">Tasks where you have clear evaluation metrics and a dataset of decent size (e.g., 100+ records)</li>
<li class="">Tasks where quality is critical to your system (e.g., medical agents, financial agents, etc.), so that the optimization cost and longer prompt as produced by GEPA is worth it</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>Reduce the Cost of GEPA Optimization</div><div class=admonitionContent_BuS1><p>The cost of GEPA optimization is tightly coupled with the reflection model you use and the max number of metric calls you allow. You can reduce the cost by using a cheaper reflection model or reducing the max number of metric calls.</div></div>
<p><strong>Learn More:</strong> <a href=https://arxiv.org/abs/2507.19457 target=_blank rel="noopener noreferrer" class="">GEPA Research Paper</a> | <a href=https://github.com/gepa-ai/gepa target=_blank rel="noopener noreferrer" class="">GEPA GitHub Repository</a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=metaprompting>Metaprompting<a href=#metaprompting class=hash-link aria-label="Direct link to Metaprompting" title="Direct link to Metaprompting" translate=no>â€‹</a></h3>
<p>Metaprompting is a prompt optimization technique that utilizes a metaprompt to call the language model to restructure your prompts to be more systematic and effective. It operates in two modes:</p>
<p><strong>Zero-Shot Mode:</strong></p>
<ul>
<li class="">Analyzes your initial prompt and restructures it to follow best practices</li>
<li class="">Makes prompts more systematic without requiring training data</li>
<li class="">Quick to run and requires no examples</li>
</ul>
<p><strong>Few-Shot Mode:</strong></p>
<ul>
<li class="">Evaluates the initial prompt on your training data to understand task-specific patterns</li>
<li class="">Leverages the evaluation results along with general best practices to restructure the prompt to be more systematic and effective</li>
</ul>
<p><strong>Key Features:</strong></p>
<ul>
<li class=""><strong>Fast Optimization</strong>: Runs fast because it only does one evaluation round in few-shot mode and just one single call to the language model in zero-shot mode</li>
<li class=""><strong>Minimal Data Requirement</strong>: Works well with zero or just a few examples (less than 10)</li>
<li class=""><strong>Systematic Improvement</strong>: Restructures prompts to follow clear patterns and best practices</li>
<li class=""><strong>Data-Aware</strong>: In few-shot mode, learns from your specific data to tailor improvements</li>
<li class=""><strong>Custom Guidelines</strong>: You can provide custom guidelines to the optimizer to tailor the optimization to your specific needs</li>
</ul>
<p><strong>Best For:</strong> Tasks where you want quick improvements based on prompt engineering best practices, or when you have limited training data but want to leverage it for targeted improvements.</p>
<p><strong>Usage Examples:</strong></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_bxn0><div class=codeBlockHeader_C_1e aria-label="Code block header for python code with copy and toggle buttons"><span class=languageLabel_zr_I>python</span></div><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">genai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">optimize </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> MetaPromptOptimizer</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Zero-shot mode: No training data or scorers required</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># The optimizer automatically uses zero-shot mode when train_data is empty and scorers is empty</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">results </span><span class="token operator">=</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">genai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">optimize_prompts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    predict_fn</span><span class="token operator">=</span><span class="token plain">predict_fn</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    train_data</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    prompt_uris</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">prompt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">uri</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    optimizer</span><span class="token operator">=</span><span class="token plain">MetaPromptOptimizer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        reflection_model</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"openai:/gpt-5"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        guidelines</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"This prompt is used in a finance agent to project tax situations."</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    scorers</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Few-shot mode: Learn from training data</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># The optimizer automatically uses few-shot mode when train_data and scorers are provided</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">results </span><span class="token operator">=</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">genai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">optimize_prompts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    predict_fn</span><span class="token operator">=</span><span class="token plain">predict_fn</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    train_data</span><span class="token operator">=</span><span class="token plain">dataset</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    prompt_uris</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">prompt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">uri</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    optimizer</span><span class="token operator">=</span><span class="token plain">MetaPromptOptimizer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        reflection_model</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"openai:/gpt-5"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        guidelines</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"This prompt is used in a finance agent to project tax situations."</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    scorers</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Correctness</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">model</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"openai:/gpt-5-mini"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=comparison-summary>Comparison Summary<a href=#comparison-summary class=hash-link aria-label="Direct link to Comparison Summary" title="Direct link to Comparison Summary" translate=no>â€‹</a></h3>
<table><thead><tr><th>Feature<th>GEPA<th>Metaprompting (Zero-Shot)<th>Metaprompting (Few-Shot)<tbody><tr><td><strong>Requires Training Data</strong><td>Yes<td>No<td>Yes<tr><td><strong>Optimization Speed</strong><td>Moderate<td>Fast<td>Fast-Moderate<tr><td><strong>Learning Approach</strong><td>Iterative trial-and-error with reflection<td>Systematic restructuring<td>Data-driven restructuring<tr><td><strong>Best Use Case</strong><td>Complex tasks with clear metrics<td>Quick improvements without data<td>Targeted improvements with limited data</table>
<p>Choose the optimizer that best fits your task requirements, available data, and optimization budget.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=example-simple-prompt--optimized-prompt>Example: Simple Prompt â†’ Optimized Prompt<a href=#example-simple-prompt--optimized-prompt class=hash-link aria-label="Direct link to Example: Simple Prompt â†’ Optimized Prompt" title="Direct link to Example: Simple Prompt â†’ Optimized Prompt" translate=no>â€‹</a></h3>
<div class="CardGroup_P84T Cols2_sRvc"><div class="Card_aSCR CardBordered_glGF" style=justify-content:flex-start><p><strong>Before Optimization:</strong><div style=max-width:100%><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_bxn0><div class=codeBlockHeader_C_1e aria-label="Code block header for text code with copy and toggle buttons"><span class=languageLabel_zr_I>text</span></div><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">Classify this medical research paper sentence</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">into one of these sections: CONCLUSIONS, RESULTS,</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">METHODS, OBJECTIVE, BACKGROUND.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">Sentence: {{sentence}}</span><br/></span></code></pre></div></div></div></div><div class="Card_aSCR CardBordered_glGF"><p><strong>After Optimization:</strong><div style=max-width:100%><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_bxn0><div class=codeBlockHeader_C_1e aria-label="Code block header for text code with copy and toggle buttons"><span class=languageLabel_zr_I>text</span></div><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">You are a single-sentence classifier for medical research abstracts. For each input sentence, decide which abstract section it belongs to and output exactly one label in UPPERCASE with no extra words, punctuation, or explanation.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">Allowed labels: CONCLUSIONS, RESULTS, METHODS, OBJECTIVE, BACKGROUND</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">Input format:</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- The prompt will be:</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">  "Classify this medical research paper sentence into one of these sections: CONCLUSIONS, RESULTS, METHODS, OBJECTIVE, BACKGROUND.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">  Sentence: {{sentence}}"</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">Core rules:</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- Use only the information in the single sentence.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- Classify by the sentence's function: context-setting vs aim vs procedure vs findings vs interpretation.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- Return exactly one uppercase label from the allowed set.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">Decision guide and lexical cues:</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">1) RESULTS</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- Reports observed findings/outcomes tied to data.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- Common cues: past-tense result verbs and outcome terms: "showed," "was/were associated with," "increased/decreased," "improved," "reduced," "significant," "p &lt; â€¦," "odds ratio," "risk ratio," "95% CI," percentages, rates, counts or numbers tied to effects/adverse events.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- If it explicitly states changes, associations, statistical significance, or quantified outcomes, choose RESULTS.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">2) CONCLUSIONS</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- Interpretation, implications, recommendations, or high-level takeaways.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- Common cues: "In conclusion," "These findings suggest/indicate," "We conclude," statements about practice/policy/clinical implications, benefitâ€“risk judgments, feasibility statements.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- Sentences that forecast the significance/utility of the study's results ("Results will provide insight/information," "Findings will inform/guide practice") are CONCLUSIONS.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- Tie-break with RESULTS: If a sentence describes an outcome as a general claim without specific observed data/statistics, prefer CONCLUSIONS over RESULTS.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">3) METHODS</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- How the study was conducted: design, participants, interventions/programs, measurements/outcomes lists, timelines, procedures, or analyses.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- Common cues: design terms ("randomized," "double-blind," "cross-sectional," "cohort," "case-control"), "participants," "n =," inclusion/exclusion criteria, instruments/scales, dosing/protocols, schedules/timelines, statistical tests/analysis plans ("multivariate regression," "Kaplanâ€“Meier," "ANOVA," "we will compare"), trial registration, ethics approval.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- Measurement/outcome lists are METHODS (e.g., "Secondary outcomes include: â€¦"; "Primary outcome was â€¦").</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- Numbers specifying sample size (e.g., "n = 200") â†’ METHODS; numbers tied to effects â†’ RESULTS.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- Program/intervention descriptions, components, theoretical basis, and mechanisms are METHODS, even if written in present tense and even if they contain purpose phrases. Examples: "The program is based on self-efficacy theoryâ€¦," "The intervention uses a self-management approach to enhance skillsâ€¦," "The device is designed toâ€¦"</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">  - Important: An infinitive "to [verb] â€¦" inside a program/intervention description (e.g., "uses X to improve Y") is METHODS, not OBJECTIVE, because it describes how the intervention works, not the study's aim.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">4) OBJECTIVE</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- The aim/purpose/hypothesis of the study.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- Common cues: "Objective(s):" "Aim/Purpose was," "We aimed/sought/intended to," "We hypothesized that â€¦"</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- Infinitive purpose phrases indicating the study's aim without procedures or results: "To determine/evaluate/assess/investigate whether â€¦" â†’ OBJECTIVE.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- Phrases like "The aim of this study was to evaluate the efficacy/safety of X vs Y â€¦" â†’ OBJECTIVE.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- If "We evaluated/assessed â€¦" is clearly used as a purpose statement (not describing methods or results), label OBJECTIVE.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">5) BACKGROUND</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- Context, rationale, prior knowledge, unmet need; introduces topic without specific aims, procedures, or results.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- Common cues: burden/prevalence statements, "X is common," "X remains poorly understood," prior work summaries, general descriptions.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- If a sentence merely states that a paper describes/reports a program/design/evaluation without concrete procedures/analyses, label as BACKGROUND.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">Important tie-break rules:</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- RESULTS vs CONCLUSIONS: Observed data/findings â†’ RESULTS; interpretation/generalization/recommendation â†’ CONCLUSIONS.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- OBJECTIVE vs METHODS: Purpose/aim of the study â†’ OBJECTIVE; concrete design/intervention details/measurements/analysis steps â†’ METHODS.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- BACKGROUND vs OBJECTIVE: Context/motivation without an explicit study aim â†’ BACKGROUND.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- BACKGROUND vs METHODS: General description without concrete procedures/analyses â†’ BACKGROUND.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- The word "Results" at the start does not guarantee RESULTS; e.g., "Results will provide information â€¦" â†’ CONCLUSIONS.</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">Output constraint:</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">- Return exactly one uppercase label: CONCLUSIONS, RESULTS, METHODS, OBJECTIVE, or BACKGROUND. No extra text or punctuation.</span><br/></span></code></pre></div></div></div></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=components>Components<a href=#components class=hash-link aria-label="Direct link to Components" title="Direct link to Components" translate=no>â€‹</a></h2>
<p>The <a href=/mlflow-website/docs/latest/api_reference/python_api/mlflow.genai.html#mlflow.genai.optimize_prompts target=_blank><code>mlflow.genai.optimize_prompts<!-- -->()</code></a> API requires the following components:</p>
<table style=width:100%><thead><tr><th style=width:30%>Component<th style=width:70%>Description<tbody><tr><td><strong>Target Prompt URIs</strong><td>List of prompt URIs to optimize (e.g., <code>["prompts:/qa/1"]</code>)<tr><td><strong>Predict Function</strong><td>A callable that takes inputs as keyword arguments and returns outputs. Must load templates from MLflow prompt versions (e.g., call <a href=/mlflow-website/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.model_registry.PromptVersion.format target=_blank><code>PromptVersion.format()</code></a>).<tr><td><strong>Training Data</strong><td>Dataset with <code>inputs</code> (dict) and <code>expectations</code> (expected results). Supports pandas DataFrame, list of dicts, or MLflow EvaluationDataset.<tr><td><strong>Optimizer</strong><td>Prompt optimizer instance (e.g., <a href=/mlflow-website/docs/latest/api_reference/python_api/mlflow.genai.html#mlflow.genai.optimize.GepaPromptOptimizer target=_blank><code>GepaPromptOptimizer</code></a> or <a href=/mlflow-website/docs/latest/api_reference/python_api/mlflow.genai.html#mlflow.genai.optimize.MetaPromptOptimizer target=_blank><code>MetaPromptOptimizer</code></a>). See <a href=#choosing-your-optimizer>Choosing Your Optimizer</a> for guidance.</table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=1-target-prompt-uris>1. Target Prompt URIs<a href=#1-target-prompt-uris class=hash-link aria-label="Direct link to 1. Target Prompt URIs" title="Direct link to 1. Target Prompt URIs" translate=no>â€‹</a></h3>
<p>Specify which prompts to optimize using their URIs from MLflow Prompt Registry:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_bxn0><div class=codeBlockHeader_C_1e aria-label="Code block header for python code with copy and toggle buttons"><span class=languageLabel_zr_I>python</span></div><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">prompt_uris </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"prompts:/qa/1"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)"># Specific version</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"prompts:/instruction@latest"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)"># Latest version</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><br/></span></code></pre></div></div>
<p>You can reference prompts by:</p>
<ul>
<li class=""><strong>Specific version</strong>: <code>"prompts:/qa/1"</code> - Optimize a particular version</li>
<li class=""><strong>Latest version</strong>: <code>"prompts:/qa@latest"</code> - Optimize the most recent version</li>
<li class=""><strong>Alias</strong>: <code>"prompts:/qa@champion"</code> - Optimize a version with a specific alias</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=2-predict-function>2. Predict Function<a href=#2-predict-function class=hash-link aria-label="Direct link to 2. Predict Function" title="Direct link to 2. Predict Function" translate=no>â€‹</a></h3>
<p>Your <code>predict_fn</code> must:</p>
<ul>
<li class="">Accept inputs as keyword arguments matching the inputs field of the dataset</li>
<li class="">Load the template from MLflow prompt versions using one of the following methods:<!-- -->
<ul>
<li class="">
<a href=/mlflow-website/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.model_registry.PromptVersion.format target=_blank><code>PromptVersion.format()</code></a>
</li>
<li class="">
<a href=/mlflow-website/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.model_registry.PromptVersion.template target=_blank><code>PromptVersion.template</code></a>
</li>
<li class="">
<a href=/mlflow-website/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.model_registry.PromptVersion.to_single_brace_format target=_blank><code>PromptVersion.to_single_brace_format()</code></a>
</li>
</ul>
</li>
<li class="">Return outputs in the same format as your training data (e.g., outputs = <code>{"answer": "xxx"}</code> if expectations = <code>{"expected_response": {"answer": "xxx"}}</code>)</li>
</ul>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_bxn0><div class=codeBlockHeader_C_1e aria-label="Code block header for python code with copy and toggle buttons"><span class=languageLabel_zr_I>python</span></div><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">predict_fn</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">question</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Load prompt from registry</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    prompt </span><span class="token operator">=</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">genai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">load_prompt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"prompts:/qa/1"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Format the prompt with input variables</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    formatted_prompt </span><span class="token operator">=</span><span class="token plain"> prompt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">format</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">question</span><span class="token operator">=</span><span class="token plain">question</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Call your LLM</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    response </span><span class="token operator">=</span><span class="token plain"> your_llm_call</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">formatted_prompt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> response</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=3-training-data>3. Training Data<a href=#3-training-data class=hash-link aria-label="Direct link to 3. Training Data" title="Direct link to 3. Training Data" translate=no>â€‹</a></h3>
<p>Provide a dataset with <code>inputs</code> and <code>expectations</code>. Both columns should have dictionary values. <code>inputs</code> values will be passed to the predict function as keyword arguments. Please refer to <a class="" href=/mlflow-website/docs/latest/genai/eval-monitor/scorers/llm-judge/predefined/>Built-in Judges</a> for the expected format of each built in scorers.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_bxn0><div class=codeBlockHeader_C_1e aria-label="Code block header for python code with copy and toggle buttons"><span class=languageLabel_zr_I>python</span></div><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token comment" style="color:rgb(98, 114, 164)"># List of dictionaries - Example: Medical paper classification</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">dataset </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"inputs"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"sentence"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"The emergence of HIV as a chronic condition means that people living with HIV are required to take more responsibility..."</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"expectations"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"expected_response"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"BACKGROUND"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"inputs"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"sentence"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"This study is designed as a randomised controlled trial in which men living with HIV..."</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"expectations"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"expected_response"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"METHODS"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"inputs"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"sentence"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Both groups showed improvement in symptoms and in clinical evidence of inflammation..."</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"expectations"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"expected_response"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"RESULTS"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"inputs"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"sentence"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Orbital steroid injection for thyroid-related ophthalmopathy is effective and safe."</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"expectations"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"expected_response"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"CONCLUSIONS"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"inputs"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"sentence"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"The aim of this study was to evaluate the efficacy, safety and complications..."</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"expectations"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"expected_response"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"OBJECTIVE"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Or pandas DataFrame</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> pd</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">dataset </span><span class="token operator">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"inputs"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"sentence"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"The emergence of HIV as a chronic condition..."</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"sentence"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"This study is designed as a randomised controlled trial..."</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"sentence"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Both groups showed improvement in symptoms..."</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"expectations"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"expected_response"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"BACKGROUND"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"expected_response"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"METHODS"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"expected_response"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"RESULTS"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=4-optimizer>4. Optimizer<a href=#4-optimizer class=hash-link aria-label="Direct link to 4. Optimizer" title="Direct link to 4. Optimizer" translate=no>â€‹</a></h3>
<p>Create an optimizer instance for the optimization algorithm. MLflow supports <a href=/mlflow-website/docs/latest/api_reference/python_api/mlflow.genai.html#mlflow.genai.optimize.GepaPromptOptimizer target=_blank><code>GepaPromptOptimizer</code></a> and <a href=/mlflow-website/docs/latest/api_reference/python_api/mlflow.genai.html#mlflow.genai.optimize.MetaPromptOptimizer target=_blank><code>MetaPromptOptimizer</code></a>. See <a href=#choosing-your-optimizer class="">Choosing Your Optimizer</a> for detailed guidance on which optimizer to use.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_bxn0><div class=codeBlockHeader_C_1e aria-label="Code block header for python code with copy and toggle buttons"><span class=languageLabel_zr_I>python</span></div><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">genai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">optimize </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> GepaPromptOptimizer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> MetaPromptOptimizer</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Option 1: GEPA optimizer</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">optimizer </span><span class="token operator">=</span><span class="token plain"> GepaPromptOptimizer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    reflection_model</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"openai:/gpt-5"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)"># Powerful model for optimization</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    max_metric_calls</span><span class="token operator">=</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    display_progress_bar</span><span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Option 2: Metaprompting optimizer</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Note: Zero-shot vs few-shot is determined by whether you provide</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># scorers and train_data to optimize_prompts()</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">optimizer </span><span class="token operator">=</span><span class="token plain"> MetaPromptOptimizer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    reflection_model</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"openai:/gpt-5"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    guidelines</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"Optional custom guidelines for optimization"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=advanced-usage>Advanced Usage<a href=#advanced-usage class=hash-link aria-label="Direct link to Advanced Usage" title="Direct link to Advanced Usage" translate=no>â€‹</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=works-with-any-agent-framework>Works with Any Agent Framework<a href=#works-with-any-agent-framework class=hash-link aria-label="Direct link to Works with Any Agent Framework" title="Direct link to Works with Any Agent Framework" translate=no>â€‹</a></h3>
<p>MLflow's optimization is <strong>framework-agnostic</strong>â€”it works seamlessly with LangChain, LangGraph, OpenAI Agent, Pydantic AI, CrewAI, AutoGen, or any custom framework. No need to rewrite your existing agents or switch frameworks.</p>
<p>See these framework-specific guides for detailed examples:</p>
<div class="CardGroup_P84T AutofillColumns_fKhQ"><a class="Card_aSCR CardBordered_glGF SmallLogoCardRounded_X50_ SmallLogoCardLink_Cm5j" href=/mlflow-website/docs/latest/genai/prompt-registry/optimize-prompts/langchain-optimization/><div class=SmallLogoCardContent_LxhV><div class="max-height-img-container SmallLogoCardImage_tPZl SmallLogoCardImageDefault_nyru"><span><img decoding=async loading=lazy alt="LangChain Logo" src=/mlflow-website/docs/latest/assets/images/langchain-logo-39d51f94cc9aebac2c191cca0e8189de.png width=783 height=138 class=img_ev3q /></span></div></div></a><a class="Card_aSCR CardBordered_glGF SmallLogoCardRounded_X50_ SmallLogoCardLink_Cm5j" href=/mlflow-website/docs/latest/genai/prompt-registry/optimize-prompts/langgraph-optimization/><div class=SmallLogoCardContent_LxhV><div class="max-height-img-container SmallLogoCardImage_tPZl SmallLogoCardImageDefault_nyru"><span><img decoding=async loading=lazy alt="LangGraph Logo" src=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAjsAAABYCAMAAAAk98a0AAAAllBMVEX///8cPDwWODgAKysAJycFMjIVODhSZ2f5+/sALS0MNDTx8/MAIyMAMDAALCwRNjYzT090gYHU2NiLmJgrSEiFkpJHXFzq7e1bbGy+xcXf4uIQOjoiQkLm6em0vLzL0NClrq6VoKB4h4cAHh5hc3M9VVW3v7+gqqrByMhre3tCWVmLl5fO09MAGxt/jIwAEBAAAAAADAwqiP3NAAAWRElEQVR4nO1daXuqutoWEpApolbRulDROrer6+z//+dewCQkIYEH22p7vb3Ph7O7ZMhw55kTer12eIv1avM62vW/AvPzdnM8jGeAdvziZyFcP+0JQr4TxLFrfwHcOHCIj/x4ly0e3dlffB7CVT9AxLXugthH6fbt0V3+xadgPAoG8X14Q2EHeHIMH93vX3wU6wQHdyUOpY9Ppr+2z4/GOInuK3IEOGjqPbr/v7gV4flxzClAyOrRQ/CL27BCj9BWEnDyq7h+ILwzfjRzcsS/oufnYZw6j+bNFXj06KH4RTeskP1o0jCQ/a+7/pOw+Q76iiG2fo2en4Ppd6KOZbnBb5rip8BMHduPIgdHyPkMjZY/6E8E8uVcsnz0mPwChGNkmkM0XBXqI1xPrQ/bQ7E/LaTJ+h0BEmWu9Wvz/AQ8G6mDj9VVmfWx4E9wYUbMYggIQMb73xjz98d4YJo//yheF/bJB6jj7oUnWQAZRnb3Hoj7w5udDqssy1an8Y8Us2FqUiHidJeYf0DyINH6XUNMc/TUoReb+a7APPv4gNwL4WqeYjTwfeL7CA8m59U34M90W2IEE/o7Y0jQz5RLvcnNNk8sS5EEUhv0Mob3eeTHBdAr/JbH4rRDg1gcTjsYoPn60c2akKBABKLxyigCYlSLsoxvduV9OdNwhKg/O4X3eXQViU4XWfVAvA2xzuaL8f7B7Ble6exDuBMajZ14qAnQbW/NW2BZhpwQ5CYyBff5R3HHG70Y7YSXx2ZkunDnbDJh7FR3+8zvShqKm7hjReAQ4U/iziJtkrpk8sigegfujI3ueaQXntMbBc/gID0mg7lscR/a5x/EnUNLfCu2HhgX7cCdvinSYpq1GUxg1BDIongOLDHDUPX/c7hzEJerHRMfIZ84Ip3iyeMcLjh31kaxU/OxGG4VPL4oiRfG9ypwL8A+/xjuvAldD3A6f1o9P6+y6d7xK6crSB7WPDh3jGLHQib/OIROu4J4LjxkD96+AxU8P4U7YcApEqOt0LlZlla25OBh3QBzx2ztyKE8CZsbzWW/0lp9uOyCWjw/hTt97pugvmrWbCLOq7+PqiMAc2dkjhPncsfUfGMcugVk/1zc7q3+dAlPm0ms68p3504VTYs29V/HhJEH7iR8MqDcCRuWPzn23Mlq6S3r1cNLckN0GeXa0R2Q5Dz0C8Vug1NjBBYp/hnc8Xgi70Vblb34w36POsTUPxNQ7qwafCZ7uECu71v+30PtvrdBZ/IE63m54txrGJ6kQCc9b4gF6vNN3AmXy/FiBgqhzoorW5M8+WXLpudxfY+O+gt4oi+4IUTozZaLxbK9O7O31fG4OR4Wmv6o3AnHh/zSbPWmPLbRUY5pyskd1l8AjOxVQFlRw1E9e+T1NsaAtgIMWoGdubPMdkMXRxgja38+qKMYUhT/PSuuJBhjP+1vzI1ZZueh5edXWcP+sXQqPfoQ/nAudswq6YmtqcaV79GmCQ1+ft+nft4d7Ez6R8WS8lZXFDZDeEwI9kkOhNPds/pkiTthlgR4UFzrY3IRN32HzTEWJlvwqd72Q7e81nWo+sxOsifFnxdgiIdoDIM6OnJnlWCfZyLdAAXyfuaQECcHyRu6PA/4lXZMcKIZjhynfv5Al13mo1H+vKd/UYH/8XMauKA3V0V6Ln0XqpTaZri/5P87X/9aHs+XPxGKpJjHiKDAFlo5l86GCBEa5MCXvE2BX5mrdoyHiu4UuBNuiS/MkesHlbAESo9YV0dzeIFNPB2Hop9Z9brShlkABQ8sxNOJO+MhVu19IiVrw+sM2sNeFimGvRvN66J+maipzSBa9TZXGVIJThaaCLbmtmWlWnMDXMU0pn5x5kxQLsDZLiJB8RiBO95IbaQVR6LOC6kK6c9S1Um20V5aNRV3To5qDtu4z7r+CvSUA530PPyF3Wy5roWzotOiqCqrKzKc/wiwnF4gtSRduHP8q/MUIyHxSgfb3m80UYzAVaXG6q9Ghr6sjgp3eEweNSUd/vooiobbTaVOruHYMkC24SypuLOIdRNJhtW00e5YE1fT8RiJkpRxp7d50UxNMKFzAQ3QIa2UNheqiu/CziXxywWTiMN7NYD7+JJYUavRjCDhwQ7c2RoULq7Iwwbb1i4vtRB/oxfCzvnaZc6dFZW0zQ54lr0pydCKO/NKdnPurHWTbAnzXHXHgBfBHaLcsZ70g0Qj3h40QOfovWSAzYNHZXCm6MNRVpCkkNpe8cNs47dwmBh8Eglw7ph3omE+hi2DHU88yAPpQzh3tlRmGPM9BnDujASNw7izMO5BcLjWa+mOaNIy7phCcGhzfWnzAzlstfSUwlw1Ru9zqibVjJuoEsnLSbPVDHJXwdwRy13tOHACwXQkjBK1wXYDxxGq/Mh79cBn+YFBECuTybmT0h9wxzw55c5OfBPjjjcRTd+8O8Lb+Rgr3XEd3/fF7Ksdc0k3VBpvu4pdQYpL12BHmxgMjhby+IKuOaqXEsFcbCl9dyGZQSh3qrG2fWd/fp+OLoRrTV7bLw92jKzk/XXaH1bFE1W0O6yGNkaT+Xm6nQ+RtBgYdzyq2uxJxx0gV+7YfVbxawe51/z3Ot1TLoqC/O3b/O3VZiibhVek7gT+5TVbZU+JXymemA+xzB2C030/mSBBRTnFsgFH58x50azJ5nGkoj+lQNn+I47foZHGoOgglDvc2wuCjBqTudZkkzLRDTbqn+iV6wsbM4dTn1dS2lW18dtc7BDjDivY1TquTaClC9QHzzlyPmbHeckdXotnU/sgp+hhwu3pcb07aMuk3nJaqTuurkXuxOSpDB96i1fh7EknH4wNOCHpG081adrFLlc7P/9DDEV3laBNcw19BFinUO4wvUH6gvc4ZjPA6hTFwS69RIYtu9Kh/7BkI+ASMc72jKseMe6wmEggKDwQxLIXOxqJCT4WSrRj0aFg5RFslIXuRGKaYMx3+/L1KXCHCEchzaotdYOcDVNwRtIxlw1vjUl1VdMsGWbjoBYsfm9sSwQowgRyh8+f7OqwoB1bJcJgKy1l7iKmwbd3Oq92LBsxwq4A9oQVHauuprLIndiSm8O0PZEyxh7tDqt7qbqDZTGw5LoHUU5V3Anm0iO5ai4eegafDlfbpyWgb5p1s2QOSY0OzfoTkpUAcmd6dWhtV4lZ0Tlgq6Qa7BclQME4wZY0MrWxMgbZT2xvyKCeIWxpNOdOPJRF8PgfDQMomoGG7pgO5t2RiqgKcPObxQ04d+xAftUbV8NBF+5YkblfYWpQN5/IHUiAB6qzVnFxYW3p09sDGvfng1338ejg0tAw89qcuh7idXWMOzTMbKFaEqnEogbGb84d21Ul8CIpprTmTTA/CHlyd+oFLbyVLzOxe5oh4tnP/CEjOHeaFv6bwc5VPHtvzHHK5wnJZ3E36yzDYEsA++jhOTdFYtWCovPKCF8Ndk1d0iANnS42rbiuVt9UkcS5o8+IFXlZCf8x+cS5gzSGZ0YCrnA4FpTSdIse644mvXNigmdwfTbnTi2bwFNYefu3YHvHIpm2t3RIDOSRoxirf3xMiuuVeKNJeDUOtoQOceWThWtSguoT1UDQRIDplVQdUPdRK2SZAwDkTq3b3EVh3NGVNORm7Dxy1aXAEkBUvLPu6KKszGKiEpZxp6bdqiKAnA3Na11C/UEiLvqopSzu1YuISOtVc1r0k7nT886iHA3fsvc5nWeVO5pFw9r6p/xLsbElcJkEs3dq3a5xx1RRsBKXgjdePZ33dJoV7uj0B6sdpTKJcUdDM6benE0HH73FSzZVPYuStObMi1b8siXS9Im2sozl4fWcRsjnwViVOxpL65nSpeTOknYd6wpjGctY8zPmZ+lDHrVu17jTNg7hejPaIzwgrBhE5U6syWqzVtEIMOOOZr2y3HkwhW0JZ91oTCm9G1goREbq9CA8n//WVsMKieF35o532gbRwJETCCp3NJyQuPPGdIPuDcwlU+M7BvFR6/ZAtXdM8f3r2zb7F0QCWbzL3OGhTxE8vXC9lnFH03PGsnjEww0QaN/K4ZlYiJJT3qBl0ah6/iIgx4XXC8ejqIU6nxobpBiPkO7suq7cOYl/qGAlF2pcmTlzCnBEwf0ZJvRYXFlr7lxftUmxbgUq3NHFWphZTfvKuVM3/ln0Pz4bHSQtdBZ+haOJhjEiaToom6w5u4cM7DRoP34QdBxGJ+68JYa3duUO/UO/tGb0HYw7M6rgDPk5HjtlDjB/OeWOMa8Xbn2D6Ja5o30AaxWNdnKdVefOuuLOElowfJ2/xrXfkMy07WvePtQKJ0jRPGi/SQfu5F66cSf1jdzRspvV9HIzhVsWzeXoF9U6aeFORoyWq8Id3UDyvZpXMdfAHZ6Py+Vmp0O8SGMhRNbMw3IK2ko2jADlf+DcWajn19sxYWLoc3WWauKy6FrzXlePtqVSUc3cqX3JIXYGPD/XRe6UzQRyx+BbG4AbI+ktVRSl1up3el8FcypWAJg7y1hsRk4bPz1v3qjT2ZU7TIxj3ZtUe4cHeJoXw1ulGigaubMT7QXXGaC4/7oa02co3Olg77RwB1qvTNFYZGu0eK4o9ldPbz3pEnQID5g7VaGZ7WB0Pq7LblEfoit3lPitfqw5d9iMNhtwLDVeLZkm7jxVVmuAosvToWxxqI0Nag2Pys8q+wDkTsddVnbakM72WorW/WxSDIkbOAHExJFAmkaaAcqdalsYsl6reMmN3PGowEe6z50yR7YKy2j2z9TBVnQVmWjgDpcaVoDPz5zBeu5ca/4UsFANJTSQO2HHU0td0vBB2LajVQpHIMaX96fRxGip6gHbIQnkDi/SduVPLd3IHZZM0YZsRoqfVQ1SU8iDPV9gSgN3+IkCeCvKFENOQpdU3tHZoB4JkDsNJ6joYaupfgHLdiGGdtdBHPe7eHigTGjn+h07lTXwrdyhR+7pIic8/1Nxh5eI++b9ikP6aiGP3cAdRp1BJv2zQe5oCrF4bI7+BuVOSxpJA8NBcgVaT/LC1bROu2hLDKruBXKHGRPqCsz0udBW7jCJj+simRfSCqkEPkjaJEb5QL51tDKhzNxhZFRls0HuaAwtvlWVjgiUO/qQSxMa9EdbmFq6dQdXl4YorAogd6icqHkc09v8LJ7Q0sSgeB2twB1eTWgbPpfBLxCPeDVz56S6cspjFO5oZDjfpEeXKJQ7Xcq/6ESaN8O2nQcmJWNCeKwHtLMPzB2q3WuFAZY+j97KHa5iagdbvPK1JE7smdlbsfY00yX3JJDALTN3WGOwwkRmWKncqQkeLubY0gZzx3zcoAFNG6lHjVJMUbUNp0bJgJ7PDeQOvUwtgmLxg+7c4TJfsQWFLSQid2Z8kFxSXxQnnlqQqGjmDo8vye3klQ0qdyxHluLVZjW2pQLMnQ7n/tHblBqnnfiGfRMflJw+OBFbnL4CAePOa88zQ6i/kgabV4h0506PJ+JFT8ebCqtSUigr/oMd7eSnL3Y8KxxL3G63d+RSuur4sBp3rMFZkP9VqJ/rXDh3uuYJ1PX6D58rI9G7NPjpyixANxbaFnAfHC9hCowo9sUzA8EVDq2fnXljbuBOdQCWQ17LEmNvsQlEGSwbI8LOkgD1M1qU7C2zBPO1Z8uFNg1+FosYESHqn1Unpta5YzlWRneUvu2q2efxVzh3uLqGwpEe6UV5//eVsG5w+pXo2TOQO1CxA1GCBTF4fCcONkuvOPnrsCOBdIk42ADu9JLqdgdZw+EwRXJWWzFkxS9JxT5yh0myH1oD8VgcZbAg8R10Hodez5utX636pnVpq6LtO5P+9nxJhd2rPs+SdODOqaPFI5/+V0Y1bcSPkm7YM69Ub25gLl5z3ZB2EM0oiVFlRghKh0MLD2L1kl437oSWNDO2rQbOVSdI+QyZ7bryPfZAqdlr4M5YiCu7k+FkIH+cU8cdq9y4HouJgKBSJx24Ix9tAgCS6oyvFHe4FTQ3ihOl40B5h0FxwQJQ7gjbxy1xytzqkl437gjmhfI+1gm1VHTXKHQDS72+KZ81EveMVv3R1yubBkbINnXhDvCEdddByI9tm4iCYMYPduBh0nfjsEi+9jPMzupwUiyUO/KR/BzBNcl/E3d6Y6RbgGiaXIenXmZ8jBqUe78W+Wnijiz1GNwkLf8fxB3pi+JduGPcIiN3aP86Hme74X4rduxchTBy1zjsFVraWEFvC6ZSW3E7A2QzMQWYO9qTlpzkmuO+jTu92bA+iNGIRQc1D1kktUPraEMiTWV4Yw3GYlB/kv2XLuu6j15/pXhAWEfuQLSWoUB/kb5E0TWzSf5sJ1G0f3o1f5DP5bL4LYZprAhSuEMxcuw2sK0ZmbrqbdzvjSM3BzvuKMztgQKa8o9nXP4SB9K/Hok8hQHO+PHV2tPFn5Oo9tnweOC/68LNU798peErE8vaGYIkGPfisgMvCncmmxel7/LBhF25s2z99Lm7e6Lm8GIzn19NELpZdTZbXMtr7SIi6jpOAytstDssw9npDPxaNoFlI67YppM2pMwsW/Qj3s7iUNDirM9x7u4kyYUOZHhJSgzr077eX39SJtLLLhFy4sLsdYMBPi+r+ghd5UMxFdNJ5AflHcU9BOF+pg9IbK6vvJh2aU/96iRWN0CkICBtv7wv1E57izkm4rGtfUUspHR36n8a7vzv+tOL0I5248N1yHZ96M3ekZ++lfWjl8IVWGfj4rxeeFYsRigmWuNAd7F5W8CHMX5N/kQRQphMmo5M7obZYTrfT9JhMiq/Kc88iYZS78Xqvbgjze85b07NVcyNbz7OUxxhhJGVbGtnRSu50OWmP/HL/blpsqnV8/HN8PWneOwn8aamU3Qo7L3l7x3HspPkpf+0/y9fqct55OPhvPEbdB+AeijJZyOcLdfrZQgMPYLhVQ+kubO2M36vAe8Pv3c2G5/G6ondFGoe3QsX4/H4c/o+ai/GsKnfZ7uFZjoX4iYoZ7hzGSCQOtpSvG8LzZyx1FXD6UX3QkMNxsex67DPr2hDkuAvEjcMEWAP+nfBYpP8V1/DzPOD1a59Kb6UO53Jc+OWBzDUI5O+L9ZTKyJufdM1tyK1R5vfF1/Lnd4ZmGC6C+yG+sTvBe8/mgTwFRVbUaehbOVe+GLu9F5v3Xr3+QisR321rjtYFYstnZM1q86ON1aX3hFfzZ3eShOgfAgGyeOlPBjVjlg/fT8tw9ALZ8/n6jMezjcQO1/Pnd5i8sX2Lwg2frxf0gFetd/MDhB2ipCycFCC3bL3/D74eu7krgH+Io8bDmL9GCv5CvWzGvIIfg+b/x7c6a3TzttuPhXxy/azg3VfDnPpQE6d7NGtK3EX7vR6x8HjFFcc9b+BYdkZW1MZS6z75OEjcCfu9LwNafso0dcgiJKf4pkryLQnQdk4gZeQfC3uxZ2cPcch7n7iwMcQ++j8WTnJ+2O2w0Reb3aAJx0qSL4Y9+NOjvX7RB2Nr0Pun5B+9l3W6G1Yvg5RUYLhunEcEB+n52+irkrclTu94tzMJMY+CSBf9LyVNG7sEDSYjA7fwZH9KJaHp10/Sfq70etK9+XxB+Le3CleOV5tRskkDpyvQBBY+/nr8fS1pRa/6BUnH8ZlhVkM+RLZJ6Nhq+XtuH83/t8i7DN8zvP+D2Y4iHf3BoqHAAAAAElFTkSuQmCC width=571 height=88 class=img_ev3q /></span></div></div></a><a class="Card_aSCR CardBordered_glGF SmallLogoCardRounded_X50_ SmallLogoCardLink_Cm5j" href=/mlflow-website/docs/latest/genai/prompt-registry/optimize-prompts/openai-agent-optimization/><div class=SmallLogoCardContent_LxhV><div class="max-height-img-container SmallLogoCardImage_tPZl SmallLogoCardImageDefault_nyru"><span><img decoding=async loading=lazy alt="OpenAI Agent Logo" src=/mlflow-website/docs/latest/assets/images/openai-agent-logo-8afddf736341f2b2dfe5cbb9caeaff45.png width=400 height=175 class=img_ev3q /></span></div></div></a><a class="Card_aSCR CardBordered_glGF SmallLogoCardRounded_X50_ SmallLogoCardLink_Cm5j" href=/mlflow-website/docs/latest/genai/prompt-registry/optimize-prompts/pydantic-ai-optimization/><div class=SmallLogoCardContent_LxhV><div class="max-height-img-container SmallLogoCardImage_tPZl SmallLogoCardImageDefault_nyru"><span><img decoding=async loading=lazy alt="Pydantic AI Logo" src=/mlflow-website/docs/latest/assets/images/pydanticai-logo-e225ccce7e8699654c01ff1aeeed6b10.png width=2584 height=546 class=img_ev3q /></span></div></div></a></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=using-custom-scorers>Using Custom Scorers<a href=#using-custom-scorers class=hash-link aria-label="Direct link to Using Custom Scorers" title="Direct link to Using Custom Scorers" translate=no>â€‹</a></h3>
<p>Define custom evaluation metrics to guide optimization:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_bxn0><div class=codeBlockHeader_C_1e aria-label="Code block header for python code with copy and toggle buttons"><span class=languageLabel_zr_I>python</span></div><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> typing </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> Any</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">genai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">scorers </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> scorer</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">@scorer</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">accuracy_scorer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">outputs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> expectations</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">dict</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Check if output matches expected value."""</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token number">1.0</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> outputs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">lower</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> expectations</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">lower</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token number">0.0</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">@scorer</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">brevity_scorer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">outputs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Prefer shorter outputs (max 50 chars)."""</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">min</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1.0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">50</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">max</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">outputs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Combine scorers with a weighted objective</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">weighted_objective</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">scores</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">dict</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token number">0.7</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> scores</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"accuracy_scorer"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">0.3</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> scores</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"brevity_scorer"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Use custom scorers</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">result </span><span class="token operator">=</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">genai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">optimize_prompts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    predict_fn</span><span class="token operator">=</span><span class="token plain">predict_fn</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    train_data</span><span class="token operator">=</span><span class="token plain">dataset</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    prompt_uris</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">prompt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">uri</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    optimizer</span><span class="token operator">=</span><span class="token plain">GepaPromptOptimizer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">reflection_model</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"openai:/gpt-5"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    scorers</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">accuracy_scorer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> brevity_scorer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    aggregation</span><span class="token operator">=</span><span class="token plain">weighted_objective</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=custom-optimization-algorithm>Custom Optimization Algorithm<a href=#custom-optimization-algorithm class=hash-link aria-label="Direct link to Custom Optimization Algorithm" title="Direct link to Custom Optimization Algorithm" translate=no>â€‹</a></h3>
<p>Implement your own optimizer by extending <a href=/mlflow-website/docs/latest/api_reference/python_api/mlflow.genai.html#mlflow.genai.optimize.BasePromptOptimizer target=_blank><code>BasePromptOptimizer</code></a>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_bxn0><div class=codeBlockHeader_C_1e aria-label="Code block header for python code with copy and toggle buttons"><span class=languageLabel_zr_I>python</span></div><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">genai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">optimize </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> BasePromptOptimizer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> PromptOptimizerOutput</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">genai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">scorers </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> Correctness</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">MyCustomOptimizer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">BasePromptOptimizer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__init__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> model_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">model_name </span><span class="token operator">=</span><span class="token plain"> model_name</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">optimize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> eval_fn</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> train_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> target_prompts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> enable_tracking</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Your custom optimization logic</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        optimized_prompts </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> prompt_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> prompt_template </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> target_prompts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">items</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)"># Implement your algorithm</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">            optimized_prompts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">prompt_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> your_optimization_algorithm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">                prompt_template</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> train_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">model_name</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> PromptOptimizerOutput</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">optimized_prompts</span><span class="token operator">=</span><span class="token plain">optimized_prompts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Use custom optimizer</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">result </span><span class="token operator">=</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">genai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">optimize_prompts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    predict_fn</span><span class="token operator">=</span><span class="token plain">predict_fn</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    train_data</span><span class="token operator">=</span><span class="token plain">dataset</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    prompt_uris</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">prompt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">uri</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    optimizer</span><span class="token operator">=</span><span class="token plain">MyCustomOptimizer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">model_name</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"openai:/gpt-5"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    scorers</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Correctness</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">model</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"openai:/gpt-5"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=multi-prompt-optimization>Multi-Prompt Optimization<a href=#multi-prompt-optimization class=hash-link aria-label="Direct link to Multi-Prompt Optimization" title="Direct link to Multi-Prompt Optimization" translate=no>â€‹</a></h3>
<p>Optimize multiple prompts together:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_bxn0><div class=codeBlockHeader_C_1e aria-label="Code block header for python code with copy and toggle buttons"><span class=languageLabel_zr_I>python</span></div><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> mlflow</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">genai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">scorers </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> Correctness</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Register multiple prompts</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">plan_prompt </span><span class="token operator">=</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">genai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">register_prompt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    name</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"plan"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    template</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"Make a plan to answer {{question}}."</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">answer_prompt </span><span class="token operator">=</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">genai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">register_prompt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    name</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"answer"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    template</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"Answer {{question}} following the plan: {{plan}}"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">predict_fn</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">question</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">></span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    plan_prompt </span><span class="token operator">=</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">genai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">load_prompt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"prompts:/plan/1"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    completion </span><span class="token operator">=</span><span class="token plain"> openai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">OpenAI</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">chat</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">completions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">create</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        model</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"gpt-5"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)"># strong model</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        messages</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"role"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"user"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"content"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> plan_prompt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">format</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">question</span><span class="token operator">=</span><span class="token plain">question</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    plan </span><span class="token operator">=</span><span class="token plain"> completion</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">choices</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">content</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    answer_prompt </span><span class="token operator">=</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">genai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">load_prompt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"prompts:/answer/1"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    completion </span><span class="token operator">=</span><span class="token plain"> openai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">OpenAI</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">chat</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">completions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">create</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        model</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"gpt-5-mini"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)"># cost efficient model</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        messages</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">"role"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"user"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">"content"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> answer_prompt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">format</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">question</span><span class="token operator">=</span><span class="token plain">question</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> plan</span><span class="token operator">=</span><span class="token plain">plan</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> completion</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">choices</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">content</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Optimize both</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">result </span><span class="token operator">=</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">genai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">optimize_prompts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    predict_fn</span><span class="token operator">=</span><span class="token plain">predict_fn</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    train_data</span><span class="token operator">=</span><span class="token plain">dataset</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    prompt_uris</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">plan_prompt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">uri</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> answer_prompt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">uri</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    optimizer</span><span class="token operator">=</span><span class="token plain">GepaPromptOptimizer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">reflection_model</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"openai:/gpt-5"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    scorers</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Correctness</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">model</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"openai:/gpt-5"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Access optimized prompts</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">optimized_plan </span><span class="token operator">=</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">optimized_prompts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">optimized_answer </span><span class="token operator">=</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">optimized_prompts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=result-object>Result Object<a href=#result-object class=hash-link aria-label="Direct link to Result Object" title="Direct link to Result Object" translate=no>â€‹</a></h2>
<p>The API returns a <a href=/mlflow-website/docs/latest/api_reference/python_api/mlflow.genai.html#mlflow.genai.optimize.PromptOptimizationResult target=_blank><code>PromptOptimizationResult</code></a> object:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_bxn0><div class=codeBlockHeader_C_1e aria-label="Code block header for python code with copy and toggle buttons"><span class=languageLabel_zr_I>python</span></div><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">result </span><span class="token operator">=</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">genai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">optimize_prompts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Access optimized prompts</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> prompt </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">optimized_prompts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Name: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">prompt</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string-interpolation interpolation">name</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Version: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">prompt</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string-interpolation interpolation">version</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Template: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">prompt</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string-interpolation interpolation">template</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"URI: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">prompt</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string-interpolation interpolation">uri</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Check optimizer used</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Optimizer: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">result</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string-interpolation interpolation">optimizer_name</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># View evaluation scores (if available)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Initial score: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">result</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string-interpolation interpolation">initial_eval_score</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Final score: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">result</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string-interpolation interpolation">final_eval_score</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=common-use-cases>Common Use Cases<a href=#common-use-cases class=hash-link aria-label="Direct link to Common Use Cases" title="Direct link to Common Use Cases" translate=no>â€‹</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=improving-accuracy>Improving Accuracy<a href=#improving-accuracy class=hash-link aria-label="Direct link to Improving Accuracy" title="Direct link to Improving Accuracy" translate=no>â€‹</a></h3>
<p>Optimize prompts to produce more accurate outputs:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_bxn0><div class=codeBlockHeader_C_1e aria-label="Code block header for python code with copy and toggle buttons"><span class=languageLabel_zr_I>python</span></div><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">genai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">scorers </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> Correctness</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">result </span><span class="token operator">=</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">genai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">optimize_prompts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    predict_fn</span><span class="token operator">=</span><span class="token plain">predict_fn</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    train_data</span><span class="token operator">=</span><span class="token plain">dataset</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    prompt_uris</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">prompt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">uri</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    optimizer</span><span class="token operator">=</span><span class="token plain">GepaPromptOptimizer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">reflection_model</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"openai:/gpt-5"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    scorers</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Correctness</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">model</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"openai:/gpt-5"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=optimizing-for-safeness>Optimizing for Safeness<a href=#optimizing-for-safeness class=hash-link aria-label="Direct link to Optimizing for Safeness" title="Direct link to Optimizing for Safeness" translate=no>â€‹</a></h3>
<p>Ensure outputs are safe:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_bxn0><div class=codeBlockHeader_C_1e aria-label="Code block header for python code with copy and toggle buttons"><span class=languageLabel_zr_I>python</span></div><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">genai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">scorers </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> Safety</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">result </span><span class="token operator">=</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">genai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">optimize_prompts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    predict_fn</span><span class="token operator">=</span><span class="token plain">predict_fn</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    train_data</span><span class="token operator">=</span><span class="token plain">dataset</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    prompt_uris</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">prompt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">uri</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    optimizer</span><span class="token operator">=</span><span class="token plain">GepaPromptOptimizer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">reflection_model</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"openai:/gpt-5"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    scorers</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Safety</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">model</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"openai:/gpt-5"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=model-switching-and-migration>Model Switching and Migration<a href=#model-switching-and-migration class=hash-link aria-label="Direct link to Model Switching and Migration" title="Direct link to Model Switching and Migration" translate=no>â€‹</a></h3>
<p>When switching between different language models (e.g., migrating from <code>gpt-5</code> to <code>gpt-5-mini</code> for cost reduction), you may need to rewrite your prompts to maintain output quality with the new model. The <a href=/mlflow-website/docs/latest/api_reference/python_api/mlflow.genai.html#mlflow.genai.optimize_prompts target=_blank><code>mlflow.genai.optimize_prompts<!-- -->()</code></a> API can help adapt prompts automatically using your existing application outputs as training data.</p>
<p>See the <a class="" href=/mlflow-website/docs/latest/genai/prompt-registry/rewrite-prompts/>Auto-rewrite Prompts for New Models</a> guide for a complete model migration workflow.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=troubleshooting>Troubleshooting<a href=#troubleshooting class=hash-link aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting" translate=no>â€‹</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=issue-optimization-takes-too-long>Issue: Optimization Takes Too Long<a href=#issue-optimization-takes-too-long class=hash-link aria-label="Direct link to Issue: Optimization Takes Too Long" title="Direct link to Issue: Optimization Takes Too Long" translate=no>â€‹</a></h3>
<p><strong>Solution</strong>: Reduce dataset size or reduce the optimizer budget:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_bxn0><div class=codeBlockHeader_C_1e aria-label="Code block header for python code with copy and toggle buttons"><span class=languageLabel_zr_I>python</span></div><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token comment" style="color:rgb(98, 114, 164)"># Use fewer examples</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">small_dataset </span><span class="token operator">=</span><span class="token plain"> dataset</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Use faster model for optimization</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">optimizer </span><span class="token operator">=</span><span class="token plain"> GepaPromptOptimizer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    reflection_model</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"openai:/gpt-5-mini"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> max_metric_calls</span><span class="token operator">=</span><span class="token number">100</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=issue-no-improvement-observed>Issue: No Improvement Observed<a href=#issue-no-improvement-observed class=hash-link aria-label="Direct link to Issue: No Improvement Observed" title="Direct link to Issue: No Improvement Observed" translate=no>â€‹</a></h3>
<p><strong>Solution</strong>: Check your evaluation metrics and increase dataset diversity:</p>
<ul>
<li class="">Ensure scorers accurately measure what you care about</li>
<li class="">Increase training data size and diversity</li>
<li class="">Try to modify optimizer configurations</li>
<li class="">Verify outputs format matches expectations</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=issue-prompts-not-being-used>Issue: Prompts Not Being Used<a href=#issue-prompts-not-being-used class=hash-link aria-label="Direct link to Issue: Prompts Not Being Used" title="Direct link to Issue: Prompts Not Being Used" translate=no>â€‹</a></h3>
<p><strong>Solution</strong>: Ensure <code>predict_fn</code> calls <a href=/mlflow-website/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.model_registry.PromptVersion.format target=_blank><code>PromptVersion.format()</code></a> during execution:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_bxn0><div class=codeBlockHeader_C_1e aria-label="Code block header for python code with copy and toggle buttons"><span class=languageLabel_zr_I>python</span></div><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token comment" style="color:rgb(98, 114, 164)"># âœ… Correct - loads from registry</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">predict_fn</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">question</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    prompt </span><span class="token operator">=</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">genai</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">load_prompt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"prompts:/qa@latest"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> llm_call</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">prompt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">format</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">question</span><span class="token operator">=</span><span class="token plain">question</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># âŒ Incorrect - hardcoded prompt</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">predict_fn</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">question</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> llm_call</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Answer: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">question</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=see-also>See Also<a href=#see-also class=hash-link aria-label="Direct link to See Also" title="Direct link to See Also" translate=no>â€‹</a></h2>
<ul>
<li class=""><a class="" href=/mlflow-website/docs/latest/genai/prompt-registry/rewrite-prompts/>Auto-rewrite Prompts for New Models</a>: Adapt prompts when switching between language models</li>
<li class=""><a class="" href=/mlflow-website/docs/latest/genai/prompt-registry/create-and-edit-prompts/>Create and Edit Prompts</a>: Basic Prompt Registry usage</li>
<li class=""><a class="" href=/mlflow-website/docs/latest/genai/eval-monitor/running-evaluation/prompts/>Evaluate Prompts</a>: Evaluate prompt performance</li>
</ul></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/mlflow-website/docs/latest/genai/prompt-registry/structured-output/><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Structured Output</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/mlflow-website/docs/latest/genai/prompt-registry/optimize-prompts/langchain-optimization/><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>LangChain Optimization</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#quick-start class="table-of-contents__link toc-highlight">Quick Start</a><li><a href=#choosing-your-optimizer class="table-of-contents__link toc-highlight">Choosing Your Optimizer</a><ul><li><a href=#gepa-genetic-pareto class="table-of-contents__link toc-highlight">GEPA (Genetic-Pareto)</a><li><a href=#metaprompting class="table-of-contents__link toc-highlight">Metaprompting</a><li><a href=#comparison-summary class="table-of-contents__link toc-highlight">Comparison Summary</a><li><a href=#example-simple-prompt--optimized-prompt class="table-of-contents__link toc-highlight">Example: Simple Prompt â†’ Optimized Prompt</a></ul><li><a href=#components class="table-of-contents__link toc-highlight">Components</a><ul><li><a href=#1-target-prompt-uris class="table-of-contents__link toc-highlight">1. Target Prompt URIs</a><li><a href=#2-predict-function class="table-of-contents__link toc-highlight">2. Predict Function</a><li><a href=#3-training-data class="table-of-contents__link toc-highlight">3. Training Data</a><li><a href=#4-optimizer class="table-of-contents__link toc-highlight">4. Optimizer</a></ul><li><a href=#advanced-usage class="table-of-contents__link toc-highlight">Advanced Usage</a><ul><li><a href=#works-with-any-agent-framework class="table-of-contents__link toc-highlight">Works with Any Agent Framework</a><li><a href=#using-custom-scorers class="table-of-contents__link toc-highlight">Using Custom Scorers</a><li><a href=#custom-optimization-algorithm class="table-of-contents__link toc-highlight">Custom Optimization Algorithm</a><li><a href=#multi-prompt-optimization class="table-of-contents__link toc-highlight">Multi-Prompt Optimization</a></ul><li><a href=#result-object class="table-of-contents__link toc-highlight">Result Object</a><li><a href=#common-use-cases class="table-of-contents__link toc-highlight">Common Use Cases</a><ul><li><a href=#improving-accuracy class="table-of-contents__link toc-highlight">Improving Accuracy</a><li><a href=#optimizing-for-safeness class="table-of-contents__link toc-highlight">Optimizing for Safeness</a><li><a href=#model-switching-and-migration class="table-of-contents__link toc-highlight">Model Switching and Migration</a></ul><li><a href=#troubleshooting class="table-of-contents__link toc-highlight">Troubleshooting</a><ul><li><a href=#issue-optimization-takes-too-long class="table-of-contents__link toc-highlight">Issue: Optimization Takes Too Long</a><li><a href=#issue-no-improvement-observed class="table-of-contents__link toc-highlight">Issue: No Improvement Observed</a><li><a href=#issue-prompts-not-being-used class="table-of-contents__link toc-highlight">Issue: Prompts Not Being Used</a></ul><li><a href=#see-also class="table-of-contents__link toc-highlight">See Also</a></ul></div></div></div></div></main></div></div></div><footer class="relative pb-30 flex flex-col pt-30 bg-bottom bg-no-repeat bg-cover bg-size-[auto_360px] 2xl:bg-size-[100%_360px] bg-brand-black"><div style="position:absolute;width:100%;bottom:0;pointer-events:none;mask-composite:intersect;height:360px;background-image:repeating-linear-gradient(
        to right,
        rgba(0, 0, 0, 0.05),
        rgba(0, 0, 0, 0.25) 18px,
        transparent 2px,
        transparent 10px
      ),
      radial-gradient(
        circle at bottom center,
        oklch(0.6 0.22 30.59) 0%,
        transparent 60%
      ),
      linear-gradient(to right, color-mix(in srgb, oklch(0.6 0.22 30.59), black 10%), color-mix(in srgb, oklch(0.6 0.22 30.59), oklch(0.91 0.09 326.28) 40%));mask-image:radial-gradient(ellipse at center bottom, black 60%, transparent 80%),
      linear-gradient(to top, black 10%, transparent 40%)"></div><div class=z-1><div class="flex flex-row justify-between items-start md:items-center px-6 lg:px-20 gap-10 xs:gap-0 max-w-container"><div class="flex flex-col gap-8"><svg xmlns=http://www.w3.org/2000/svg width=109 height=40 fill=none viewBox="0 0 109 40" class="h-[36px] shrink-0"><path fill=#fff d="M0 31.032v-15.53h3.543v1.968c.893-1.594 2.84-2.425 4.593-2.425 2.042 0 3.828.926 4.658 2.745 1.216-2.043 3.034-2.745 5.043-2.745 2.81 0 5.49 1.787 5.49 5.904v10.083h-3.574v-9.478c0-1.818-.926-3.19-3-3.19-1.947 0-3.224 1.53-3.224 3.445v9.22H9.893v-9.475c0-1.786-.898-3.18-3.003-3.18-1.977 0-3.223 1.467-3.223 3.444v9.221ZM27.855 31.032V7.929h3.703v23.103ZM30.07 39.487c.833.232 1.582.383 3.17.383 2.953 0 6.436-1.665 7.353-6.339l3.786-18.739h5.629l.687-3.117h-5.686l.765-3.725c.586-2.892 2.186-4.358 4.754-4.358.668 0 .48.058 1.076.17L52.427.57c-.793-.237-1.503-.379-3.049-.379a7.32 7.32 0 0 0-4.528 1.484c-1.441 1.114-2.393 2.75-2.827 4.863l-1.066 5.137h-5.034l-.411 3.12h4.823L36.859 32.12c-.383 1.965-1.5 4.315-4.708 4.315-.727 0-.463-.055-1.121-.162ZM53.342 30.905H49.64l5.074-23.309h3.701ZM71.807 16.477A7.962 7.962 0 0 0 60.97 27.904l2.425-1.78a5.005 5.005 0 0 1 3.845-8.145v1.895ZM62.618 29.472a7.962 7.962 0 0 0 10.836-11.428l-2.425 1.78a5.005 5.005 0 0 1-3.845 8.145v-1.894ZM78.092 15.493h4.044l.823 10.612 5.759-10.612 3.839.055 1.508 10.557 5.074-10.612 3.701.055-7.678 15.493H91.46l-1.783-11.106-5.895 11.106h-3.84ZM105.072 15.768h-.766v-.266h1.845v.272h-.765v2.243h-.314ZM106.614 15.502h.383l.482 1.34q.091.259.178.524h.018c.059-.176.113-.352.172-.524l.478-1.34h.383v2.515h-.298V16.63c0-.22.024-.523.04-.747h-.016l-.191.574-.475 1.304h-.208l-.481-1.302-.191-.574h-.015c.017.224.042.527.042.747v1.387h-.291Z"/></svg><div class="text-xs text-left md:text-nowrap md:w-0">Â© 2025 MLflow Project, a Series of LF Projects, LLC.</div></div><div class="flex flex-col flex-wrap justify-end md:text-right md:flex-row gap-x-10 lg:gap-x-20 gap-y-5 w-2/5 md:w-auto md:pt-2 max-w-fit"><div><a href=https://mlflow.org target=_blank rel="noopener noreferrer" class="text-[15px] font-medium no-underline hover:no-underline transition-opacity hover:opacity-80 text-white visited:text-white">Components</a></div><div><a href=https://mlflow.org/releases target=_blank rel="noopener noreferrer" class="text-[15px] font-medium no-underline hover:no-underline transition-opacity hover:opacity-80 text-white visited:text-white">Releases</a></div><div><a href=https://mlflow.org/blog target=_blank rel="noopener noreferrer" class="text-[15px] font-medium no-underline hover:no-underline transition-opacity hover:opacity-80 text-white visited:text-white">Blog</a></div><div><a class="text-[15px] font-medium no-underline hover:no-underline transition-opacity hover:opacity-80 text-white visited:text-white" href=/mlflow-website/docs/latest/>Docs</a></div><div><a href=https://mlflow.org/ambassadors target=_blank rel="noopener noreferrer" class="text-[15px] font-medium no-underline hover:no-underline transition-opacity hover:opacity-80 text-white visited:text-white">Ambassador Program</a></div></div></div></div></footer></div></body>