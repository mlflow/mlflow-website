
  

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ü§ó Transformers within MLflow &mdash; MLflow 2.9.3.dev0 documentation</title>
  
   
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="canonical" href="https://mlflow.org/docs/latest/llms/transformers/guide/index.html">
  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    

    

  
    

  

  
  
    

  

  
  
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600" rel="stylesheet">
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/cards.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/grids.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/mobile.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/simple-cards.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/tabs.css" type="text/css" />
    
  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="MLflow 2.9.3.dev0 documentation" href="../../../index.html"/>
        <link rel="up" title="MLflow Transformers Flavor" href="../index.html"/>
        <link rel="next" title="MLflow OpenAI Flavor" href="/../../openai/index.html"/>
        <link rel="prev" title="Prompt Templating with MLflow and Transformers" href="/../tutorials/prompt-templating/prompt-templating.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>
<script type="text/javascript" src="../../../_static/jquery.js"></script>
<script type="text/javascript" src="../../../_static/underscore.js"></script>
<script type="text/javascript" src="../../../_static/doctools.js"></script>
<script type="text/javascript" src="../../../_static/languagesections.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>

<body class="wy-body-for-nav" role="document">
  

  
  <nav class="wy-nav-top header" role="navigation" aria-label="top navigation">
    <ul>
  <li class="menu-toggle">
    <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
    <a href="../../../index.html" class="wy-nav-top-logo"
      ><img src="../../../_static/MLflow-logo-final-black.png" alt="MLflow"
    /></a>
    <span class="version">2.9.3.dev0</span>
  </li>
</ul>
  </nav>
  <page>
    

    <nav data-toggle="wy-nav-shift" class="wy-nav-side relative">
      <div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
  </form>
</div>


    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../../../index.html" class="main-navigation-home"><img src="../../../_static/icons/nav-home.svg"> MLflow</a>
    

    
      

      
        <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/index.html">What is MLflow?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/index.html">Getting Started with MLflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../new-features/index.html">New Features</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">LLMs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../index.html#id1">MLflow Deployments Server for LLMs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#id2">LLM Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#id3">Prompt Engineering UI</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html#native-mlflow-flavors-for-llms">Native MLflow Flavors for LLMs</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../../index.html#explore-the-native-llm-flavors">Explore the Native LLM Flavors</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="../index.html">MLflow Transformers Flavor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../openai/index.html">MLflow OpenAI Flavor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../sentence-transformers/index.html">MLflow Sentence-Transformers Flavor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../langchain/index.html">MLflow LangChain Flavor</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#id4">LLM Tracking in MLflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#tutorials-and-use-case-guides-for-llms-in-mlflow">Tutorials and Use Case Guides for LLMs in MLflow</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../model-evaluation/index.html">Model Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../deep-learning/index.html">Deep Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../traditional-ml/index.html">Traditional ML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../deployment/index.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tracking.html">MLflow Tracking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../system-metrics/index.html">System Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../projects.html">MLflow Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../models.html">MLflow Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../model-registry.html">MLflow Model Registry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../recipes.html">MLflow Recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../plugins.html">MLflow Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auth/index.html">MLflow Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cli.html">Command-Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../search-runs.html">Search Runs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../search-experiments.html">Search Experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python_api/index.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../R-api.html">R API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../java_api/index.html">Java API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rest-api.html">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docker.html">Official MLflow Docker Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../community-model-flavors.html">Community Model Flavors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials-and-examples/index.html">Tutorials and Examples</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    

    <p>
      <a id='feedbacklink' href="https://github.com/mlflow/mlflow/blob/master/CONTRIBUTING.md" target="_blank">Contribute</a>
    </p>
  </div>
</div>
    </nav>

    <main class="wy-grid-for-nav">
      <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
        <div class="wy-nav-content">
          <div class="rst-content">
            










<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
        <li><a href="../../index.html">LLMs</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
        <li><a href="../index.html">MLflow Transformers Flavor</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>ü§ó Transformers within MLflow</li>
    
    
    <!-- <li class="wy-breadcrumbs-aside">
      <a href="https://github.com/mlflow/mlflow/blob/master/docs/source/llms/transformers/guide/index.rst" class="fa fa-github"> Edit on GitHub</a>
    </li> -->
    
  </ul>
</div>
            <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
              <div itemprop="articleBody">
                
  <div class="section" id="transformers-within-mlflow">
<h1>ü§ó Transformers within MLflow<a class="headerlink" href="#transformers-within-mlflow" title="Permalink to this headline"> </a></h1>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>The <code class="docutils literal notranslate"><span class="pre">transformers</span></code> flavor is in active development and is marked as Experimental. Public APIs may change and new features are
subject to be added as additional functionality is brought to the flavor.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">transformers</span></code> model flavor enables logging of
<a class="reference external" href="https://huggingface.co/docs/transformers/index">transformers models, components, and pipelines</a> in MLflow format via
the <a class="reference internal" href="../../../python_api/mlflow.transformers.html#mlflow.transformers.save_model" title="mlflow.transformers.save_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.transformers.save_model()</span></code></a> and <a class="reference internal" href="../../../python_api/mlflow.transformers.html#mlflow.transformers.log_model" title="mlflow.transformers.log_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.transformers.log_model()</span></code></a> functions. Use of these
functions also adds the <code class="docutils literal notranslate"><span class="pre">python_function</span></code> flavor to the MLflow Models that they produce, allowing the model to be
interpreted as a generic Python function for inference via <a class="reference internal" href="../../../python_api/mlflow.pyfunc.html#mlflow.pyfunc.load_model" title="mlflow.pyfunc.load_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.pyfunc.load_model()</span></code></a>.
You can also use the <a class="reference internal" href="../../../python_api/mlflow.transformers.html#mlflow.transformers.load_model" title="mlflow.transformers.load_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.transformers.load_model()</span></code></a> function to load a saved or logged MLflow
Model with the <code class="docutils literal notranslate"><span class="pre">transformers</span></code> flavor in the native transformers formats.</p>
<div class="section" id="input-and-output-types-for-pyfunc">
<h2>Input and Output types for PyFunc<a class="headerlink" href="#input-and-output-types-for-pyfunc" title="Permalink to this headline"> </a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">transformers</span></code> <a class="reference internal" href="../../../models.html#pyfunc-model-flavor"><span class="std std-ref">python_function (pyfunc) model flavor</span></a> simplifies
and standardizes both the inputs and outputs of pipeline inference. This conformity allows for serving
and batch inference by coercing the data structures that are required for <code class="docutils literal notranslate"><span class="pre">transformers</span></code> inference pipelines
to formats that are compatible with json serialization and casting to Pandas DataFrames.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Certain <cite>TextGenerationPipeline</cite> types, particularly instructional-based ones, may return the original
prompt and included line-formatting carriage returns <cite>‚Äún‚Äù</cite> in their outputs. For these pipeline types,
if you would like to disable the prompt return, you can set the following in the <cite>model_config</cite> dictionary when
saving or logging the model: <cite>‚Äúinclude_prompt‚Äù: False</cite>. To remove the newline characters from within the body
of the generated text output, you can add the <cite>‚Äúcollapse_whitespace‚Äù: True</cite> option to the <cite>model_config</cite> dictionary.
If the pipeline type being saved does not inherit from <cite>TextGenerationPipeline</cite>, these options will not perform
any modification to the output returned from pipeline inference.</p>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Not all <code class="docutils literal notranslate"><span class="pre">transformers</span></code> pipeline types are supported. See the table below for the list of currently supported Pipeline
types that can be loaded as <code class="docutils literal notranslate"><span class="pre">pyfunc</span></code>.</p>
<p>In the current version, audio and text-based large language
models are supported for use with <code class="docutils literal notranslate"><span class="pre">pyfunc</span></code>, while computer vision, multi-modal, timeseries,
reinforcement learning, and graph models are only supported for native type loading via <a class="reference internal" href="../../../python_api/mlflow.transformers.html#mlflow.transformers.load_model" title="mlflow.transformers.load_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.transformers.load_model()</span></code></a></p>
<p>Future releases of MLflow will introduce <code class="docutils literal notranslate"><span class="pre">pyfunc</span></code> support for these additional types.</p>
</div>
<p>The table below shows the mapping of <code class="docutils literal notranslate"><span class="pre">transformers</span></code> pipeline types to the <a class="reference internal" href="../../../models.html#pyfunc-model-flavor"><span class="std std-ref">python_function (pyfunc) model flavor</span></a>
data type inputs and outputs.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The inputs and outputs of the <code class="docutils literal notranslate"><span class="pre">pyfunc</span></code> implementation of these pipelines <em>are not guaranteed to match</em> the input types and output types that would
return from a native use of a given pipeline type. If your use case requires access to scores, top_k results, or other additional references within
the output from a pipeline inference call, please use the native implementation by loading via <a class="reference internal" href="../../../python_api/mlflow.transformers.html#mlflow.transformers.load_model" title="mlflow.transformers.load_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.transformers.load_model()</span></code></a> to
receive the full output.</p>
<p>Similarly, if your use case requires the use of raw tensor outputs or processing of outputs through an external <code class="docutils literal notranslate"><span class="pre">processor</span></code> module, load the
model components directly as a <code class="docutils literal notranslate"><span class="pre">dict</span></code> by calling <a class="reference internal" href="../../../python_api/mlflow.transformers.html#mlflow.transformers.load_model" title="mlflow.transformers.load_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.transformers.load_model()</span></code></a> and specify the <code class="docutils literal notranslate"><span class="pre">return_type</span></code> argument as ‚Äòcomponents‚Äô.</p>
</div>
</div>
<div class="section" id="supported-transformers-pipeline-types-for-pyfunc">
<h2>Supported transformers Pipeline types for Pyfunc<a class="headerlink" href="#supported-transformers-pipeline-types-for-pyfunc" title="Permalink to this headline"> </a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 22%" />
<col style="width: 54%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Pipeline Type</p></th>
<th class="head"><p>Input Type</p></th>
<th class="head"><p>Output Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Instructional Text Generation</p></td>
<td><p>str or List[str]</p></td>
<td><p>List[str]</p></td>
</tr>
<tr class="row-odd"><td><p>Conversational</p></td>
<td><p>str or List[str]</p></td>
<td><p>List[str]</p></td>
</tr>
<tr class="row-even"><td><p>Summarization</p></td>
<td><p>str or List[str]</p></td>
<td><p>List[str]</p></td>
</tr>
<tr class="row-odd"><td><p>Text Classification</p></td>
<td><p>str or List[str]</p></td>
<td><p>pd.DataFrame (dtypes: {‚Äòlabel‚Äô: str, ‚Äòscore‚Äô: double})</p></td>
</tr>
<tr class="row-even"><td><p>Text Generation</p></td>
<td><p>str or List[str]</p></td>
<td><p>List[str]</p></td>
</tr>
<tr class="row-odd"><td><p>Text2Text Generation</p></td>
<td><p>str or List[str]</p></td>
<td><p>List[str]</p></td>
</tr>
<tr class="row-even"><td><p>Token Classification</p></td>
<td><p>str or List[str]</p></td>
<td><p>List[str]</p></td>
</tr>
<tr class="row-odd"><td><p>Translation</p></td>
<td><p>str or List[str]</p></td>
<td><p>List[str]</p></td>
</tr>
<tr class="row-even"><td><p>ZeroShot Classification*</p></td>
<td><p>Dict[str, [List[str] | str]*</p></td>
<td><p>pd.DataFrame (dtypes: {‚Äòsequence‚Äô: str, ‚Äòlabels‚Äô: str, ‚Äòscores‚Äô: double})</p></td>
</tr>
<tr class="row-odd"><td><p>Table Question Answering**</p></td>
<td><p>Dict[str, [List[str] | str]**</p></td>
<td><p>List[str]</p></td>
</tr>
<tr class="row-even"><td><p>Question Answering***</p></td>
<td><p>Dict[str, str]***</p></td>
<td><p>List[str]</p></td>
</tr>
<tr class="row-odd"><td><p>Fill Mask****</p></td>
<td><p>str or List[str]****</p></td>
<td><p>List[str]</p></td>
</tr>
<tr class="row-even"><td><p>Feature Extraction</p></td>
<td><p>str or List[str]</p></td>
<td><p>np.ndarray</p></td>
</tr>
<tr class="row-odd"><td><p>AutomaticSpeechRecognition</p></td>
<td><p>bytes*****, str, or np.ndarray</p></td>
<td><p>List[str]</p></td>
</tr>
<tr class="row-even"><td><p>AudioClassification</p></td>
<td><p>bytes*****, str, or np.ndarray</p></td>
<td><p>pd.DataFrame (dtypes: {‚Äòlabel‚Äô: str, ‚Äòscore‚Äô: double})</p></td>
</tr>
</tbody>
</table>
<p>* A collection of these inputs can also be passed. The standard required key names are ‚Äòsequences‚Äô and ‚Äòcandidate_labels‚Äô, but these may vary.
Check the input requirments for the architecture that you‚Äôre using to ensure that the correct dictionary key names are provided.</p>
<p>** A collection of these inputs can also be passed. The reference table must be a json encoded dict (i.e. {‚Äòquery‚Äô: ‚Äòwhat did we sell most of?‚Äô, ‚Äòtable‚Äô: json.dumps(table_as_dict)})</p>
<p>*** A collection of these inputs can also be passed. The standard required key names are ‚Äòquestion‚Äô and ‚Äòcontext‚Äô. Verify the expected input key names match the
expected input to the model to ensure your inference request can be read properly.</p>
<p>**** The mask syntax for the model that you‚Äôve chosen is going to be specific to that model‚Äôs implementation. Some are ‚Äò[MASK]‚Äô, while others are ‚Äò&lt;mask&gt;‚Äô. Verify the expected syntax to
avoid failed inference requests.</p>
<p>***** If using <cite>pyfunc</cite> in MLflow Model Serving for realtime inference, the raw audio in bytes format must be base64 encoded prior to submitting to the endpoint. String inputs will be interpreted as uri locations.</p>
<div class="section" id="saving-prompt-templates-with-transformer-pipelines">
<h3>Saving Prompt Templates with Transformer Pipelines<a class="headerlink" href="#saving-prompt-templates-with-transformer-pipelines" title="Permalink to this headline"> </a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This feature is only available in MLflow 2.10.0 and above.</p>
</div>
<p>MLflow supports specifying prompt templates for certain pipeline types:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://huggingface.co/transformers/main_classes/pipelines.html#transformers.FeatureExtractionPipeline">feature-extraction</a></p></li>
<li><p><a class="reference external" href="https://huggingface.co/transformers/main_classes/pipelines.html#transformers.FillMaskPipeline">fill-mask</a></p></li>
<li><p><a class="reference external" href="https://huggingface.co/transformers/main_classes/pipelines.html#transformers.SummarizationPipeline">summarization</a></p></li>
<li><p><a class="reference external" href="https://huggingface.co/transformers/main_classes/pipelines.html#transformers.Text2TextGenerationPipeline">text2text-generation</a></p></li>
<li><p><a class="reference external" href="https://huggingface.co/transformers/main_classes/pipelines.html#transformers.TextGenerationPipeline">text-generation</a></p></li>
</ul>
<p>Prompt templates are strings that are used to format user inputs prior to <code class="docutils literal notranslate"><span class="pre">pyfunc</span></code> inference. To specify a prompt template,
use the <code class="docutils literal notranslate"><span class="pre">prompt_template</span></code> argument when calling <a class="reference internal" href="../../../python_api/mlflow.transformers.html#mlflow.transformers.save_model" title="mlflow.transformers.save_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.transformers.save_model()</span></code></a> or <a class="reference internal" href="../../../python_api/mlflow.transformers.html#mlflow.transformers.log_model" title="mlflow.transformers.log_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.transformers.log_model()</span></code></a>.
The prompt template must be a string with a single format placeholder, <code class="docutils literal notranslate"><span class="pre">{prompt}</span></code>.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">pipeline</span>

<span class="c1"># Initialize a pipeline. `distilgpt2` uses a &quot;text-generation&quot; pipeline</span>
<span class="n">generator</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;distilgpt2&quot;</span><span class="p">)</span>

<span class="c1"># Define a prompt template</span>
<span class="n">prompt_template</span> <span class="o">=</span> <span class="s2">&quot;Answer the following question: </span><span class="si">{prompt}</span><span class="s2">&quot;</span>

<span class="c1"># Save the model</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">transformers</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span>
    <span class="n">transformers_model</span><span class="o">=</span><span class="n">generator</span><span class="p">,</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;path/to/model&quot;</span><span class="p">,</span>
    <span class="n">prompt_template</span><span class="o">=</span><span class="n">prompt_template</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>When the model is then loaded with <a class="reference internal" href="../../../python_api/mlflow.pyfunc.html#mlflow.pyfunc.load_model" title="mlflow.pyfunc.load_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.pyfunc.load_model()</span></code></a>, the prompt
template will be used to format user inputs before passing them into the pipeline:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>

<span class="c1"># Load the model with pyfunc</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;path/to/model&quot;</span><span class="p">)</span>

<span class="c1"># The prompt template will be used to format this input, so the</span>
<span class="c1"># string that is passed to the text-generation pipeline will be:</span>
<span class="c1"># &quot;Answer the following question: What is MLflow?&quot;</span>
<span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s2">&quot;What is MLflow?&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">text-generation</span></code> pipelines with a prompt template will have the <a class="reference external" href="https://huggingface.co/docs/huggingface_hub/main/en/package_reference/inference_client#huggingface_hub.inference._text_generation.TextGenerationParameters.return_full_text">return_full_text pipeline argument</a>
set to <code class="docutils literal notranslate"><span class="pre">False</span></code> by default. This is to prevent the template from being shown to the users,
which could potentially cause confusion as it was not part of their original input. To
override this behaviour, either set <code class="docutils literal notranslate"><span class="pre">return_full_text</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code> via <code class="docutils literal notranslate"><span class="pre">params</span></code>, or by
including it in a <code class="docutils literal notranslate"><span class="pre">model_config</span></code> dict in <code class="docutils literal notranslate"><span class="pre">log_model()</span></code>. See <a class="reference external" href="#using-model-config-and-model-signature-params-for-transformers-inference">this section</a>
for more details on how to do this.</p>
</div>
<p>For a more in-depth guide, check out the <a class="reference internal" href="../tutorials/prompt-templating/prompt-templating.html"><span class="doc">Prompt Templating notebook</span></a>!</p>
</div>
<div class="section" id="using-model-config-and-model-signature-params-for-transformers-inference">
<h3>Using model_config and model signature params for <cite>transformers</cite> inference<a class="headerlink" href="#using-model-config-and-model-signature-params-for-transformers-inference" title="Permalink to this headline"> </a></h3>
<p>For <cite>transformers</cite> inference, there are two ways to pass in additional arguments to the pipeline.</p>
<ul class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">model_config</span></code> when saving/logging the model. Optionally, specify <code class="docutils literal notranslate"><span class="pre">model_config</span></code> when calling <code class="docutils literal notranslate"><span class="pre">load_model</span></code>.</p></li>
<li><p>Specify params at inference time when calling <code class="docutils literal notranslate"><span class="pre">predict()</span></code></p></li>
</ul>
<p>Use <code class="docutils literal notranslate"><span class="pre">model_config</span></code> to control how the model is loaded and inference performed for all input samples. Configuration in
<code class="docutils literal notranslate"><span class="pre">model_config</span></code> is not overridable at <code class="docutils literal notranslate"><span class="pre">predict()</span></code> time unless a <code class="docutils literal notranslate"><span class="pre">ModelSignature</span></code> is indicated with the same parameters.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">ModelSignature</span></code> with params schema, on the other hand, to allow downstream consumers to provide additional inference
params that may be needed to compute the predictions for their specific samples.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If both <code class="docutils literal notranslate"><span class="pre">model_config</span></code> and <code class="docutils literal notranslate"><span class="pre">ModelSignature</span></code> with parameters are saved when logging model, both of them
will be used for inference. The default parameters in <code class="docutils literal notranslate"><span class="pre">ModelSignature</span></code> will override the params in <code class="docutils literal notranslate"><span class="pre">model_config</span></code>.
If extra <code class="docutils literal notranslate"><span class="pre">params</span></code> are provided at inference time, they take precedence over all params. We recommend using
<code class="docutils literal notranslate"><span class="pre">model_config</span></code> for those parameters needed to run the model in general for all the samples. Then, add
<code class="docutils literal notranslate"><span class="pre">ModelSignature</span></code> with parameters for those extra parameters that you want downstream consumers to indicated at
per each of the samples.</p>
</div>
<ul class="simple">
<li><p>Using <code class="docutils literal notranslate"><span class="pre">model_config</span></code></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">from</span> <span class="nn">mlflow.models</span> <span class="kn">import</span> <span class="n">infer_signature</span>
<span class="kn">from</span> <span class="nn">mlflow.transformers</span> <span class="kn">import</span> <span class="n">generate_signature_output</span>
<span class="kn">import</span> <span class="nn">transformers</span>

<span class="n">architecture</span> <span class="o">=</span> <span class="s2">&quot;mrm8488/t5-base-finetuned-common_gen&quot;</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">transformers</span><span class="o">.</span><span class="n">pipeline</span><span class="p">(</span>
    <span class="n">task</span><span class="o">=</span><span class="s2">&quot;text2text-generation&quot;</span><span class="p">,</span>
    <span class="n">tokenizer</span><span class="o">=</span><span class="n">transformers</span><span class="o">.</span><span class="n">T5TokenizerFast</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">architecture</span><span class="p">),</span>
    <span class="n">model</span><span class="o">=</span><span class="n">transformers</span><span class="o">.</span><span class="n">T5ForConditionalGeneration</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">architecture</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;pencil draw paper&quot;</span>

<span class="c1"># Infer the signature</span>
<span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">generate_signature_output</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">),</span>
<span class="p">)</span>

<span class="c1"># Define an model_config</span>
<span class="n">model_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;num_beams&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;max_length&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
    <span class="s2">&quot;do_sample&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;remove_invalid_values&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Saving model_config with the model</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">transformers</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;text2text&quot;</span><span class="p">,</span>
    <span class="n">model_config</span><span class="o">=</span><span class="n">model_config</span><span class="p">,</span>
    <span class="n">signature</span><span class="o">=</span><span class="n">signature</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">pyfunc_loaded</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;text2text&quot;</span><span class="p">)</span>
<span class="c1"># model_config will be applied</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">pyfunc_loaded</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># overriding some inference configuration with diferent values</span>
<span class="n">pyfunc_loaded</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span>
    <span class="s2">&quot;text2text&quot;</span><span class="p">,</span> <span class="n">model_config</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">do_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that in the previous example, the user can‚Äôt override the configuration <code class="docutils literal notranslate"><span class="pre">do_sample</span></code>
when calling <code class="docutils literal notranslate"><span class="pre">predict</span></code>.</p>
</div>
<ul class="simple">
<li><p>Specifying params at inference time</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">from</span> <span class="nn">mlflow.models</span> <span class="kn">import</span> <span class="n">infer_signature</span>
<span class="kn">from</span> <span class="nn">mlflow.transformers</span> <span class="kn">import</span> <span class="n">generate_signature_output</span>
<span class="kn">import</span> <span class="nn">transformers</span>

<span class="n">architecture</span> <span class="o">=</span> <span class="s2">&quot;mrm8488/t5-base-finetuned-common_gen&quot;</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">transformers</span><span class="o">.</span><span class="n">pipeline</span><span class="p">(</span>
    <span class="n">task</span><span class="o">=</span><span class="s2">&quot;text2text-generation&quot;</span><span class="p">,</span>
    <span class="n">tokenizer</span><span class="o">=</span><span class="n">transformers</span><span class="o">.</span><span class="n">T5TokenizerFast</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">architecture</span><span class="p">),</span>
    <span class="n">model</span><span class="o">=</span><span class="n">transformers</span><span class="o">.</span><span class="n">T5ForConditionalGeneration</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">architecture</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;pencil draw paper&quot;</span>

<span class="c1"># Define an model_config</span>
<span class="n">model_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;num_beams&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;remove_invalid_values&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Define the inference parameters params</span>
<span class="n">inference_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;max_length&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
    <span class="s2">&quot;do_sample&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Infer the signature including params</span>
<span class="n">signature_with_params</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">generate_signature_output</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">),</span>
    <span class="n">params</span><span class="o">=</span><span class="n">inference_params</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Saving model with signature and model config</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">transformers</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;text2text&quot;</span><span class="p">,</span>
    <span class="n">model_config</span><span class="o">=</span><span class="n">model_config</span><span class="p">,</span>
    <span class="n">signature</span><span class="o">=</span><span class="n">signature_with_params</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">pyfunc_loaded</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;text2text&quot;</span><span class="p">)</span>

<span class="c1"># Pass params at inference time</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;max_length&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="s2">&quot;do_sample&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># In this case we only override max_length and do_sample,</span>
<span class="c1"># other params will use the default one saved on ModelSignature</span>
<span class="c1"># or in the model configuration.</span>
<span class="c1"># The final params used for prediction is as follows:</span>
<span class="c1"># {</span>
<span class="c1">#    &quot;num_beams&quot;: 5,</span>
<span class="c1">#    &quot;max_length&quot;: 20,</span>
<span class="c1">#    &quot;do_sample&quot;: False,</span>
<span class="c1">#    &quot;remove_invalid_values&quot;: True,</span>
<span class="c1"># }</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">pyfunc_loaded</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="example-of-loading-a-transformers-model-as-a-python-function">
<h3>Example of loading a transformers model as a python function<a class="headerlink" href="#example-of-loading-a-transformers-model-as-a-python-function" title="Permalink to this headline"> </a></h3>
<p>In the below example, a simple pre-trained model is used within a pipeline. After logging to MLflow, the pipeline is
loaded as a <code class="docutils literal notranslate"><span class="pre">pyfunc</span></code> and used to generate a response from a passed-in list of strings.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">transformers</span>

<span class="c1"># Read a pre-trained conversation pipeline from HuggingFace hub</span>
<span class="n">conversational_pipeline</span> <span class="o">=</span> <span class="n">transformers</span><span class="o">.</span><span class="n">pipeline</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;microsoft/DialoGPT-medium&quot;</span><span class="p">)</span>

<span class="c1"># Define the signature</span>
<span class="n">signature</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">infer_signature</span><span class="p">(</span>
    <span class="s2">&quot;Hi there, chatbot!&quot;</span><span class="p">,</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">transformers</span><span class="o">.</span><span class="n">generate_signature_output</span><span class="p">(</span>
        <span class="n">conversational_pipeline</span><span class="p">,</span> <span class="s2">&quot;Hi there, chatbot!&quot;</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="c1"># Log the pipeline</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">model_info</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">transformers</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">transformers_model</span><span class="o">=</span><span class="n">conversational_pipeline</span><span class="p">,</span>
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;chatbot&quot;</span><span class="p">,</span>
        <span class="n">task</span><span class="o">=</span><span class="s2">&quot;conversational&quot;</span><span class="p">,</span>
        <span class="n">signature</span><span class="o">=</span><span class="n">signature</span><span class="p">,</span>
        <span class="n">input_example</span><span class="o">=</span><span class="s2">&quot;A clever and witty question&quot;</span><span class="p">,</span>
    <span class="p">)</span>

<span class="c1"># Load the saved pipeline as pyfunc</span>
<span class="n">chatbot</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">model_uri</span><span class="o">=</span><span class="n">model_info</span><span class="o">.</span><span class="n">model_uri</span><span class="p">)</span>

<span class="c1"># Ask the chatbot a question</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">chatbot</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s2">&quot;What is machine learning?&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

<span class="c1"># &gt;&gt; [It&#39;s a new thing that&#39;s been around for a while.]</span>
</pre></div>
</div>
</div>
<div class="section" id="save-and-load-options-for-transformers">
<h3>Save and Load options for transformers<a class="headerlink" href="#save-and-load-options-for-transformers" title="Permalink to this headline"> </a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">transformers</span></code> flavor for MLflow provides support for saving either components of a model or a pipeline object that contains the customized components in
an easy to use interface that is optimized for inference.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>MLflow by default uses a 500 MB <cite>max_shard_size</cite> to save the model object in <a class="reference internal" href="../../../python_api/mlflow.transformers.html#mlflow.transformers.save_model" title="mlflow.transformers.save_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.transformers.save_model()</span></code></a> or <a class="reference internal" href="../../../python_api/mlflow.transformers.html#mlflow.transformers.log_model" title="mlflow.transformers.log_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.transformers.log_model()</span></code></a> APIs. You can use the environment variable <cite>MLFLOW_HUGGINGFACE_MODEL_MAX_SHARD_SIZE</cite> to override the value.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For component-based logging, the only requirement that must be met in the submitted <code class="docutils literal notranslate"><span class="pre">dict</span></code> is that a model is provided. All other elements of the <code class="docutils literal notranslate"><span class="pre">dict</span></code> are optional.</p>
</div>
<div class="section" id="logging-a-components-based-model">
<h4>Logging a components-based model<a class="headerlink" href="#logging-a-components-based-model" title="Permalink to this headline"> </a></h4>
<p>The example below shows logging components of a <code class="docutils literal notranslate"><span class="pre">transformers</span></code> model via a dictionary mapping of specific named components. The names of the keys within the submitted dictionary
must be in the set: <code class="docutils literal notranslate"><span class="pre">{&quot;model&quot;,</span> <span class="pre">&quot;tokenizer&quot;,</span> <span class="pre">&quot;feature_extractor&quot;,</span> <span class="pre">&quot;image_processor&quot;}</span></code>. Processor type objects (some image processors, audio processors, and multi-modal processors)
must be saved explicitly with the <code class="docutils literal notranslate"><span class="pre">processor</span></code> argument in the <a class="reference internal" href="../../../python_api/mlflow.transformers.html#mlflow.transformers.save_model" title="mlflow.transformers.save_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.transformers.save_model()</span></code></a> or <a class="reference internal" href="../../../python_api/mlflow.transformers.html#mlflow.transformers.log_model" title="mlflow.transformers.log_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.transformers.log_model()</span></code></a> APIs.</p>
<p>After logging, the components are automatically inserted into the appropriate <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> type for the task being performed and are returned, ready for inference.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The components that are logged can be retrieved in their original structure (a dictionary) by setting the attribute <code class="docutils literal notranslate"><span class="pre">return_type</span></code> to ‚Äúcomponents‚Äù in the <code class="docutils literal notranslate"><span class="pre">load_model()</span></code> API.</p>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Not all model types are compatible with the pipeline API constructor via component elements. Incompatible models will raise an
<code class="docutils literal notranslate"><span class="pre">MLflowException</span></code> error stating that the model is missing the <cite>name_or_path</cite> attribute. In
the event that this occurs, please construct the model directly via the <code class="docutils literal notranslate"><span class="pre">transformers.pipeline(&lt;repo</span> <span class="pre">name&gt;)</span></code> API and save the pipeline object directly.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">transformers</span>

<span class="n">task</span> <span class="o">=</span> <span class="s2">&quot;text-classification&quot;</span>
<span class="n">architecture</span> <span class="o">=</span> <span class="s2">&quot;distilbert-base-uncased-finetuned-sst-2-english&quot;</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">transformers</span><span class="o">.</span><span class="n">AutoModelForSequenceClassification</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">architecture</span><span class="p">)</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">transformers</span><span class="o">.</span><span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">architecture</span><span class="p">)</span>

<span class="c1"># Define the components of the model in a dictionary</span>
<span class="n">transformers_model</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span> <span class="s2">&quot;tokenizer&quot;</span><span class="p">:</span> <span class="n">tokenizer</span><span class="p">}</span>

<span class="c1"># Log the model components</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">model_info</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">transformers</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">transformers_model</span><span class="o">=</span><span class="n">transformers_model</span><span class="p">,</span>
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;text_classifier&quot;</span><span class="p">,</span>
        <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
    <span class="p">)</span>

<span class="c1"># Load the components as a pipeline</span>
<span class="n">loaded_pipeline</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">transformers</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span>
    <span class="n">model_info</span><span class="o">.</span><span class="n">model_uri</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s2">&quot;pipeline&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">loaded_pipeline</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
<span class="c1"># &gt;&gt; TextClassificationPipeline</span>

<span class="n">loaded_pipeline</span><span class="p">([</span><span class="s2">&quot;MLflow is awesome!&quot;</span><span class="p">,</span> <span class="s2">&quot;Transformers is a great library!&quot;</span><span class="p">])</span>

<span class="c1"># &gt;&gt; [{&#39;label&#39;: &#39;POSITIVE&#39;, &#39;score&#39;: 0.9998478889465332},</span>
<span class="c1"># &gt;&gt;  {&#39;label&#39;: &#39;POSITIVE&#39;, &#39;score&#39;: 0.9998030066490173}]</span>
</pre></div>
</div>
</div>
<div class="section" id="saving-a-pipeline-and-loading-components">
<h4>Saving a pipeline and loading components<a class="headerlink" href="#saving-a-pipeline-and-loading-components" title="Permalink to this headline"> </a></h4>
<p>Some use cases can benefit from the simplicity of defining a solution as a pipeline, but need the component-level access for performing a micro-services based deployment strategy
where pre / post-processing is performed on containers that do not house the model itself. For this paradigm, a pipeline can be loaded as its constituent parts, as shown below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">transformers</span>
<span class="kn">import</span> <span class="nn">mlflow</span>

<span class="n">translation_pipeline</span> <span class="o">=</span> <span class="n">transformers</span><span class="o">.</span><span class="n">pipeline</span><span class="p">(</span>
    <span class="n">task</span><span class="o">=</span><span class="s2">&quot;translation_en_to_fr&quot;</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="n">transformers</span><span class="o">.</span><span class="n">T5ForConditionalGeneration</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;t5-small&quot;</span><span class="p">),</span>
    <span class="n">tokenizer</span><span class="o">=</span><span class="n">transformers</span><span class="o">.</span><span class="n">T5TokenizerFast</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span>
        <span class="s2">&quot;t5-small&quot;</span><span class="p">,</span> <span class="n">model_max_length</span><span class="o">=</span><span class="mi">100</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">model_info</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">transformers</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">transformers_model</span><span class="o">=</span><span class="n">translation_pipeline</span><span class="p">,</span>
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;french_translator&quot;</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">translation_components</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">transformers</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span>
    <span class="n">model_info</span><span class="o">.</span><span class="n">model_uri</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s2">&quot;components&quot;</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">translation_components</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># &gt;&gt; task -&gt; str</span>
<span class="c1"># &gt;&gt; model -&gt; T5ForConditionalGeneration</span>
<span class="c1"># &gt;&gt; tokenizer -&gt; T5TokenizerFast</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">translation_pipeline</span><span class="p">(</span><span class="s2">&quot;MLflow is great!&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

<span class="c1"># &gt;&gt; [{&#39;translation_text&#39;: &#39;MLflow est formidable!&#39;}]</span>

<span class="n">reconstructed_pipeline</span> <span class="o">=</span> <span class="n">transformers</span><span class="o">.</span><span class="n">pipeline</span><span class="p">(</span><span class="o">**</span><span class="n">translation_components</span><span class="p">)</span>

<span class="n">reconstructed_response</span> <span class="o">=</span> <span class="n">reconstructed_pipeline</span><span class="p">(</span>
    <span class="s2">&quot;transformers makes using Deep Learning models easy and fun!&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">reconstructed_response</span><span class="p">)</span>

<span class="c1"># &gt;&gt; [{&#39;translation_text&#39;: &quot;Les transformateurs rendent l&#39;utilisation de mod√®les Deep Learning facile et amusante!&quot;}]</span>
</pre></div>
</div>
</div>
<div class="section" id="automatic-metadata-and-modelcard-logging">
<h4>Automatic Metadata and ModelCard logging<a class="headerlink" href="#automatic-metadata-and-modelcard-logging" title="Permalink to this headline"> </a></h4>
<p>In order to provide as much information as possible for saved models, the <code class="docutils literal notranslate"><span class="pre">transformers</span></code> flavor will automatically fetch the <code class="docutils literal notranslate"><span class="pre">ModelCard</span></code> for any model or pipeline that
is saved that has a stored card on the HuggingFace hub. This card will be logged as part of the model artifact, viewable at the same directory level as the <code class="docutils literal notranslate"><span class="pre">MLmodel</span></code> file and
the stored model object.</p>
<p>In addition to the <code class="docutils literal notranslate"><span class="pre">ModelCard</span></code>, the components that comprise any Pipeline (or the individual components if saving a dictionary of named components) will have their source types
stored. The model type, pipeline type, task, and classes of any supplementary component (such as a <code class="docutils literal notranslate"><span class="pre">Tokenizer</span></code> or <code class="docutils literal notranslate"><span class="pre">ImageProcessor</span></code>) will be stored in the <code class="docutils literal notranslate"><span class="pre">MLmodel</span></code> file as well.</p>
</div>
<div class="section" id="automatic-signature-inference">
<h4>Automatic Signature inference<a class="headerlink" href="#automatic-signature-inference" title="Permalink to this headline"> </a></h4>
<p>For pipelines that support <code class="docutils literal notranslate"><span class="pre">pyfunc</span></code>, there are 3 means of attaching a model signature to the <code class="docutils literal notranslate"><span class="pre">MLmodel</span></code> file.</p>
<ul class="simple">
<li><p>Provide a model signature explicitly via setting a valid <code class="docutils literal notranslate"><span class="pre">ModelSignature</span></code> to the <code class="docutils literal notranslate"><span class="pre">signature</span></code> attribute. This can be generated via the helper utility <a class="reference internal" href="../../../python_api/mlflow.transformers.html#mlflow.transformers.generate_signature_output" title="mlflow.transformers.generate_signature_output"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.transformers.generate_signature_output()</span></code></a></p></li>
<li><p>Provide an <code class="docutils literal notranslate"><span class="pre">input_example</span></code>. The signature will be inferred and validated that it matches the appropriate input type. The output type will be validated by performing inference automatically (if the model is a <code class="docutils literal notranslate"><span class="pre">pyfunc</span></code> supported type).</p></li>
<li><p>Do nothing. The <code class="docutils literal notranslate"><span class="pre">transformers</span></code> flavor will automatically apply the appropriate general signature that the pipeline type supports (only for a single-entity; collections will not be inferred).</p></li>
</ul>
</div>
<div class="section" id="scalability-for-inference">
<h4>Scalability for inference<a class="headerlink" href="#scalability-for-inference" title="Permalink to this headline"> </a></h4>
<p>A common configuration for lowering the total memory pressure for pytorch models within <code class="docutils literal notranslate"><span class="pre">transformers</span></code> pipelines is to modify the
processing data type. This is achieved through setting the <code class="docutils literal notranslate"><span class="pre">torch_dtype</span></code> argument when creating a <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code>.
For a full reference of these tunable arguments for configuration of pipelines, see the <a class="reference external" href="https://huggingface.co/docs/transformers/v4.28.1/en/perf_train_gpu_one#floating-data-types">training docs</a> .</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This feature does not exist in versions of <code class="docutils literal notranslate"><span class="pre">transformers</span></code> &lt; 4.26.x</p>
</div>
<p>In order to apply these configurations to a saved or logged run, there are two options:</p>
<ul class="simple">
<li><p>Save a pipeline with the <cite>torch_dtype</cite> argument set to the encoding type of your choice.</p></li>
</ul>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">transformers</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">mlflow</span>

<span class="n">task</span> <span class="o">=</span> <span class="s2">&quot;translation_en_to_fr&quot;</span>

<span class="n">my_pipeline</span> <span class="o">=</span> <span class="n">transformers</span><span class="o">.</span><span class="n">pipeline</span><span class="p">(</span>
    <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="n">transformers</span><span class="o">.</span><span class="n">T5ForConditionalGeneration</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;t5-small&quot;</span><span class="p">),</span>
    <span class="n">tokenizer</span><span class="o">=</span><span class="n">transformers</span><span class="o">.</span><span class="n">T5TokenizerFast</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span>
        <span class="s2">&quot;t5-small&quot;</span><span class="p">,</span> <span class="n">model_max_length</span><span class="o">=</span><span class="mi">100</span>
    <span class="p">),</span>
    <span class="n">framework</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">,</span>
    <span class="n">torch_dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">bfloat16</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">model_info</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">transformers</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">transformers_model</span><span class="o">=</span><span class="n">my_pipeline</span><span class="p">,</span>
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;my_pipeline&quot;</span><span class="p">,</span>
    <span class="p">)</span>

<span class="c1"># Illustrate that the torch data type is recorded in the flavor configuration</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model_info</span><span class="o">.</span><span class="n">flavors</span><span class="p">[</span><span class="s2">&quot;transformers&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>Result:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">{</span><span class="s1">&#39;transformers_version&#39;</span>:<span class="w"> </span><span class="s1">&#39;4.28.1&#39;</span>,
<span class="w"> </span><span class="s1">&#39;code&#39;</span>:<span class="w"> </span>None,
<span class="w"> </span><span class="s1">&#39;task&#39;</span>:<span class="w"> </span><span class="s1">&#39;translation_en_to_fr&#39;</span>,
<span class="w"> </span><span class="s1">&#39;instance_type&#39;</span>:<span class="w"> </span><span class="s1">&#39;TranslationPipeline&#39;</span>,
<span class="w"> </span><span class="s1">&#39;source_model_name&#39;</span>:<span class="w"> </span><span class="s1">&#39;t5-small&#39;</span>,
<span class="w"> </span><span class="s1">&#39;pipeline_model_type&#39;</span>:<span class="w"> </span><span class="s1">&#39;T5ForConditionalGeneration&#39;</span>,
<span class="w"> </span><span class="s1">&#39;framework&#39;</span>:<span class="w"> </span><span class="s1">&#39;pt&#39;</span>,
<span class="w"> </span><span class="s1">&#39;torch_dtype&#39;</span>:<span class="w"> </span><span class="s1">&#39;torch.bfloat16&#39;</span>,
<span class="w"> </span><span class="s1">&#39;tokenizer_type&#39;</span>:<span class="w"> </span><span class="s1">&#39;T5TokenizerFast&#39;</span>,
<span class="w"> </span><span class="s1">&#39;components&#39;</span>:<span class="w"> </span><span class="o">[</span><span class="s1">&#39;tokenizer&#39;</span><span class="o">]</span>,
<span class="w"> </span><span class="s1">&#39;pipeline&#39;</span>:<span class="w"> </span><span class="s1">&#39;pipeline&#39;</span><span class="o">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Specify the <cite>torch_dtype</cite> argument when loading the model to override any values set during logging or saving.</p></li>
</ul>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">transformers</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">mlflow</span>

<span class="n">task</span> <span class="o">=</span> <span class="s2">&quot;translation_en_to_fr&quot;</span>

<span class="n">my_pipeline</span> <span class="o">=</span> <span class="n">transformers</span><span class="o">.</span><span class="n">pipeline</span><span class="p">(</span>
    <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="n">transformers</span><span class="o">.</span><span class="n">T5ForConditionalGeneration</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;t5-small&quot;</span><span class="p">),</span>
    <span class="n">tokenizer</span><span class="o">=</span><span class="n">transformers</span><span class="o">.</span><span class="n">T5TokenizerFast</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span>
        <span class="s2">&quot;t5-small&quot;</span><span class="p">,</span> <span class="n">model_max_length</span><span class="o">=</span><span class="mi">100</span>
    <span class="p">),</span>
    <span class="n">framework</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">,</span>
    <span class="n">torch_dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">bfloat16</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">model_info</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">transformers</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">transformers_model</span><span class="o">=</span><span class="n">my_pipeline</span><span class="p">,</span>
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;my_pipeline&quot;</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">loaded_pipeline</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">transformers</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span>
    <span class="n">model_info</span><span class="o">.</span><span class="n">model_uri</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s2">&quot;pipeline&quot;</span><span class="p">,</span> <span class="n">torch_dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float64</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">loaded_pipeline</span><span class="o">.</span><span class="n">torch_dtype</span><span class="p">)</span>
</pre></div>
</div>
<p>Result:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>torch.float64
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Logging or saving a model in ‚Äòcomponents‚Äô mode (using a dictionary to declare components) does not support setting the data type for a constructed pipeline.
If you need to override the default behavior of how data is encoded, please save or log a <cite>pipeline</cite> object.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Overriding the data type for a pipeline when loading as a <a class="reference internal" href="../../../models.html#pyfunc-model-flavor"><span class="std std-ref">python_function (pyfunc) model flavor</span></a> is not supported.
The value set for <code class="docutils literal notranslate"><span class="pre">torch_dtype</span></code> during <code class="docutils literal notranslate"><span class="pre">save_model()</span></code> or <code class="docutils literal notranslate"><span class="pre">log_model()</span></code> will persist when loading as <cite>pyfunc</cite>.</p>
</div>
</div>
<div class="section" id="input-data-types-for-audio-pipelines">
<h4>Input data types for audio pipelines<a class="headerlink" href="#input-data-types-for-audio-pipelines" title="Permalink to this headline"> </a></h4>
<p>Note that passing raw data to an audio pipeline (raw bytes) requires two separate elements of the same effective library.
In order to use the bitrate transposition and conversion of the audio bytes data into numpy nd.array format, the library <cite>ffmpeg</cite> is required.
Installing this package directly from pypi (<cite>pip install ffmpeg</cite>) does not install the underlying <cite>c</cite> dll‚Äôs that are required to make <cite>ffmpeg</cite> function.
Please consult with the documentation at <a class="reference external" href="https://ffmpeg.org/download.html">the ffmpeg website</a> for guidance on your given operating system.</p>
<p>The Audio Pipeline types, when loaded as a <a class="reference internal" href="../../../models.html#pyfunc-model-flavor"><span class="std std-ref">python_function (pyfunc) model flavor</span></a> have three input types available:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">str</span></code></p></li>
</ul>
<p>The string input type is meant for blob references (uri locations) that are accessible to the instance of the <code class="docutils literal notranslate"><span class="pre">pyfunc</span></code> model.
This input mode is useful when doing large batch processing of audio inference in Spark due to the inherent limitations of handling large <code class="docutils literal notranslate"><span class="pre">bytes</span></code>
data in <code class="docutils literal notranslate"><span class="pre">Spark</span></code> <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>. Ensure that you have <code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code> installed in the environment that the <code class="docutils literal notranslate"><span class="pre">pyfunc</span></code> model is running in order
to use <code class="docutils literal notranslate"><span class="pre">str</span></code> input uri-based inference. If this package is not properly installed (both from <code class="docutils literal notranslate"><span class="pre">pypi</span></code> and from the <code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code> binaries), an Exception
will be thrown at inference time.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If using a uri (<cite>str</cite>) as an input type for a <cite>pyfunc</cite> model that you are intending to host for realtime inference through the <cite>MLflow Model Server</cite>,
you <em>must</em> specify a custom model signature when logging or saving the model.
The default signature input value type of <code class="docutils literal notranslate"><span class="pre">bytes</span></code> will, in <cite>MLflow Model serving</cite>, force the conversion of the uri string to <code class="docutils literal notranslate"><span class="pre">bytes</span></code>, which will cause an Exception
to be thrown from the serving process stating that the soundfile is corrupt.</p>
</div>
<p>An example of specifying an appropriate uri-based input model signature for an audio model is shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mlflow.models</span> <span class="kn">import</span> <span class="n">infer_signature</span>
<span class="kn">from</span> <span class="nn">mlflow.transformers</span> <span class="kn">import</span> <span class="n">generate_signature_output</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://www.mywebsite.com/sound/files/for/transcription/file111.mp3&quot;</span>
<span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">generate_signature_output</span><span class="p">(</span><span class="n">my_audio_pipeline</span><span class="p">,</span> <span class="n">url</span><span class="p">))</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">transformers</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">transformers_model</span><span class="o">=</span><span class="n">my_audio_pipeline</span><span class="p">,</span>
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;my_transcriber&quot;</span><span class="p">,</span>
        <span class="n">signature</span><span class="o">=</span><span class="n">signature</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bytes</span></code></p></li>
</ul>
<p>This is the default serialization format of audio files. It is the easiest format to utilize due to the fact that
Pipeline implementations will automatically convert the audio bitrate from the file with the use of <code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code> (a required dependency if using this format) to the bitrate required by the underlying model within the <cite>Pipeline</cite>.
When using the <code class="docutils literal notranslate"><span class="pre">pyfunc</span></code> representation of the pipeline directly (not through serving), the sound file can be passed directly as <code class="docutils literal notranslate"><span class="pre">bytes</span></code> without any
modification. When used through serving, the <code class="docutils literal notranslate"><span class="pre">bytes</span></code> data <em>must be</em> base64 encoded.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">np.ndarray</span></code></p></li>
</ul>
<p>This input format requires that both the bitrate has been set prior to conversion to <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> (i.e., through the use of a package like
<code class="docutils literal notranslate"><span class="pre">librosa</span></code> or <code class="docutils literal notranslate"><span class="pre">pydub</span></code>) and that the model has been saved with a signature that uses the <code class="docutils literal notranslate"><span class="pre">np.ndarray</span></code> format for the input.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Audio models being used for serving that intend to utilize pre-formatted audio in <code class="docutils literal notranslate"><span class="pre">np.ndarray</span></code> format
must have the model saved with a signature configuration that reflects this schema. Failure to do so will result in type casting errors due to the default signature for
audio transformers pipelines being set as expecting <code class="docutils literal notranslate"><span class="pre">binary</span></code> (<code class="docutils literal notranslate"><span class="pre">bytes</span></code>) data. The serving endpoint cannot accept a union of types, so a particular model instance must choose one
or the other as an allowed input type.</p>
</div>
</div>
</div>
</div>
</div>


              </div>
            </div>
            <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../tutorials/prompt-templating/prompt-templating.html" class="btn btn-neutral" title="Prompt Templating with MLflow and Transformers" accesskey="p"><span class="db-icon db-icon-chevron-left"></span> Previous</a>
      
      
        <a href="../../openai/index.html" class="btn btn-neutral" title="MLflow OpenAI Flavor" accesskey="n">Next <span class="db-icon db-icon-chevron-right"></span></a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
      <p class="copyright">
          &copy; MLflow Project, a Series of LF Projects, LLC. All rights reserved.
      </p>

  </div> 

</footer>
          </div>
        </div>
      </section>
    </main>
  </page>

  


  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT:'../../../',
      VERSION:'2.9.3.dev0',
      COLLAPSE_INDEX:false,
      FILE_SUFFIX:'.html',
      LINK_SUFFIX: '.html',
      HAS_SOURCE:  true
    };
  </script>

  

  <script type="text/javascript" src="../../../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../../../_static/js/jquery.waypoints.min.js"></script>

  
  
  
  <script type="text/javascript">var CLIPPY_SVG_PATH = "../../../_static/clippy.svg";</script>
  <script type="text/javascript" src="../../../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  

  
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
        }
        // Get the code block designator class entries
        const allHighlights = document.querySelectorAll('.highlight');
        // Disable copyable links for notebook cell numbering and for cell outputs
        const highlights = Array.from(allHighlights).filter(highlight => !highlight.closest('.highlight-none') && 
            !highlight.closest('.nboutput'));
    
        highlights.forEach(function(highlight) {
            const copyIcon = document.createElement('span');
            copyIcon.classList.add('copy-icon');
            copyIcon.innerHTML = '&#xf0ea;';

            copyIcon.addEventListener('click', function() {
                const code = highlight.querySelector('pre').textContent;
                copyToClipboard(code);

                // Flash effect on click
                this.style.color = '#0194E2';
                setTimeout(() => {
                    this.style.color = ''; 
                }, 100);

                // Display "Code copied to clipboard" near the clicked icon
                const message = document.createElement('span');
                message.textContent = "Copied!";
                message.classList.add('copy-message'); 

                // Append the message to the icon
                this.appendChild(message);

                setTimeout(() => {
                    this.removeChild(message);
                }, 500);
            });

            highlight.appendChild(copyIcon);
        });
    });
  </script>


<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
        // Force download for notebook-download-btn
        const downloadButtons = document.querySelectorAll('.notebook-download-btn');
        downloadButtons.forEach(function(button) {
            button.addEventListener('click', function(event) {
                event.preventDefault(); // Prevent default behavior

                // Fetch the raw content of the notebook from GitHub
                fetch(button.href)
                    .then(response => response.blob())
                    .then(blob => {
                        const url = window.URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.style.display = 'none';
                        link.href = url;
                        const filename = button.href.split('/').pop();
                        link.download = filename; 

                        document.body.appendChild(link);
                        link.click();

                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(link);
                    })
                    .catch(err => console.error('Error fetching the notebook:', err));
            });
        });
    });
</script> 
</body>
</html>