

<!DOCTYPE html>
<!-- source: docs/source/llms/dspy/index.rst -->
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>MLflow DSPy Flavor</title>
  
   
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="canonical" href="https://mlflow.org/docs/latest/llms/dspy/index.html">
  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    

    

  
    
        <!-- Google Tag Manager -->
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer',"GTM-N6WMTTJ");</script>
        <!-- End Google Tag Manager -->
    

  

  
  
    

  

  
  
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600" rel="stylesheet">
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/cards.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/grids.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/mobile.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/simple-cards.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/tabs.css" type="text/css" />
    
  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="MLflow 2.17.3.dev0 documentation" href="../../index.html"/>
        <link rel="up" title="LLMs" href="../index.html"/>
        <link rel="next" title="How does it work?" href="/notebooks/dspy_quickstart.html"/>
        <link rel="prev" title="Introduction to Using LlamaIndex with MLflow" href="/../llama-index/notebooks/llama_index_quickstart.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>
<script type="text/javascript" src="../../_static/jquery.js"></script>
<script type="text/javascript" src="../../_static/underscore.js"></script>
<script type="text/javascript" src="../../_static/doctools.js"></script>
<script type="text/javascript" src="../../_static/languagesections.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
<script type="text/javascript" src="../../_static/runllm.js"></script>

<body class="wy-body-for-nav" role="document">
  
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N6WMTTJ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
  

  
  <nav class="wy-nav-top header" role="navigation" aria-label="top navigation">
    <ul>
  <li class="menu-toggle">
    <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
    <a href="../../index.html" class="wy-nav-top-logo"
      ><img src="../../_static/MLflow-logo-final-black.png" alt="MLflow"
    /></a>
    <span class="version">2.17.3.dev0</span>
  </li>
</ul>
  </nav>
  <page>
    

    <nav data-toggle="wy-nav-shift" class="wy-nav-side relative">
      <div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
  </form>
</div>


    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../../index.html" class="main-navigation-home"><img src="../../_static/icons/nav-home.svg"> MLflow</a>
    

    
      

      
        <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">MLflow Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/index.html">Getting Started with MLflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../new-features/index.html">New Features</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">LLMs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#tutorials-and-use-case-guides-for-genai-applications-in-mlflow">Tutorials and Use Case Guides for GenAI applications in MLflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#id1">MLflow Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#id2">MLflow AI Gateway for LLMs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#id3">LLM Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#id4">Prompt Engineering UI</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#native-mlflow-flavors-for-llms">Native MLflow Flavors for LLMs</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../transformers/index.html">MLflow Transformers Flavor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../openai/index.html">MLflow OpenAI Flavor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sentence-transformers/index.html">MLflow Sentence-Transformers Flavor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../langchain/index.html">MLflow LangChain Flavor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../llama-index/index.html">MLflow LlamaIndex Flavor</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">MLflow DSPy Flavor</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#why-use-dspy-with-mlflow">Why use DSPy with MLflow?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getting-started">Getting Started</a></li>
<li class="toctree-l4"><a class="reference internal" href="#concepts">Concepts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#faq">FAQ</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#explore-the-native-llm-flavors">Explore the Native LLM Flavors</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#id5">LLM Tracking in MLflow</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tracing/index.html">MLflow Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../model-evaluation/index.html">Model Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deep-learning/index.html">Deep Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../traditional-ml/index.html">Traditional ML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deployment/index.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tracking.html">MLflow Tracking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../system-metrics/index.html">System Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../projects.html">MLflow Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../models.html">MLflow Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../model-registry.html">MLflow Model Registry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../recipes.html">MLflow Recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins.html">MLflow Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../auth/index.html">MLflow Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli.html">Command-Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../search-runs.html">Search Runs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../search-experiments.html">Search Experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python_api/index.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../R-api.html">R API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../java_api/index.html">Java API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rest-api.html">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docker.html">Official MLflow Docker Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community-model-flavors.html">Community Model Flavors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials-and-examples/index.html">Tutorials and Examples</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    

    <p>
      <a id='feedbacklink' href="https://github.com/mlflow/mlflow/blob/master/CONTRIBUTING.md" target="_blank">Contribute</a>
    </p>
  </div>
</div>
    </nav>

    <main class="wy-grid-for-nav">
      <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
        <div class="wy-nav-content">
          <div class="rst-content">
            










<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
        <li><a href="../index.html">LLMs</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>MLflow DSPy Flavor</li>
    
    
    <!-- <li class="wy-breadcrumbs-aside">
      <a href="https://github.com/mlflow/mlflow/blob/master/docs/source/llms/dspy/index.rst" class="fa fa-github"> Edit on GitHub</a>
    </li> -->
    
  </ul>
</div>
            <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
              <div itemprop="articleBody">
                
  <div class="section" id="mlflow-dspy-flavor">
<h1>MLflow DSPy Flavor<a class="headerlink" href="#mlflow-dspy-flavor" title="Permalink to this headline"> </a></h1>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>The <code class="docutils literal notranslate"><span class="pre">dspy</span></code> flavor is under active development and is marked as Experimental. Public APIs are
subject to change and new features may be added as the flavor evolves.</p>
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline"> </a></h2>
<p><a class="reference external" href="https://dspy-docs.vercel.app/">DSPy</a> is a framework for algorithmically optimizing LM prompts and weights. It’s designed to
improve the process of prompt engineering by replacing hand-crafted prompt strings with modular
components. These modules are concise, well-defined, and maintain high quality and expressive power,
making prompt creation more efficient and scalable. By parameterizing these modules and treating
prompting as an optimization problem, DSPy can adapt better to different language models,
potentially outperforming prompts crafted by experts. This modularity also enables easier
exploration of complex pipelines, allowing for fine-tuning performance based on specific tasks or
nuanced metrics.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/dspy-integration-architecture.png"><img alt="Overview of DSPy and MLflow integration" src="../../_images/dspy-integration-architecture.png" style="width: 70%;" /></a>
</div>
</div>
<div class="section" id="why-use-dspy-with-mlflow">
<h2>Why use DSPy with MLflow?<a class="headerlink" href="#why-use-dspy-with-mlflow" title="Permalink to this headline"> </a></h2>
<p>The native integration of the DSPy library with MLflow helps users manage the development lifecycle with DSPy. The following are some of the key benefits of using DSPy with MLflow:</p>
<ul class="simple">
<li><p><a class="reference external" href="../../tracking.html">MLflow Tracking</a> allows you to track your DSPy program’s training and execution. With the MLflow APIs, you can log a variety of artifacts and organize training runs, thereby increasing visibility into your model performance.</p></li>
<li><p><a class="reference external" href="../../models.html">MLflow Model</a> packages your compiled DSPy program along with its dependency versions, input and output interfaces and other essential metadata. This allows you to deploy your compiled DSPy program with ease, knowing that the environment is consistent across different stages of the ML lifecycle.</p></li>
<li><p><a class="reference external" href="../llm-evaluate/index.html">MLflow Evaluate</a> provides native capabilities within MLflow to evaluate GenAI applications. This capability facilitates the efficient assessment of inference results from your DSPy compiled program, ensuring robust performance analytics and facilitating quick iterations.</p></li>
</ul>
</div>
<div class="section" id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline"> </a></h2>
<p>In this introductory tutorial, you will learn the most fundamental components of DSPy and how to leverage the integration with MLflow to store, retrieve, and
use a DSPy program.</p>
<section>
    <article class="simple-grid">
        <div class="simple-card">
            <a href="notebooks/dspy_quickstart.html">
                <div class="header">
                    DSPy Quickstart
                </div>
                <p>
                    Get started with MLflow and DSPy by exploring the simplest possible configuration of a DSPy program.
                </p>
            </a>
        </div>
    </article>
</section><div class="toctree-wrapper compound">
</div>
</div>
<div class="section" id="concepts">
<h2>Concepts<a class="headerlink" href="#concepts" title="Permalink to this headline"> </a></h2>
<div class="section" id="module">
<h3><code class="docutils literal notranslate"><span class="pre">Module</span></code><a class="headerlink" href="#module" title="Permalink to this headline"> </a></h3>
<p><a class="reference external" href="https://dspy-docs.vercel.app/docs/building-blocks/modules">Modules</a> are components that handle specific text transformations, like answering questions or summarizing. They replace traditional hand-written prompts and can learn from examples, making them more adaptable.</p>
</div>
<div class="section" id="signature">
<h3><code class="docutils literal notranslate"><span class="pre">Signature</span></code><a class="headerlink" href="#signature" title="Permalink to this headline"> </a></h3>
<p>A <a class="reference external" href="https://dspy-docs.vercel.app/docs/building-blocks/signatures">signature</a> is a natural language description of a module’s input and output behavior. For example, <cite>“question -&gt; answer”</cite> specifies that the module should take a question as input and return an answer.</p>
</div>
<div class="section" id="optimizer">
<h3><code class="docutils literal notranslate"><span class="pre">Optimizer</span></code><a class="headerlink" href="#optimizer" title="Permalink to this headline"> </a></h3>
<p>A <a class="reference external" href="https://dspy-docs.vercel.app/docs/building-blocks/optimizers">optimizer</a> improves LM pipelines by adjusting modules to meet a performance metric, either by generating better prompts or fine-tuning models.</p>
</div>
<div class="section" id="program">
<h3><code class="docutils literal notranslate"><span class="pre">Program</span></code><a class="headerlink" href="#program" title="Permalink to this headline"> </a></h3>
<p>A program is a a set of modules connected into a pipeline to perform complex tasks. DSPy programs are flexible, allowing you to optimize and adapt them using the compiler.</p>
</div>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline"> </a></h2>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="saving-and-loading-dspy-program-in-mlflow-experiment">
<h3>Saving and Loading DSPy Program in MLflow Experiment<a class="headerlink" href="#saving-and-loading-dspy-program-in-mlflow-experiment" title="Permalink to this headline"> </a></h3>
<div class="section" id="creating-a-dspy-program">
<h4>Creating a DSPy Program<a class="headerlink" href="#creating-a-dspy-program" title="Permalink to this headline"> </a></h4>
<p>The <a class="reference external" href="https://dspy-docs.vercel.app/docs/building-blocks/modules">Module</a> object is the centerpiece of
the DSPy and MLflow integration. With DSPy, you can create complex agentic logic via a module or
set of modules.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>mlflow<span class="w"> </span>dspy<span class="w"> </span>-U
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dspy</span>

<span class="c1"># Define our language model</span>
<span class="n">lm</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">LM</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;openai/gpt-4o-mini&quot;</span><span class="p">,</span> <span class="n">max_tokens</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
<span class="n">dspy</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">lm</span><span class="o">=</span><span class="n">lm</span><span class="p">)</span>


<span class="c1"># Define a Chain of Thought module</span>
<span class="k">class</span> <span class="nc">CoT</span><span class="p">(</span><span class="n">dspy</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prog</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">ChainOfThought</span><span class="p">(</span><span class="s2">&quot;question -&gt; answer&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">question</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prog</span><span class="p">(</span><span class="n">question</span><span class="o">=</span><span class="n">question</span><span class="p">)</span>


<span class="n">dspy_model</span> <span class="o">=</span> <span class="n">CoT</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Typically you’d want to leverage a
<a class="reference external" href="https://dspy-docs.vercel.app/docs/building-blocks/optimizers#what-does-a-dspy-optimizer-tune-how-does-it-tune-them">compiled DSPy</a>
module. MLflow will natively supports logging both compiled and uncompiled DSPy modules. Above
we show an uncompiled version for simplicity, but in production you’d want to leverage an
<a class="reference external" href="https://dspy-docs.vercel.app/docs/building-blocks/optimizers">optimizer</a> and log the
outputted object instead.</p>
</div>
</div>
<div class="section" id="logging-the-program-to-mlflow">
<h4>Logging the Program to MLflow<a class="headerlink" href="#logging-the-program-to-mlflow" title="Permalink to this headline"> </a></h4>
<p>You can log the <code class="docutils literal notranslate"><span class="pre">dspy.Module</span></code> object to an MLflow run using the
<a class="reference internal" href="../../python_api/mlflow.dspy.html#mlflow.dspy.log_model" title="mlflow.dspy.log_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.dspy.log_model()</span></code></a> function.</p>
<p>We will also specify a <a class="reference external" href="https://mlflow.org/docs/latest/model/signatures.html#input-example">model signature</a>.
An MLflow model signature defines the expected schema for model inputs and outputs, ensuring
consistency and correctness during model inference.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>

<span class="c1"># Start an MLflow run</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="c1"># Log the model</span>
    <span class="n">model_info</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">dspy</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">dspy_model</span><span class="p">,</span>
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">,</span>
        <span class="n">input_example</span><span class="o">=</span><span class="s2">&quot;what is 2 + 2?&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/dspy-artifacts.png"><img alt="MLflow artifacts for the DSPy program" src="../../_images/dspy-artifacts.png" style="width: 80%;" /></a>
</div>
</div>
<div class="section" id="loading-the-module-for-inference">
<h4>Loading the Module for inference<a class="headerlink" href="#loading-the-module-for-inference" title="Permalink to this headline"> </a></h4>
<p>The saved module can be loaded back for inference using the <a class="reference internal" href="../../python_api/mlflow.pyfunc.html#mlflow.pyfunc.load_model" title="mlflow.pyfunc.load_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.pyfunc.load_model()</span></code></a> function. This function
gives an MLflow Python Model backed by the DSPy module.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>

<span class="c1"># Load the model as an MLflow PythonModel</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">model_info</span><span class="o">.</span><span class="n">model_uri</span><span class="p">)</span>

<span class="c1"># Predict with the object</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s2">&quot;What kind of bear is best?&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</pre></div>
</div>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Output</span><a class="headerlink" href="#id5" title="Permalink to this code"> </a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;reasoning&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;The question &quot;What kind of bear is best?&quot; is often associated with a</span>
<span class="s1">    humorous reference from the television show &quot;The Office,&quot; where the character Jim</span>
<span class="s1">    Halpert jokingly states, &quot;Bears, beets, Battlestar Galactica.&quot; However, if we consider</span>
<span class="s1">    the question seriously, it depends on the context. Different species of bears have</span>
<span class="s1">    different characteristics and adaptations that make them &quot;best&quot; in various ways.</span>
<span class="s1">    For example, the American black bear is known for its adaptability, while the polar bear is</span>
<span class="s1">    the largest land carnivore and is well adapted to its Arctic environment. Ultimately, the</span>
<span class="s1">    answer can vary based on personal preference or specific criteria such as strength,</span>
<span class="s1">    intelligence, or adaptability.&#39;&#39;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;answer&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;There isn</span><span class="se">\&#39;</span><span class="s1">t a definitive answer, as it depends on the context. However, many</span>
<span class="s1">    people humorously refer to the American black bear or the polar bear when discussing</span>
<span class="s1">    &quot;the best&quot; kind of bear.&#39;&#39;&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>To load the DSPy program itself back instead of the PyFunc-wrapped model, use the <a class="reference internal" href="../../python_api/mlflow.dspy.html#mlflow.dspy.load_model" title="mlflow.dspy.load_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.dspy.load_model()</span></code></a> function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">dspy</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">model_uri</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="faq">
<h2>FAQ<a class="headerlink" href="#faq" title="Permalink to this headline"> </a></h2>
<div class="section" id="how-can-i-save-a-compiled-vs-uncompiled-model">
<h3>How can I save a compiled vs. uncompiled model?<a class="headerlink" href="#how-can-i-save-a-compiled-vs-uncompiled-model" title="Permalink to this headline"> </a></h3>
<p>DSPy compiles models by updating various LLM parameters, such as prompts, hyperparameters, and
model weights, to optimize training. While MLflow allows logging both compiled and uncompiled
models, it’s generally preferable to use a compiled model, as it is expected to perform better in
practice.</p>
</div>
<div class="section" id="what-can-be-serialized-by-mlflow">
<h3>What can be serialized by MLflow?<a class="headerlink" href="#what-can-be-serialized-by-mlflow" title="Permalink to this headline"> </a></h3>
<p>When using <a class="reference internal" href="../../python_api/mlflow.dspy.html#mlflow.dspy.log_model" title="mlflow.dspy.log_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.dspy.log_model()</span></code></a> or <a class="reference internal" href="../../python_api/mlflow.dspy.html#mlflow.dspy.save_model" title="mlflow.dspy.save_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.dspy.save_model()</span></code></a> in MLflow, the
DSPy program is serialized and saved to the tracking server as a <code class="docutils literal notranslate"><span class="pre">.pkl</span></code> file. This enables easy
deployment. Under the hood, MLflow uses <code class="docutils literal notranslate"><span class="pre">cloudpickle</span></code> to serialize the DSPy object, but some
DSPy artifacts are note serializable. Relevant examples are listed below.</p>
<ul class="simple">
<li><p>API tokens. These should be managed separately and passed securely via environment variables.</p></li>
<li><p>The DSPy trace object, which is primarily used during training, not inference.</p></li>
</ul>
</div>
<div class="section" id="how-do-i-manage-secrets">
<h3>How do I manage secrets?<a class="headerlink" href="#how-do-i-manage-secrets" title="Permalink to this headline"> </a></h3>
<p>When serializing using the MLflow DSPy flavor, tokens are dropped from the settings objects. It is
the user’s responsibility to securely pass the required secrets to the deployment environment.</p>
</div>
<div class="section" id="how-is-the-dspy-settings-object-saved">
<h3>How is the DSPy <code class="docutils literal notranslate"><span class="pre">settings</span></code> object saved?<a class="headerlink" href="#how-is-the-dspy-settings-object-saved" title="Permalink to this headline"> </a></h3>
<p>To ensure program reproducibility, the service context is converted to a Python dictionary and
pickled with the model artifact. Service context is a concept that has been popularized in GenAI
frameworks. Put simply, it stores a configuration that is global to your project. For DSPy
specifically, we can set information such as the language model, reranker, adapter, etc.</p>
<p>DSPy stores this service context in a <code class="docutils literal notranslate"><span class="pre">Settings</span></code> singleton class. Sensitive API access keys that
are set within the <code class="docutils literal notranslate"><span class="pre">Settings</span></code> object are not persisted when logging your model. When deploying
your DSPy model, you must ensure that the deployment environment has these keys set so that your
DSPy model can make remote calls to services that require access keys.</p>
</div>
</div>
</div>


              </div>
            </div>
            <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../llama-index/notebooks/llama_index_quickstart.html" class="btn btn-neutral" title="Introduction to Using LlamaIndex with MLflow" accesskey="p"><span class="db-icon db-icon-chevron-left"></span> Previous</a>
      
      
        <a href="notebooks/dspy_quickstart.html" class="btn btn-neutral" title="How does it work?" accesskey="n">Next <span class="db-icon db-icon-chevron-right"></span></a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
      <p class="copyright">
          &copy; MLflow Project, a Series of LF Projects, LLC. All rights reserved.
      </p>

  </div> 

</footer>
          </div>
        </div>
      </section>
    </main>
  </page>

  


  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT:'../../',
      VERSION:'2.17.3.dev0',
      COLLAPSE_INDEX:false,
      FILE_SUFFIX:'.html',
      LINK_SUFFIX: '.html',
      HAS_SOURCE:  true
    };
  </script>

  

  <script type="text/javascript" src="../../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../../_static/js/jquery.waypoints.min.js"></script>

  
  
  
  <script type="text/javascript">var CLIPPY_SVG_PATH = "../../_static/clippy.svg";</script>
  <script type="text/javascript" src="../../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  

  
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
        }
        // Get the code block designator class entries
        const allHighlights = document.querySelectorAll('.highlight');
        // Disable copyable links for notebook cell numbering and for cell outputs
        const highlights = Array.from(allHighlights).filter(highlight => !highlight.closest('.highlight-none') && 
            !highlight.closest('.nboutput'));
    
        highlights.forEach(function(highlight) {
            const copyIcon = document.createElement('span');
            copyIcon.classList.add('copy-icon');
            copyIcon.innerHTML = '&#xf0ea;';

            copyIcon.addEventListener('click', function() {
                const code = highlight.querySelector('pre').textContent;
                copyToClipboard(code);

                // Flash effect on click
                this.style.color = '#0194E2';
                setTimeout(() => {
                    this.style.color = ''; 
                }, 100);

                // Display "Code copied to clipboard" near the clicked icon
                const message = document.createElement('span');
                message.textContent = "Copied!";
                message.classList.add('copy-message'); 

                // Append the message to the icon
                this.appendChild(message);

                setTimeout(() => {
                    this.removeChild(message);
                }, 500);
            });

            highlight.appendChild(copyIcon);
        });
    });
  </script>


<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
        // Force download for notebook-download-btn
        const downloadButtons = document.querySelectorAll('.notebook-download-btn');
        downloadButtons.forEach(function(button) {
            button.addEventListener('click', function(event) {
                event.preventDefault(); // Prevent default behavior

                // Fetch the raw content of the notebook from GitHub
                fetch(button.href)
                    .then(response => response.blob())
                    .then(blob => {
                        const url = window.URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.style.display = 'none';
                        link.href = url;
                        const filename = button.href.split('/').pop();
                        link.download = filename; 

                        document.body.appendChild(link);
                        link.click();

                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(link);
                    })
                    .catch(err => console.error('Error fetching the notebook:', err));
            });
        });
    });
</script> 
</body>
</html>