
  

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Advanced Semantic Search with Sentence Transformers and MLflow &mdash; MLflow 2.9.3.dev0 documentation</title>
  
   
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="canonical" href="https://mlflow.org/docs/latest/llms/sentence-transformers/tutorials/semantic-search/semantic-search-sentence-transformers.html">
  
  
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    

    

  
    

  

  
  
    

  

  
  
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600" rel="stylesheet">
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/cards.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/grids.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/mobile.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/simple-cards.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/tabs.css" type="text/css" />
    
  
        <link rel="index" title="Index"
              href="../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../search.html"/>
    <link rel="top" title="MLflow 2.9.3.dev0 documentation" href="../../../../index.html"/>
        <link rel="up" title="MLflow Sentence-Transformers Flavor" href="../../index.html"/>
        <link rel="next" title="Introduction to Advanced Semantic Similarity Analysis with Sentence Transformers and MLflow" href="/../semantic-similarity/semantic-similarity-sentence-transformers.html"/>
        <link rel="prev" title="Advanced Paraphrase Mining with Sentence Transformers and MLflow" href="/../paraphrase-mining/paraphrase-mining-sentence-transformers.html"/> 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>
<script type="text/javascript" src="../../../../_static/jquery.js"></script>
<script type="text/javascript" src="../../../../_static/underscore.js"></script>
<script type="text/javascript" src="../../../../_static/doctools.js"></script>
<script type="text/javascript" src="../../../../_static/languagesections.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/javascript" src="../../../../None"></script>

<body class="wy-body-for-nav" role="document">
  

  
  <nav class="wy-nav-top header" role="navigation" aria-label="top navigation">
    <ul>
  <li class="menu-toggle">
    <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
    <a href="../../../../index.html" class="wy-nav-top-logo"
      ><img src="../../../../_static/MLflow-logo-final-black.png" alt="MLflow"
    /></a>
    <span class="version">2.9.3.dev0</span>
  </li>
</ul>
  </nav>
  <page>
    

    <nav data-toggle="wy-nav-shift" class="wy-nav-side relative">
      <div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
  </form>
</div>


    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../../../../index.html" class="main-navigation-home"><img src="../../../../_static/icons/nav-home.svg"> MLflow</a>
    

    
      

      
        <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction/index.html">What is MLflow?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting-started/index.html">Getting Started with MLflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../new-features/index.html">New Features</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">LLMs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../index.html#id1">MLflow Deployments Server for LLMs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../index.html#id2">LLM Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../index.html#id3">Prompt Engineering UI</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../index.html#native-mlflow-flavors-for-llms">Native MLflow Flavors for LLMs</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../../../index.html#explore-the-native-llm-flavors">Explore the Native LLM Flavors</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../../../transformers/index.html">MLflow Transformers Flavor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../openai/index.html">MLflow OpenAI Flavor</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../../index.html">MLflow Sentence-Transformers Flavor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../langchain/index.html">MLflow LangChain Flavor</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../index.html#id4">LLM Tracking in MLflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../index.html#tutorials-and-use-case-guides-for-llms-in-mlflow">Tutorials and Use Case Guides for LLMs in MLflow</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../model-evaluation/index.html">Model Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../deep-learning/index.html">Deep Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../traditional-ml/index.html">Traditional ML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../deployment/index.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tracking.html">MLflow Tracking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../system-metrics/index.html">System Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../projects.html">MLflow Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../models.html">MLflow Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../model-registry.html">MLflow Model Registry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../recipes.html">MLflow Recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../plugins.html">MLflow Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../auth/index.html">MLflow Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cli.html">Command-Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../search-runs.html">Search Runs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../search-experiments.html">Search Experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../python_api/index.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../R-api.html">R API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../java_api/index.html">Java API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rest-api.html">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../docker.html">Official MLflow Docker Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../community-model-flavors.html">Community Model Flavors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials-and-examples/index.html">Tutorials and Examples</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    

    <p>
      <a id='feedbacklink' href="https://github.com/mlflow/mlflow/blob/master/CONTRIBUTING.md" target="_blank">Contribute</a>
    </p>
  </div>
</div>
    </nav>

    <main class="wy-grid-for-nav">
      <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
        <div class="wy-nav-content">
          <div class="rst-content">
            










<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
        <li><a href="../../../index.html">LLMs</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
        <li><a href="../../index.html">MLflow Sentence-Transformers Flavor</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>Advanced Semantic Search with Sentence Transformers and MLflow</li>
    
    
    <!-- <li class="wy-breadcrumbs-aside">
      <a href="https://github.com/mlflow/mlflow/blob/master/docs/source/llms/sentence-transformers/tutorials/semantic-search/semantic-search-sentence-transformers.ipynb" class="fa fa-github"> Edit on GitHub</a>
    </li> -->
    
  </ul>
</div>
            <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
              <div itemprop="articleBody">
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Advanced-Semantic-Search-with-Sentence-Transformers-and-MLflow">
<h1>Advanced Semantic Search with Sentence Transformers and MLflow<a class="headerlink" href="#Advanced-Semantic-Search-with-Sentence-Transformers-and-MLflow" title="Permalink to this headline"> </a></h1>
<p>Embark on a hands-on journey exploring Advanced Semantic Search using Sentence Transformers and MLflow.</p>
<div class="section" id="What-You-Will-Learn">
<h2>What You Will Learn<a class="headerlink" href="#What-You-Will-Learn" title="Permalink to this headline"> </a></h2>
<ul class="simple">
<li><p>Implement advanced semantic search with <code class="docutils literal notranslate"><span class="pre">sentence-transformers</span></code>.</p></li>
<li><p>Customize MLflow’s <code class="docutils literal notranslate"><span class="pre">PythonModel</span></code> for unique project requirements.</p></li>
<li><p>Manage and log models within MLflow’s ecosystem.</p></li>
<li><p>Deploy complex models for practical applications using MLflow.</p></li>
</ul>
<div class="section" id="Understanding-Semantic-Search">
<h3>Understanding Semantic Search<a class="headerlink" href="#Understanding-Semantic-Search" title="Permalink to this headline"> </a></h3>
<p>Semantic search transcends keyword matching, using language nuances and context to find relevant results. This advanced approach reflects human language understanding, considering the varied meanings of words in different scenarios.</p>
</div>
<div class="section" id="Harnessing-Power-of-Sentence-Transformers-for-Search">
<h3>Harnessing Power of Sentence Transformers for Search<a class="headerlink" href="#Harnessing-Power-of-Sentence-Transformers-for-Search" title="Permalink to this headline"> </a></h3>
<p>Sentence Transformers, specialized for context-rich sentence embeddings, transform search queries and text corpora into semantic vectors. This enables the identification of semantically similar entries, a cornerstone of semantic search.</p>
</div>
<div class="section" id="MLflow:-A-Vanguard-in-Model-Management-and-Deployment">
<h3>MLflow: A Vanguard in Model Management and Deployment<a class="headerlink" href="#MLflow:-A-Vanguard-in-Model-Management-and-Deployment" title="Permalink to this headline"> </a></h3>
<p>MLflow enhances NLP projects with efficient experiment logging and customizable model environments. It brings efficiency to experiment tracking and adds a layer of customization, vital for unique NLP tasks.</p>
<p>Join us in this tutorial to master advanced semantic search techniques and discover how MLflow can revolutionize your approach to NLP model deployment and management.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>

<span class="c1"># Disable a few less-than-useful UserWarnings from setuptools and pydantic</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Understanding-the-Semantic-Search-Model-with-MLflow-and-Sentence-Transformers">
<h2>Understanding the Semantic Search Model with MLflow and Sentence Transformers<a class="headerlink" href="#Understanding-the-Semantic-Search-Model-with-MLflow-and-Sentence-Transformers" title="Permalink to this headline"> </a></h2>
<p>Delve into the intricacies of the <code class="docutils literal notranslate"><span class="pre">SemanticSearchModel</span></code>, a custom implementation for semantic search using MLflow and Sentence Transformers.</p>
<div class="section" id="MLflow-and-Custom-PyFunc-Models">
<h3>MLflow and Custom PyFunc Models<a class="headerlink" href="#MLflow-and-Custom-PyFunc-Models" title="Permalink to this headline"> </a></h3>
<p>MLflow’s custom Python function (<code class="docutils literal notranslate"><span class="pre">pyfunc</span></code>) models provide a flexible and deployable solution for integrating complex logic, ideal for our <code class="docutils literal notranslate"><span class="pre">SemanticSearchModel</span></code>.</p>
</div>
<div class="section" id="The-Model’s-Core-Functionalities">
<h3>The Model’s Core Functionalities<a class="headerlink" href="#The-Model’s-Core-Functionalities" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p><strong>Context Loading</strong>: Essential for initializing the Sentence Transformer model and preparing the corpus for semantic comparison.</p></li>
<li><p><strong>Predict Method</strong>: The central function for semantic search, encompassing input validation, query encoding, and similarity computation.</p></li>
</ul>
</div>
<div class="section" id="Detailed-Breakdown-of-Predict-Method">
<h3>Detailed Breakdown of Predict Method<a class="headerlink" href="#Detailed-Breakdown-of-Predict-Method" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p><strong>Input Validation</strong>: Ensures proper format and extraction of the query sentence.</p></li>
<li><p><strong>Query Encoding</strong>: Converts the query into an embedding for comparison.</p></li>
<li><p><strong>Cosine Similarity Computation</strong>: Determines the relevance of each corpus entry to the query.</p></li>
<li><p><strong>Top Results Extraction</strong>: Identifies the most relevant entries based on similarity scores.</p></li>
<li><p><strong>Relevancy Filtering</strong>: Filters results based on a minimum relevancy threshold, enhancing practical usability.</p></li>
<li><p><strong>Warning Mechanism</strong>: Issues a warning if all top results are below the relevancy threshold, ensuring a result is always provided.</p></li>
</ul>
</div>
<div class="section" id="Conclusion">
<h3>Conclusion<a class="headerlink" href="#Conclusion" title="Permalink to this headline"> </a></h3>
<p>This semantic search model exemplifies the integration of NLP with MLflow, showcasing flexibility, user-friendliness, and practical application in modern machine learning workflows.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">from</span> <span class="nn">mlflow.pyfunc</span> <span class="kn">import</span> <span class="n">PythonModel</span>
<span class="kn">from</span> <span class="nn">mlflow.models.signature</span> <span class="kn">import</span> <span class="n">infer_signature</span>
<span class="kn">from</span> <span class="nn">sentence_transformers</span> <span class="kn">import</span> <span class="n">SentenceTransformer</span><span class="p">,</span> <span class="n">util</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">import</span> <span class="nn">warnings</span>


<span class="k">class</span> <span class="nc">SemanticSearchModel</span><span class="p">(</span><span class="n">PythonModel</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">load_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load the model context for inference, including the corpus from a file.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Load the pre-trained sentence transformer model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">artifacts</span><span class="p">[</span><span class="s2">&quot;model_path&quot;</span><span class="p">])</span>

            <span class="c1"># Load the corpus from the specified file</span>
            <span class="n">corpus_file</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">artifacts</span><span class="p">[</span><span class="s2">&quot;corpus_file&quot;</span><span class="p">]</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">corpus_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">corpus</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

            <span class="c1"># Encode the corpus and convert it to a tensor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">corpus_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corpus</span><span class="p">,</span> <span class="n">convert_to_tensor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading model and corpus: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">model_input</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Predict method to perform semantic search over the corpus.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_input</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">model_input</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;DataFrame input must have exactly one column.&quot;</span><span class="p">)</span>
            <span class="n">model_input</span> <span class="o">=</span> <span class="n">model_input</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_input</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">model_input</span> <span class="o">=</span> <span class="n">model_input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sentence&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">model_input</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The input dictionary must have a key named &#39;sentence&#39;.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unexpected type for model_input: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">model_input</span><span class="p">)</span><span class="si">}</span><span class="s2">. Must be either a Dict or a DataFrame.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Encode the query</span>
        <span class="n">query_embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">model_input</span><span class="p">,</span> <span class="n">convert_to_tensor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Compute cosine similarity scores</span>
        <span class="n">cos_scores</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">cos_sim</span><span class="p">(</span><span class="n">query_embedding</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corpus_embeddings</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Determine the number of top results to return</span>
        <span class="n">top_k</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;top_k&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="k">if</span> <span class="n">params</span> <span class="k">else</span> <span class="mi">3</span>  <span class="c1"># Default to 3 if not specified</span>

        <span class="n">minimum_relevancy</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;minimum_relevancy&quot;</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span> <span class="k">if</span> <span class="n">params</span> <span class="k">else</span> <span class="mf">0.2</span>
        <span class="p">)</span>  <span class="c1"># Default to 0.2 if not specified</span>

        <span class="c1"># Get the top_k most similar sentences from the corpus</span>
        <span class="n">top_results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">cos_scores</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="o">-</span><span class="n">top_k</span><span class="p">:]</span>

        <span class="c1"># Prepare the initial results list</span>
        <span class="n">initial_results</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corpus</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">cos_scores</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">())</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">top_results</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="c1"># Filter the results based on the minimum relevancy threshold</span>
        <span class="n">filtered_results</span> <span class="o">=</span> <span class="p">[</span><span class="n">result</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">initial_results</span> <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">minimum_relevancy</span><span class="p">]</span>

        <span class="c1"># If all results are below the threshold, issue a warning and return the top result</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filtered_results</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;All top results are below the minimum relevancy threshold. &quot;</span>
                <span class="s2">&quot;Returning the highest match instead.&quot;</span><span class="p">,</span>
                <span class="ne">RuntimeWarning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">initial_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">filtered_results</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Building-and-Preparing-the-Semantic-Search-Corpus">
<h2>Building and Preparing the Semantic Search Corpus<a class="headerlink" href="#Building-and-Preparing-the-Semantic-Search-Corpus" title="Permalink to this headline"> </a></h2>
<p>Explore constructing and preparing the corpus for the semantic search model, a critical component for search functionality.</p>
<div class="section" id="Simulating-a-Real-World-Use-Case">
<h3>Simulating a Real-World Use Case<a class="headerlink" href="#Simulating-a-Real-World-Use-Case" title="Permalink to this headline"> </a></h3>
<p>We create a simplified corpus of synthetic blog posts to demonstrate the model’s core functionality, replicating a scaled-down version of a typical real-world scenario.</p>
</div>
<div class="section" id="Key-Steps-in-Corpus-Preparation">
<h3>Key Steps in Corpus Preparation<a class="headerlink" href="#Key-Steps-in-Corpus-Preparation" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p><strong>Corpus Creation</strong>: Formation of a list representing individual blog post entries.</p></li>
<li><p><strong>Writing to a File</strong>: Saving the corpus to a text file, mimicking the process of data extraction and preprocessing in a real application.</p></li>
</ul>
</div>
<div class="section" id="Efficient-Data-Handling-for-Scalability">
<h3>Efficient Data Handling for Scalability<a class="headerlink" href="#Efficient-Data-Handling-for-Scalability" title="Permalink to this headline"> </a></h3>
<p>Our model encodes the corpus into embeddings for rapid comparison, demonstrating an efficient approach suitable for scaling to larger datasets.</p>
</div>
<div class="section" id="Production-Considerations">
<h3>Production Considerations<a class="headerlink" href="#Production-Considerations" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p><strong>Storing Embeddings</strong>: Discusses options for efficient storage and retrieval of embeddings, crucial in large-scale applications.</p></li>
<li><p><strong>Scalability</strong>: Highlights the importance of scalable storage systems for handling extensive datasets and complex queries.</p></li>
<li><p><strong>Updating the Corpus</strong>: Outlines strategies for managing and updating the corpus in dynamic, evolving use cases.</p></li>
</ul>
</div>
<div class="section" id="Realizing-the-Semantic-Search-Concept">
<h3>Realizing the Semantic Search Concept<a class="headerlink" href="#Realizing-the-Semantic-Search-Concept" title="Permalink to this headline"> </a></h3>
<p>This setup, while simplified, reflects the essential steps for developing a robust and scalable semantic search system, combining NLP techniques with efficient data management. In a real production use-case, the processing of a corpus (creating embeddings) would be an external process to that which is running the semantic search. The corpus example below is intended to showcase functionality solely for the purposes of demonstration.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corpus</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Perfecting a Sourdough Bread Recipe: The Joy of Baking. Baking sourdough bread &quot;</span>
    <span class="s2">&quot;requires patience, skill, and a good understanding of yeast fermentation. Each &quot;</span>
    <span class="s2">&quot;loaf is unique, telling its own story of the baker&#39;s journey.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The Mars Rover&#39;s Discoveries: Unveiling the Red Planet. NASA&#39;s Mars rover has &quot;</span>
    <span class="s2">&quot;sent back stunning images and data, revealing the planet&#39;s secrets. These &quot;</span>
    <span class="s2">&quot;discoveries may hold the key to understanding Mars&#39; history.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The Art of Growing Herbs: Enhancing Your Culinary Skills. Growing your own &quot;</span>
    <span class="s2">&quot;herbs can transform your cooking, adding fresh and vibrant flavors. Whether it&#39;s &quot;</span>
    <span class="s2">&quot;basil, thyme, or rosemary, each herb has its own unique characteristics.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AI in Software Development: Transforming the Tech Landscape. The rapid &quot;</span>
    <span class="s2">&quot;advancements in artificial intelligence are reshaping how we approach software &quot;</span>
    <span class="s2">&quot;development. From automation to machine learning, the possibilities are endless.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Backpacking Through Europe: A Journey of Discovery. Traveling across Europe by &quot;</span>
    <span class="s2">&quot;backpack allows one to immerse in diverse cultures and landscapes. It&#39;s an &quot;</span>
    <span class="s2">&quot;adventure that combines the thrill of exploration with personal growth.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Shakespeare&#39;s Timeless Influence: Reshaping Modern Storytelling. The works of &quot;</span>
    <span class="s2">&quot;William Shakespeare continue to inspire and influence contemporary literature. &quot;</span>
    <span class="s2">&quot;His mastery of language and deep understanding of human nature are unparalleled.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The Rise of Renewable Energy: A Sustainable Future. Embracing renewable energy &quot;</span>
    <span class="s2">&quot;is crucial for achieving a sustainable and environmentally friendly lifestyle. &quot;</span>
    <span class="s2">&quot;Solar, wind, and hydro power are leading the way in this green revolution.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The Magic of Jazz: An Exploration of Sound and Harmony. Jazz music, known for &quot;</span>
    <span class="s2">&quot;its improvisation and complex harmonies, has a rich and diverse history. It &quot;</span>
    <span class="s2">&quot;evokes a range of emotions, often reflecting the soul of the musician.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Yoga for Mind and Body: The Benefits of Regular Practice. Engaging in regular &quot;</span>
    <span class="s2">&quot;yoga practice can significantly improve flexibility, strength, and mental &quot;</span>
    <span class="s2">&quot;well-being. It&#39;s a holistic approach to health, combining physical and spiritual &quot;</span>
    <span class="s2">&quot;aspects.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The Egyptian Pyramids: Monuments of Ancient Majesty. The ancient Egyptian &quot;</span>
    <span class="s2">&quot;pyramids, monumental tombs for pharaohs, are marvels of architectural &quot;</span>
    <span class="s2">&quot;ingenuity. They stand as a testament to the advanced skills of ancient builders.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Vegan Cuisine: A World of Flavor. Exploring vegan cuisine reveals a world of &quot;</span>
    <span class="s2">&quot;nutritious and delicious possibilities. From hearty soups to delectable desserts, &quot;</span>
    <span class="s2">&quot;plant-based dishes are diverse and satisfying.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Extraterrestrial Life: The Endless Search. The quest to find life beyond Earth &quot;</span>
    <span class="s2">&quot;continues to captivate scientists and the public alike. Advances in space &quot;</span>
    <span class="s2">&quot;technology are bringing us closer to answering this age-old question.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The Art of Plant Pruning: Promoting Healthy Growth. Regular pruning is essential &quot;</span>
    <span class="s2">&quot;for maintaining healthy and vibrant plants. It&#39;s not just about cutting back, but &quot;</span>
    <span class="s2">&quot;understanding each plant&#39;s growth patterns and needs.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Cybersecurity in the Digital Age: Protecting Our Data. With the rise of digital &quot;</span>
    <span class="s2">&quot;technology, cybersecurity has become a critical concern. Protecting sensitive &quot;</span>
    <span class="s2">&quot;information from cyber threats is an ongoing challenge for individuals and &quot;</span>
    <span class="s2">&quot;businesses alike.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The Great Wall of China: A Historical Journey. Visiting the Great Wall offers &quot;</span>
    <span class="s2">&quot;more than just breathtaking views; it&#39;s a journey through history. This ancient &quot;</span>
    <span class="s2">&quot;structure tells stories of empires, invasions, and human resilience.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Mystery Novels: Crafting Suspense and Intrigue. A great mystery novel captivates &quot;</span>
    <span class="s2">&quot;the reader with intricate plots and unexpected twists. It&#39;s a genre that combines &quot;</span>
    <span class="s2">&quot;intellectual challenge with entertainment.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Conserving Endangered Species: A Global Effort. Protecting endangered species &quot;</span>
    <span class="s2">&quot;is a critical task that requires international collaboration. From rainforests to &quot;</span>
    <span class="s2">&quot;oceans, every effort counts in preserving our planet&#39;s biodiversity.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Emotions in Classical Music: A Symphony of Feelings. Classical music is not just &quot;</span>
    <span class="s2">&quot;an auditory experience; it&#39;s an emotional journey. Each composition tells a story, &quot;</span>
    <span class="s2">&quot;conveying feelings from joy to sorrow, tranquility to excitement.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CrossFit: A Test of Strength and Endurance. CrossFit is more than just a fitness &quot;</span>
    <span class="s2">&quot;regimen; it&#39;s a lifestyle that challenges your physical and mental limits. It &quot;</span>
    <span class="s2">&quot;combines various disciplines to create a comprehensive workout.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The Renaissance: An Era of Artistic Genius. The Renaissance marked a period of &quot;</span>
    <span class="s2">&quot;extraordinary artistic and scientific achievements. It was a time when creativity &quot;</span>
    <span class="s2">&quot;and innovation flourished, reshaping the course of history.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Exploring International Cuisines: A Culinary Adventure. Discovering international &quot;</span>
    <span class="s2">&quot;cuisines is an adventure for the palate. Each dish offers a glimpse into the &quot;</span>
    <span class="s2">&quot;culture and traditions of its origin.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Astronaut Training: Preparing for the Unknown. Becoming an astronaut involves &quot;</span>
    <span class="s2">&quot;rigorous training to prepare for the extreme conditions of space. It&#39;s a journey &quot;</span>
    <span class="s2">&quot;that tests both physical endurance and mental resilience.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Sustainable Gardening: Nurturing the Environment. Sustainable gardening is not &quot;</span>
    <span class="s2">&quot;just about growing plants; it&#39;s about cultivating an ecosystem. By embracing &quot;</span>
    <span class="s2">&quot;environmentally friendly practices, gardeners can have a positive impact on the &quot;</span>
    <span class="s2">&quot;planet.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The Smartphone Revolution: Changing Communication. Smartphones have transformed &quot;</span>
    <span class="s2">&quot;how we communicate, offering unprecedented connectivity and convenience. This &quot;</span>
    <span class="s2">&quot;technology continues to evolve, shaping our daily interactions.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Experiencing African Safaris: Wildlife and Wilderness. An African safari is an &quot;</span>
    <span class="s2">&quot;unforgettable experience that brings you face-to-face with the wonders of &quot;</span>
    <span class="s2">&quot;wildlife. It&#39;s a journey that connects you with the raw beauty of nature.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Graphic Novels: A Blend of Art and Story. Graphic novels offer a unique medium &quot;</span>
    <span class="s2">&quot;where art and narrative intertwine to tell compelling stories. They challenge &quot;</span>
    <span class="s2">&quot;traditional forms of storytelling, offering visual and textual richness.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Addressing Ocean Pollution: A Call to Action. The increasing levels of pollution &quot;</span>
    <span class="s2">&quot;in our oceans are a pressing environmental concern. Protecting marine life and &quot;</span>
    <span class="s2">&quot;ecosystems requires concerted global efforts.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The Origins of Hip Hop: A Cultural Movement. Hip hop music, originating from the &quot;</span>
    <span class="s2">&quot;streets of New York, has grown into a powerful cultural movement. Its beats and &quot;</span>
    <span class="s2">&quot;lyrics reflect the experiences and voices of a community.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Swimming: A Comprehensive Workout. Swimming offers a full-body workout that is &quot;</span>
    <span class="s2">&quot;both challenging and refreshing. It&#39;s an exercise that enhances cardiovascular &quot;</span>
    <span class="s2">&quot;health, builds muscle, and improves endurance.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The Fall of the Berlin Wall: A Historical Turning Point. The fall of the Berlin &quot;</span>
    <span class="s2">&quot;Wall was not just a physical demolition; it was a symbol of political and social &quot;</span>
    <span class="s2">&quot;change. This historic event marked the end of an era and the beginning of a new &quot;</span>
    <span class="s2">&quot;chapter in world history.&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># Write the corpus to a file</span>
<span class="n">corpus_file</span> <span class="o">=</span> <span class="s2">&quot;/tmp/search_corpus.txt&quot;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">corpus_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">corpus</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sentence</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Model-Preparation-and-Configuration-in-MLflow">
<h2>Model Preparation and Configuration in MLflow<a class="headerlink" href="#Model-Preparation-and-Configuration-in-MLflow" title="Permalink to this headline"> </a></h2>
<p>Explore the steps to prepare and configure the Sentence Transformer model for integration with MLflow, essential for deployment readiness.</p>
<div class="section" id="Loading-and-Saving-the-Sentence-Transformer-Model">
<h3>Loading and Saving the Sentence Transformer Model<a class="headerlink" href="#Loading-and-Saving-the-Sentence-Transformer-Model" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p><strong>Model Initialization</strong>: Loading the <code class="docutils literal notranslate"><span class="pre">&quot;all-MiniLM-L6-v2&quot;</span></code> model, known for its balance in performance and speed, suitable for semantic search tasks.</p></li>
<li><p><strong>Model Storage</strong>: Saving the model to a directory, essential for later deployment via MLflow. The choice of <code class="docutils literal notranslate"><span class="pre">/tmp/search_model</span></code> is for tutorial convenience so that your current working directory is not filled with the model files. You can change this to any location of your choosing.</p></li>
</ul>
</div>
<div class="section" id="Preparing-Model-Artifacts-and-Signature">
<h3>Preparing Model Artifacts and Signature<a class="headerlink" href="#Preparing-Model-Artifacts-and-Signature" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p><strong>Artifacts Dictionary</strong>: Creating a dictionary with paths to model and corpus file, guiding MLflow to the components that are required to initialize the custom model object.</p></li>
<li><p><strong>Input Example and Test Output</strong>: Defining sample input and output to illustrate the model’s expected data formats.</p></li>
<li><p><strong>Model Signature</strong>: Using <code class="docutils literal notranslate"><span class="pre">infer_signature</span></code> for automatic signature generation, encompassing input, output, and operational parameters.</p></li>
</ul>
</div>
<div class="section" id="Importance-of-the-Model-Signature">
<h3>Importance of the Model Signature<a class="headerlink" href="#Importance-of-the-Model-Signature" title="Permalink to this headline"> </a></h3>
<p>The signature ensures data consistency between training and deployment, enhancing model usability and reducing error potential. Having a signature specified ensures that type validation occurs at inference time, preventing unexpected behavior with invalid type conversions that could render incorrect or confusing inference results.</p>
</div>
<div class="section" id="id1">
<h3>Conclusion<a class="headerlink" href="#id1" title="Permalink to this headline"> </a></h3>
<p>This comprehensive preparation process guarantees the model is deployment-ready, with all dependencies and operational requirements explicitly defined.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load a pre-trained sentence transformer model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s2">&quot;all-MiniLM-L6-v2&quot;</span><span class="p">)</span>

<span class="c1"># Create an input example DataFrame</span>
<span class="n">input_example</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Something I want to find matches for.&quot;</span><span class="p">]</span>

<span class="c1"># Save the model in the /tmp directory</span>
<span class="n">model_directory</span> <span class="o">=</span> <span class="s2">&quot;/tmp/search_model&quot;</span>
<span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model_directory</span><span class="p">)</span>

<span class="n">artifacts</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;model_path&quot;</span><span class="p">:</span> <span class="n">model_directory</span><span class="p">,</span> <span class="s2">&quot;corpus_file&quot;</span><span class="p">:</span> <span class="n">corpus_file</span><span class="p">}</span>

<span class="c1"># Generate test output for signature</span>
<span class="n">test_output</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;match 1&quot;</span><span class="p">,</span> <span class="s2">&quot;match 2&quot;</span><span class="p">,</span> <span class="s2">&quot;match 3&quot;</span><span class="p">]</span>

<span class="c1"># Define the signature associated with the model</span>
<span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span>
    <span class="n">input_example</span><span class="p">,</span> <span class="n">test_output</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;top_k&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;minimum_relevancy&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Visualize the signature</span>
<span class="n">signature</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
inputs:
  [string]
outputs:
  [string]
params:
  [&#39;top_k&#39;: long (default: 3), &#39;minimum_relevancy&#39;: double (default: 0.2)]
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Creating-an-experiment">
<h2>Creating an experiment<a class="headerlink" href="#Creating-an-experiment" title="Permalink to this headline"> </a></h2>
<p>We create a new MLflow Experiment so that the run we’re going to log our model to does not log to the default experiment and instead has its own contextually relevant entry.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># If you are running this tutorial in local mode, leave the next line commented out.</span>
<span class="c1"># Otherwise, uncomment the following line and set your tracking uri to your local or remote tracking server.</span>

<span class="c1"># mlflow.set_tracking_uri(&quot;http://127.0.0.1:8080&quot;)</span>

<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Semantic Similarity&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Experiment: artifact_location=&#39;file:///Users/benjamin.wilson/repos/mlflow-fork/mlflow/docs/source/llms/sentence-transformers/tutorials/semantic-search/mlruns/405641275158666585&#39;, creation_time=1701278766302, experiment_id=&#39;405641275158666585&#39;, last_update_time=1701278766302, lifecycle_stage=&#39;active&#39;, name=&#39;Semantic Similarity&#39;, tags={}&gt;
</pre></div></div>
</div>
</div>
<div class="section" id="Logging-the-Model-with-MLflow">
<h2>Logging the Model with MLflow<a class="headerlink" href="#Logging-the-Model-with-MLflow" title="Permalink to this headline"> </a></h2>
<p>Discover the process of logging the model in MLflow, a crucial step for managing and deploying the model within the MLflow framework.</p>
<div class="section" id="Starting-an-MLflow-Run">
<h3>Starting an MLflow Run<a class="headerlink" href="#Starting-an-MLflow-Run" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p><strong>Context Management</strong>: Initiating an MLflow run using <code class="docutils literal notranslate"><span class="pre">with</span> <span class="pre">mlflow.start_run()</span></code>, essential for tracking and managing model-related operations.</p></li>
</ul>
</div>
<div class="section" id="Logging-the-Model">
<h3>Logging the Model<a class="headerlink" href="#Logging-the-Model" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p><strong>Model Logging</strong>: Utilizing <code class="docutils literal notranslate"><span class="pre">mlflow.pyfunc.log_model</span></code> to log the custom <code class="docutils literal notranslate"><span class="pre">SemanticSearchModel</span></code>, including key arguments like model name, instance, input example, signature, artifacts, and requirements.</p></li>
</ul>
</div>
<div class="section" id="Outcome-of-Model-Logging">
<h3>Outcome of Model Logging<a class="headerlink" href="#Outcome-of-Model-Logging" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p><strong>Model Registration</strong>: Ensures the model is registered with all necessary components in MLflow, ready for deployment.</p></li>
<li><p><strong>Reproducibility and Traceability</strong>: Facilitates consistent model deployment and tracks versioning and associated data.</p></li>
</ul>
</div>
<div class="section" id="id2">
<h3>Conclusion<a class="headerlink" href="#id2" title="Permalink to this headline"> </a></h3>
<p>Completing this critical step transitions the model from development to a deployment-ready state, encapsulated within the MLflow ecosystem.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">()</span> <span class="k">as</span> <span class="n">run</span><span class="p">:</span>
    <span class="n">model_info</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="s2">&quot;semantic_search&quot;</span><span class="p">,</span>
        <span class="n">python_model</span><span class="o">=</span><span class="n">SemanticSearchModel</span><span class="p">(),</span>
        <span class="n">input_example</span><span class="o">=</span><span class="n">input_example</span><span class="p">,</span>
        <span class="n">signature</span><span class="o">=</span><span class="n">signature</span><span class="p">,</span>
        <span class="n">artifacts</span><span class="o">=</span><span class="n">artifacts</span><span class="p">,</span>
        <span class="n">pip_requirements</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sentence_transformers&quot;</span><span class="p">,</span> <span class="s2">&quot;numpy&quot;</span><span class="p">],</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "8642d786cb0d4f0b8a07689339885d45", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2023/11/30 15:57:53 INFO mlflow.store.artifact.artifact_repo: The progress bar can be disabled by setting the environment variable MLFLOW_ENABLE_ARTIFACTS_PROGRESS_BAR to false
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "b62ea1e304c34dfeb29813efb230cc48", "version_major": 2, "version_minor": 0}</script></div>
</div>
</div>
</div>
<div class="section" id="Model-Inference-and-Prediction-Demonstration">
<h2>Model Inference and Prediction Demonstration<a class="headerlink" href="#Model-Inference-and-Prediction-Demonstration" title="Permalink to this headline"> </a></h2>
<p>Observe the practical application of our semantic search model, demonstrating its ability to respond to user queries with relevant predictions.</p>
<div class="section" id="Loading-the-Model-for-Inference">
<h3>Loading the Model for Inference<a class="headerlink" href="#Loading-the-Model-for-Inference" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p><strong>Model Loading</strong>: Utilizing <code class="docutils literal notranslate"><span class="pre">mlflow.pyfunc.load_model</span></code> to load the model, preparing it to process semantic search queries.</p></li>
</ul>
</div>
<div class="section" id="Making-a-Prediction">
<h3>Making a Prediction<a class="headerlink" href="#Making-a-Prediction" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p><strong>Running a Query</strong>: Passing a sample query to the loaded model, demonstrating its semantic search capability.</p></li>
</ul>
</div>
<div class="section" id="Understanding-the-Prediction-Output">
<h3>Understanding the Prediction Output<a class="headerlink" href="#Understanding-the-Prediction-Output" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p><strong>Output Format</strong>: Analysis of the prediction output, showcasing the model’s semantic understanding through relevance scores.</p></li>
<li><p><strong>Example Results</strong>: Illustrating the model’s results, including relevance scores for various query-related entries.</p></li>
</ul>
</div>
<div class="section" id="id3">
<h3>Conclusion<a class="headerlink" href="#id3" title="Permalink to this headline"> </a></h3>
<p>This demonstration underscores the model’s efficacy in semantic search, highlighting its potential in recommendation and knowledge retrieval applications.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load our model as a PyFuncModel.</span>
<span class="c1"># Note that unlike the example shown in the Introductory Tutorial, there is no &#39;native&#39; flavor for PyFunc models.</span>
<span class="c1"># This model cannot be loaded with `mlflow.sentence_transformers.load_model()` because it is not in the native model format.</span>
<span class="n">loaded_dynamic</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">model_info</span><span class="o">.</span><span class="n">model_uri</span><span class="p">)</span>

<span class="c1"># Make sure that it generates a reasonable output</span>
<span class="n">loaded_dynamic</span><span class="o">.</span><span class="n">predict</span><span class="p">([</span><span class="s2">&quot;I&#39;d like some ideas for a meal to cook.&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[(&#39;Exploring International Cuisines: A Culinary Adventure. Discovering international cuisines is an adventure for the palate. Each dish offers a glimpse into the culture and traditions of its origin.&#39;,
  0.43857115507125854),
 (&#39;Vegan Cuisine: A World of Flavor. Exploring vegan cuisine reveals a world of nutritious and delicious possibilities. From hearty soups to delectable desserts, plant-based dishes are diverse and satisfying.&#39;,
  0.34688490629196167),
 (&#34;The Art of Growing Herbs: Enhancing Your Culinary Skills. Growing your own herbs can transform your cooking, adding fresh and vibrant flavors. Whether it&#39;s basil, thyme, or rosemary, each herb has its own unique characteristics.&#34;,
  0.22686949372291565)]
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Advanced-Query-Handling-with-Customizable-Parameters-and-Warning-Mechanism">
<h2>Advanced Query Handling with Customizable Parameters and Warning Mechanism<a class="headerlink" href="#Advanced-Query-Handling-with-Customizable-Parameters-and-Warning-Mechanism" title="Permalink to this headline"> </a></h2>
<p>Explore the model’s advanced features, including customizable search parameters and a unique warning mechanism for optimal user experience.</p>
<div class="section" id="Executing-a-Customized-Prediction-with-Warnings">
<h3>Executing a Customized Prediction with Warnings<a class="headerlink" href="#Executing-a-Customized-Prediction-with-Warnings" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p><strong>Customized Query with Challenging Parameters</strong>: Testing the model’s ability to discern highly relevant content with a high relevancy threshold query.</p></li>
<li><p><strong>Triggering the Warning</strong>: A mechanism to alert users when search criteria are too restrictive, enhancing user feedback.</p></li>
</ul>
</div>
<div class="section" id="Understanding-the-Model’s-Response">
<h3>Understanding the Model’s Response<a class="headerlink" href="#Understanding-the-Model’s-Response" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p><strong>Result in Challenging Scenarios</strong>: Analyzing the model’s response to stringent search criteria, including cases where the relevancy threshold is not met.</p></li>
</ul>
</div>
<div class="section" id="Implications-and-Best-Practices">
<h3>Implications and Best Practices<a class="headerlink" href="#Implications-and-Best-Practices" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p><strong>Balancing Relevancy and Coverage</strong>: Discussing the importance of setting appropriate relevancy thresholds to ensure a balance between precision and result coverage.</p></li>
<li><p><strong>User Feedback for Corpus Improvement</strong>: Utilizing warnings as feedback for refining the corpus and enhancing the search system.</p></li>
</ul>
</div>
<div class="section" id="id4">
<h3>Conclusion<a class="headerlink" href="#id4" title="Permalink to this headline"> </a></h3>
<p>This advanced feature set demonstrates the model’s adaptability and the importance of fine-tuning search parameters for a dynamic and responsive search experience.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Verify that the fallback logic works correctly by returning the &#39;best, closest&#39; result, even though the parameters submitted should return no results.</span>
<span class="c1"># We are also validating that the warning is issued, alerting us to the fact that this behavior is occurring.</span>
<span class="n">loaded_dynamic</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&quot;Latest stories on computing&quot;</span><span class="p">],</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;top_k&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;minimum_relevancy&quot;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/var/folders/cd/n8n0rm2x53l_s0xv_j_xklb00000gp/T/ipykernel_55915/1325605132.py:71: RuntimeWarning: All top results are below the minimum relevancy threshold. Returning the highest match instead.
  warnings.warn(
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[(&#39;AI in Software Development: Transforming the Tech Landscape. The rapid advancements in artificial intelligence are reshaping how we approach software development. From automation to machine learning, the possibilities are endless.&#39;,
  0.2533860206604004)]
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Conclusion:-Crafting-Custom-Logic-with-MLflow’s-PythonModel">
<h2>Conclusion: Crafting Custom Logic with MLflow’s PythonModel<a class="headerlink" href="#Conclusion:-Crafting-Custom-Logic-with-MLflow’s-PythonModel" title="Permalink to this headline"> </a></h2>
<p>As we wrap up this tutorial, let’s reflect on the key learnings and the powerful capabilities of MLflow’s <code class="docutils literal notranslate"><span class="pre">PythonModel</span></code> in crafting custom logic for real-world applications, particularly when integrating advanced libraries like <code class="docutils literal notranslate"><span class="pre">sentence-transformers</span></code>.</p>
<div class="section" id="Key-Takeaways">
<h3>Key Takeaways<a class="headerlink" href="#Key-Takeaways" title="Permalink to this headline"> </a></h3>
<ol class="arabic simple">
<li><p><strong>Flexibility of PythonModel</strong>:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">PythonModel</span></code> in MLflow offers unparalleled flexibility in defining custom logic. Throughout this tutorial, we leveraged this to build a semantic search model tailored to our specific requirements.</p></li>
<li><p>This flexibility proves invaluable when dealing with complex use cases that go beyond standard model implementations.</p></li>
</ul>
</li>
<li><p><strong>Integration with Sentence Transformers</strong>:</p>
<ul class="simple">
<li><p>We seamlessly integrated the <code class="docutils literal notranslate"><span class="pre">sentence-transformers</span></code> library within our MLflow model. This demonstrated how advanced NLP capabilities can be embedded within custom models to handle sophisticated tasks like semantic search.</p></li>
<li><p>The use of transformer models for generating embeddings showcased how cutting-edge NLP techniques could be applied in practical scenarios.</p></li>
</ul>
</li>
<li><p><strong>Customization and User Experience</strong>:</p>
<ul class="simple">
<li><p>Our model not only performed the core task of semantic search but also allowed for customizable search parameters (<code class="docutils literal notranslate"><span class="pre">top_k</span></code> and <code class="docutils literal notranslate"><span class="pre">minimum_relevancy</span></code>). This level of customization is crucial for aligning the model’s output with varying user needs.</p></li>
<li><p>The inclusion of a warning mechanism further enriched the model by providing valuable feedback, enhancing the user experience.</p></li>
</ul>
</li>
<li><p><strong>Real-World Application and Scalability</strong>:</p>
<ul class="simple">
<li><p>While our tutorial focused on a controlled dataset, the principles and methodologies apply to much larger, real-world datasets. The discussion around using vector databases and in-memory databases like Redis or Elasticsearch for scalability highlighted how the model could be adapted for large-scale applications.</p></li>
</ul>
</li>
</ol>
</div>
<div class="section" id="Empowering-Real-World-Applications">
<h3>Empowering Real-World Applications<a class="headerlink" href="#Empowering-Real-World-Applications" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p>The combination of MLflow’s <code class="docutils literal notranslate"><span class="pre">PythonModel</span></code> and advanced libraries like <code class="docutils literal notranslate"><span class="pre">sentence-transformers</span></code> simplifies the creation of sophisticated, real-world applications.</p></li>
<li><p>The ability to encapsulate complex logic, manage dependencies, and ensure model portability makes MLflow an invaluable tool in the modern data scientist’s toolkit.</p></li>
</ul>
</div>
<div class="section" id="Moving-Forward">
<h3>Moving Forward<a class="headerlink" href="#Moving-Forward" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p>As we conclude, remember that the journey doesn’t end here. The concepts and techniques explored in this tutorial lay the groundwork for further exploration and innovation in the field of NLP and beyond.</p></li>
<li><p>We encourage you to take these learnings, experiment with your datasets, and continue pushing the boundaries of what’s possible with MLflow and advanced NLP technologies.</p></li>
</ul>
<p>Thank you for joining us on this enlightening journey through semantic search with Sentence Transformers and MLflow!</p>
</div>
</div>
</div>


              </div>
            </div>
            <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../paraphrase-mining/paraphrase-mining-sentence-transformers.html" class="btn btn-neutral" title="Advanced Paraphrase Mining with Sentence Transformers and MLflow" accesskey="p"><span class="db-icon db-icon-chevron-left"></span> Previous</a>
      
      
        <a href="../semantic-similarity/semantic-similarity-sentence-transformers.html" class="btn btn-neutral" title="Introduction to Advanced Semantic Similarity Analysis with Sentence Transformers and MLflow" accesskey="n">Next <span class="db-icon db-icon-chevron-right"></span></a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
      <p class="copyright">
          &copy; MLflow Project, a Series of LF Projects, LLC. All rights reserved.
      </p>

  </div> 

</footer>
          </div>
        </div>
      </section>
    </main>
  </page>

  


  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT:'../../../../',
      VERSION:'2.9.3.dev0',
      COLLAPSE_INDEX:false,
      FILE_SUFFIX:'.html',
      LINK_SUFFIX: '.html',
      HAS_SOURCE:  true
    };
  </script>

  

  <script type="text/javascript" src="../../../../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../../../../_static/js/jquery.waypoints.min.js"></script>

  
  
  
  <script type="text/javascript">var CLIPPY_SVG_PATH = "../../../../_static/clippy.svg";</script>
  <script type="text/javascript" src="../../../../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  

  
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
        }
        // Get the code block designator class entries
        const allHighlights = document.querySelectorAll('.highlight');
        // Disable copyable links for notebook cell numbering and for cell outputs
        const highlights = Array.from(allHighlights).filter(highlight => !highlight.closest('.highlight-none') && 
            !highlight.closest('.nboutput'));
    
        highlights.forEach(function(highlight) {
            const copyIcon = document.createElement('span');
            copyIcon.classList.add('copy-icon');
            copyIcon.innerHTML = '&#xf0ea;';

            copyIcon.addEventListener('click', function() {
                const code = highlight.querySelector('pre').textContent;
                copyToClipboard(code);

                // Flash effect on click
                this.style.color = '#0194E2';
                setTimeout(() => {
                    this.style.color = ''; 
                }, 100);

                // Display "Code copied to clipboard" near the clicked icon
                const message = document.createElement('span');
                message.textContent = "Copied!";
                message.classList.add('copy-message'); 

                // Append the message to the icon
                this.appendChild(message);

                setTimeout(() => {
                    this.removeChild(message);
                }, 500);
            });

            highlight.appendChild(copyIcon);
        });
    });
  </script>


<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
        // Force download for notebook-download-btn
        const downloadButtons = document.querySelectorAll('.notebook-download-btn');
        downloadButtons.forEach(function(button) {
            button.addEventListener('click', function(event) {
                event.preventDefault(); // Prevent default behavior

                // Fetch the raw content of the notebook from GitHub
                fetch(button.href)
                    .then(response => response.blob())
                    .then(blob => {
                        const url = window.URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.style.display = 'none';
                        link.href = url;
                        const filename = button.href.split('/').pop();
                        link.download = filename; 

                        document.body.appendChild(link);
                        link.click();

                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(link);
                    })
                    .catch(err => console.error('Error fetching the notebook:', err));
            });
        });
    });
</script> 
</body>
</html>