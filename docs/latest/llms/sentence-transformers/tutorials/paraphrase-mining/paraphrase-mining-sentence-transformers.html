
  

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Advanced Paraphrase Mining with Sentence Transformers and MLflow &mdash; MLflow 2.9.3.dev0 documentation</title>
  
   
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="canonical" href="https://mlflow.org/docs/latest/llms/sentence-transformers/tutorials/paraphrase-mining/paraphrase-mining-sentence-transformers.html">
  
  
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    

    

  
    

  

  
  
    

  

  
  
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600" rel="stylesheet">
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/cards.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/grids.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/mobile.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/simple-cards.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/tabs.css" type="text/css" />
    
  
        <link rel="index" title="Index"
              href="../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../search.html"/>
    <link rel="top" title="MLflow 2.9.3.dev0 documentation" href="../../../../index.html"/>
        <link rel="up" title="MLflow Sentence-Transformers Flavor" href="../../index.html"/>
        <link rel="next" title="Advanced Semantic Search with Sentence Transformers and MLflow" href="/../semantic-search/semantic-search-sentence-transformers.html"/>
        <link rel="prev" title="Introduction to Sentence Transformers and MLflow" href="/../quickstart/sentence-transformers-quickstart.html"/> 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>
<script type="text/javascript" src="../../../../_static/jquery.js"></script>
<script type="text/javascript" src="../../../../_static/underscore.js"></script>
<script type="text/javascript" src="../../../../_static/doctools.js"></script>
<script type="text/javascript" src="../../../../_static/languagesections.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/javascript" src="../../../../None"></script>

<body class="wy-body-for-nav" role="document">
  

  
  <nav class="wy-nav-top header" role="navigation" aria-label="top navigation">
    <ul>
  <li class="menu-toggle">
    <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
    <a href="../../../../index.html" class="wy-nav-top-logo"
      ><img src="../../../../_static/MLflow-logo-final-black.png" alt="MLflow"
    /></a>
    <span class="version">2.9.3.dev0</span>
  </li>
</ul>
  </nav>
  <page>
    

    <nav data-toggle="wy-nav-shift" class="wy-nav-side relative">
      <div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
  </form>
</div>


    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../../../../index.html" class="main-navigation-home"><img src="../../../../_static/icons/nav-home.svg"> MLflow</a>
    

    
      

      
        <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction/index.html">What is MLflow?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting-started/index.html">Getting Started with MLflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../new-features/index.html">New Features</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">LLMs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../index.html#id1">MLflow Deployments Server for LLMs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../index.html#id2">LLM Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../index.html#id3">Prompt Engineering UI</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../index.html#native-mlflow-flavors-for-llms">Native MLflow Flavors for LLMs</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../../../index.html#explore-the-native-llm-flavors">Explore the Native LLM Flavors</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../../../transformers/index.html">MLflow Transformers Flavor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../openai/index.html">MLflow OpenAI Flavor</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../../index.html">MLflow Sentence-Transformers Flavor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../langchain/index.html">MLflow LangChain Flavor</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../index.html#id4">LLM Tracking in MLflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../index.html#tutorials-and-use-case-guides-for-llms-in-mlflow">Tutorials and Use Case Guides for LLMs in MLflow</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../model-evaluation/index.html">Model Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../deep-learning/index.html">Deep Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../traditional-ml/index.html">Traditional ML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../deployment/index.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tracking.html">MLflow Tracking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../system-metrics/index.html">System Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../projects.html">MLflow Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../models.html">MLflow Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../model-registry.html">MLflow Model Registry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../recipes.html">MLflow Recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../plugins.html">MLflow Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../auth/index.html">MLflow Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cli.html">Command-Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../search-runs.html">Search Runs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../search-experiments.html">Search Experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../python_api/index.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../R-api.html">R API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../java_api/index.html">Java API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rest-api.html">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../docker.html">Official MLflow Docker Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../community-model-flavors.html">Community Model Flavors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials-and-examples/index.html">Tutorials and Examples</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    

    <p>
      <a id='feedbacklink' href="https://github.com/mlflow/mlflow/blob/master/CONTRIBUTING.md" target="_blank">Contribute</a>
    </p>
  </div>
</div>
    </nav>

    <main class="wy-grid-for-nav">
      <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
        <div class="wy-nav-content">
          <div class="rst-content">
            










<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
        <li><a href="../../../index.html">LLMs</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
        <li><a href="../../index.html">MLflow Sentence-Transformers Flavor</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>Advanced Paraphrase Mining with Sentence Transformers and MLflow</li>
    
    
    <!-- <li class="wy-breadcrumbs-aside">
      <a href="https://github.com/mlflow/mlflow/blob/master/docs/source/llms/sentence-transformers/tutorials/paraphrase-mining/paraphrase-mining-sentence-transformers.ipynb" class="fa fa-github"> Edit on GitHub</a>
    </li> -->
    
  </ul>
</div>
            <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
              <div itemprop="articleBody">
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Advanced-Paraphrase-Mining-with-Sentence-Transformers-and-MLflow">
<h1>Advanced Paraphrase Mining with Sentence Transformers and MLflow<a class="headerlink" href="#Advanced-Paraphrase-Mining-with-Sentence-Transformers-and-MLflow" title="Permalink to this headline"> </a></h1>
<p>Embark on an enriching journey through advanced paraphrase mining using Sentence Transformers, enhanced by MLflow.</p>
<div class="section" id="Learning-Objectives">
<h2>Learning Objectives<a class="headerlink" href="#Learning-Objectives" title="Permalink to this headline"> </a></h2>
<ul class="simple">
<li><p>Apply <code class="docutils literal notranslate"><span class="pre">sentence-transformers</span></code> for advanced paraphrase mining.</p></li>
<li><p>Develop a custom <code class="docutils literal notranslate"><span class="pre">PythonModel</span></code> in MLflow tailored for this task.</p></li>
<li><p>Effectively manage and track models within the MLflow ecosystem.</p></li>
<li><p>Deploy paraphrase mining models using MLflow’s deployment capabilities.</p></li>
</ul>
<div class="section" id="Exploring-Paraphrase-Mining">
<h3>Exploring Paraphrase Mining<a class="headerlink" href="#Exploring-Paraphrase-Mining" title="Permalink to this headline"> </a></h3>
<p>Discover the process of identifying semantically similar but textually distinct sentences, a key aspect in various NLP applications such as document summarization and chatbot development.</p>
</div>
<div class="section" id="The-Role-of-Sentence-Transformers-in-Paraphrase-Mining">
<h3>The Role of Sentence Transformers in Paraphrase Mining<a class="headerlink" href="#The-Role-of-Sentence-Transformers-in-Paraphrase-Mining" title="Permalink to this headline"> </a></h3>
<p>Learn how Sentence Transformers, specialized for generating rich sentence embeddings, are used to capture deep semantic meanings and compare textual content.</p>
</div>
<div class="section" id="MLflow:-Simplifying-Model-Management-and-Deployment">
<h3>MLflow: Simplifying Model Management and Deployment<a class="headerlink" href="#MLflow:-Simplifying-Model-Management-and-Deployment" title="Permalink to this headline"> </a></h3>
<p>Delve into how MLflow streamlines the process of managing and deploying NLP models, with a focus on efficient tracking and customizable model implementations.</p>
<p>Join us to develop a nuanced understanding of paraphrase mining and master the art of managing and deploying NLP models with MLflow.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>

<span class="c1"># Disable a few less-than-useful UserWarnings from setuptools and pydantic</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Introduction-to-the-Paraphrase-Mining-Model">
<h2>Introduction to the Paraphrase Mining Model<a class="headerlink" href="#Introduction-to-the-Paraphrase-Mining-Model" title="Permalink to this headline"> </a></h2>
<p>Initiate the Paraphrase Mining Model, integrating Sentence Transformers and MLflow for advanced NLP tasks.</p>
<div class="section" id="Overview-of-the-Model-Structure">
<h3>Overview of the Model Structure<a class="headerlink" href="#Overview-of-the-Model-Structure" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p><strong>Loading Model and Corpus ``load_context`` Method</strong>: Essential for loading the Sentence Transformer model and the text corpus for paraphrase identification.</p></li>
<li><p><strong>Paraphrase Mining Logic ``predict`` Method</strong>: Integrates custom logic for input validation and paraphrase mining, offering customizable parameters.</p></li>
<li><p><strong>Sorting and Filtering Matches ``_sort_and_filter_matches`` Helper Method</strong>: Ensures relevant and unique paraphrase identification by sorting and filtering based on similarity scores.</p></li>
</ul>
</div>
<div class="section" id="Key-Features">
<h3>Key Features<a class="headerlink" href="#Key-Features" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p><strong>Advanced NLP Techniques</strong>: Utilizes Sentence Transformers for semantic text understanding.</p></li>
<li><p><strong>Custom Logic Integration</strong>: Demonstrates flexibility in model behavior customization.</p></li>
<li><p><strong>User Customization Options</strong>: Allows end users to adjust match criteria for various use cases.</p></li>
<li><p><strong>Efficiency in Processing</strong>: Pre-encodes the corpus for efficient paraphrase mining operations.</p></li>
<li><p><strong>Robust Error Handling</strong>: Incorporates validations for reliable model performance.</p></li>
</ul>
</div>
<div class="section" id="Practical-Implications">
<h3>Practical Implications<a class="headerlink" href="#Practical-Implications" title="Permalink to this headline"> </a></h3>
<p>This model provides a powerful tool for paraphrase detection in diverse applications, exemplifying the effective use of custom models within the MLflow framework.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">from</span> <span class="nn">mlflow.models.signature</span> <span class="kn">import</span> <span class="n">infer_signature</span>
<span class="kn">from</span> <span class="nn">mlflow.pyfunc</span> <span class="kn">import</span> <span class="n">PythonModel</span>
<span class="kn">from</span> <span class="nn">sentence_transformers</span> <span class="kn">import</span> <span class="n">SentenceTransformer</span><span class="p">,</span> <span class="n">util</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>


<span class="k">class</span> <span class="nc">ParaphraseMiningModel</span><span class="p">(</span><span class="n">PythonModel</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">load_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load the model context for inference, including the customer feedback corpus.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Load the pre-trained sentence transformer model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">artifacts</span><span class="p">[</span><span class="s2">&quot;model_path&quot;</span><span class="p">])</span>

            <span class="c1"># Load the customer feedback corpus from the specified file</span>
            <span class="n">corpus_file</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">artifacts</span><span class="p">[</span><span class="s2">&quot;corpus_file&quot;</span><span class="p">]</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">corpus_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">corpus</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading model and corpus: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sort_and_filter_matches</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">paraphrase_pairs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">tuple</span><span class="p">],</span> <span class="n">similarity_threshold</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sort and filter the matches by similarity score.&quot;&quot;&quot;</span>

        <span class="c1"># Convert to list of tuples and sort by score</span>
        <span class="n">sorted_matches</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">paraphrase_pairs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Filter and collect paraphrases for the query, avoiding duplicates</span>
        <span class="n">query_paraphrases</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">score</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">sorted_matches</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">score</span> <span class="o">&lt;</span> <span class="n">similarity_threshold</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">paraphrase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corpus</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">corpus</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">query</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">corpus</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">paraphrase</span> <span class="o">==</span> <span class="n">query</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">paraphrase</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">query_paraphrases</span> <span class="ow">or</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="n">query_paraphrases</span><span class="p">[</span><span class="n">paraphrase</span><span class="p">]:</span>
                <span class="n">query_paraphrases</span><span class="p">[</span><span class="n">paraphrase</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span>

        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">query_paraphrases</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">model_input</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Predict method to perform paraphrase mining over the corpus.&quot;&quot;&quot;</span>

        <span class="c1"># Validate and extract the query input</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_input</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">model_input</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;DataFrame input must have exactly one column.&quot;</span><span class="p">)</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">model_input</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_input</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">model_input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;query&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The input dictionary must have a key named &#39;query&#39;.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unexpected type for model_input: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">model_input</span><span class="p">)</span><span class="si">}</span><span class="s2">. Must be either a Dict or a DataFrame.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Determine the minimum similarity threshold</span>
        <span class="n">similarity_threshold</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;similarity_threshold&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span> <span class="k">if</span> <span class="n">params</span> <span class="k">else</span> <span class="mf">0.5</span>

        <span class="c1"># Add the query to the corpus for paraphrase mining</span>
        <span class="n">extended_corpus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corpus</span> <span class="o">+</span> <span class="p">[</span><span class="n">query</span><span class="p">]</span>

        <span class="c1"># Perform paraphrase mining</span>
        <span class="n">paraphrase_pairs</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">paraphrase_mining</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">extended_corpus</span><span class="p">,</span> <span class="n">show_progress_bar</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="c1"># Convert to list of tuples and sort by score</span>
        <span class="n">sorted_paraphrases</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_and_filter_matches</span><span class="p">(</span>
            <span class="n">query</span><span class="p">,</span> <span class="n">paraphrase_pairs</span><span class="p">,</span> <span class="n">similarity_threshold</span>
        <span class="p">)</span>

        <span class="c1"># Warning if no paraphrases found</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sorted_paraphrases</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No paraphrases found above the similarity threshold.&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="n">sentence</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="nb">str</span><span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">sorted_paraphrases</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Preparing-the-Corpus-for-Paraphrase-Mining">
<h2>Preparing the Corpus for Paraphrase Mining<a class="headerlink" href="#Preparing-the-Corpus-for-Paraphrase-Mining" title="Permalink to this headline"> </a></h2>
<p>Set up the foundation for paraphrase mining by creating and preparing a diverse corpus.</p>
<div class="section" id="Corpus-Creation">
<h3>Corpus Creation<a class="headerlink" href="#Corpus-Creation" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p>Define a <code class="docutils literal notranslate"><span class="pre">corpus</span></code> comprising a range of sentences from various topics, including space exploration, AI, gardening, and more. This diversity enables the model to identify paraphrases across a broad spectrum of subjects.</p></li>
</ul>
</div>
<div class="section" id="Writing-the-Corpus-to-a-File">
<h3>Writing the Corpus to a File<a class="headerlink" href="#Writing-the-Corpus-to-a-File" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p>The corpus is saved to a file named <code class="docutils literal notranslate"><span class="pre">feedback.txt</span></code>, mirroring a common practice in large-scale data handling.</p></li>
<li><p>This step also prepares the corpus for efficient processing within the Paraphrase Mining Model.</p></li>
</ul>
</div>
<div class="section" id="Significance-of-the-Corpus">
<h3>Significance of the Corpus<a class="headerlink" href="#Significance-of-the-Corpus" title="Permalink to this headline"> </a></h3>
<p>The corpus serves as the key dataset for the model to find semantically similar sentences. Its variety ensures the model’s adaptability and effectiveness across diverse use cases.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corpus</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Exploring ancient cities in Europe offers a glimpse into history.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Modern AI technologies are revolutionizing industries.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Healthy eating contributes significantly to overall well-being.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Advancements in renewable energy are combating climate change.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Learning a new language opens doors to different cultures.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Gardening is a relaxing hobby that connects you with nature.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Blockchain technology could redefine digital transactions.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Homemade Italian pasta is a delight to cook and eat.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Practicing yoga daily improves both physical and mental health.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The art of photography captures moments in time.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Baking bread at home has become a popular quarantine activity.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Virtual reality is creating new experiences in gaming.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Sustainable travel is becoming a priority for eco-conscious tourists.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Reading books is a great way to unwind and learn.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Jazz music provides a rich tapestry of sound and rhythm.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Marathon training requires discipline and perseverance.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Studying the stars helps us understand our universe.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The rise of electric cars is an important environmental development.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Documentary films offer deep insights into real-world issues.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Crafting DIY projects can be both fun and rewarding.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The history of ancient civilizations is fascinating to explore.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Exploring the depths of the ocean reveals a world of marine wonders.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Learning to play a musical instrument can be a rewarding challenge.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Artificial intelligence is shaping the future of personalized medicine.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Cycling is not only a great workout but also eco-friendly transportation.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Home automation with IoT devices is enhancing living experiences.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Understanding quantum computing requires a grasp of complex physics.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;A well-brewed cup of coffee is the perfect start to the day.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Urban farming is gaining popularity as a sustainable food source.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Meditation and mindfulness can lead to a more balanced life.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The popularity of podcasts has revolutionized audio storytelling.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Space exploration continues to push the boundaries of human knowledge.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Wildlife conservation is essential for maintaining biodiversity.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The fusion of technology and fashion is creating new trends.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;E-learning platforms have transformed the educational landscape.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Dark chocolate has surprising health benefits when enjoyed in moderation.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Robotics in manufacturing is leading to more efficient production.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Creating a personal budget is key to financial well-being.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Hiking in nature is a great way to connect with the outdoors.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;3D printing is innovating the way we create and manufacture objects.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Sommeliers can identify a wine&#39;s characteristics with just a taste.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Mind-bending puzzles and riddles are great for cognitive exercise.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Social media has a profound impact on communication and culture.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Urban sketching captures the essence of city life on paper.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The ethics of AI is a growing field in tech philosophy.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Homemade skincare remedies are becoming more popular.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Virtual travel experiences can provide a sense of adventure at home.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Ancient mythology still influences modern storytelling and literature.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Building model kits is a hobby that requires patience and precision.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The study of languages opens windows into different worldviews.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Professional esports has become a major global phenomenon.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The mysteries of the universe are unveiled through space missions.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Astronauts&#39; experiences in space stations offer unique insights into life beyond Earth.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Telescopic observations bring distant galaxies within our view.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The study of celestial bodies helps us understand the cosmos.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Space travel advancements could lead to interplanetary exploration.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Observing celestial events provides valuable data for astronomers.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The development of powerful rockets is key to deep space exploration.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Mars rover missions are crucial in searching for extraterrestrial life.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Satellites play a vital role in our understanding of Earth&#39;s atmosphere.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Astrophysics is central to unraveling the secrets of space.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Zero gravity environments in space pose unique challenges and opportunities.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Space tourism might soon become a reality for many.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Lunar missions have contributed significantly to our knowledge of the moon.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The International Space Station is a hub for groundbreaking space research.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Studying comets and asteroids reveals information about the early solar system.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Advancements in space technology have implications for many scientific fields.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The possibility of life on other planets continues to intrigue scientists.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Black holes are among the most mysterious phenomena in space.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The history of space exploration is filled with remarkable achievements.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Future space missions could unlock the mysteries of dark matter.&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># Write out the corpus to a file</span>
<span class="n">corpus_file</span> <span class="o">=</span> <span class="s2">&quot;/tmp/feedback.txt&quot;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">corpus_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">corpus</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sentence</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Setting-Up-the-Paraphrase-Mining-Model">
<h2>Setting Up the Paraphrase Mining Model<a class="headerlink" href="#Setting-Up-the-Paraphrase-Mining-Model" title="Permalink to this headline"> </a></h2>
<p>Prepare the Sentence Transformer model for integration with MLflow to harness its paraphrase mining capabilities.</p>
<div class="section" id="Loading-the-Sentence-Transformer-Model">
<h3>Loading the Sentence Transformer Model<a class="headerlink" href="#Loading-the-Sentence-Transformer-Model" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p>Initialize the <code class="docutils literal notranslate"><span class="pre">all-MiniLM-L6-v2</span></code> Sentence Transformer model, ideal for generating sentence embeddings suitable for paraphrase mining.</p></li>
</ul>
</div>
<div class="section" id="Preparing-the-Input-Example">
<h3>Preparing the Input Example<a class="headerlink" href="#Preparing-the-Input-Example" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p>Create a DataFrame as an input example to illustrate the type of query the model will handle, aiding in defining the model’s input structure.</p></li>
</ul>
</div>
<div class="section" id="Saving-the-Model">
<h3>Saving the Model<a class="headerlink" href="#Saving-the-Model" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p>Save the model to <code class="docutils literal notranslate"><span class="pre">/tmp/paraphrase_search_model</span></code> for portability and ease of loading during deployment with MLflow.</p></li>
</ul>
</div>
<div class="section" id="Defining-Artifacts-and-Corpus-Path">
<h3>Defining Artifacts and Corpus Path<a class="headerlink" href="#Defining-Artifacts-and-Corpus-Path" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p>Specify paths to the saved model and corpus as artifacts in MLflow, crucial for model logging and reproduction.</p></li>
</ul>
</div>
<div class="section" id="Generating-Test-Output-for-Signature">
<h3>Generating Test Output for Signature<a class="headerlink" href="#Generating-Test-Output-for-Signature" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p>Generate a sample output, illustrating the model’s expected output format for paraphrase mining.</p></li>
</ul>
</div>
<div class="section" id="Creating-the-Model-Signature">
<h3>Creating the Model Signature<a class="headerlink" href="#Creating-the-Model-Signature" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p>Use MLflow’s <code class="docutils literal notranslate"><span class="pre">infer_signature</span></code> to define the model’s input and output schema, adding the <code class="docutils literal notranslate"><span class="pre">similarity_threshold</span></code> parameter for inference flexibility.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load a pre-trained sentence transformer model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s2">&quot;all-MiniLM-L6-v2&quot;</span><span class="p">)</span>

<span class="c1"># Create an input example DataFrame</span>
<span class="n">input_example</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;This product works well. I&#39;m satisfied.&quot;</span><span class="p">]})</span>

<span class="c1"># Save the model in the /tmp directory</span>
<span class="n">model_directory</span> <span class="o">=</span> <span class="s2">&quot;/tmp/paraphrase_search_model&quot;</span>
<span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model_directory</span><span class="p">)</span>

<span class="c1"># Define the path for the corpus file</span>
<span class="n">corpus_file</span> <span class="o">=</span> <span class="s2">&quot;/tmp/feedback.txt&quot;</span>

<span class="c1"># Define the artifacts (paths to the model and corpus file)</span>
<span class="n">artifacts</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;model_path&quot;</span><span class="p">:</span> <span class="n">model_directory</span><span class="p">,</span> <span class="s2">&quot;corpus_file&quot;</span><span class="p">:</span> <span class="n">corpus_file</span><span class="p">}</span>

<span class="c1"># Generate test output for signature</span>
<span class="c1"># Sample output for paraphrase mining could be a list of tuples (paraphrase, score)</span>
<span class="n">test_output</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;This product is satisfactory and functions as expected.&quot;</span><span class="p">:</span> <span class="s2">&quot;0.8&quot;</span><span class="p">}]</span>

<span class="c1"># Define the signature associated with the model</span>
<span class="c1"># The signature includes the structure of the input and the expected output, as well as any parameters that</span>
<span class="c1"># we would like to expose for overriding at inference time (including their default values if they are not overridden).</span>
<span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span>
    <span class="n">model_input</span><span class="o">=</span><span class="n">input_example</span><span class="p">,</span> <span class="n">model_output</span><span class="o">=</span><span class="n">test_output</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;similarity_threshold&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Visualize the signature, showing our overridden inference parameter and its default.</span>
<span class="n">signature</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
inputs:
  [&#39;query&#39;: string]
outputs:
  [&#39;This product is satisfactory and functions as expected.&#39;: string]
params:
  [&#39;similarity_threshold&#39;: double (default: 0.5)]
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Creating-an-experiment">
<h2>Creating an experiment<a class="headerlink" href="#Creating-an-experiment" title="Permalink to this headline"> </a></h2>
<p>We create a new MLflow Experiment so that the run we’re going to log our model to does not log to the default experiment and instead has its own contextually relevant entry.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># If you are running this tutorial in local mode, leave the next line commented out.</span>
<span class="c1"># Otherwise, uncomment the following line and set your tracking uri to your local or remote tracking server.</span>

<span class="c1"># mlflow.set_tracking_uri(&quot;http://127.0.0.1:8080&quot;)</span>

<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Paraphrase Mining&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Experiment: artifact_location=&#39;file:///Users/benjamin.wilson/repos/mlflow-fork/mlflow/docs/source/llms/sentence-transformers/tutorials/paraphrase-mining/mlruns/380691166097743403&#39;, creation_time=1701282619556, experiment_id=&#39;380691166097743403&#39;, last_update_time=1701282619556, lifecycle_stage=&#39;active&#39;, name=&#39;Paraphrase Mining&#39;, tags={}&gt;
</pre></div></div>
</div>
</div>
<div class="section" id="Logging-the-Paraphrase-Mining-Model-with-MLflow">
<h2>Logging the Paraphrase Mining Model with MLflow<a class="headerlink" href="#Logging-the-Paraphrase-Mining-Model-with-MLflow" title="Permalink to this headline"> </a></h2>
<p>Log the custom Paraphrase Mining Model with MLflow, a key step for model management and deployment.</p>
<div class="section" id="Initiating-an-MLflow-Run">
<h3>Initiating an MLflow Run<a class="headerlink" href="#Initiating-an-MLflow-Run" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p>Start an MLflow run to create a comprehensive record of model logging and tracking within the MLflow framework.</p></li>
</ul>
</div>
<div class="section" id="Logging-the-Model-in-MLflow">
<h3>Logging the Model in MLflow<a class="headerlink" href="#Logging-the-Model-in-MLflow" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p>Use MLflow’s Python model logging function to integrate the custom model into the MLflow ecosystem.</p></li>
<li><p>Provide a unique name for the model for easy identification in MLflow.</p></li>
<li><p>Log the instantiated Paraphrase Mining Model, along with an input example, model signature, artifacts, and Python dependencies.</p></li>
</ul>
</div>
<div class="section" id="Outcomes-and-Benefits-of-Model-Logging">
<h3>Outcomes and Benefits of Model Logging<a class="headerlink" href="#Outcomes-and-Benefits-of-Model-Logging" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p>Register the model within MLflow for streamlined management and deployment, enhancing its accessibility and trackability.</p></li>
<li><p>Ensure model reproducibility and version control across deployment environments.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">()</span> <span class="k">as</span> <span class="n">run</span><span class="p">:</span>
    <span class="n">model_info</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="s2">&quot;paraphrase_model&quot;</span><span class="p">,</span>
        <span class="n">python_model</span><span class="o">=</span><span class="n">ParaphraseMiningModel</span><span class="p">(),</span>
        <span class="n">input_example</span><span class="o">=</span><span class="n">input_example</span><span class="p">,</span>
        <span class="n">signature</span><span class="o">=</span><span class="n">signature</span><span class="p">,</span>
        <span class="n">artifacts</span><span class="o">=</span><span class="n">artifacts</span><span class="p">,</span>
        <span class="n">pip_requirements</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sentence_transformers&quot;</span><span class="p">],</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "1fa5a17ce9f84f628c9cee02b633222a", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2023/11/30 15:41:39 INFO mlflow.store.artifact.artifact_repo: The progress bar can be disabled by setting the environment variable MLFLOW_ENABLE_ARTIFACTS_PROGRESS_BAR to false
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e3c6e0c116f24b82a2042fab4cff52b9", "version_major": 2, "version_minor": 0}</script></div>
</div>
</div>
</div>
<div class="section" id="Model-Loading-and-Paraphrase-Mining-Prediction">
<h2>Model Loading and Paraphrase Mining Prediction<a class="headerlink" href="#Model-Loading-and-Paraphrase-Mining-Prediction" title="Permalink to this headline"> </a></h2>
<p>Illustrate the real-world application of the Paraphrase Mining Model by loading it with MLflow and executing a prediction.</p>
<div class="section" id="Loading-the-Model-for-Inference">
<h3>Loading the Model for Inference<a class="headerlink" href="#Loading-the-Model-for-Inference" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p>Utilize MLflow’s <code class="docutils literal notranslate"><span class="pre">load_model</span></code> function to retrieve and prepare the model for inference.</p></li>
<li><p>Locate and load the model using its unique URI within the MLflow registry.</p></li>
</ul>
</div>
<div class="section" id="Executing-a-Paraphrase-Mining-Prediction">
<h3>Executing a Paraphrase Mining Prediction<a class="headerlink" href="#Executing-a-Paraphrase-Mining-Prediction" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p>Make a prediction using the model’s <code class="docutils literal notranslate"><span class="pre">predict</span></code> method, applying the paraphrase mining logic embedded in the model class.</p></li>
<li><p>Pass a representative query with a set <code class="docutils literal notranslate"><span class="pre">similarity_threshold</span></code> to find matching paraphrases in the corpus.</p></li>
</ul>
</div>
<div class="section" id="Interpreting-the-Model-Output">
<h3>Interpreting the Model Output<a class="headerlink" href="#Interpreting-the-Model-Output" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p>Review the list of semantically similar sentences to the query, highlighting the model’s paraphrase identification capabilities.</p></li>
<li><p>Analyze the similarity scores to understand the degree of semantic relatedness between the query and corpus sentences.</p></li>
</ul>
</div>
<div class="section" id="Conclusion">
<h3>Conclusion<a class="headerlink" href="#Conclusion" title="Permalink to this headline"> </a></h3>
<p>This demonstration validates the Paraphrase Mining Model’s effectiveness in real-world scenarios, underscoring its utility in content recommendation, information retrieval, and conversational AI.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load our model by supplying the uri that was used to save the model artifacts</span>
<span class="n">loaded_dynamic</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">model_info</span><span class="o">.</span><span class="n">model_uri</span><span class="p">)</span>

<span class="c1"># Perform a quick validation that our loaded model is performing adequately</span>
<span class="n">loaded_dynamic</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="s2">&quot;Space exploration is fascinating.&quot;</span><span class="p">},</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;similarity_threshold&quot;</span><span class="p">:</span> <span class="mf">0.65</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Studying the stars helps us understand our universe.&#39;: &#39;0.8207424879074097&#39;,
 &#39;The history of space exploration is filled with remarkable achievements.&#39;: &#39;0.7770636677742004&#39;,
 &#39;Exploring ancient cities in Europe offers a glimpse into history.&#39;: &#39;0.7461957335472107&#39;,
 &#39;Space travel advancements could lead to interplanetary exploration.&#39;: &#39;0.7090306282043457&#39;,
 &#39;Space exploration continues to push the boundaries of human knowledge.&#39;: &#39;0.6893945932388306&#39;,
 &#39;The mysteries of the universe are unveiled through space missions.&#39;: &#39;0.6830739974975586&#39;,
 &#39;The study of celestial bodies helps us understand the cosmos.&#39;: &#39;0.671358048915863&#39;}
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Conclusion:-Insights-and-Potential-Enhancements">
<h2>Conclusion: Insights and Potential Enhancements<a class="headerlink" href="#Conclusion:-Insights-and-Potential-Enhancements" title="Permalink to this headline"> </a></h2>
<p>As we wrap up this tutorial, let’s reflect on our journey through the implementation of a Paraphrase Mining Model using Sentence Transformers and MLflow. We’ve successfully built and deployed a model capable of identifying semantically similar sentences, showcasing the flexibility and power of MLflow’s <code class="docutils literal notranslate"><span class="pre">PythonModel</span></code> implementation.</p>
<div class="section" id="Key-Takeaways">
<h3>Key Takeaways<a class="headerlink" href="#Key-Takeaways" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p>We learned how to integrate advanced NLP techniques, specifically paraphrase mining, with MLflow. This integration not only enhances model management but also simplifies deployment and scalability.</p></li>
<li><p>The flexibility of the <code class="docutils literal notranslate"><span class="pre">PythonModel</span></code> implementation in MLflow was a central theme. We saw firsthand how it allows for the incorporation of custom logic into the model’s predict function, catering to specific NLP tasks like paraphrase mining.</p></li>
<li><p>Through our custom model, we explored the dynamics of sentence embeddings, semantic similarity, and the nuances of language understanding. This understanding is crucial in a wide range of applications, from content recommendation to conversational AI.</p></li>
</ul>
</div>
<div class="section" id="Ideas-for-Enhancing-the-Paraphrase-Mining-Model">
<h3>Ideas for Enhancing the Paraphrase Mining Model<a class="headerlink" href="#Ideas-for-Enhancing-the-Paraphrase-Mining-Model" title="Permalink to this headline"> </a></h3>
<p>While our model serves as a robust starting point, there are several enhancements that could be made within the <code class="docutils literal notranslate"><span class="pre">predict</span></code> function to make it more powerful and feature-rich:</p>
<ol class="arabic simple">
<li><p><strong>Contextual Filters</strong>: Introduce filters based on contextual clues or specific keywords to refine the search results further. This feature would allow users to narrow down paraphrases to those most relevant to their particular context or subject matter.</p></li>
<li><p><strong>Sentiment Analysis Integration</strong>: Incorporate sentiment analysis to group paraphrases by their emotional tone. This would be especially useful in applications like customer feedback analysis, where understanding sentiment is as important as content.</p></li>
<li><p><strong>Multi-Lingual Support</strong>: Expand the model to support paraphrase mining in multiple languages. This enhancement would significantly broaden the model’s applicability in global or multi-lingual contexts.</p></li>
</ol>
</div>
<div class="section" id="Scalability-with-Vector-Databases">
<h3>Scalability with Vector Databases<a class="headerlink" href="#Scalability-with-Vector-Databases" title="Permalink to this headline"> </a></h3>
<ul class="simple">
<li><p>Moving beyond a static text file as a corpus, a more scalable and real-world approach would involve connecting the model to an external vector database or in-memory store.</p></li>
<li><p>Pre-calculated embeddings could be stored and updated in such databases, accommodating real-time content generation without requiring model redeployment. This approach would dramatically improve the model’s scalability and responsiveness in real-world applications.</p></li>
</ul>
</div>
<div class="section" id="Final-Thoughts">
<h3>Final Thoughts<a class="headerlink" href="#Final-Thoughts" title="Permalink to this headline"> </a></h3>
<p>The journey through building and deploying the Paraphrase Mining Model has been both enlightening and practical. We’ve seen how MLflow’s <code class="docutils literal notranslate"><span class="pre">PythonModel</span></code> offers a flexible canvas for crafting custom NLP solutions, and how sentence transformers can be leveraged to delve deep into the semantics of language.</p>
<p>This tutorial is just the beginning. There’s a vast potential for further exploration and innovation in paraphrase mining and NLP as a whole. We encourage you to build upon this foundation, experiment with enhancements, and continue pushing the boundaries of what’s possible with MLflow and advanced NLP techniques.</p>
</div>
</div>
</div>


              </div>
            </div>
            <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../quickstart/sentence-transformers-quickstart.html" class="btn btn-neutral" title="Introduction to Sentence Transformers and MLflow" accesskey="p"><span class="db-icon db-icon-chevron-left"></span> Previous</a>
      
      
        <a href="../semantic-search/semantic-search-sentence-transformers.html" class="btn btn-neutral" title="Advanced Semantic Search with Sentence Transformers and MLflow" accesskey="n">Next <span class="db-icon db-icon-chevron-right"></span></a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
      <p class="copyright">
          &copy; MLflow Project, a Series of LF Projects, LLC. All rights reserved.
      </p>

  </div> 

</footer>
          </div>
        </div>
      </section>
    </main>
  </page>

  


  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT:'../../../../',
      VERSION:'2.9.3.dev0',
      COLLAPSE_INDEX:false,
      FILE_SUFFIX:'.html',
      LINK_SUFFIX: '.html',
      HAS_SOURCE:  true
    };
  </script>

  

  <script type="text/javascript" src="../../../../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../../../../_static/js/jquery.waypoints.min.js"></script>

  
  
  
  <script type="text/javascript">var CLIPPY_SVG_PATH = "../../../../_static/clippy.svg";</script>
  <script type="text/javascript" src="../../../../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  

  
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
        }
        // Get the code block designator class entries
        const allHighlights = document.querySelectorAll('.highlight');
        // Disable copyable links for notebook cell numbering and for cell outputs
        const highlights = Array.from(allHighlights).filter(highlight => !highlight.closest('.highlight-none') && 
            !highlight.closest('.nboutput'));
    
        highlights.forEach(function(highlight) {
            const copyIcon = document.createElement('span');
            copyIcon.classList.add('copy-icon');
            copyIcon.innerHTML = '&#xf0ea;';

            copyIcon.addEventListener('click', function() {
                const code = highlight.querySelector('pre').textContent;
                copyToClipboard(code);

                // Flash effect on click
                this.style.color = '#0194E2';
                setTimeout(() => {
                    this.style.color = ''; 
                }, 100);

                // Display "Code copied to clipboard" near the clicked icon
                const message = document.createElement('span');
                message.textContent = "Copied!";
                message.classList.add('copy-message'); 

                // Append the message to the icon
                this.appendChild(message);

                setTimeout(() => {
                    this.removeChild(message);
                }, 500);
            });

            highlight.appendChild(copyIcon);
        });
    });
  </script>


<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
        // Force download for notebook-download-btn
        const downloadButtons = document.querySelectorAll('.notebook-download-btn');
        downloadButtons.forEach(function(button) {
            button.addEventListener('click', function(event) {
                event.preventDefault(); // Prevent default behavior

                // Fetch the raw content of the notebook from GitHub
                fetch(button.href)
                    .then(response => response.blob())
                    .then(blob => {
                        const url = window.URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.style.display = 'none';
                        link.href = url;
                        const filename = button.href.split('/').pop();
                        link.download = filename; 

                        document.body.appendChild(link);
                        link.click();

                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(link);
                    })
                    .catch(err => console.error('Error fetching the notebook:', err));
            });
        });
    });
</script> 
</body>
</html>